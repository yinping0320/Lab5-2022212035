/**
 * @fileoverview added by tsickle
 * Generated from: lib/ubcc-param-data-ui-dialog/ubcc-param-data-ui-dialog.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, Input, TemplateRef, ViewChild } from '@angular/core';
import { UbccParamTemplate, UbccParamTemplateSerializer } from '@gsp-cmp/ubcc-param-vo';
import { UbccParamDataManangerService } from '../service/http-service';
import { DataTypeConst } from '@ecp-caf/common-structure';
import { UbccParamDataUtils } from '../utils/param-data-utils';
export class UbccParamDataUiDialogComponent {
    /**
     * @param {?} utils
     * @param {?} http
     */
    constructor(utils, http) {
        this.utils = utils;
        this.http = http;
        this.paramDataItems = [];
        this.confirmEmitter = new EventEmitter();
        this.closeEmitter = new EventEmitter();
        this.close = (/**
         * @return {?}
         */
        () => {
            if (this.dialog) {
                this.dialog.close();
            }
            this.closeEmitter.emit();
        });
    }
    /**
     * 输入数据为JSON对象
     * @param {?} data
     * @return {?}
     */
    set data(data) {
        this._data = data;
        this.loadParamData(this.templateId);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.template = this.template || new UbccParamTemplate();
    }
    /**
     * @private
     * @param {?} templateId
     * @return {?}
     */
    loadParamData(templateId) {
        if (!templateId) {
            return;
        }
        this.http.getParamTemplate(templateId).subscribe((/**
         * @param {?} vo
         * @return {?}
         */
        (vo) => {
            if (!vo.content) {
                return;
            }
            /** @type {?} */
            let serializer = new UbccParamTemplateSerializer();
            this.template = serializer.deserializer(JSON.parse(vo.content));
            this.getParamDataItemsStructure();
            this.convertJsonToParamData();
        }));
    }
    /**
     * @private
     * @return {?}
     */
    convertJsonToParamData() {
        if (!this._data || Object.keys(this._data).length <= 0) {
            return;
        }
        this.paramDataItems.map((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            /** @type {?} */
            let key = Object.keys(this._data).find((/**
             * @param {?} x
             * @return {?}
             */
            x => x === item.code));
            if (!key || !this._data[key]) {
                return;
            }
            if (this.isCollection(item)) {
                //参数的值如果是数组，以逗号隔开
                item.value = this._data[key].join(',');
                if (!this.utils.isHelpType(item.parameterType)) {
                    return;
                }
                /** @type {?} */
                let helpId = ((/** @type {?} */ (this.utils.getCollectionElementType(item.parameterType)))).refId;
                this.http.getHelpData(helpId, this._data[key]).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                (result) => {
                    if (!result || result.length <= 0) {
                        return;
                    }
                    /** @type {?} */
                    let values = [];
                    result.map((/**
                     * @param {?} resItem
                     * @return {?}
                     */
                    resItem => values.push(resItem.text)));
                    item.valueText = values.join(',');
                }));
            }
            else {
                item.value = this._data[key];
                if (item.parameterTypeDesc !== 'help') {
                    return;
                }
                /** @type {?} */
                let helpId = ((/** @type {?} */ (item.parameterType))).refId;
                this.http.getHelpData(helpId, [item.value]).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                (result) => {
                    if (!result || result.length <= 0) {
                        return;
                    }
                    item.valueText = result[0].text;
                }));
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    getParamDataItemsStructure() {
        if (!this.template || !this.template.params) {
            return;
        }
        this.paramDataItems = [];
        this.template.params.map((/**
         * @param {?} x
         * @return {?}
         */
        x => this.paramDataItems.push(x)));
    }
    /**
     * @private
     * @return {?}
     */
    covertParamDataToJson() {
        if (!this.paramDataItems || this.paramDataItems.length <= 0) {
            return null;
        }
        /** @type {?} */
        let object = new Object();
        this.paramDataItems.map((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            if (this.isCollection(item)) {
                object[item.code] = [];
                /** @type {?} */
                let itemValues = item.value.split(',');
                if (!itemValues || itemValues.length <= 0) {
                    return;
                }
                itemValues.map((/**
                 * @param {?} itemValue
                 * @return {?}
                 */
                itemValue => object[item.code].push(itemValue)));
                //帮助name赋值
                if (item.parameterTypeDesc === 'help') {
                    object[`${item.code}_name`] = [];
                    /** @type {?} */
                    let itemTextValues = item.valueText.split(',');
                    if (!itemTextValues || itemTextValues.length <= 0) {
                        return;
                    }
                    itemTextValues.map((/**
                     * @param {?} itemTextValue
                     * @return {?}
                     */
                    itemTextValue => object[`${item.code}_name`].push(itemTextValue)));
                }
            }
            else {
                object[item.code] = item.value;
                //帮助name赋值
                if (item.parameterTypeDesc === 'help') {
                    object[`${item.code}_name`] = item.valueText;
                }
            }
        }));
        return object;
    }
    /**
     * @return {?}
     */
    confirm() {
        /** @type {?} */
        let jsonData = this.covertParamDataToJson();
        this.confirmEmitter.emit(jsonData);
    }
    /**
     * @private
     * @param {?} param
     * @return {?}
     */
    isCollection(param) {
        if (!param || !param.parameterType) {
            return false;
        }
        if (param.parameterType.getKind() === DataTypeConst.DEFAULT_COLLECTION) {
            return true;
        }
        else {
            return false;
        }
    }
}
UbccParamDataUiDialogComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-ubcc-param-data-ui-dialog',
                template: "<div class=\"d-flex\" style=\"position: absolute;top: 0;bottom: 0;left: 0;right: 0;padding: 0px 8px 0px 8px;\">\n  <lib-ubcc-param-data-ui class=\"f-utils-fill\" [(template)]=\"template\" [(paramDataItems)]=\"paramDataItems\"  style=\"overflow-y: auto;\"></lib-ubcc-param-data-ui>\n</div>\n\n<ng-template #btnRef>\n  <div style=\"width: 100%;line-height: 50px; text-align: center;min-width: 140px;\">\n    <button class=\"btn btn-primary\" (click)=confirm() style=\"float:right;margin-right: 5px\">\u786E\u5B9A</button>\n    <button class=\"btn btn-secondary\" (click)=close() style=\"float:right;margin-right: 5px\">\u5173\u95ED</button>\n  </div>\n</ng-template>",
                styles: [":host{display:flex;flex-direction:column;flex:1}"]
            }] }
];
/** @nocollapse */
UbccParamDataUiDialogComponent.ctorParameters = () => [
    { type: UbccParamDataUtils },
    { type: UbccParamDataManangerService }
];
UbccParamDataUiDialogComponent.propDecorators = {
    templateId: [{ type: Input }],
    data: [{ type: Input }],
    confirmEmitter: [{ type: Output }],
    closeEmitter: [{ type: Output }],
    btnRef: [{ type: ViewChild, args: ['btnRef',] }]
};
if (false) {
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.template;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype._data;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.templateId;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.paramDataItems;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.confirmEmitter;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.closeEmitter;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.btnRef;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.dialog;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.close;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiDialogComponent.prototype.utils;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiDialogComponent.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWJjYy1wYXJhbS1kYXRhLXVpLWRpYWxvZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWNtcC91YmNjLXBhcmFtLWRhdGEtdWkvIiwic291cmNlcyI6WyJsaWIvdWJjYy1wYXJhbS1kYXRhLXVpLWRpYWxvZy91YmNjLXBhcmFtLWRhdGEtdWktZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQUUsaUJBQWlCLEVBQXVCLDJCQUEyQixFQUFvQixNQUFNLHdCQUF3QixDQUFDO0FBRS9ILE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3ZFLE9BQU8sRUFBYSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUdyRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQU8vRCxNQUFNLE9BQU8sOEJBQThCOzs7OztJQTBCdkMsWUFDWSxLQUF3QixFQUN4QixJQUFrQztRQURsQyxVQUFLLEdBQUwsS0FBSyxDQUFtQjtRQUN4QixTQUFJLEdBQUosSUFBSSxDQUE4QjtRQVo5QyxtQkFBYyxHQUFxQixFQUFFLENBQUM7UUFFNUIsbUJBQWMsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUU1RCxpQkFBWSxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBc0hwRSxVQUFLOzs7UUFBRyxHQUFHLEVBQUU7WUFDVCxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUN2QjtZQUNELElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDN0IsQ0FBQyxFQUFBO0lBbkhpRCxDQUFDOzs7Ozs7SUFq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dHRlciwgSW5wdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFViY2NQYXJhbVRlbXBsYXRlLCBVYmNjUGFyYW1UZW1wbGF0ZVZvLCBVYmNjUGFyYW1UZW1wbGF0ZVNlcmlhbGl6ZXIsIFN0cnVjdHVyZVR5cGVSZWYgfSBmcm9tICdAZ3NwLWNtcC91YmNjLXBhcmFtLXZvJztcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcbmltcG9ydCB7IFViY2NQYXJhbURhdGFNYW5hbmdlclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2h0dHAtc2VydmljZSc7XG5pbXBvcnQgeyBQYXJhbWV0ZXIsIERhdGFUeXBlQ29uc3QgfSBmcm9tICdAZWNwLWNhZi9jb21tb24tc3RydWN0dXJlJztcbmltcG9ydCB7IEJhc2VQYXJhbURhdGEgfSBmcm9tICcuLi9jb21tb24vcGFyYW1ldGVyLWRhdGEvYmFzZS1wYXJhbS1kYXRhJztcbmltcG9ydCB7IEhlbHBEYXRhSXRlbSB9IGZyb20gJy4uL2NvbW1vbi9oZWxwLWRhdGEtaXRlbS9oZWxwLWRhdGEtaXRlbSc7XG5pbXBvcnQgeyBVYmNjUGFyYW1EYXRhVXRpbHMgfSBmcm9tICcuLi91dGlscy9wYXJhbS1kYXRhLXV0aWxzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsaWItdWJjYy1wYXJhbS1kYXRhLXVpLWRpYWxvZycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3ViY2MtcGFyYW0tZGF0YS11aS1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3ViY2MtcGFyYW0tZGF0YS11aS1kaWFsb2cuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFViY2NQYXJhbURhdGFVaURpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICB0ZW1wbGF0ZTogVWJjY1BhcmFtVGVtcGxhdGU7XG5cbiAgICBfZGF0YTogYW55O1xuXG4gICAgQElucHV0KCkgdGVtcGxhdGVJZDogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICog6L6T5YWl5pWw5o2u5Li6SlNPTuWvueixoVxuICAgICAqL1xuICAgIEBJbnB1dCgpIHNldCBkYXRhKGRhdGE6IGFueSkge1xuICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy5sb2FkUGFyYW1EYXRhKHRoaXMudGVtcGxhdGVJZCk7XG4gICAgfVxuXG4gICAgcGFyYW1EYXRhSXRlbXM6IEFycmF5PFBhcmFtZXRlcj4gPSBbXTtcblxuICAgIEBPdXRwdXQoKSBjb25maXJtRW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBPdXRwdXQoKSBjbG9zZUVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBAVmlld0NoaWxkKCdidG5SZWYnKSBidG5SZWY6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBkaWFsb2c6IEJzTW9kYWxSZWY7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSB1dGlsczpVYmNjUGFyYW1EYXRhVXRpbHMsXG4gICAgICAgIHByaXZhdGUgaHR0cDogVWJjY1BhcmFtRGF0YU1hbmFuZ2VyU2VydmljZSkgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGUgfHwgbmV3IFViY2NQYXJhbVRlbXBsYXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBsb2FkUGFyYW1EYXRhKHRlbXBsYXRlSWQ6IHN0cmluZykge1xuICAgICAgICBpZiAoIXRlbXBsYXRlSWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmh0dHAuZ2V0UGFyYW1UZW1wbGF0ZSh0ZW1wbGF0ZUlkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAodm86IFViY2NQYXJhbVRlbXBsYXRlVm8pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXZvLmNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgc2VyaWFsaXplciA9IG5ldyBVYmNjUGFyYW1UZW1wbGF0ZVNlcmlhbGl6ZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gc2VyaWFsaXplci5kZXNlcmlhbGl6ZXIoSlNPTi5wYXJzZSh2by5jb250ZW50KSk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRQYXJhbURhdGFJdGVtc1N0cnVjdHVyZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udmVydEpzb25Ub1BhcmFtRGF0YSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb252ZXJ0SnNvblRvUGFyYW1EYXRhKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RhdGEgfHwgT2JqZWN0LmtleXModGhpcy5fZGF0YSkubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zLm1hcCgoaXRlbTogQmFzZVBhcmFtRGF0YSkgPT4ge1xuICAgICAgICAgICAgbGV0IGtleSA9IE9iamVjdC5rZXlzKHRoaXMuX2RhdGEpLmZpbmQoeCA9PiB4ID09PSBpdGVtLmNvZGUpO1xuICAgICAgICAgICAgaWYgKCFrZXkgfHwgIXRoaXMuX2RhdGFba2V5XSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ29sbGVjdGlvbihpdGVtKSkge1xuICAgICAgICAgICAgICAgIC8v5Y+C5pWw55qE5YC85aaC5p6c5piv5pWw57uE77yM5Lul6YCX5Y+36ZqU5byAXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZSA9IHRoaXMuX2RhdGFba2V5XS5qb2luKCcsJyk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnV0aWxzLmlzSGVscFR5cGUoaXRlbS5wYXJhbWV0ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBoZWxwSWQgPSAodGhpcy51dGlscy5nZXRDb2xsZWN0aW9uRWxlbWVudFR5cGUoaXRlbS5wYXJhbWV0ZXJUeXBlKSBhcyBTdHJ1Y3R1cmVUeXBlUmVmKS5yZWZJZDtcbiAgICAgICAgICAgICAgICB0aGlzLmh0dHAuZ2V0SGVscERhdGEoaGVscElkLCB0aGlzLl9kYXRhW2tleV0pLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgKHJlc3VsdDogQXJyYXk8SGVscERhdGFJdGVtPikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm1hcChyZXNJdGVtID0+IHZhbHVlcy5wdXNoKHJlc0l0ZW0udGV4dCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS52YWx1ZVRleHQgPSB2YWx1ZXMuam9pbignLCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZSA9IHRoaXMuX2RhdGFba2V5XTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5wYXJhbWV0ZXJUeXBlRGVzYyAhPT0gJ2hlbHAnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGhlbHBJZCA9IChpdGVtLnBhcmFtZXRlclR5cGUgYXMgU3RydWN0dXJlVHlwZVJlZikucmVmSWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5odHRwLmdldEhlbHBEYXRhKGhlbHBJZCwgW2l0ZW0udmFsdWVdKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChyZXN1bHQ6IEFycmF5PEhlbHBEYXRhSXRlbT4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWVUZXh0ID0gcmVzdWx0WzBdLnRleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQYXJhbURhdGFJdGVtc1N0cnVjdHVyZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnRlbXBsYXRlIHx8ICF0aGlzLnRlbXBsYXRlLnBhcmFtcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZS5wYXJhbXMubWFwKHggPT4gdGhpcy5wYXJhbURhdGFJdGVtcy5wdXNoKHgpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvdmVydFBhcmFtRGF0YVRvSnNvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBhcmFtRGF0YUl0ZW1zIHx8IHRoaXMucGFyYW1EYXRhSXRlbXMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCBvYmplY3QgPSBuZXcgT2JqZWN0KCk7XG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXMubWFwKChpdGVtOiBCYXNlUGFyYW1EYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NvbGxlY3Rpb24oaXRlbSkpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RbaXRlbS5jb2RlXSA9IFtdO1xuICAgICAgICAgICAgICAgIGxldCBpdGVtVmFsdWVzID0gaXRlbS52YWx1ZS5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgIGlmICghaXRlbVZhbHVlcyB8fCBpdGVtVmFsdWVzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaXRlbVZhbHVlcy5tYXAoaXRlbVZhbHVlID0+IG9iamVjdFtpdGVtLmNvZGVdLnB1c2goaXRlbVZhbHVlKSk7XG4gICAgICAgICAgICAgICAgLy/luK7liqluYW1l6LWL5YC8XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucGFyYW1ldGVyVHlwZURlc2MgPT09ICdoZWxwJykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RbYCR7aXRlbS5jb2RlfV9uYW1lYF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW1UZXh0VmFsdWVzID0gaXRlbS52YWx1ZVRleHQuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtVGV4dFZhbHVlcyB8fCBpdGVtVGV4dFZhbHVlcy5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1UZXh0VmFsdWVzLm1hcChpdGVtVGV4dFZhbHVlID0+IG9iamVjdFtgJHtpdGVtLmNvZGV9X25hbWVgXS5wdXNoKGl0ZW1UZXh0VmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmplY3RbaXRlbS5jb2RlXSA9IGl0ZW0udmFsdWU7XG4gICAgICAgICAgICAgICAgLy/luK7liqluYW1l6LWL5YC8XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucGFyYW1ldGVyVHlwZURlc2MgPT09ICdoZWxwJykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RbYCR7aXRlbS5jb2RlfV9uYW1lYF0gPSBpdGVtLnZhbHVlVGV4dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgY2xvc2UgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZykge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsb3NlRW1pdHRlci5lbWl0KCk7XG4gICAgfVxuXG4gICAgY29uZmlybSgpIHtcbiAgICAgICAgbGV0IGpzb25EYXRhID0gdGhpcy5jb3ZlcnRQYXJhbURhdGFUb0pzb24oKTtcbiAgICAgICAgdGhpcy5jb25maXJtRW1pdHRlci5lbWl0KGpzb25EYXRhKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQ29sbGVjdGlvbihwYXJhbTogYW55KSB7XG4gICAgICAgIGlmICghcGFyYW0gfHwgIXBhcmFtLnBhcmFtZXRlclR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyYW0ucGFyYW1ldGVyVHlwZS5nZXRLaW5kKCkgPT09IERhdGFUeXBlQ29uc3QuREVGQVVMVF9DT0xMRUNUSU9OKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxufVxuIl19
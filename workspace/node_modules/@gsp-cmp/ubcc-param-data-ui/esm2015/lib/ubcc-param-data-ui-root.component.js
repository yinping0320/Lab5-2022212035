/**
 * @fileoverview added by tsickle
 * Generated from: lib/ubcc-param-data-ui-root.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ViewContainerRef, ComponentFactoryResolver } from '@angular/core';
import { UbccParamTemplate, UbccParamTemplateAssignment, UbccParamTemplateSerializer, DataItem, DataTypeExtensionConst, StructureTypeRefEnum, UbccParamTemplateAssignmentSerializer } from '@gsp-cmp/ubcc-param-vo';
import { UbccParamDataManangerService } from './service/http-service';
import { UbccParamDataUiComponent } from './ubcc-param-data-ui/ubcc-param-data-ui.component';
import { UbccParamDimensionUiRootComponent } from './ubcc-param-dimension-ui-root/ubcc-param-dimension-ui-root.component';
import { DataTypeConst, PrimitiveTypeKind } from '@ecp-caf/common-structure';
import { UbccEventBusService } from './service/event-bus-service';
import { UbccParamDataUtils } from './utils/param-data-utils';
export class UbccParamDataUiRootComponent {
    /**
     * @param {?} utils
     * @param {?} ebsService
     * @param {?} http
     * @param {?} resolver
     */
    constructor(utils, ebsService, http, resolver) {
        this.utils = utils;
        this.ebsService = ebsService;
        this.http = http;
        this.resolver = resolver;
        this._canEdit = true;
        this.dimensionItemDatas = [];
        this.paramDataItems = [];
        this.paramDataItemsClone = [];
        this.templateSerializer = new UbccParamTemplateSerializer();
        this.assignmentSerializer = new UbccParamTemplateAssignmentSerializer();
        this.ebsService.ebs.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            this.loadDimensionDataFromRemote();
        }));
    }
    /**
     * @param {?} assignment
     * @return {?}
     */
    set assignment(assignment) {
        this._assignment = assignment;
        this.loadData();
    }
    /**
     * @param {?} canEdit
     * @return {?}
     */
    set canEdit(canEdit) {
        this._canEdit = canEdit;
        if (this.currentInstance) {
            this.currentInstance.canEdit = this._canEdit;
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this._assignment = this._assignment || new UbccParamTemplateAssignment();
        this.template = this.template || new UbccParamTemplate();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.paramDataPanel.clear();
    }
    /**
     * @private
     * @return {?}
     */
    loadData() {
        //参数,维度数据源初始化
        this.dimensionItemDatas = [];
        this.paramDataItems = [];
        this.paramDataItemsClone = [];
        if (!this._assignment || !this._assignment.templateId) {
            return;
        }
        this.http.getParamTemplate(this._assignment.templateId).subscribe((/**
         * @param {?} vo
         * @return {?}
         */
        (vo) => {
            if (!vo || !vo.content) {
                return;
            }
            /** @type {?} */
            let serializer = new UbccParamTemplateSerializer();
            this.template = serializer.deserializer(JSON.parse(vo.content));
            this.load();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        err => {
            throw err;
        }));
    }
    /**
     * @private
     * @return {?}
     */
    load() {
        //参数结构初始化，参数值为空
        this.paramDataItemsInit();
        //根据维度创建对应的UI组件
        if (this._assignment.useDimension) {
            //维度结构初始化，维度数据为空
            this.dimensionDataItemsInit();
            //创建维度UI组件，此处不取数，只渲染界面，在选择维度数据后再加载数据
            this.createDimensionRootUiComponent();
        }
        else {
            this.http.getParamData(this._assignment.templateId, this._assignment.bizTypeId).subscribe((/**
             * @param {?} dataItems
             * @return {?}
             */
            (dataItems) => {
                this.getParamValues(dataItems);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            err => {
                throw err;
            }));
            //创建参数UI组件
            this.createParamDataUiComponent();
        }
    }
    /**
     * @private
     * @param {?} dataItems
     * @return {?}
     */
    getParamValues(dataItems) {
        if (!dataItems || dataItems.length <= 0) {
            return;
        }
        this.paramDataItems.map((/**
         * @param {?} paramDataItem
         * @return {?}
         */
        (paramDataItem) => {
            /** @type {?} */
            let data = dataItems.find((/**
             * @param {?} item
             * @return {?}
             */
            item => item.dataCode === paramDataItem.code));
            if (data) {
                paramDataItem.value = data.dataValue;
                if (!this.utils.isHelpType(paramDataItem.parameterType)) {
                    return;
                }
                paramDataItem.valueText = data.dataValueText || '';
                // 从前端获取帮助数据
                // this.getHelpData(data,paramDataItem);
            }
        }));
        this.paramValuesClone(this.paramDataItemsClone, this.paramDataItems);
    }
    /**
     * @private
     * @param {?} target
     * @param {?} source
     * @return {?}
     */
    paramValuesClone(target, source) {
        if (source.length == 0 || target.length == 0 || target.length !== source.length) {
            return;
        }
        target.map((/**
         * @param {?} paramDataItemClone
         * @return {?}
         */
        paramDataItemClone => {
            /** @type {?} */
            let index = source.findIndex((/**
             * @param {?} x
             * @return {?}
             */
            x => x.code === paramDataItemClone.code));
            if (index !== (-1)) {
                paramDataItemClone.id = source[index].id;
                paramDataItemClone.value = source[index].value;
                paramDataItemClone.valueText = source[index].valueText;
            }
        }));
    }
    /**
     * @private
     * @return {?}
     */
    loadDimensionDataFromRemote() {
        this.paramDataItemsInit();
        this.currentInstance.paramDataItems = this.paramDataItems;
        /** @type {?} */
        let dimensionItemValues = [];
        this.dimensionItemDatas.map((/**
         * @param {?} x
         * @return {?}
         */
        (x) => dimensionItemValues.push(x.value)));
        /** @type {?} */
        let count = dimensionItemValues.length;
        if (count <= 0) {
            return;
        }
        if (count === 1) {
            if (!dimensionItemValues[0]) {
                return;
            }
        }
        if (count === 2) {
            if (!dimensionItemValues[0] || !dimensionItemValues[1]) {
                return;
            }
        }
        /** @type {?} */
        let dimension1 = dimensionItemValues[0] ? dimensionItemValues[0] : null;
        /** @type {?} */
        let dimension2 = dimensionItemValues[1] ? dimensionItemValues[1] : null;
        this.http.getDimensionData(this._assignment.templateId, this._assignment.bizTypeId, dimension1, dimension2, count).subscribe((/**
         * @param {?} dataItems
         * @return {?}
         */
        (dataItems) => {
            this.getParamValues(dataItems);
        }));
    }
    /**
     * @private
     * @return {?}
     */
    paramDataItemsInit() {
        /** @type {?} */
        let template = this.templateSerializer.deserializer(this.templateSerializer.serialize(this.template));
        this.paramDataItems = [];
        if (template && template.params) {
            template.params.map((/**
             * @param {?} x
             * @return {?}
             */
            x => {
                if (this._assignment.useDimension) {
                    this.dimensionParamDefaultValueInit((/** @type {?} */ (x)));
                }
                else {
                    ((/** @type {?} */ (x))).value = x.defaultValue;
                }
                this.paramDataItems.push(x);
            }));
        }
        this.paramDataItemsCloneInit();
    }
    /**
     * @private
     * @param {?} paramData
     * @return {?}
     */
    dimensionParamDefaultValueInit(paramData) {
        /** @type {?} */
        let count = this.dimensionItemDatas.length;
        if (count <= 0) {
            return;
        }
        if (count === 1) {
            if (!this.dimensionItemDatas[0] || !this.dimensionItemDatas[0].value) {
                return;
            }
        }
        if (count === 2) {
            if (!this.dimensionItemDatas[0] || !this.dimensionItemDatas[1] || !this.dimensionItemDatas[0].value || !this.dimensionItemDatas[1].value) {
                return;
            }
        }
        paramData.value = paramData.defaultValue;
    }
    /**
     * @private
     * @return {?}
     */
    paramDataItemsCloneInit() {
        /** @type {?} */
        let template = this.templateSerializer.deserializer(this.templateSerializer.serialize(this.template));
        this.paramDataItemsClone = [];
        if (template && template.params) {
            template.params.map((/**
             * @param {?} x
             * @return {?}
             */
            x => {
                if (this._assignment.useDimension) {
                    this.dimensionParamDefaultValueInit((/** @type {?} */ (x)));
                }
                else {
                    ((/** @type {?} */ (x))).value = x.defaultValue;
                }
                this.paramDataItemsClone.push(x);
            }));
        }
    }
    /**
     * @private
     * @return {?}
     */
    dimensionDataItemsInit() {
        /** @type {?} */
        let assignment = this.assignmentSerializer.deserialize(this.assignmentSerializer.serialize(this._assignment));
        if (assignment && assignment.dimensionInfo
            && assignment.dimensionInfo.definition
            && assignment.dimensionInfo.definition.dimensionItems) {
            this.dimensionItemDatas = [];
            assignment.dimensionInfo.definition.dimensionItems.forEach((/**
             * @param {?} dimensionData
             * @return {?}
             */
            dimensionData => {
                this.dimensionItemDatas.push((/** @type {?} */ (dimensionData)));
            }));
        }
    }
    /**
     * @private
     * @return {?}
     */
    createParamDataUiComponent() {
        this.paramDataPanel.clear();
        /** @type {?} */
        const factory = this.resolver.resolveComponentFactory(UbccParamDataUiComponent);
        /** @type {?} */
        let cmpRef = this.paramDataPanel.createComponent(factory);
        cmpRef.instance.canEdit = this.canEdit;
        cmpRef.instance.template = this.template;
        cmpRef.instance.paramDataItems = this.paramDataItems;
        this.currentInstance = cmpRef.instance;
    }
    /**
     * @private
     * @return {?}
     */
    createDimensionRootUiComponent() {
        this.paramDataPanel.clear();
        /** @type {?} */
        const factory = this.resolver.resolveComponentFactory(UbccParamDimensionUiRootComponent);
        /** @type {?} */
        let cmpRef = this.paramDataPanel.createComponent(factory);
        cmpRef.instance.canEdit = this.canEdit;
        cmpRef.instance.dimensionItemDatas = this.dimensionItemDatas;
        cmpRef.instance.paramDataItems = this.paramDataItems;
        cmpRef.instance.template = this.template;
        this.currentInstance = cmpRef.instance;
    }
    /**
     * @return {?}
     */
    convertDimensionDataToDataVo() {
        if (!this.dimensionItemDatas) {
            return null;
        }
        /** @type {?} */
        let dimensionValues = new Array();
        this.dimensionItemDatas.map((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            let dimensionValue = new DataItem();
            dimensionValue.dataCode = x.code;
            dimensionValue.dataValue = ((/** @type {?} */ (x))).value;
            dimensionValue.dataType = this.getDimensionValueType(x.dataType);
            dimensionValues.push(dimensionValue);
        }));
        return dimensionValues;
    }
    /**
     * @return {?}
     */
    convertParamDataToDataVo() {
        if (!this.paramDataItems) {
            return null;
        }
        /** @type {?} */
        let paramValues = new Array();
        this.paramDataItems.map((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            /** @type {?} */
            let paramValue = new DataItem();
            paramValue.dataCode = x.code;
            paramValue.dataValue = ((/** @type {?} */ (x))).value;
            paramValue.dataType = this.getParamValueType(((/** @type {?} */ (x))).parameterType);
            paramValues.push(paramValue);
        }));
        this.paramValuesClone(this.paramDataItemsClone, this.paramDataItems);
        return paramValues;
    }
    /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    getDimensionValueType(dataType) {
        /** @type {?} */
        let kind = dataType.getKind();
        switch (kind) {
            case DataTypeConst.DEFAULT_PRIMITIVE:
                return `${DataTypeConst.DEFAULT_PRIMITIVE}.${((/** @type {?} */ (dataType))).primitiveTypeKind}`;
            case DataTypeConst.DEFAULT_ENUMERATION:
                return DataTypeConst.DEFAULT_ENUMERATION;
            case DataTypeExtensionConst.HELP_TYPE:
                return DataTypeExtensionConst.HELP_TYPE + `##${((/** @type {?} */ (dataType))).helpId}`;
            default:
                throw new Error(`业务参数不支持的参数类型${kind}`);
        }
    }
    /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    getParamValueType(dataType) {
        /** @type {?} */
        let kind = dataType.getKind();
        switch (kind) {
            case DataTypeConst.DEFAULT_COLLECTION:
                /** @type {?} */
                let elemetType = ((/** @type {?} */ (dataType))).elementType;
                return `${DataTypeConst.DEFAULT_COLLECTION}.` + this.getParamValueType(elemetType);
            case DataTypeConst.DEFAULT_PRIMITIVE:
                return `${DataTypeConst.DEFAULT_PRIMITIVE}.${PrimitiveTypeKind[((/** @type {?} */ (dataType))).primitiveTypeKind]}`;
            case DataTypeExtensionConst.UBCC_STRUCTURE_TYPE_REF:
                /** @type {?} */
                let refType = (/** @type {?} */ (dataType));
                return refType.type === StructureTypeRefEnum.HELP ? DataTypeExtensionConst.HELP_TYPE + `##${refType.refId}` : DataTypeConst.DEFAULT_ENUMERATION;
            default:
                throw new Error(`业务参数不支持的参数类型${kind}`);
        }
    }
    /**
     * @return {?}
     */
    cancel() {
        this.paramValuesClone(this.paramDataItems, this.paramDataItemsClone);
        this.currentInstance.paramDataItems = this.paramDataItems;
    }
}
UbccParamDataUiRootComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-ubcc-param-data-ui-root',
                template: "<div class=\"col-12\">\r\n    <ng-template #paramDataPanel></ng-template>\r\n    <!-- <lib-ubcc-param-data-ui *ngIf=\"show()=='paramUi'\"\r\n        [canEdit]=\"canEdit\" \r\n        [(template)]=\"template\" \r\n        [(paramDataItems)]=\"paramDataItems\">\r\n    </lib-ubcc-param-data-ui>\r\n    <lib-ubcc-param-dimension-ui-root  *ngIf=\"show()=='dimensionUi'\"\r\n        [canEdit]=\"canEdit\" \r\n        [(template)]=\"template\" \r\n        [(paramDataItems)]=\"paramDataItems\" \r\n        [(dimensionItemDatas)]=\"dimensionItemDatas\">\r\n    </lib-ubcc-param-dimension-ui-root> -->\r\n</div>",
                providers: [UbccEventBusService],
                styles: [":host{display:flex;flex-direction:column;flex:1}"]
            }] }
];
/** @nocollapse */
UbccParamDataUiRootComponent.ctorParameters = () => [
    { type: UbccParamDataUtils },
    { type: UbccEventBusService },
    { type: UbccParamDataManangerService },
    { type: ComponentFactoryResolver }
];
UbccParamDataUiRootComponent.propDecorators = {
    assignment: [{ type: Input }],
    canEdit: [{ type: Input }],
    paramDataPanel: [{ type: ViewChild, args: ['paramDataPanel', { read: ViewContainerRef },] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype._assignment;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype._canEdit;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.template;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.dimensionItemDatas;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.paramDataItems;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.paramDataItemsClone;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.currentInstance;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.templateSerializer;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.assignmentSerializer;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.paramDataPanel;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.utils;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.ebsService;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWJjYy1wYXJhbS1kYXRhLXVpLXJvb3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1jbXAvdWJjYy1wYXJhbS1kYXRhLXVpLyIsInNvdXJjZXMiOlsibGliL3ViY2MtcGFyYW0tZGF0YS11aS1yb290LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBYSx3QkFBd0IsRUFBcUMsTUFBTSxlQUFlLENBQUM7QUFDOUosT0FBTyxFQUFFLGlCQUFpQixFQUFFLDJCQUEyQixFQUF1QiwyQkFBMkIsRUFBRSxRQUFRLEVBQUUsc0JBQXNCLEVBQThCLG9CQUFvQixFQUFFLHFDQUFxQyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDclEsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sbURBQW1ELENBQUM7QUFDN0YsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sdUVBQXVFLENBQUM7QUFDMUgsT0FBTyxFQUFhLGFBQWEsRUFBNEMsaUJBQWlCLEVBQVksTUFBTSwyQkFBMkIsQ0FBQztBQUc1SSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQVE5RCxNQUFNLE9BQU8sNEJBQTRCOzs7Ozs7O0lBa0NyQyxZQUNZLEtBQXdCLEVBQ3hCLFVBQStCLEVBQy9CLElBQWtDLEVBQ2xDLFFBQWtDO1FBSGxDLFVBQUssR0FBTCxLQUFLLENBQW1CO1FBQ3hCLGVBQVUsR0FBVixVQUFVLENBQXFCO1FBQy9CLFNBQUksR0FBSixJQUFJLENBQThCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBN0I5QyxhQUFRLEdBQVMsSUFBSSxDQUFDO1FBV3RCLHVC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b21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIFZpZXdDaGlsZCwgVmlld0NvbnRhaW5lclJlZiwgT25EZXN0cm95LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENoYW5nZURldGVjdG9yUmVmLCBUeXBlLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBVYmNjUGFyYW1UZW1wbGF0ZSwgVWJjY1BhcmFtVGVtcGxhdGVBc3NpZ25tZW50LCBVYmNjUGFyYW1UZW1wbGF0ZVZvLCBVYmNjUGFyYW1UZW1wbGF0ZVNlcmlhbGl6ZXIsIERhdGFJdGVtLCBEYXRhVHlwZUV4dGVuc2lvbkNvbnN0LCBTdHJ1Y3R1cmVUeXBlUmVmLCBIZWxwVHlwZSwgU3RydWN0dXJlVHlwZVJlZkVudW0sIFViY2NQYXJhbVRlbXBsYXRlQXNzaWdubWVudFNlcmlhbGl6ZXIgfSBmcm9tICdAZ3NwLWNtcC91YmNjLXBhcmFtLXZvJztcclxuaW1wb3J0IHsgVWJjY1BhcmFtRGF0YU1hbmFuZ2VyU2VydmljZSB9IGZyb20gJy4vc2VydmljZS9odHRwLXNlcnZpY2UnO1xyXG5pbXBvcnQgeyBVYmNjUGFyYW1EYXRhVWlDb21wb25lbnQgfSBmcm9tICcuL3ViY2MtcGFyYW0tZGF0YS11aS91YmNjLXBhcmFtLWRhdGEtdWkuY29tcG9uZW50JztcclxuaW1wb3J0IHsgVWJjY1BhcmFtRGltZW5zaW9uVWlSb290Q29tcG9uZW50IH0gZnJvbSAnLi91YmNjLXBhcmFtLWRpbWVuc2lvbi11aS1yb290L3ViY2MtcGFyYW0tZGltZW5zaW9uLXVpLXJvb3QuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUGFyYW1ldGVyLCBEYXRhVHlwZUNvbnN0LCBJRGF0YVR5cGUsIENvbGxlY3Rpb25UeXBlLCBQcmltaXRpdmVUeXBlLCBQcmltaXRpdmVUeXBlS2luZCwgRGF0YVR5cGUgfSBmcm9tICdAZWNwLWNhZi9jb21tb24tc3RydWN0dXJlJztcclxuaW1wb3J0IHsgQmFzZVBhcmFtRGF0YSB9IGZyb20gJy4vY29tbW9uL3BhcmFtZXRlci1kYXRhL2Jhc2UtcGFyYW0tZGF0YSc7XHJcbmltcG9ydCB7IERpbWVuc2lvbkl0ZW1EYXRhIH0gZnJvbSAnLi9jb21tb24vZGltZW5zaW9uLWl0ZW0tZGF0YS9kaW1lbnNpb24taXRlbS1kYXRhJztcclxuaW1wb3J0IHsgVWJjY0V2ZW50QnVzU2VydmljZSB9IGZyb20gJy4vc2VydmljZS9ldmVudC1idXMtc2VydmljZSc7XHJcbmltcG9ydCB7IFViY2NQYXJhbURhdGFVdGlscyB9IGZyb20gJy4vdXRpbHMvcGFyYW0tZGF0YS11dGlscyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnbGliLXViY2MtcGFyYW0tZGF0YS11aS1yb290JyxcclxuICAgIHRlbXBsYXRlVXJsOiAnLi91YmNjLXBhcmFtLWRhdGEtdWktcm9vdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi91YmNjLXBhcmFtLWRhdGEtdWktcm9vdC5jb21wb25lbnQuY3NzJ10sXHJcbiAgICBwcm92aWRlcnM6IFtVYmNjRXZlbnRCdXNTZXJ2aWNlXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVWJjY1BhcmFtRGF0YVVpUm9vdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgICBwcml2YXRlIF9hc3NpZ25tZW50OiBVYmNjUGFyYW1UZW1wbGF0ZUFzc2lnbm1lbnQ7XHJcblxyXG4gICAgQElucHV0KCkgc2V0IGFzc2lnbm1lbnQoYXNzaWdubWVudDogVWJjY1BhcmFtVGVtcGxhdGVBc3NpZ25tZW50KSB7XHJcbiAgICAgICAgdGhpcy5fYXNzaWdubWVudCA9IGFzc2lnbm1lbnQ7XHJcbiAgICAgICAgdGhpcy5sb2FkRGF0YSgpO1xyXG4gICAgfVxyXG5cclxuICAgIF9jYW5FZGl0OmJvb2xlYW49dHJ1ZTtcclxuXHJcbiAgICBASW5wdXQoKSBzZXQgY2FuRWRpdChjYW5FZGl0OmJvb2xlYW4pe1xyXG4gICAgICAgIHRoaXMuX2NhbkVkaXQ9Y2FuRWRpdDtcclxuICAgICAgICBpZih0aGlzLmN1cnJlbnRJbnN0YW5jZSl7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEluc3RhbmNlLmNhbkVkaXQ9dGhpcy5fY2FuRWRpdDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdGVtcGxhdGU6IFViY2NQYXJhbVRlbXBsYXRlO1xyXG5cclxuICAgIGRpbWVuc2lvbkl0ZW1EYXRhczogQXJyYXk8RGltZW5zaW9uSXRlbURhdGE+ID0gW107XHJcblxyXG4gICAgcGFyYW1EYXRhSXRlbXM6IEFycmF5PFBhcmFtZXRlcj4gPSBbXTtcclxuXHJcbiAgICBwYXJhbURhdGFJdGVtc0Nsb25lOiBBcnJheTxQYXJhbWV0ZXI+ID0gW107XHJcblxyXG4gICAgY3VycmVudEluc3RhbmNlOmFueTtcclxuXHJcbiAgICB0ZW1wbGF0ZVNlcmlhbGl6ZXI9bmV3IFViY2NQYXJhbVRlbXBsYXRlU2VyaWFsaXplcigpO1xyXG4gICAgXHJcbiAgICBhc3NpZ25tZW50U2VyaWFsaXplcj1uZXcgVWJjY1BhcmFtVGVtcGxhdGVBc3NpZ25tZW50U2VyaWFsaXplcigpO1xyXG5cclxuICAgIEBWaWV3Q2hpbGQoJ3BhcmFtRGF0YVBhbmVsJywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIHBhcmFtRGF0YVBhbmVsOiBWaWV3Q29udGFpbmVyUmVmO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgdXRpbHM6VWJjY1BhcmFtRGF0YVV0aWxzLFxyXG4gICAgICAgIHByaXZhdGUgZWJzU2VydmljZTogVWJjY0V2ZW50QnVzU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIGh0dHA6IFViY2NQYXJhbURhdGFNYW5hbmdlclNlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyKSB7XHJcbiAgICAgICAgdGhpcy5lYnNTZXJ2aWNlLmVicy5zdWJzY3JpYmUoZXZlbnQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmxvYWREaW1lbnNpb25EYXRhRnJvbVJlbW90ZSgpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5fYXNzaWdubWVudCA9IHRoaXMuX2Fzc2lnbm1lbnQgfHwgbmV3IFViY2NQYXJhbVRlbXBsYXRlQXNzaWdubWVudCgpO1xyXG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlIHx8IG5ldyBVYmNjUGFyYW1UZW1wbGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhUGFuZWwuY2xlYXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWREYXRhKCkge1xyXG4gICAgICAgIC8v5Y+C5pWwLOe7tOW6puaVsOaNrua6kOWIneWni+WMllxyXG4gICAgICAgIHRoaXMuZGltZW5zaW9uSXRlbURhdGFzPVtdO1xyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXM9W107XHJcbiAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtc0Nsb25lPVtdO1xyXG4gICAgICAgIGlmICghdGhpcy5fYXNzaWdubWVudCB8fCAhdGhpcy5fYXNzaWdubWVudC50ZW1wbGF0ZUlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5odHRwLmdldFBhcmFtVGVtcGxhdGUodGhpcy5fYXNzaWdubWVudC50ZW1wbGF0ZUlkKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICh2bzogVWJjY1BhcmFtVGVtcGxhdGVWbykgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF2b3x8IXZvLmNvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsZXQgc2VyaWFsaXplciA9IG5ldyBVYmNjUGFyYW1UZW1wbGF0ZVNlcmlhbGl6ZXIoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudGVtcGxhdGUgPSBzZXJpYWxpemVyLmRlc2VyaWFsaXplcihKU09OLnBhcnNlKHZvLmNvbnRlbnQpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9hZCgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlcnI9PntcclxuICAgICAgICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWQoKSB7XHJcbiAgICAgICAgLy/lj4LmlbDnu5PmnoTliJ3lp4vljJbvvIzlj4LmlbDlgLzkuLrnqbpcclxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zSW5pdCgpO1xyXG4gICAgICAgIC8v5qC55o2u57u05bqm5Yib5bu65a+55bqU55qEVUnnu4Tku7ZcclxuICAgICAgICBpZiAodGhpcy5fYXNzaWdubWVudC51c2VEaW1lbnNpb24pIHtcclxuICAgICAgICAgICAgLy/nu7Tluqbnu5PmnoTliJ3lp4vljJbvvIznu7TluqbmlbDmja7kuLrnqbpcclxuICAgICAgICAgICAgdGhpcy5kaW1lbnNpb25EYXRhSXRlbXNJbml0KCk7XHJcbiAgICAgICAgICAgIC8v5Yib5bu657u05bqmVUnnu4Tku7bvvIzmraTlpITkuI3lj5bmlbDvvIzlj6rmuLLmn5PnlYzpnaLvvIzlnKjpgInmi6nnu7TluqbmlbDmja7lkI7lho3liqDovb3mlbDmja5cclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVEaW1lbnNpb25Sb290VWlDb21wb25lbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuaHR0cC5nZXRQYXJhbURhdGEodGhpcy5fYXNzaWdubWVudC50ZW1wbGF0ZUlkLCB0aGlzLl9hc3NpZ25tZW50LmJpelR5cGVJZCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgKGRhdGFJdGVtczogQXJyYXk8RGF0YUl0ZW0+KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRQYXJhbVZhbHVlcyhkYXRhSXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGVycj0+e1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgIC8v5Yib5bu65Y+C5pWwVUnnu4Tku7ZcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVQYXJhbURhdGFVaUNvbXBvbmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFBhcmFtVmFsdWVzKGRhdGFJdGVtczogQXJyYXk8RGF0YUl0ZW0+KSB7XHJcbiAgICAgICAgaWYgKCFkYXRhSXRlbXMgfHwgZGF0YUl0ZW1zLmxlbmd0aCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtcy5tYXAoKHBhcmFtRGF0YUl0ZW06IEJhc2VQYXJhbURhdGEpID0+IHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSBkYXRhSXRlbXMuZmluZChpdGVtID0+IGl0ZW0uZGF0YUNvZGUgPT09IHBhcmFtRGF0YUl0ZW0uY29kZSk7XHJcbiAgICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbURhdGFJdGVtLnZhbHVlID0gZGF0YS5kYXRhVmFsdWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMudXRpbHMuaXNIZWxwVHlwZShwYXJhbURhdGFJdGVtLnBhcmFtZXRlclR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcGFyYW1EYXRhSXRlbS52YWx1ZVRleHQgPSBkYXRhLmRhdGFWYWx1ZVRleHR8fCcnO1xyXG4gICAgICAgICAgICAgICAgLy8g5LuO5YmN56uv6I635Y+W5biu5Yqp5pWw5o2uXHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmdldEhlbHBEYXRhKGRhdGEscGFyYW1EYXRhSXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnBhcmFtVmFsdWVzQ2xvbmUodGhpcy5wYXJhbURhdGFJdGVtc0Nsb25lLHRoaXMucGFyYW1EYXRhSXRlbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcGFyYW1WYWx1ZXNDbG9uZSh0YXJnZXQ6YW55W10sc291cmNlOmFueVtdKSB7XHJcbiAgICAgICAgaWYoc291cmNlLmxlbmd0aD09MHx8dGFyZ2V0Lmxlbmd0aD09MHx8dGFyZ2V0Lmxlbmd0aCE9PXNvdXJjZS5sZW5ndGgpe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRhcmdldC5tYXAocGFyYW1EYXRhSXRlbUNsb25lID0+IHtcclxuICAgICAgICAgICAgbGV0IGluZGV4ID0gc291cmNlLmZpbmRJbmRleCh4ID0+IHguY29kZSA9PT0gcGFyYW1EYXRhSXRlbUNsb25lLmNvZGUpO1xyXG4gICAgICAgICAgICBpZihpbmRleCE9PSgtMSkpe1xyXG4gICAgICAgICAgICAgICAgcGFyYW1EYXRhSXRlbUNsb25lLmlkID0gc291cmNlW2luZGV4XS5pZDtcclxuICAgICAgICAgICAgICAgIHBhcmFtRGF0YUl0ZW1DbG9uZS52YWx1ZSA9IHNvdXJjZVtpbmRleF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBwYXJhbURhdGFJdGVtQ2xvbmUudmFsdWVUZXh0PXNvdXJjZVtpbmRleF0udmFsdWVUZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsb2FkRGltZW5zaW9uRGF0YUZyb21SZW1vdGUoKSB7XHJcbiAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtc0luaXQoKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRJbnN0YW5jZS5wYXJhbURhdGFJdGVtcyA9IHRoaXMucGFyYW1EYXRhSXRlbXM7XHJcbiAgICAgICAgbGV0IGRpbWVuc2lvbkl0ZW1WYWx1ZXMgPSBbXTtcclxuICAgICAgICB0aGlzLmRpbWVuc2lvbkl0ZW1EYXRhcy5tYXAoKHg6IERpbWVuc2lvbkl0ZW1EYXRhKSA9PiBkaW1lbnNpb25JdGVtVmFsdWVzLnB1c2goeC52YWx1ZSkpO1xyXG4gICAgICAgIGxldCBjb3VudD1kaW1lbnNpb25JdGVtVmFsdWVzLmxlbmd0aDtcclxuICAgICAgICBpZihjb3VudDw9MCl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoY291bnQ9PT0xKXtcclxuICAgICAgICAgICAgaWYoIWRpbWVuc2lvbkl0ZW1WYWx1ZXNbMF0pe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNvdW50PT09Mil7XHJcbiAgICAgICAgICAgIGlmKCFkaW1lbnNpb25JdGVtVmFsdWVzWzBdfHwhZGltZW5zaW9uSXRlbVZhbHVlc1sxXSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGRpbWVuc2lvbjE9ZGltZW5zaW9uSXRlbVZhbHVlc1swXT9kaW1lbnNpb25JdGVtVmFsdWVzWzBdOm51bGw7XHJcbiAgICAgICAgbGV0IGRpbWVuc2lvbjI9ZGltZW5zaW9uSXRlbVZhbHVlc1sxXT9kaW1lbnNpb25JdGVtVmFsdWVzWzFdOm51bGw7XHJcbiAgICAgICAgdGhpcy5odHRwLmdldERpbWVuc2lvbkRhdGEodGhpcy5fYXNzaWdubWVudC50ZW1wbGF0ZUlkLCBcclxuICAgICAgICAgICAgdGhpcy5fYXNzaWdubWVudC5iaXpUeXBlSWQsXHJcbiAgICAgICAgICAgIGRpbWVuc2lvbjEsZGltZW5zaW9uMixjb3VudCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAoZGF0YUl0ZW1zOiBBcnJheTxEYXRhSXRlbT4pID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0UGFyYW1WYWx1ZXMoZGF0YUl0ZW1zKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHBhcmFtRGF0YUl0ZW1zSW5pdCgpIHtcclxuICAgICAgICBsZXQgdGVtcGxhdGU9dGhpcy50ZW1wbGF0ZVNlcmlhbGl6ZXIuZGVzZXJpYWxpemVyKHRoaXMudGVtcGxhdGVTZXJpYWxpemVyLnNlcmlhbGl6ZSh0aGlzLnRlbXBsYXRlKSk7XHJcbiAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtcyA9IFtdO1xyXG4gICAgICAgIGlmICh0ZW1wbGF0ZSYmIHRlbXBsYXRlLnBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGUucGFyYW1zLm1hcCh4PT57XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5fYXNzaWdubWVudC51c2VEaW1lbnNpb24pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpbWVuc2lvblBhcmFtRGVmYXVsdFZhbHVlSW5pdCh4IGFzIEJhc2VQYXJhbURhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoeCBhcyBCYXNlUGFyYW1EYXRhKS52YWx1ZT14LmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtcy5wdXNoKHgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zQ2xvbmVJbml0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkaW1lbnNpb25QYXJhbURlZmF1bHRWYWx1ZUluaXQocGFyYW1EYXRhOkJhc2VQYXJhbURhdGEpe1xyXG4gICAgICAgIGxldCBjb3VudD10aGlzLmRpbWVuc2lvbkl0ZW1EYXRhcy5sZW5ndGg7XHJcbiAgICAgICAgaWYoY291bnQ8PTApe1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNvdW50PT09MSl7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmRpbWVuc2lvbkl0ZW1EYXRhc1swXXx8IXRoaXMuZGltZW5zaW9uSXRlbURhdGFzWzBdLnZhbHVlKXtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihjb3VudD09PTIpe1xyXG4gICAgICAgICAgICBpZighdGhpcy5kaW1lbnNpb25JdGVtRGF0YXNbMF18fCF0aGlzLmRpbWVuc2lvbkl0ZW1EYXRhc1sxXXx8IXRoaXMuZGltZW5zaW9uSXRlbURhdGFzWzBdLnZhbHVlfHwhdGhpcy5kaW1lbnNpb25JdGVtRGF0YXNbMV0udmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhcmFtRGF0YS52YWx1ZT1wYXJhbURhdGEuZGVmYXVsdFZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcGFyYW1EYXRhSXRlbXNDbG9uZUluaXQoKSB7XHJcbiAgICAgICAgbGV0IHRlbXBsYXRlPXRoaXMudGVtcGxhdGVTZXJpYWxpemVyLmRlc2VyaWFsaXplcih0aGlzLnRlbXBsYXRlU2VyaWFsaXplci5zZXJpYWxpemUodGhpcy50ZW1wbGF0ZSkpO1xyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXNDbG9uZSA9IFtdO1xyXG4gICAgICAgIGlmICh0ZW1wbGF0ZSYmIHRlbXBsYXRlLnBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGUucGFyYW1zLm1hcCh4PT57XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5fYXNzaWdubWVudC51c2VEaW1lbnNpb24pe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpbWVuc2lvblBhcmFtRGVmYXVsdFZhbHVlSW5pdCh4IGFzIEJhc2VQYXJhbURhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoeCBhcyBCYXNlUGFyYW1EYXRhKS52YWx1ZT14LmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtc0Nsb25lLnB1c2goeCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZGltZW5zaW9uRGF0YUl0ZW1zSW5pdCgpIHtcclxuICAgICAgICBsZXQgYXNzaWdubWVudD10aGlzLmFzc2lnbm1lbnRTZXJpYWxpemVyLmRlc2VyaWFsaXplKHRoaXMuYXNzaWdubWVudFNlcmlhbGl6ZXIuc2VyaWFsaXplKHRoaXMuX2Fzc2lnbm1lbnQpKTtcclxuICAgICAgICBpZiAoYXNzaWdubWVudCYmYXNzaWdubWVudC5kaW1lbnNpb25JbmZvXHJcbiAgICAgICAgICAgICYmIGFzc2lnbm1lbnQuZGltZW5zaW9uSW5mby5kZWZpbml0aW9uXHJcbiAgICAgICAgICAgICYmIGFzc2lnbm1lbnQuZGltZW5zaW9uSW5mby5kZWZpbml0aW9uLmRpbWVuc2lvbkl0ZW1zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uSXRlbURhdGFzID0gW107XHJcbiAgICAgICAgICAgIGFzc2lnbm1lbnQuZGltZW5zaW9uSW5mby5kZWZpbml0aW9uLmRpbWVuc2lvbkl0ZW1zLmZvckVhY2goZGltZW5zaW9uRGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpbWVuc2lvbkl0ZW1EYXRhcy5wdXNoKGRpbWVuc2lvbkRhdGEgYXMgRGltZW5zaW9uSXRlbURhdGEpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVQYXJhbURhdGFVaUNvbXBvbmVudCgpIHtcclxuICAgICAgICB0aGlzLnBhcmFtRGF0YVBhbmVsLmNsZWFyKCk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoVWJjY1BhcmFtRGF0YVVpQ29tcG9uZW50KTtcclxuICAgICAgICBsZXQgY21wUmVmID0gdGhpcy5wYXJhbURhdGFQYW5lbC5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XHJcbiAgICAgICAgY21wUmVmLmluc3RhbmNlLmNhbkVkaXQgPSB0aGlzLmNhbkVkaXQ7XHJcbiAgICAgICAgY21wUmVmLmluc3RhbmNlLnRlbXBsYXRlID0gdGhpcy50ZW1wbGF0ZTtcclxuICAgICAgICBjbXBSZWYuaW5zdGFuY2UucGFyYW1EYXRhSXRlbXMgPSB0aGlzLnBhcmFtRGF0YUl0ZW1zO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEluc3RhbmNlPWNtcFJlZi5pbnN0YW5jZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZURpbWVuc2lvblJvb3RVaUNvbXBvbmVudCgpIHtcclxuICAgICAgICB0aGlzLnBhcmFtRGF0YVBhbmVsLmNsZWFyKCk7XHJcbiAgICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoVWJjY1BhcmFtRGltZW5zaW9uVWlSb290Q29tcG9uZW50KTtcclxuICAgICAgICBsZXQgY21wUmVmID0gdGhpcy5wYXJhbURhdGFQYW5lbC5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XHJcbiAgICAgICAgY21wUmVmLmluc3RhbmNlLmNhbkVkaXQgPSB0aGlzLmNhbkVkaXQ7XHJcbiAgICAgICAgY21wUmVmLmluc3RhbmNlLmRpbWVuc2lvbkl0ZW1EYXRhcyA9IHRoaXMuZGltZW5zaW9uSXRlbURhdGFzO1xyXG4gICAgICAgIGNtcFJlZi5pbnN0YW5jZS5wYXJhbURhdGFJdGVtcyA9IHRoaXMucGFyYW1EYXRhSXRlbXM7XHJcbiAgICAgICAgY21wUmVmLmluc3RhbmNlLnRlbXBsYXRlID0gdGhpcy50ZW1wbGF0ZTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRJbnN0YW5jZT1jbXBSZWYuaW5zdGFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgY29udmVydERpbWVuc2lvbkRhdGFUb0RhdGFWbygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuZGltZW5zaW9uSXRlbURhdGFzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZGltZW5zaW9uVmFsdWVzID0gbmV3IEFycmF5PERhdGFJdGVtPigpO1xyXG4gICAgICAgIHRoaXMuZGltZW5zaW9uSXRlbURhdGFzLm1hcCh4ID0+IHtcclxuICAgICAgICAgICAgbGV0IGRpbWVuc2lvblZhbHVlID0gbmV3IERhdGFJdGVtKCk7XHJcbiAgICAgICAgICAgIGRpbWVuc2lvblZhbHVlLmRhdGFDb2RlID0geC5jb2RlO1xyXG4gICAgICAgICAgICBkaW1lbnNpb25WYWx1ZS5kYXRhVmFsdWUgPSAoeCBhcyBEaW1lbnNpb25JdGVtRGF0YSkudmFsdWU7XHJcbiAgICAgICAgICAgIGRpbWVuc2lvblZhbHVlLmRhdGFUeXBlID0gdGhpcy5nZXREaW1lbnNpb25WYWx1ZVR5cGUoeC5kYXRhVHlwZSk7XHJcbiAgICAgICAgICAgIGRpbWVuc2lvblZhbHVlcy5wdXNoKGRpbWVuc2lvblZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGltZW5zaW9uVmFsdWVzO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnZlcnRQYXJhbURhdGFUb0RhdGFWbygpIHtcclxuICAgICAgICBpZiAoIXRoaXMucGFyYW1EYXRhSXRlbXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBwYXJhbVZhbHVlcyA9IG5ldyBBcnJheTxEYXRhSXRlbT4oKTtcclxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zLm1hcCh4ID0+IHtcclxuICAgICAgICAgICAgbGV0IHBhcmFtVmFsdWUgPSBuZXcgRGF0YUl0ZW0oKTtcclxuICAgICAgICAgICAgcGFyYW1WYWx1ZS5kYXRhQ29kZSA9IHguY29kZTtcclxuICAgICAgICAgICAgcGFyYW1WYWx1ZS5kYXRhVmFsdWUgPSAoeCBhcyBCYXNlUGFyYW1EYXRhKS52YWx1ZTtcclxuICAgICAgICAgICAgcGFyYW1WYWx1ZS5kYXRhVHlwZSA9IHRoaXMuZ2V0UGFyYW1WYWx1ZVR5cGUoKHggYXMgQmFzZVBhcmFtRGF0YSkucGFyYW1ldGVyVHlwZSk7XHJcbiAgICAgICAgICAgIHBhcmFtVmFsdWVzLnB1c2gocGFyYW1WYWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5wYXJhbVZhbHVlc0Nsb25lKHRoaXMucGFyYW1EYXRhSXRlbXNDbG9uZSx0aGlzLnBhcmFtRGF0YUl0ZW1zKTtcclxuICAgICAgICByZXR1cm4gcGFyYW1WYWx1ZXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXREaW1lbnNpb25WYWx1ZVR5cGUoZGF0YVR5cGU6IElEYXRhVHlwZSkge1xyXG4gICAgICAgIGxldCBraW5kID0gZGF0YVR5cGUuZ2V0S2luZCgpO1xyXG4gICAgICAgIHN3aXRjaCAoa2luZCkge1xyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlQ29uc3QuREVGQVVMVF9QUklNSVRJVkU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7RGF0YVR5cGVDb25zdC5ERUZBVUxUX1BSSU1JVElWRX0uJHsoZGF0YVR5cGUgYXMgUHJpbWl0aXZlVHlwZSkucHJpbWl0aXZlVHlwZUtpbmR9YDtcclxuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZUNvbnN0LkRFRkFVTFRfRU5VTUVSQVRJT046XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVR5cGVDb25zdC5ERUZBVUxUX0VOVU1FUkFUSU9OO1xyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlRXh0ZW5zaW9uQ29uc3QuSEVMUF9UWVBFOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIERhdGFUeXBlRXh0ZW5zaW9uQ29uc3QuSEVMUF9UWVBFK2AjIyR7KGRhdGFUeXBlIGFzIEhlbHBUeXBlKS5oZWxwSWR9YDtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5Lia5Yqh5Y+C5pWw5LiN5pSv5oyB55qE5Y+C5pWw57G75Z6LJHtraW5kfWApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFBhcmFtVmFsdWVUeXBlKGRhdGFUeXBlOiBJRGF0YVR5cGUpIHtcclxuICAgICAgICBsZXQga2luZCA9IGRhdGFUeXBlLmdldEtpbmQoKTtcclxuICAgICAgICBzd2l0Y2ggKGtpbmQpIHtcclxuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZUNvbnN0LkRFRkFVTFRfQ09MTEVDVElPTjpcclxuICAgICAgICAgICAgICAgIGxldCBlbGVtZXRUeXBlID0gKGRhdGFUeXBlIGFzIENvbGxlY3Rpb25UeXBlKS5lbGVtZW50VHlwZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBgJHtEYXRhVHlwZUNvbnN0LkRFRkFVTFRfQ09MTEVDVElPTn0uYCArIHRoaXMuZ2V0UGFyYW1WYWx1ZVR5cGUoZWxlbWV0VHlwZSk7XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGVDb25zdC5ERUZBVUxUX1BSSU1JVElWRTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBgJHtEYXRhVHlwZUNvbnN0LkRFRkFVTFRfUFJJTUlUSVZFfS4ke1ByaW1pdGl2ZVR5cGVLaW5kWyhkYXRhVHlwZSBhcyBQcmltaXRpdmVUeXBlKS5wcmltaXRpdmVUeXBlS2luZF19YDtcclxuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZUV4dGVuc2lvbkNvbnN0LlVCQ0NfU1RSVUNUVVJFX1RZUEVfUkVGOlxyXG4gICAgICAgICAgICAgICAgbGV0IHJlZlR5cGUgPSBkYXRhVHlwZSBhcyBTdHJ1Y3R1cmVUeXBlUmVmO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlZlR5cGUudHlwZSA9PT0gU3RydWN0dXJlVHlwZVJlZkVudW0uSEVMUCA/IERhdGFUeXBlRXh0ZW5zaW9uQ29uc3QuSEVMUF9UWVBFICtgIyMke3JlZlR5cGUucmVmSWR9YDogRGF0YVR5cGVDb25zdC5ERUZBVUxUX0VOVU1FUkFUSU9OO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuJrliqHlj4LmlbDkuI3mlK/mjIHnmoTlj4LmlbDnsbvlnoske2tpbmR9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbCgpe1xyXG4gICAgICAgIHRoaXMucGFyYW1WYWx1ZXNDbG9uZSh0aGlzLnBhcmFtRGF0YUl0ZW1zLHRoaXMucGFyYW1EYXRhSXRlbXNDbG9uZSk7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2UucGFyYW1EYXRhSXRlbXM9dGhpcy5wYXJhbURhdGFJdGVtcztcclxuICAgIH1cclxufVxyXG4iXX0=
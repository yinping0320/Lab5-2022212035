/**
 * @fileoverview added by tsickle
 * Generated from: lib/ubcc-param-data-ui-root.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ViewContainerRef, ComponentFactoryResolver } from '@angular/core';
import { UbccParamTemplate, UbccParamTemplateAssignment, UbccParamTemplateSerializer, DataItem, DataTypeExtensionConst, StructureTypeRefEnum, UbccParamTemplateAssignmentSerializer } from '@gsp-cmp/ubcc-param-vo';
import { UbccParamDataManangerService } from './service/http-service';
import { UbccParamDataUiComponent } from './ubcc-param-data-ui/ubcc-param-data-ui.component';
import { UbccParamDimensionUiRootComponent } from './ubcc-param-dimension-ui-root/ubcc-param-dimension-ui-root.component';
import { DataTypeConst, PrimitiveTypeKind } from '@ecp-caf/common-structure';
import { UbccEventBusService } from './service/event-bus-service';
import { UbccParamDataUtils } from './utils/param-data-utils';
var UbccParamDataUiRootComponent = /** @class */ (function () {
    function UbccParamDataUiRootComponent(utils, ebsService, http, resolver) {
        var _this = this;
        this.utils = utils;
        this.ebsService = ebsService;
        this.http = http;
        this.resolver = resolver;
        this._canEdit = true;
        this.dimensionItemDatas = [];
        this.paramDataItems = [];
        this.paramDataItemsClone = [];
        this.templateSerializer = new UbccParamTemplateSerializer();
        this.assignmentSerializer = new UbccParamTemplateAssignmentSerializer();
        this.ebsService.ebs.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.loadDimensionDataFromRemote();
        }));
    }
    Object.defineProperty(UbccParamDataUiRootComponent.prototype, "assignment", {
        set: /**
         * @param {?} assignment
         * @return {?}
         */
        function (assignment) {
            this._assignment = assignment;
            this.loadData();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(UbccParamDataUiRootComponent.prototype, "canEdit", {
        set: /**
         * @param {?} canEdit
         * @return {?}
         */
        function (canEdit) {
            this._canEdit = canEdit;
            if (this.currentInstance) {
                this.currentInstance.canEdit = this._canEdit;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this._assignment = this._assignment || new UbccParamTemplateAssignment();
        this.template = this.template || new UbccParamTemplate();
    };
    /**
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.paramDataPanel.clear();
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.loadData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        //参数,维度数据源初始化
        this.dimensionItemDatas = [];
        this.paramDataItems = [];
        this.paramDataItemsClone = [];
        if (!this._assignment || !this._assignment.templateId) {
            return;
        }
        this.http.getParamTemplate(this._assignment.templateId).subscribe((/**
         * @param {?} vo
         * @return {?}
         */
        function (vo) {
            if (!vo || !vo.content) {
                return;
            }
            /** @type {?} */
            var serializer = new UbccParamTemplateSerializer();
            _this.template = serializer.deserializer(JSON.parse(vo.content));
            _this.load();
        }), (/**
         * @param {?} err
         * @return {?}
         */
        function (err) {
            throw err;
        }));
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.load = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        //参数结构初始化，参数值为空
        this.paramDataItemsInit();
        //根据维度创建对应的UI组件
        if (this._assignment.useDimension) {
            //维度结构初始化，维度数据为空
            this.dimensionDataItemsInit();
            //创建维度UI组件，此处不取数，只渲染界面，在选择维度数据后再加载数据
            this.createDimensionRootUiComponent();
        }
        else {
            this.http.getParamData(this._assignment.templateId, this._assignment.bizTypeId).subscribe((/**
             * @param {?} dataItems
             * @return {?}
             */
            function (dataItems) {
                _this.getParamValues(dataItems);
            }), (/**
             * @param {?} err
             * @return {?}
             */
            function (err) {
                throw err;
            }));
            //创建参数UI组件
            this.createParamDataUiComponent();
        }
    };
    /**
     * @private
     * @param {?} dataItems
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.getParamValues = /**
     * @private
     * @param {?} dataItems
     * @return {?}
     */
    function (dataItems) {
        var _this = this;
        if (!dataItems || dataItems.length <= 0) {
            return;
        }
        this.paramDataItems.map((/**
         * @param {?} paramDataItem
         * @return {?}
         */
        function (paramDataItem) {
            /** @type {?} */
            var data = dataItems.find((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.dataCode === paramDataItem.code; }));
            if (data) {
                paramDataItem.value = data.dataValue;
                if (!_this.utils.isHelpType(paramDataItem.parameterType)) {
                    return;
                }
                paramDataItem.valueText = data.dataValueText || '';
                // 从前端获取帮助数据
                // this.getHelpData(data,paramDataItem);
            }
        }));
        this.paramValuesClone(this.paramDataItemsClone, this.paramDataItems);
    };
    /**
     * @private
     * @param {?} target
     * @param {?} source
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.paramValuesClone = /**
     * @private
     * @param {?} target
     * @param {?} source
     * @return {?}
     */
    function (target, source) {
        if (source.length == 0 || target.length == 0 || target.length !== source.length) {
            return;
        }
        target.map((/**
         * @param {?} paramDataItemClone
         * @return {?}
         */
        function (paramDataItemClone) {
            /** @type {?} */
            var index = source.findIndex((/**
             * @param {?} x
             * @return {?}
             */
            function (x) { return x.code === paramDataItemClone.code; }));
            if (index !== (-1)) {
                paramDataItemClone.id = source[index].id;
                paramDataItemClone.value = source[index].value;
                paramDataItemClone.valueText = source[index].valueText;
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.loadDimensionDataFromRemote = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.paramDataItemsInit();
        this.currentInstance.paramDataItems = this.paramDataItems;
        /** @type {?} */
        var dimensionItemValues = [];
        this.dimensionItemDatas.map((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return dimensionItemValues.push(x.value); }));
        /** @type {?} */
        var count = dimensionItemValues.length;
        if (count <= 0) {
            return;
        }
        if (count === 1) {
            if (!dimensionItemValues[0]) {
                return;
            }
        }
        if (count === 2) {
            if (!dimensionItemValues[0] || !dimensionItemValues[1]) {
                return;
            }
        }
        /** @type {?} */
        var dimension1 = dimensionItemValues[0] ? dimensionItemValues[0] : null;
        /** @type {?} */
        var dimension2 = dimensionItemValues[1] ? dimensionItemValues[1] : null;
        this.http.getDimensionData(this._assignment.templateId, this._assignment.bizTypeId, dimension1, dimension2, count).subscribe((/**
         * @param {?} dataItems
         * @return {?}
         */
        function (dataItems) {
            _this.getParamValues(dataItems);
        }));
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.paramDataItemsInit = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var template = this.templateSerializer.deserializer(this.templateSerializer.serialize(this.template));
        this.paramDataItems = [];
        if (template && template.params) {
            template.params.map((/**
             * @param {?} x
             * @return {?}
             */
            function (x) {
                if (_this._assignment.useDimension) {
                    _this.dimensionParamDefaultValueInit((/** @type {?} */ (x)));
                }
                else {
                    ((/** @type {?} */ (x))).value = x.defaultValue;
                }
                _this.paramDataItems.push(x);
            }));
        }
        this.paramDataItemsCloneInit();
    };
    /**
     * @private
     * @param {?} paramData
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.dimensionParamDefaultValueInit = /**
     * @private
     * @param {?} paramData
     * @return {?}
     */
    function (paramData) {
        /** @type {?} */
        var count = this.dimensionItemDatas.length;
        if (count <= 0) {
            return;
        }
        if (count === 1) {
            if (!this.dimensionItemDatas[0] || !this.dimensionItemDatas[0].value) {
                return;
            }
        }
        if (count === 2) {
            if (!this.dimensionItemDatas[0] || !this.dimensionItemDatas[1] || !this.dimensionItemDatas[0].value || !this.dimensionItemDatas[1].value) {
                return;
            }
        }
        paramData.value = paramData.defaultValue;
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.paramDataItemsCloneInit = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var template = this.templateSerializer.deserializer(this.templateSerializer.serialize(this.template));
        this.paramDataItemsClone = [];
        if (template && template.params) {
            template.params.map((/**
             * @param {?} x
             * @return {?}
             */
            function (x) {
                if (_this._assignment.useDimension) {
                    _this.dimensionParamDefaultValueInit((/** @type {?} */ (x)));
                }
                else {
                    ((/** @type {?} */ (x))).value = x.defaultValue;
                }
                _this.paramDataItemsClone.push(x);
            }));
        }
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.dimensionDataItemsInit = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var assignment = this.assignmentSerializer.deserialize(this.assignmentSerializer.serialize(this._assignment));
        if (assignment && assignment.dimensionInfo
            && assignment.dimensionInfo.definition
            && assignment.dimensionInfo.definition.dimensionItems) {
            this.dimensionItemDatas = [];
            assignment.dimensionInfo.definition.dimensionItems.forEach((/**
             * @param {?} dimensionData
             * @return {?}
             */
            function (dimensionData) {
                _this.dimensionItemDatas.push((/** @type {?} */ (dimensionData)));
            }));
        }
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.createParamDataUiComponent = /**
     * @private
     * @return {?}
     */
    function () {
        this.paramDataPanel.clear();
        /** @type {?} */
        var factory = this.resolver.resolveComponentFactory(UbccParamDataUiComponent);
        /** @type {?} */
        var cmpRef = this.paramDataPanel.createComponent(factory);
        cmpRef.instance.canEdit = this.canEdit;
        cmpRef.instance.template = this.template;
        cmpRef.instance.paramDataItems = this.paramDataItems;
        this.currentInstance = cmpRef.instance;
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.createDimensionRootUiComponent = /**
     * @private
     * @return {?}
     */
    function () {
        this.paramDataPanel.clear();
        /** @type {?} */
        var factory = this.resolver.resolveComponentFactory(UbccParamDimensionUiRootComponent);
        /** @type {?} */
        var cmpRef = this.paramDataPanel.createComponent(factory);
        cmpRef.instance.canEdit = this.canEdit;
        cmpRef.instance.dimensionItemDatas = this.dimensionItemDatas;
        cmpRef.instance.paramDataItems = this.paramDataItems;
        cmpRef.instance.template = this.template;
        this.currentInstance = cmpRef.instance;
    };
    /**
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.convertDimensionDataToDataVo = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.dimensionItemDatas) {
            return null;
        }
        /** @type {?} */
        var dimensionValues = new Array();
        this.dimensionItemDatas.map((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            /** @type {?} */
            var dimensionValue = new DataItem();
            dimensionValue.dataCode = x.code;
            dimensionValue.dataValue = ((/** @type {?} */ (x))).value;
            dimensionValue.dataType = _this.getDimensionValueType(x.dataType);
            dimensionValues.push(dimensionValue);
        }));
        return dimensionValues;
    };
    /**
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.convertParamDataToDataVo = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.paramDataItems) {
            return null;
        }
        /** @type {?} */
        var paramValues = new Array();
        this.paramDataItems.map((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            /** @type {?} */
            var paramValue = new DataItem();
            paramValue.dataCode = x.code;
            paramValue.dataValue = ((/** @type {?} */ (x))).value;
            paramValue.dataType = _this.getParamValueType(((/** @type {?} */ (x))).parameterType);
            paramValues.push(paramValue);
        }));
        this.paramValuesClone(this.paramDataItemsClone, this.paramDataItems);
        return paramValues;
    };
    /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.getDimensionValueType = /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    function (dataType) {
        /** @type {?} */
        var kind = dataType.getKind();
        switch (kind) {
            case DataTypeConst.DEFAULT_PRIMITIVE:
                return DataTypeConst.DEFAULT_PRIMITIVE + "." + ((/** @type {?} */ (dataType))).primitiveTypeKind;
            case DataTypeConst.DEFAULT_ENUMERATION:
                return DataTypeConst.DEFAULT_ENUMERATION;
            case DataTypeExtensionConst.HELP_TYPE:
                return DataTypeExtensionConst.HELP_TYPE + ("##" + ((/** @type {?} */ (dataType))).helpId);
            default:
                throw new Error("\u4E1A\u52A1\u53C2\u6570\u4E0D\u652F\u6301\u7684\u53C2\u6570\u7C7B\u578B" + kind);
        }
    };
    /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.getParamValueType = /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    function (dataType) {
        /** @type {?} */
        var kind = dataType.getKind();
        switch (kind) {
            case DataTypeConst.DEFAULT_COLLECTION:
                /** @type {?} */
                var elemetType = ((/** @type {?} */ (dataType))).elementType;
                return DataTypeConst.DEFAULT_COLLECTION + "." + this.getParamValueType(elemetType);
            case DataTypeConst.DEFAULT_PRIMITIVE:
                return DataTypeConst.DEFAULT_PRIMITIVE + "." + PrimitiveTypeKind[((/** @type {?} */ (dataType))).primitiveTypeKind];
            case DataTypeExtensionConst.UBCC_STRUCTURE_TYPE_REF:
                /** @type {?} */
                var refType = (/** @type {?} */ (dataType));
                return refType.type === StructureTypeRefEnum.HELP ? DataTypeExtensionConst.HELP_TYPE + ("##" + refType.refId) : DataTypeConst.DEFAULT_ENUMERATION;
            default:
                throw new Error("\u4E1A\u52A1\u53C2\u6570\u4E0D\u652F\u6301\u7684\u53C2\u6570\u7C7B\u578B" + kind);
        }
    };
    /**
     * @return {?}
     */
    UbccParamDataUiRootComponent.prototype.cancel = /**
     * @return {?}
     */
    function () {
        this.paramValuesClone(this.paramDataItems, this.paramDataItemsClone);
        this.currentInstance.paramDataItems = this.paramDataItems;
    };
    UbccParamDataUiRootComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-ubcc-param-data-ui-root',
                    template: "<div class=\"col-12\">\r\n    <ng-template #paramDataPanel></ng-template>\r\n    <!-- <lib-ubcc-param-data-ui *ngIf=\"show()=='paramUi'\"\r\n        [canEdit]=\"canEdit\" \r\n        [(template)]=\"template\" \r\n        [(paramDataItems)]=\"paramDataItems\">\r\n    </lib-ubcc-param-data-ui>\r\n    <lib-ubcc-param-dimension-ui-root  *ngIf=\"show()=='dimensionUi'\"\r\n        [canEdit]=\"canEdit\" \r\n        [(template)]=\"template\" \r\n        [(paramDataItems)]=\"paramDataItems\" \r\n        [(dimensionItemDatas)]=\"dimensionItemDatas\">\r\n    </lib-ubcc-param-dimension-ui-root> -->\r\n</div>",
                    providers: [UbccEventBusService],
                    styles: [":host{display:flex;flex-direction:column;flex:1}"]
                }] }
    ];
    /** @nocollapse */
    UbccParamDataUiRootComponent.ctorParameters = function () { return [
        { type: UbccParamDataUtils },
        { type: UbccEventBusService },
        { type: UbccParamDataManangerService },
        { type: ComponentFactoryResolver }
    ]; };
    UbccParamDataUiRootComponent.propDecorators = {
        assignment: [{ type: Input }],
        canEdit: [{ type: Input }],
        paramDataPanel: [{ type: ViewChild, args: ['paramDataPanel', { read: ViewContainerRef },] }]
    };
    return UbccParamDataUiRootComponent;
}());
export { UbccParamDataUiRootComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype._assignment;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype._canEdit;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.template;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.dimensionItemDatas;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.paramDataItems;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.paramDataItemsClone;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.currentInstance;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.templateSerializer;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.assignmentSerializer;
    /** @type {?} */
    UbccParamDataUiRootComponent.prototype.paramDataPanel;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.utils;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.ebsService;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.http;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiRootComponent.prototype.resolver;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWJjYy1wYXJhbS1kYXRhLXVpLXJvb3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1jbXAvdWJjYy1wYXJhbS1kYXRhLXVpLyIsInNvdXJjZXMiOlsibGliL3ViY2MtcGFyYW0tZGF0YS11aS1yb290LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBYSx3QkFBd0IsRUFBcUMsTUFBTSxlQUFlLENBQUM7QUFDOUosT0FBTyxFQUFFLGlCQUFpQixFQUFFLDJCQUEyQixFQUF1QiwyQkFBMkIsRUFBRSxRQUFRLEVBQUUsc0JBQXNCLEVBQThCLG9CQUFvQixFQUFFLHFDQUFxQyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDclEsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sbURBQW1ELENBQUM7QUFDN0YsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLE1BQU0sdUVBQXVFLENBQUM7QUFDMUgsT0FBTyxFQUFhLGFBQWEsRUFBNEMsaUJBQWlCLEVBQVksTUFBTSwyQkFBMkIsQ0FBQztBQUc1SSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUU5RDtJQXdDSSxzQ0FDWSxLQUF3QixFQUN4QixVQUErQixFQUMvQixJQUFrQyxFQUNsQyxRQUFrQztRQUo5QyxpQkFRQztRQVBXLFVBQUssR0FBTCxLQUFLLENBQW1CO1FBQ3hCLGVBQVUsR0FBVixVQUFVLENBQXFCO1FBQy9CLFNBQUksR0FBSixJQUFJLENBQThCO1FBQ2xDLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBN0I5QyxhQUFRLEdBQVMsSUFBSSxDQUFDO1FBV3RCLHVCQUFrQixHQUE2QixF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WSw0QkFBNEI7Ozs7OztJQUVyQyxtREFBaUQ7O0lBT2pELGdEQUFzQjs7SUFTdEIsZ0RBQTRCOztJQUU1QiwwREFBa0Q7O0lBRWxELHNEQUFzQzs7SUFFdEMsMkRBQTJDOztJQUUzQyx1REFBb0I7O0lBRXBCLDBEQUFxRDs7SUFFckQsNERBQWlFOztJQUVqRSxzREFBMEY7Ozs7O0lBR3RGLDZDQUFnQzs7Ozs7SUFDaEMsa0RBQXVDOzs7OztJQUN2Qyw0Q0FBMEM7Ozs7O0lBQzFDLGdEQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmLCBPbkRlc3Ryb3ksIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlciwgQ2hhbmdlRGV0ZWN0b3JSZWYsIFR5cGUsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFViY2NQYXJhbVRlbXBsYXRlLCBVYmNjUGFyYW1UZW1wbGF0ZUFzc2lnbm1lbnQsIFViY2NQYXJhbVRlbXBsYXRlVm8sIFViY2NQYXJhbVRlbXBsYXRlU2VyaWFsaXplciwgRGF0YUl0ZW0sIERhdGFUeXBlRXh0ZW5zaW9uQ29uc3QsIFN0cnVjdHVyZVR5cGVSZWYsIEhlbHBUeXBlLCBTdHJ1Y3R1cmVUeXBlUmVmRW51bSwgVWJjY1BhcmFtVGVtcGxhdGVBc3NpZ25tZW50U2VyaWFsaXplciB9IGZyb20gJ0Bnc3AtY21wL3ViY2MtcGFyYW0tdm8nO1xyXG5pbXBvcnQgeyBVYmNjUGFyYW1EYXRhTWFuYW5nZXJTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlL2h0dHAtc2VydmljZSc7XHJcbmltcG9ydCB7IFViY2NQYXJhbURhdGFVaUNvbXBvbmVudCB9IGZyb20gJy4vdWJjYy1wYXJhbS1kYXRhLXVpL3ViY2MtcGFyYW0tZGF0YS11aS5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBVYmNjUGFyYW1EaW1lbnNpb25VaVJvb3RDb21wb25lbnQgfSBmcm9tICcuL3ViY2MtcGFyYW0tZGltZW5zaW9uLXVpLXJvb3QvdWJjYy1wYXJhbS1kaW1lbnNpb24tdWktcm9vdC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBQYXJhbWV0ZXIsIERhdGFUeXBlQ29uc3QsIElEYXRhVHlwZSwgQ29sbGVjdGlvblR5cGUsIFByaW1pdGl2ZVR5cGUsIFByaW1pdGl2ZVR5cGVLaW5kLCBEYXRhVHlwZSB9IGZyb20gJ0BlY3AtY2FmL2NvbW1vbi1zdHJ1Y3R1cmUnO1xyXG5pbXBvcnQgeyBCYXNlUGFyYW1EYXRhIH0gZnJvbSAnLi9jb21tb24vcGFyYW1ldGVyLWRhdGEvYmFzZS1wYXJhbS1kYXRhJztcclxuaW1wb3J0IHsgRGltZW5zaW9uSXRlbURhdGEgfSBmcm9tICcuL2NvbW1vbi9kaW1lbnNpb24taXRlbS1kYXRhL2RpbWVuc2lvbi1pdGVtLWRhdGEnO1xyXG5pbXBvcnQgeyBVYmNjRXZlbnRCdXNTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlL2V2ZW50LWJ1cy1zZXJ2aWNlJztcclxuaW1wb3J0IHsgVWJjY1BhcmFtRGF0YVV0aWxzIH0gZnJvbSAnLi91dGlscy9wYXJhbS1kYXRhLXV0aWxzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdsaWItdWJjYy1wYXJhbS1kYXRhLXVpLXJvb3QnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3ViY2MtcGFyYW0tZGF0YS11aS1yb290LmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3ViY2MtcGFyYW0tZGF0YS11aS1yb290LmNvbXBvbmVudC5jc3MnXSxcclxuICAgIHByb3ZpZGVyczogW1ViY2NFdmVudEJ1c1NlcnZpY2VdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBVYmNjUGFyYW1EYXRhVWlSb290Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICAgIHByaXZhdGUgX2Fzc2lnbm1lbnQ6IFViY2NQYXJhbVRlbXBsYXRlQXNzaWdubWVudDtcclxuXHJcbiAgICBASW5wdXQoKSBzZXQgYXNzaWdubWVudChhc3NpZ25tZW50OiBVYmNjUGFyYW1UZW1wbGF0ZUFzc2lnbm1lbnQpIHtcclxuICAgICAgICB0aGlzLl9hc3NpZ25tZW50ID0gYXNzaWdubWVudDtcclxuICAgICAgICB0aGlzLmxvYWREYXRhKCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2NhbkVkaXQ6Ym9vbGVhbj10cnVlO1xyXG5cclxuICAgIEBJbnB1dCgpIHNldCBjYW5FZGl0KGNhbkVkaXQ6Ym9vbGVhbil7XHJcbiAgICAgICAgdGhpcy5fY2FuRWRpdD1jYW5FZGl0O1xyXG4gICAgICAgIGlmKHRoaXMuY3VycmVudEluc3RhbmNlKXtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2UuY2FuRWRpdD10aGlzLl9jYW5FZGl0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0ZW1wbGF0ZTogVWJjY1BhcmFtVGVtcGxhdGU7XHJcblxyXG4gICAgZGltZW5zaW9uSXRlbURhdGFzOiBBcnJheTxEaW1lbnNpb25JdGVtRGF0YT4gPSBbXTtcclxuXHJcbiAgICBwYXJhbURhdGFJdGVtczogQXJyYXk8UGFyYW1ldGVyPiA9IFtdO1xyXG5cclxuICAgIHBhcmFtRGF0YUl0ZW1zQ2xvbmU6IEFycmF5PFBhcmFtZXRlcj4gPSBbXTtcclxuXHJcbiAgICBjdXJyZW50SW5zdGFuY2U6YW55O1xyXG5cclxuICAgIHRlbXBsYXRlU2VyaWFsaXplcj1uZXcgVWJjY1BhcmFtVGVtcGxhdGVTZXJpYWxpemVyKCk7XHJcbiAgICBcclxuICAgIGFzc2lnbm1lbnRTZXJpYWxpemVyPW5ldyBVYmNjUGFyYW1UZW1wbGF0ZUFzc2lnbm1lbnRTZXJpYWxpemVyKCk7XHJcblxyXG4gICAgQFZpZXdDaGlsZCgncGFyYW1EYXRhUGFuZWwnLCB7IHJlYWQ6IFZpZXdDb250YWluZXJSZWYgfSkgcGFyYW1EYXRhUGFuZWw6IFZpZXdDb250YWluZXJSZWY7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSB1dGlsczpVYmNjUGFyYW1EYXRhVXRpbHMsXHJcbiAgICAgICAgcHJpdmF0ZSBlYnNTZXJ2aWNlOiBVYmNjRXZlbnRCdXNTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgaHR0cDogVWJjY1BhcmFtRGF0YU1hbmFuZ2VyU2VydmljZSxcclxuICAgICAgICBwcml2YXRlIHJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIpIHtcclxuICAgICAgICB0aGlzLmVic1NlcnZpY2UuZWJzLnN1YnNjcmliZShldmVudCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZERpbWVuc2lvbkRhdGFGcm9tUmVtb3RlKCk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBuZ09uSW5pdCgpIHtcclxuICAgICAgICB0aGlzLl9hc3NpZ25tZW50ID0gdGhpcy5fYXNzaWdubWVudCB8fCBuZXcgVWJjY1BhcmFtVGVtcGxhdGVBc3NpZ25tZW50KCk7XHJcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGUgfHwgbmV3IFViY2NQYXJhbVRlbXBsYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5wYXJhbURhdGFQYW5lbC5jbGVhcigpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9hZERhdGEoKSB7XHJcbiAgICAgICAgLy/lj4LmlbAs57u05bqm5pWw5o2u5rqQ5Yid5aeL5YyWXHJcbiAgICAgICAgdGhpcy5kaW1lbnNpb25JdGVtRGF0YXM9W107XHJcbiAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtcz1bXTtcclxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zQ2xvbmU9W107XHJcbiAgICAgICAgaWYgKCF0aGlzLl9hc3NpZ25tZW50IHx8ICF0aGlzLl9hc3NpZ25tZW50LnRlbXBsYXRlSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmh0dHAuZ2V0UGFyYW1UZW1wbGF0ZSh0aGlzLl9hc3NpZ25tZW50LnRlbXBsYXRlSWQpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgKHZvOiBVYmNjUGFyYW1UZW1wbGF0ZVZvKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXZvfHwhdm8uY29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxldCBzZXJpYWxpemVyID0gbmV3IFViY2NQYXJhbVRlbXBsYXRlU2VyaWFsaXplcigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHNlcmlhbGl6ZXIuZGVzZXJpYWxpemVyKEpTT04ucGFyc2Uodm8uY29udGVudCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGVycj0+e1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbG9hZCgpIHtcclxuICAgICAgICAvL+WPguaVsOe7k+aehOWIneWni+WMlu+8jOWPguaVsOWAvOS4uuepulxyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXNJbml0KCk7XHJcbiAgICAgICAgLy/moLnmja7nu7TluqbliJvlu7rlr7nlupTnmoRVSee7hOS7tlxyXG4gICAgICAgIGlmICh0aGlzLl9hc3NpZ25tZW50LnVzZURpbWVuc2lvbikge1xyXG4gICAgICAgICAgICAvL+e7tOW6pue7k+aehOWIneWni+WMlu+8jOe7tOW6puaVsOaNruS4uuepulxyXG4gICAgICAgICAgICB0aGlzLmRpbWVuc2lvbkRhdGFJdGVtc0luaXQoKTtcclxuICAgICAgICAgICAgLy/liJvlu7rnu7TluqZVSee7hOS7tu+8jOatpOWkhOS4jeWPluaVsO+8jOWPqua4suafk+eVjOmdou+8jOWcqOmAieaLqee7tOW6puaVsOaNruWQjuWGjeWKoOi9veaVsOaNrlxyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZURpbWVuc2lvblJvb3RVaUNvbXBvbmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5odHRwLmdldFBhcmFtRGF0YSh0aGlzLl9hc3NpZ25tZW50LnRlbXBsYXRlSWQsIHRoaXMuX2Fzc2lnbm1lbnQuYml6VHlwZUlkKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICAoZGF0YUl0ZW1zOiBBcnJheTxEYXRhSXRlbT4pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFBhcmFtVmFsdWVzKGRhdGFJdGVtcyk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZXJyPT57XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgLy/liJvlu7rlj4LmlbBVSee7hOS7tlxyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVBhcmFtRGF0YVVpQ29tcG9uZW50KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UGFyYW1WYWx1ZXMoZGF0YUl0ZW1zOiBBcnJheTxEYXRhSXRlbT4pIHtcclxuICAgICAgICBpZiAoIWRhdGFJdGVtcyB8fCBkYXRhSXRlbXMubGVuZ3RoIDw9IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zLm1hcCgocGFyYW1EYXRhSXRlbTogQmFzZVBhcmFtRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IGRhdGFJdGVtcy5maW5kKGl0ZW0gPT4gaXRlbS5kYXRhQ29kZSA9PT0gcGFyYW1EYXRhSXRlbS5jb2RlKTtcclxuICAgICAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtRGF0YUl0ZW0udmFsdWUgPSBkYXRhLmRhdGFWYWx1ZTtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy51dGlscy5pc0hlbHBUeXBlKHBhcmFtRGF0YUl0ZW0ucGFyYW1ldGVyVHlwZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBwYXJhbURhdGFJdGVtLnZhbHVlVGV4dCA9IGRhdGEuZGF0YVZhbHVlVGV4dHx8Jyc7XHJcbiAgICAgICAgICAgICAgICAvLyDku47liY3nq6/ojrflj5bluK7liqnmlbDmja5cclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuZ2V0SGVscERhdGEoZGF0YSxwYXJhbURhdGFJdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMucGFyYW1WYWx1ZXNDbG9uZSh0aGlzLnBhcmFtRGF0YUl0ZW1zQ2xvbmUsdGhpcy5wYXJhbURhdGFJdGVtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwYXJhbVZhbHVlc0Nsb25lKHRhcmdldDphbnlbXSxzb3VyY2U6YW55W10pIHtcclxuICAgICAgICBpZihzb3VyY2UubGVuZ3RoPT0wfHx0YXJnZXQubGVuZ3RoPT0wfHx0YXJnZXQubGVuZ3RoIT09c291cmNlLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFyZ2V0Lm1hcChwYXJhbURhdGFJdGVtQ2xvbmUgPT4ge1xyXG4gICAgICAgICAgICBsZXQgaW5kZXggPSBzb3VyY2UuZmluZEluZGV4KHggPT4geC5jb2RlID09PSBwYXJhbURhdGFJdGVtQ2xvbmUuY29kZSk7XHJcbiAgICAgICAgICAgIGlmKGluZGV4IT09KC0xKSl7XHJcbiAgICAgICAgICAgICAgICBwYXJhbURhdGFJdGVtQ2xvbmUuaWQgPSBzb3VyY2VbaW5kZXhdLmlkO1xyXG4gICAgICAgICAgICAgICAgcGFyYW1EYXRhSXRlbUNsb25lLnZhbHVlID0gc291cmNlW2luZGV4XS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIHBhcmFtRGF0YUl0ZW1DbG9uZS52YWx1ZVRleHQ9c291cmNlW2luZGV4XS52YWx1ZVRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGxvYWREaW1lbnNpb25EYXRhRnJvbVJlbW90ZSgpIHtcclxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zSW5pdCgpO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEluc3RhbmNlLnBhcmFtRGF0YUl0ZW1zID0gdGhpcy5wYXJhbURhdGFJdGVtcztcclxuICAgICAgICBsZXQgZGltZW5zaW9uSXRlbVZhbHVlcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuZGltZW5zaW9uSXRlbURhdGFzLm1hcCgoeDogRGltZW5zaW9uSXRlbURhdGEpID0+IGRpbWVuc2lvbkl0ZW1WYWx1ZXMucHVzaCh4LnZhbHVlKSk7XHJcbiAgICAgICAgbGV0IGNvdW50PWRpbWVuc2lvbkl0ZW1WYWx1ZXMubGVuZ3RoO1xyXG4gICAgICAgIGlmKGNvdW50PD0wKXtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihjb3VudD09PTEpe1xyXG4gICAgICAgICAgICBpZighZGltZW5zaW9uSXRlbVZhbHVlc1swXSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoY291bnQ9PT0yKXtcclxuICAgICAgICAgICAgaWYoIWRpbWVuc2lvbkl0ZW1WYWx1ZXNbMF18fCFkaW1lbnNpb25JdGVtVmFsdWVzWzFdKXtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZGltZW5zaW9uMT1kaW1lbnNpb25JdGVtVmFsdWVzWzBdP2RpbWVuc2lvbkl0ZW1WYWx1ZXNbMF06bnVsbDtcclxuICAgICAgICBsZXQgZGltZW5zaW9uMj1kaW1lbnNpb25JdGVtVmFsdWVzWzFdP2RpbWVuc2lvbkl0ZW1WYWx1ZXNbMV06bnVsbDtcclxuICAgICAgICB0aGlzLmh0dHAuZ2V0RGltZW5zaW9uRGF0YSh0aGlzLl9hc3NpZ25tZW50LnRlbXBsYXRlSWQsIFxyXG4gICAgICAgICAgICB0aGlzLl9hc3NpZ25tZW50LmJpelR5cGVJZCxcclxuICAgICAgICAgICAgZGltZW5zaW9uMSxkaW1lbnNpb24yLGNvdW50KS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIChkYXRhSXRlbXM6IEFycmF5PERhdGFJdGVtPikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRQYXJhbVZhbHVlcyhkYXRhSXRlbXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcGFyYW1EYXRhSXRlbXNJbml0KCkge1xyXG4gICAgICAgIGxldCB0ZW1wbGF0ZT10aGlzLnRlbXBsYXRlU2VyaWFsaXplci5kZXNlcmlhbGl6ZXIodGhpcy50ZW1wbGF0ZVNlcmlhbGl6ZXIuc2VyaWFsaXplKHRoaXMudGVtcGxhdGUpKTtcclxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zID0gW107XHJcbiAgICAgICAgaWYgKHRlbXBsYXRlJiYgdGVtcGxhdGUucGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5wYXJhbXMubWFwKHg9PntcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLl9hc3NpZ25tZW50LnVzZURpbWVuc2lvbil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uUGFyYW1EZWZhdWx0VmFsdWVJbml0KHggYXMgQmFzZVBhcmFtRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh4IGFzIEJhc2VQYXJhbURhdGEpLnZhbHVlPXguZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zLnB1c2goeCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXNDbG9uZUluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRpbWVuc2lvblBhcmFtRGVmYXVsdFZhbHVlSW5pdChwYXJhbURhdGE6QmFzZVBhcmFtRGF0YSl7XHJcbiAgICAgICAgbGV0IGNvdW50PXRoaXMuZGltZW5zaW9uSXRlbURhdGFzLmxlbmd0aDtcclxuICAgICAgICBpZihjb3VudDw9MCl7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoY291bnQ9PT0xKXtcclxuICAgICAgICAgICAgaWYoIXRoaXMuZGltZW5zaW9uSXRlbURhdGFzWzBdfHwhdGhpcy5kaW1lbnNpb25JdGVtRGF0YXNbMF0udmFsdWUpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGNvdW50PT09Mil7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmRpbWVuc2lvbkl0ZW1EYXRhc1swXXx8IXRoaXMuZGltZW5zaW9uSXRlbURhdGFzWzFdfHwhdGhpcy5kaW1lbnNpb25JdGVtRGF0YXNbMF0udmFsdWV8fCF0aGlzLmRpbWVuc2lvbkl0ZW1EYXRhc1sxXS52YWx1ZSl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcGFyYW1EYXRhLnZhbHVlPXBhcmFtRGF0YS5kZWZhdWx0VmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBwYXJhbURhdGFJdGVtc0Nsb25lSW5pdCgpIHtcclxuICAgICAgICBsZXQgdGVtcGxhdGU9dGhpcy50ZW1wbGF0ZVNlcmlhbGl6ZXIuZGVzZXJpYWxpemVyKHRoaXMudGVtcGxhdGVTZXJpYWxpemVyLnNlcmlhbGl6ZSh0aGlzLnRlbXBsYXRlKSk7XHJcbiAgICAgICAgdGhpcy5wYXJhbURhdGFJdGVtc0Nsb25lID0gW107XHJcbiAgICAgICAgaWYgKHRlbXBsYXRlJiYgdGVtcGxhdGUucGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZS5wYXJhbXMubWFwKHg9PntcclxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLl9hc3NpZ25tZW50LnVzZURpbWVuc2lvbil7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uUGFyYW1EZWZhdWx0VmFsdWVJbml0KHggYXMgQmFzZVBhcmFtRGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh4IGFzIEJhc2VQYXJhbURhdGEpLnZhbHVlPXguZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zQ2xvbmUucHVzaCh4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkaW1lbnNpb25EYXRhSXRlbXNJbml0KCkge1xyXG4gICAgICAgIGxldCBhc3NpZ25tZW50PXRoaXMuYXNzaWdubWVudFNlcmlhbGl6ZXIuZGVzZXJpYWxpemUodGhpcy5hc3NpZ25tZW50U2VyaWFsaXplci5zZXJpYWxpemUodGhpcy5fYXNzaWdubWVudCkpO1xyXG4gICAgICAgIGlmIChhc3NpZ25tZW50JiZhc3NpZ25tZW50LmRpbWVuc2lvbkluZm9cclxuICAgICAgICAgICAgJiYgYXNzaWdubWVudC5kaW1lbnNpb25JbmZvLmRlZmluaXRpb25cclxuICAgICAgICAgICAgJiYgYXNzaWdubWVudC5kaW1lbnNpb25JbmZvLmRlZmluaXRpb24uZGltZW5zaW9uSXRlbXMpIHtcclxuICAgICAgICAgICAgdGhpcy5kaW1lbnNpb25JdGVtRGF0YXMgPSBbXTtcclxuICAgICAgICAgICAgYXNzaWdubWVudC5kaW1lbnNpb25JbmZvLmRlZmluaXRpb24uZGltZW5zaW9uSXRlbXMuZm9yRWFjaChkaW1lbnNpb25EYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uSXRlbURhdGFzLnB1c2goZGltZW5zaW9uRGF0YSBhcyBEaW1lbnNpb25JdGVtRGF0YSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVBhcmFtRGF0YVVpQ29tcG9uZW50KCkge1xyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhUGFuZWwuY2xlYXIoKTtcclxuICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShVYmNjUGFyYW1EYXRhVWlDb21wb25lbnQpO1xyXG4gICAgICAgIGxldCBjbXBSZWYgPSB0aGlzLnBhcmFtRGF0YVBhbmVsLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcclxuICAgICAgICBjbXBSZWYuaW5zdGFuY2UuY2FuRWRpdCA9IHRoaXMuY2FuRWRpdDtcclxuICAgICAgICBjbXBSZWYuaW5zdGFuY2UudGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlO1xyXG4gICAgICAgIGNtcFJlZi5pbnN0YW5jZS5wYXJhbURhdGFJdGVtcyA9IHRoaXMucGFyYW1EYXRhSXRlbXM7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50SW5zdGFuY2U9Y21wUmVmLmluc3RhbmNlO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlRGltZW5zaW9uUm9vdFVpQ29tcG9uZW50KCkge1xyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhUGFuZWwuY2xlYXIoKTtcclxuICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShVYmNjUGFyYW1EaW1lbnNpb25VaVJvb3RDb21wb25lbnQpO1xyXG4gICAgICAgIGxldCBjbXBSZWYgPSB0aGlzLnBhcmFtRGF0YVBhbmVsLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcclxuICAgICAgICBjbXBSZWYuaW5zdGFuY2UuY2FuRWRpdCA9IHRoaXMuY2FuRWRpdDtcclxuICAgICAgICBjbXBSZWYuaW5zdGFuY2UuZGltZW5zaW9uSXRlbURhdGFzID0gdGhpcy5kaW1lbnNpb25JdGVtRGF0YXM7XHJcbiAgICAgICAgY21wUmVmLmluc3RhbmNlLnBhcmFtRGF0YUl0ZW1zID0gdGhpcy5wYXJhbURhdGFJdGVtcztcclxuICAgICAgICBjbXBSZWYuaW5zdGFuY2UudGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlO1xyXG4gICAgICAgIHRoaXMuY3VycmVudEluc3RhbmNlPWNtcFJlZi5pbnN0YW5jZTtcclxuICAgIH1cclxuXHJcbiAgICBjb252ZXJ0RGltZW5zaW9uRGF0YVRvRGF0YVZvKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5kaW1lbnNpb25JdGVtRGF0YXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBkaW1lbnNpb25WYWx1ZXMgPSBuZXcgQXJyYXk8RGF0YUl0ZW0+KCk7XHJcbiAgICAgICAgdGhpcy5kaW1lbnNpb25JdGVtRGF0YXMubWFwKHggPT4ge1xyXG4gICAgICAgICAgICBsZXQgZGltZW5zaW9uVmFsdWUgPSBuZXcgRGF0YUl0ZW0oKTtcclxuICAgICAgICAgICAgZGltZW5zaW9uVmFsdWUuZGF0YUNvZGUgPSB4LmNvZGU7XHJcbiAgICAgICAgICAgIGRpbWVuc2lvblZhbHVlLmRhdGFWYWx1ZSA9ICh4IGFzIERpbWVuc2lvbkl0ZW1EYXRhKS52YWx1ZTtcclxuICAgICAgICAgICAgZGltZW5zaW9uVmFsdWUuZGF0YVR5cGUgPSB0aGlzLmdldERpbWVuc2lvblZhbHVlVHlwZSh4LmRhdGFUeXBlKTtcclxuICAgICAgICAgICAgZGltZW5zaW9uVmFsdWVzLnB1c2goZGltZW5zaW9uVmFsdWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkaW1lbnNpb25WYWx1ZXM7XHJcbiAgICB9XHJcblxyXG4gICAgY29udmVydFBhcmFtRGF0YVRvRGF0YVZvKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5wYXJhbURhdGFJdGVtcykge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHBhcmFtVmFsdWVzID0gbmV3IEFycmF5PERhdGFJdGVtPigpO1xyXG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXMubWFwKHggPT4ge1xyXG4gICAgICAgICAgICBsZXQgcGFyYW1WYWx1ZSA9IG5ldyBEYXRhSXRlbSgpO1xyXG4gICAgICAgICAgICBwYXJhbVZhbHVlLmRhdGFDb2RlID0geC5jb2RlO1xyXG4gICAgICAgICAgICBwYXJhbVZhbHVlLmRhdGFWYWx1ZSA9ICh4IGFzIEJhc2VQYXJhbURhdGEpLnZhbHVlO1xyXG4gICAgICAgICAgICBwYXJhbVZhbHVlLmRhdGFUeXBlID0gdGhpcy5nZXRQYXJhbVZhbHVlVHlwZSgoeCBhcyBCYXNlUGFyYW1EYXRhKS5wYXJhbWV0ZXJUeXBlKTtcclxuICAgICAgICAgICAgcGFyYW1WYWx1ZXMucHVzaChwYXJhbVZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnBhcmFtVmFsdWVzQ2xvbmUodGhpcy5wYXJhbURhdGFJdGVtc0Nsb25lLHRoaXMucGFyYW1EYXRhSXRlbXMpO1xyXG4gICAgICAgIHJldHVybiBwYXJhbVZhbHVlcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldERpbWVuc2lvblZhbHVlVHlwZShkYXRhVHlwZTogSURhdGFUeXBlKSB7XHJcbiAgICAgICAgbGV0IGtpbmQgPSBkYXRhVHlwZS5nZXRLaW5kKCk7XHJcbiAgICAgICAgc3dpdGNoIChraW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGVDb25zdC5ERUZBVUxUX1BSSU1JVElWRTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBgJHtEYXRhVHlwZUNvbnN0LkRFRkFVTFRfUFJJTUlUSVZFfS4keyhkYXRhVHlwZSBhcyBQcmltaXRpdmVUeXBlKS5wcmltaXRpdmVUeXBlS2luZH1gO1xyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlQ29uc3QuREVGQVVMVF9FTlVNRVJBVElPTjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBEYXRhVHlwZUNvbnN0LkRFRkFVTFRfRU5VTUVSQVRJT047XHJcbiAgICAgICAgICAgIGNhc2UgRGF0YVR5cGVFeHRlbnNpb25Db25zdC5IRUxQX1RZUEU6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRGF0YVR5cGVFeHRlbnNpb25Db25zdC5IRUxQX1RZUEUrYCMjJHsoZGF0YVR5cGUgYXMgSGVscFR5cGUpLmhlbHBJZH1gO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuJrliqHlj4LmlbDkuI3mlK/mjIHnmoTlj4LmlbDnsbvlnoske2tpbmR9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0UGFyYW1WYWx1ZVR5cGUoZGF0YVR5cGU6IElEYXRhVHlwZSkge1xyXG4gICAgICAgIGxldCBraW5kID0gZGF0YVR5cGUuZ2V0S2luZCgpO1xyXG4gICAgICAgIHN3aXRjaCAoa2luZCkge1xyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlQ29uc3QuREVGQVVMVF9DT0xMRUNUSU9OOlxyXG4gICAgICAgICAgICAgICAgbGV0IGVsZW1ldFR5cGUgPSAoZGF0YVR5cGUgYXMgQ29sbGVjdGlvblR5cGUpLmVsZW1lbnRUeXBlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke0RhdGFUeXBlQ29uc3QuREVGQVVMVF9DT0xMRUNUSU9OfS5gICsgdGhpcy5nZXRQYXJhbVZhbHVlVHlwZShlbGVtZXRUeXBlKTtcclxuICAgICAgICAgICAgY2FzZSBEYXRhVHlwZUNvbnN0LkRFRkFVTFRfUFJJTUlUSVZFOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke0RhdGFUeXBlQ29uc3QuREVGQVVMVF9QUklNSVRJVkV9LiR7UHJpbWl0aXZlVHlwZUtpbmRbKGRhdGFUeXBlIGFzIFByaW1pdGl2ZVR5cGUpLnByaW1pdGl2ZVR5cGVLaW5kXX1gO1xyXG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlRXh0ZW5zaW9uQ29uc3QuVUJDQ19TVFJVQ1RVUkVfVFlQRV9SRUY6XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVmVHlwZSA9IGRhdGFUeXBlIGFzIFN0cnVjdHVyZVR5cGVSZWY7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVmVHlwZS50eXBlID09PSBTdHJ1Y3R1cmVUeXBlUmVmRW51bS5IRUxQID8gRGF0YVR5cGVFeHRlbnNpb25Db25zdC5IRUxQX1RZUEUgK2AjIyR7cmVmVHlwZS5yZWZJZH1gOiBEYXRhVHlwZUNvbnN0LkRFRkFVTFRfRU5VTUVSQVRJT047XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOS4muWKoeWPguaVsOS4jeaUr+aMgeeahOWPguaVsOexu+WeiyR7a2luZH1gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY2FuY2VsKCl7XHJcbiAgICAgICAgdGhpcy5wYXJhbVZhbHVlc0Nsb25lKHRoaXMucGFyYW1EYXRhSXRlbXMsdGhpcy5wYXJhbURhdGFJdGVtc0Nsb25lKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRJbnN0YW5jZS5wYXJhbURhdGFJdGVtcz10aGlzLnBhcmFtRGF0YUl0ZW1zO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
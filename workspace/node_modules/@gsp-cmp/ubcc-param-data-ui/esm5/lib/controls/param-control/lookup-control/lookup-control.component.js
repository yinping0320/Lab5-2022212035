/**
 * @fileoverview added by tsickle
 * Generated from: lib/controls/param-control/lookup-control/lookup-control.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from '@angular/core';
import { UbccParamTemplate, DataTypeExtensionConst } from '@gsp-cmp/ubcc-param-vo';
import { DataTypeConst } from '@ecp-caf/common-structure';
import { GSPMetadataRTService } from '@gsp-lcm/metadatart-selector';
import { ServerSideToken } from '@farris/ui-lookup';
import { LookUpHttpService } from '../../../service/lookup-http-service';
import { LookUpBindingFields } from '../../../common/look-up-binding-fields';
/** @type {?} */
var BCC_HELP_URL = "/api/runtime/bcc/v1.0/param/help/{helpId}";
var LookupControlComponent = /** @class */ (function () {
    function LookupControlComponent(metadataRTService) {
        this.metadataRTService = metadataRTService;
        this.canEdit = true;
        this.isSingleSelect = true;
        this.isHelpInfoLoad = false;
        this.helpUrl = BCC_HELP_URL;
    }
    /**
     * @return {?}
     */
    LookupControlComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.param = this.param || {};
        this.bindingFields = this.bindingFields || new LookUpBindingFields();
        this.helpConfigInit();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    LookupControlComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        this.helpConfigInit();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    LookupControlComponent.prototype.selectedHelpHandler = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        var _this = this;
        if (!$event) {
            return;
        }
        this.param.value = '';
        this.param.valueText = '';
        if (this.isCollection()) {
            if ($event.length <= 0) {
                return;
            }
            $event.map((/**
             * @param {?} selectItem
             * @param {?} index
             * @return {?}
             */
            function (selectItem, index) {
                _this.param.value = _this.param.value + (index > 0 ? "," + selectItem[_this.bindingFields.idField] : selectItem[_this.bindingFields.idField]);
                _this.param.valueText = _this.param.valueText + (index > 0 ? "," + selectItem[_this.bindingFields.textField] : selectItem[_this.bindingFields.textField]);
            }));
        }
        else {
            this.param.value = $event[this.bindingFields.idField];
            this.param.valueText = $event[this.bindingFields.textField];
        }
    };
    /**
     * @private
     * @return {?}
     */
    LookupControlComponent.prototype.helpConfigInit = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.isHelpInfoLoad || !this.param || !this.param.parameterType) {
            return;
        }
        if (this.param.parameterType.kind === DataTypeConst.DEFAULT_COLLECTION) {
            this.isSingleSelect = false;
            /** @type {?} */
            var elementType = (/** @type {?} */ (this.getCollectionElementType(this.param.parameterType)));
            this.loadDataFromMetadata(elementType);
        }
        else if (this.param.parameterType.kind === DataTypeExtensionConst.UBCC_STRUCTURE_TYPE_REF) {
            this.isSingleSelect = true;
            /** @type {?} */
            var typeRef = (/** @type {?} */ (this.param.parameterType));
            this.loadDataFromMetadata(typeRef);
        }
        else {
            throw new Error("\u5E2E\u52A9\u4E0D\u652F\u6301\u7684\u53C2\u6570\u7C7B\u578B" + this.param.parameterType.kind);
        }
    };
    /**
     * @private
     * @param {?} refType
     * @return {?}
     */
    LookupControlComponent.prototype.loadDataFromMetadata = /**
     * @private
     * @param {?} refType
     * @return {?}
     */
    function (refType) {
        var _this = this;
        if (!refType.refId) {
            return;
        }
        this.metadataRTService.GetMetadataRT(refType.refId).subscribe((/**
         * @param {?} metadataDto
         * @return {?}
         */
        function (metadataDto) {
            /** @type {?} */
            var helpMetadata = JSON.parse(metadataDto.content);
            _this.setHelpInfo(helpMetadata);
            _this.isHelpInfoLoad = true;
        }));
    };
    /**
     * @param {?} helpMetadata
     * @return {?}
     */
    LookupControlComponent.prototype.setHelpInfo = /**
     * @param {?} helpMetadata
     * @return {?}
     */
    function (helpMetadata) {
        this.helpUrl = BCC_HELP_URL.replace('{helpId}', helpMetadata.id);
        this.bindingFields.idField = helpMetadata.idField;
        this.bindingFields.textField = helpMetadata.textField;
        this.bindingFields.valueField = helpMetadata.valueField;
        this.bindingFields.displayType = helpMetadata.displayType;
    };
    /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    LookupControlComponent.prototype.getCollectionElementType = /**
     * @private
     * @param {?} dataType
     * @return {?}
     */
    function (dataType) {
        /** @type {?} */
        var kind = dataType.getKind();
        switch (kind) {
            case DataTypeConst.DEFAULT_COLLECTION:
                /** @type {?} */
                var elementType = ((/** @type {?} */ (dataType))).elementType;
                return this.getCollectionElementType(elementType);
            default:
                return dataType;
        }
    };
    /**
     * @return {?}
     */
    LookupControlComponent.prototype.isCollection = /**
     * @return {?}
     */
    function () {
        if (!this.param || !this.param.parameterType) {
            return false;
        }
        if (this.param.parameterType.getKind() === DataTypeConst.DEFAULT_COLLECTION) {
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @return {?}
     */
    LookupControlComponent.prototype.isReadonly = /**
     * @return {?}
     */
    function () {
        if (!this.canEdit) {
            return true;
        }
        else {
            return !this.param || !this.param.readonly ? false : true;
        }
    };
    /**
     * @return {?}
     */
    LookupControlComponent.prototype.show = /**
     * @return {?}
     */
    function () {
        return !this.param || !this.param.description ? false : true;
    };
    LookupControlComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-lookup-control',
                    template: "<div class=\"farris-form-controls-inline farris-group-wrap col-12\">\n  <div class=\"form-group farris-form-group\">\n    <label class=\"col-form-label col-4\">\n      <span class=\"farris-label-text\" style=\"float:right\">{{param.name}}</span>\n    </label>\n    <div class=\"farris-input-wrap col-6\">\n      <farris-lookup-grid [editable]=\"false\" [readonly]=\"isReadonly()\" (selectedData)=\"selectedHelpHandler($event)\" [uri]=\"helpUrl\" [idField]=\"bindingFields.idField\"\n        [textField]=\"bindingFields.textField\" [valueField]=\"bindingFields.valueField\" [enableClear]=\"false\" [displayType]=\"bindingFields.displayType\"\n        [(ngModel)]=\"param.valueText\" name=\"{{param.code}}\" [pagination]=\"true\" [singleSelect]=\"isSingleSelect\">\n      </farris-lookup-grid>\n    </div>\n     <span *ngIf=\"show()\" farrisTooltip [placement]=\"'right-top'\" [content]=\"param.description\" class=\"f-icon f-icon-info\"></span>\n  </div>\n</div>",
                    providers: [{ provide: ServerSideToken, useClass: LookUpHttpService }, GSPMetadataRTService],
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    LookupControlComponent.ctorParameters = function () { return [
        { type: GSPMetadataRTService }
    ]; };
    LookupControlComponent.propDecorators = {
        param: [{ type: Input }],
        template: [{ type: Input }],
        canEdit: [{ type: Input }]
    };
    return LookupControlComponent;
}());
export { LookupControlComponent };
if (false) {
    /** @type {?} */
    LookupControlComponent.prototype.param;
    /** @type {?} */
    LookupControlComponent.prototype.template;
    /** @type {?} */
    LookupControlComponent.prototype.canEdit;
    /** @type {?} */
    LookupControlComponent.prototype.isSingleSelect;
    /** @type {?} */
    LookupControlComponent.prototype.isHelpInfoLoad;
    /** @type {?} */
    LookupControlComponent.prototype.bindingFields;
    /** @type {?} */
    LookupControlComponent.prototype.helpUrl;
    /**
     * @type {?}
     * @private
     */
    LookupControlComponent.prototype.metadataRTService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9va3VwLWNvbnRyb2wuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1jbXAvdWJjYy1wYXJhbS1kYXRhLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbnRyb2xzL3BhcmFtLWNvbnRyb2wvbG9va3VwLWNvbnRyb2wvbG9va3VwLWNvbnRyb2wuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQTRCLE1BQU0sZUFBZSxDQUFDO0FBQ25GLE9BQU8sRUFBRSxpQkFBaUIsRUFBb0Isc0JBQXNCLEVBQUMsTUFBTSx3QkFBd0IsQ0FBQztBQUNwRyxPQUFPLEVBQUUsYUFBYSxFQUE2QixNQUFNLDJCQUEyQixDQUFDO0FBQ3JGLE9BQU8sRUFBZSxvQkFBb0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUN6RSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQzs7SUFFdkUsWUFBWSxHQUFDLDJDQUEyQztBQUU5RDtJQXNCSSxnQ0FBb0IsaUJBQXVDO1FBQXZDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBc0I7UUFWbEQsWUFBTyxHQUFTLElBQUksQ0FBQztRQUU5QixtQkFBYyxHQUFTLElBQUksQ0FBQztRQUU1QixtQkFBYyxHQUFTLEtBQUssQ0FBQztRQUk3QixZQUFPLEdBQVMsWUFBWSxDQUFDO0lBRW1DLENBQUM7Ozs7SUFFakUseUNBQVE7OztJQUFSO1FBQ0ksSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsYUFBYSxHQUFDLElBQUksQ0FBQyxhQUFhLElBQUUsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1FBQ2pFLElBQUksQ0FB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Q0FBb0M7O0lBRXBDLHlDQUE4Qjs7SUFFOUIsZ0RBQTRCOztJQUU1QixnREFBNkI7O0lBRTdCLCtDQUFrQzs7SUFFbEMseUNBQTZCOzs7OztJQUVqQixtREFBK0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVWJjY1BhcmFtVGVtcGxhdGUsIFN0cnVjdHVyZVR5cGVSZWYsIERhdGFUeXBlRXh0ZW5zaW9uQ29uc3R9IGZyb20gJ0Bnc3AtY21wL3ViY2MtcGFyYW0tdm8nO1xuaW1wb3J0IHsgRGF0YVR5cGVDb25zdCwgSURhdGFUeXBlLCBDb2xsZWN0aW9uVHlwZSB9IGZyb20gJ0BlY3AtY2FmL2NvbW1vbi1zdHJ1Y3R1cmUnO1xuaW1wb3J0IHsgTWV0YWRhdGFEdG8sIEdTUE1ldGFkYXRhUlRTZXJ2aWNlIH0gZnJvbSAnQGdzcC1sY20vbWV0YWRhdGFydC1zZWxlY3Rvcic7XG5pbXBvcnQgeyBTZXJ2ZXJTaWRlVG9rZW4gfSBmcm9tICdAZmFycmlzL3VpLWxvb2t1cCc7XG5pbXBvcnQgeyBMb29rVXBIdHRwU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2UvbG9va3VwLWh0dHAtc2VydmljZSc7XG5pbXBvcnQgeyBMb29rVXBCaW5kaW5nRmllbGRzIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2xvb2stdXAtYmluZGluZy1maWVsZHMnO1xuXG5jb25zdCBCQ0NfSEVMUF9VUkw9YC9hcGkvcnVudGltZS9iY2MvdjEuMC9wYXJhbS9oZWxwL3toZWxwSWR9YDtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsaWItbG9va3VwLWNvbnRyb2wnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9sb29rdXAtY29udHJvbC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vbG9va3VwLWNvbnRyb2wuY29tcG9uZW50LmNzcyddLFxuICAgIHByb3ZpZGVyczogW3sgcHJvdmlkZTogU2VydmVyU2lkZVRva2VuLCB1c2VDbGFzczogTG9va1VwSHR0cFNlcnZpY2UgfSwgR1NQTWV0YWRhdGFSVFNlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIExvb2t1cENvbnRyb2xDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQgLE9uQ2hhbmdlc3tcbiAgICBcbiAgICBASW5wdXQoKSBwYXJhbTphbnk7XG5cbiAgICBASW5wdXQoKSB0ZW1wbGF0ZTpVYmNjUGFyYW1UZW1wbGF0ZTtcblxuICAgIEBJbnB1dCgpIGNhbkVkaXQ6Ym9vbGVhbj10cnVlO1xuICAgIFxuICAgIGlzU2luZ2xlU2VsZWN0OmJvb2xlYW49dHJ1ZTtcblxuICAgIGlzSGVscEluZm9Mb2FkOmJvb2xlYW49ZmFsc2U7XG5cbiAgICBiaW5kaW5nRmllbGRzOkxvb2tVcEJpbmRpbmdGaWVsZHM7XG5cbiAgICBoZWxwVXJsOnN0cmluZz0gQkNDX0hFTFBfVVJMO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBtZXRhZGF0YVJUU2VydmljZTogR1NQTWV0YWRhdGFSVFNlcnZpY2UsKSB7IH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnBhcmFtID0gdGhpcy5wYXJhbSB8fCB7fTtcbiAgICAgICAgdGhpcy5iaW5kaW5nRmllbGRzPXRoaXMuYmluZGluZ0ZpZWxkc3x8bmV3IExvb2tVcEJpbmRpbmdGaWVsZHMoKTtcbiAgICAgICAgdGhpcy5oZWxwQ29uZmlnSW5pdCgpO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5oZWxwQ29uZmlnSW5pdCgpO1xuICAgIH1cblxuICAgIHNlbGVjdGVkSGVscEhhbmRsZXIoJGV2ZW50KSB7XG4gICAgICAgIGlmICghJGV2ZW50KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wYXJhbS52YWx1ZSA9ICcnO1xuICAgICAgICB0aGlzLnBhcmFtLnZhbHVlVGV4dCA9ICcnO1xuICAgICAgICBpZiAodGhpcy5pc0NvbGxlY3Rpb24oKSkge1xuICAgICAgICAgICAgaWYgKCRldmVudC5sZW5ndGggPD0wKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGV2ZW50Lm1hcCgoc2VsZWN0SXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmFtLnZhbHVlPXRoaXMucGFyYW0udmFsdWUrKGluZGV4PjA/YCwke3NlbGVjdEl0ZW1bdGhpcy5iaW5kaW5nRmllbGRzLmlkRmllbGRdfWA6c2VsZWN0SXRlbVt0aGlzLmJpbmRpbmdGaWVsZHMuaWRGaWVsZF0pO1xuICAgICAgICAgICAgICAgIHRoaXMucGFyYW0udmFsdWVUZXh0PXRoaXMucGFyYW0udmFsdWVUZXh0KyhpbmRleD4wP2AsJHtzZWxlY3RJdGVtW3RoaXMuYmluZGluZ0ZpZWxkcy50ZXh0RmllbGRdfWA6c2VsZWN0SXRlbVt0aGlzLmJpbmRpbmdGaWVsZHMudGV4dEZpZWxkXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGFyYW0udmFsdWUgPSAkZXZlbnRbdGhpcy5iaW5kaW5nRmllbGRzLmlkRmllbGRdO1xuICAgICAgICAgICAgdGhpcy5wYXJhbS52YWx1ZVRleHQ9JGV2ZW50W3RoaXMuYmluZGluZ0ZpZWxkcy50ZXh0RmllbGRdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoZWxwQ29uZmlnSW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNIZWxwSW5mb0xvYWQgfHwgIXRoaXMucGFyYW0gfHwgIXRoaXMucGFyYW0ucGFyYW1ldGVyVHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcmFtLnBhcmFtZXRlclR5cGUua2luZCA9PT0gRGF0YVR5cGVDb25zdC5ERUZBVUxUX0NPTExFQ1RJT04pIHtcbiAgICAgICAgICAgIHRoaXMuaXNTaW5nbGVTZWxlY3Q9ZmFsc2U7XG4gICAgICAgICAgICBsZXQgZWxlbWVudFR5cGUgPSB0aGlzLmdldENvbGxlY3Rpb25FbGVtZW50VHlwZSh0aGlzLnBhcmFtLnBhcmFtZXRlclR5cGUpIGFzIFN0cnVjdHVyZVR5cGVSZWY7XG4gICAgICAgICAgICB0aGlzLmxvYWREYXRhRnJvbU1ldGFkYXRhKGVsZW1lbnRUeXBlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnBhcmFtLnBhcmFtZXRlclR5cGUua2luZCA9PT0gRGF0YVR5cGVFeHRlbnNpb25Db25zdC5VQkNDX1NUUlVDVFVSRV9UWVBFX1JFRikge1xuICAgICAgICAgICAgdGhpcy5pc1NpbmdsZVNlbGVjdD10cnVlO1xuICAgICAgICAgICAgbGV0IHR5cGVSZWYgPSB0aGlzLnBhcmFtLnBhcmFtZXRlclR5cGUgYXMgU3RydWN0dXJlVHlwZVJlZjtcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGFGcm9tTWV0YWRhdGEodHlwZVJlZik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOW4ruWKqeS4jeaUr+aMgeeahOWPguaVsOexu+WeiyR7dGhpcy5wYXJhbS5wYXJhbWV0ZXJUeXBlLmtpbmR9YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcHJpdmF0ZSBsb2FkRGF0YUZyb21NZXRhZGF0YShyZWZUeXBlOiBTdHJ1Y3R1cmVUeXBlUmVmKSB7XG4gICAgICAgIGlmICghcmVmVHlwZS5yZWZJZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubWV0YWRhdGFSVFNlcnZpY2UuR2V0TWV0YWRhdGFSVChyZWZUeXBlLnJlZklkKS5zdWJzY3JpYmUoKG1ldGFkYXRhRHRvOiBNZXRhZGF0YUR0bykgPT4ge1xuICAgICAgICAgICAgbGV0IGhlbHBNZXRhZGF0YSA9IEpTT04ucGFyc2UobWV0YWRhdGFEdG8uY29udGVudCk7XG4gICAgICAgICAgICB0aGlzLnNldEhlbHBJbmZvKGhlbHBNZXRhZGF0YSk7XG4gICAgICAgICAgICB0aGlzLmlzSGVscEluZm9Mb2FkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgc2V0SGVscEluZm8oaGVscE1ldGFkYXRhOmFueSl7XG4gICAgICAgIHRoaXMuaGVscFVybCA9IEJDQ19IRUxQX1VSTC5yZXBsYWNlKCd7aGVscElkfScsIGhlbHBNZXRhZGF0YS5pZCk7XG4gICAgICAgIHRoaXMuYmluZGluZ0ZpZWxkcy5pZEZpZWxkID0gaGVscE1ldGFkYXRhLmlkRmllbGQ7XG4gICAgICAgIHRoaXMuYmluZGluZ0ZpZWxkcy50ZXh0RmllbGQgPSBoZWxwTWV0YWRhdGEudGV4dEZpZWxkO1xuICAgICAgICB0aGlzLmJpbmRpbmdGaWVsZHMudmFsdWVGaWVsZCA9IGhlbHBNZXRhZGF0YS52YWx1ZUZpZWxkO1xuICAgICAgICB0aGlzLmJpbmRpbmdGaWVsZHMuZGlzcGxheVR5cGUgPSBoZWxwTWV0YWRhdGEuZGlzcGxheVR5cGU7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb2xsZWN0aW9uRWxlbWVudFR5cGUoZGF0YVR5cGU6IElEYXRhVHlwZSkge1xuICAgICAgICBsZXQga2luZCA9IGRhdGFUeXBlLmdldEtpbmQoKTtcbiAgICAgICAgc3dpdGNoIChraW5kKSB7XG4gICAgICAgICAgICBjYXNlIERhdGFUeXBlQ29uc3QuREVGQVVMVF9DT0xMRUNUSU9OOlxuICAgICAgICAgICAgICAgIGxldCBlbGVtZW50VHlwZSA9IChkYXRhVHlwZSBhcyBDb2xsZWN0aW9uVHlwZSkuZWxlbWVudFR5cGU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sbGVjdGlvbkVsZW1lbnRUeXBlKGVsZW1lbnRUeXBlKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFUeXBlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXNDb2xsZWN0aW9uKCkge1xuICAgICAgICBpZiAoIXRoaXMucGFyYW0gfHwgIXRoaXMucGFyYW0ucGFyYW1ldGVyVHlwZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcmFtLnBhcmFtZXRlclR5cGUuZ2V0S2luZCgpID09PSBEYXRhVHlwZUNvbnN0LkRFRkFVTFRfQ09MTEVDVElPTikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc1JlYWRvbmx5KCl7XG4gICAgICAgIGlmKCF0aGlzLmNhbkVkaXQpe1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIHJldHVybiAhdGhpcy5wYXJhbXx8IXRoaXMucGFyYW0ucmVhZG9ubHk/ZmFsc2U6dHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNob3coKXtcbiAgICAgICAgcmV0dXJuICF0aGlzLnBhcmFtfHwhdGhpcy5wYXJhbS5kZXNjcmlwdGlvbj9mYWxzZTp0cnVlO1xuICAgIH1cbn1cbiJdfQ==
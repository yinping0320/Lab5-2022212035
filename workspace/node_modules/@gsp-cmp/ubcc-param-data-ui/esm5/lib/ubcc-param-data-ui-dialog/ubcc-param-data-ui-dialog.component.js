/**
 * @fileoverview added by tsickle
 * Generated from: lib/ubcc-param-data-ui-dialog/ubcc-param-data-ui-dialog.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Output, EventEmitter, Input, TemplateRef, ViewChild } from '@angular/core';
import { UbccParamTemplate, UbccParamTemplateSerializer } from '@gsp-cmp/ubcc-param-vo';
import { UbccParamDataManangerService } from '../service/http-service';
import { DataTypeConst } from '@ecp-caf/common-structure';
import { UbccParamDataUtils } from '../utils/param-data-utils';
var UbccParamDataUiDialogComponent = /** @class */ (function () {
    function UbccParamDataUiDialogComponent(utils, http) {
        var _this = this;
        this.utils = utils;
        this.http = http;
        this.paramDataItems = [];
        this.confirmEmitter = new EventEmitter();
        this.closeEmitter = new EventEmitter();
        this.close = (/**
         * @return {?}
         */
        function () {
            if (_this.dialog) {
                _this.dialog.close();
            }
            _this.closeEmitter.emit();
        });
    }
    Object.defineProperty(UbccParamDataUiDialogComponent.prototype, "data", {
        /**
         * 输入数据为JSON对象
         */
        set: /**
         * 输入数据为JSON对象
         * @param {?} data
         * @return {?}
         */
        function (data) {
            this._data = data;
            this.loadParamData(this.templateId);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    UbccParamDataUiDialogComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.template = this.template || new UbccParamTemplate();
    };
    /**
     * @private
     * @param {?} templateId
     * @return {?}
     */
    UbccParamDataUiDialogComponent.prototype.loadParamData = /**
     * @private
     * @param {?} templateId
     * @return {?}
     */
    function (templateId) {
        var _this = this;
        if (!templateId) {
            return;
        }
        this.http.getParamTemplate(templateId).subscribe((/**
         * @param {?} vo
         * @return {?}
         */
        function (vo) {
            if (!vo.content) {
                return;
            }
            /** @type {?} */
            var serializer = new UbccParamTemplateSerializer();
            _this.template = serializer.deserializer(JSON.parse(vo.content));
            _this.getParamDataItemsStructure();
            _this.convertJsonToParamData();
        }));
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiDialogComponent.prototype.convertJsonToParamData = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this._data || Object.keys(this._data).length <= 0) {
            return;
        }
        this.paramDataItems.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            /** @type {?} */
            var key = Object.keys(_this._data).find((/**
             * @param {?} x
             * @return {?}
             */
            function (x) { return x === item.code; }));
            if (!key || !_this._data[key]) {
                return;
            }
            if (_this.isCollection(item)) {
                //参数的值如果是数组，以逗号隔开
                item.value = _this._data[key].join(',');
                if (!_this.utils.isHelpType(item.parameterType)) {
                    return;
                }
                /** @type {?} */
                var helpId = ((/** @type {?} */ (_this.utils.getCollectionElementType(item.parameterType)))).refId;
                _this.http.getHelpData(helpId, _this._data[key]).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    if (!result || result.length <= 0) {
                        return;
                    }
                    /** @type {?} */
                    var values = [];
                    result.map((/**
                     * @param {?} resItem
                     * @return {?}
                     */
                    function (resItem) { return values.push(resItem.text); }));
                    item.valueText = values.join(',');
                }));
            }
            else {
                item.value = _this._data[key];
                if (item.parameterTypeDesc !== 'help') {
                    return;
                }
                /** @type {?} */
                var helpId = ((/** @type {?} */ (item.parameterType))).refId;
                _this.http.getHelpData(helpId, [item.value]).subscribe((/**
                 * @param {?} result
                 * @return {?}
                 */
                function (result) {
                    if (!result || result.length <= 0) {
                        return;
                    }
                    item.valueText = result[0].text;
                }));
            }
        }));
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiDialogComponent.prototype.getParamDataItemsStructure = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.template || !this.template.params) {
            return;
        }
        this.paramDataItems = [];
        this.template.params.map((/**
         * @param {?} x
         * @return {?}
         */
        function (x) { return _this.paramDataItems.push(x); }));
    };
    /**
     * @private
     * @return {?}
     */
    UbccParamDataUiDialogComponent.prototype.covertParamDataToJson = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.paramDataItems || this.paramDataItems.length <= 0) {
            return null;
        }
        /** @type {?} */
        var object = new Object();
        this.paramDataItems.map((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            if (_this.isCollection(item)) {
                object[item.code] = [];
                /** @type {?} */
                var itemValues = item.value.split(',');
                if (!itemValues || itemValues.length <= 0) {
                    return;
                }
                itemValues.map((/**
                 * @param {?} itemValue
                 * @return {?}
                 */
                function (itemValue) { return object[item.code].push(itemValue); }));
                //帮助name赋值
                if (item.parameterTypeDesc === 'help') {
                    object[item.code + "_name"] = [];
                    /** @type {?} */
                    var itemTextValues = item.valueText.split(',');
                    if (!itemTextValues || itemTextValues.length <= 0) {
                        return;
                    }
                    itemTextValues.map((/**
                     * @param {?} itemTextValue
                     * @return {?}
                     */
                    function (itemTextValue) { return object[item.code + "_name"].push(itemTextValue); }));
                }
            }
            else {
                object[item.code] = item.value;
                //帮助name赋值
                if (item.parameterTypeDesc === 'help') {
                    object[item.code + "_name"] = item.valueText;
                }
            }
        }));
        return object;
    };
    /**
     * @return {?}
     */
    UbccParamDataUiDialogComponent.prototype.confirm = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var jsonData = this.covertParamDataToJson();
        this.confirmEmitter.emit(jsonData);
    };
    /**
     * @private
     * @param {?} param
     * @return {?}
     */
    UbccParamDataUiDialogComponent.prototype.isCollection = /**
     * @private
     * @param {?} param
     * @return {?}
     */
    function (param) {
        if (!param || !param.parameterType) {
            return false;
        }
        if (param.parameterType.getKind() === DataTypeConst.DEFAULT_COLLECTION) {
            return true;
        }
        else {
            return false;
        }
    };
    UbccParamDataUiDialogComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-ubcc-param-data-ui-dialog',
                    template: "<div class=\"d-flex\" style=\"position: absolute;top: 0;bottom: 0;left: 0;right: 0;padding: 0px 8px 0px 8px;\">\n  <lib-ubcc-param-data-ui class=\"f-utils-fill\" [(template)]=\"template\" [(paramDataItems)]=\"paramDataItems\"  style=\"overflow-y: auto;\"></lib-ubcc-param-data-ui>\n</div>\n\n<ng-template #btnRef>\n  <div style=\"width: 100%;line-height: 50px; text-align: center;min-width: 140px;\">\n    <button class=\"btn btn-primary\" (click)=confirm() style=\"float:right;margin-right: 5px\">\u786E\u5B9A</button>\n    <button class=\"btn btn-secondary\" (click)=close() style=\"float:right;margin-right: 5px\">\u5173\u95ED</button>\n  </div>\n</ng-template>",
                    styles: [":host{display:flex;flex-direction:column;flex:1}"]
                }] }
    ];
    /** @nocollapse */
    UbccParamDataUiDialogComponent.ctorParameters = function () { return [
        { type: UbccParamDataUtils },
        { type: UbccParamDataManangerService }
    ]; };
    UbccParamDataUiDialogComponent.propDecorators = {
        templateId: [{ type: Input }],
        data: [{ type: Input }],
        confirmEmitter: [{ type: Output }],
        closeEmitter: [{ type: Output }],
        btnRef: [{ type: ViewChild, args: ['btnRef',] }]
    };
    return UbccParamDataUiDialogComponent;
}());
export { UbccParamDataUiDialogComponent };
if (false) {
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.template;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype._data;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.templateId;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.paramDataItems;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.confirmEmitter;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.closeEmitter;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.btnRef;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.dialog;
    /** @type {?} */
    UbccParamDataUiDialogComponent.prototype.close;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiDialogComponent.prototype.utils;
    /**
     * @type {?}
     * @private
     */
    UbccParamDataUiDialogComponent.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWJjYy1wYXJhbS1kYXRhLXVpLWRpYWxvZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWNtcC91YmNjLXBhcmFtLWRhdGEtdWkvIiwic291cmNlcyI6WyJsaWIvdWJjYy1wYXJhbS1kYXRhLXVpLWRpYWxvZy91YmNjLXBhcmFtLWRhdGEtdWktZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQUUsaUJBQWlCLEVBQXVCLDJCQUEyQixFQUFvQixNQUFNLHdCQUF3QixDQUFDO0FBRS9ILE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3ZFLE9BQU8sRUFBYSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUdyRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUUvRDtJQStCSSx3Q0FDWSxLQUF3QixFQUN4QixJQUFrQztRQUY5QyxpQkFFbUQ7UUFEdkMsVUFBSyxHQUFMLEtBQUssQ0FBbUI7UUFDeEIsU0FBSSxHQUFKLElBQUksQ0FBOEI7UUFaOUMsbUJBQWMsR0FBcUIsRUFBRSxDQUFDO1FBRTVCLG1CQUFjLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFFNUQsaUJBQVksR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQXNIcEUsVUFBSzs7O1FBQUc7WUFDSixJQUFJLEtBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ2IsS0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQzthQUN2QjtZQUNELEtBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDN0IsQ0FBQyxFQUFBO0lBbkhpRCxDQUFDO0lBakJuRCxzQkFBYSxnREFBSTtRQUhqQjs7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QUFzRTs7SUFFdEUsc0RBQW9FOztJQUVwRSxnREFBOEM7O0lBRTlDLGdEQUFtQjs7SUFrSG5CLCtDQUtDOzs7OztJQXBIRywrQ0FBZ0M7Ozs7O0lBQ2hDLDhDQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFViY2NQYXJhbVRlbXBsYXRlLCBVYmNjUGFyYW1UZW1wbGF0ZVZvLCBVYmNjUGFyYW1UZW1wbGF0ZVNlcmlhbGl6ZXIsIFN0cnVjdHVyZVR5cGVSZWYgfSBmcm9tICdAZ3NwLWNtcC91YmNjLXBhcmFtLXZvJztcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICdAZmFycmlzL3VpLW1vZGFsJztcbmltcG9ydCB7IFViY2NQYXJhbURhdGFNYW5hbmdlclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlL2h0dHAtc2VydmljZSc7XG5pbXBvcnQgeyBQYXJhbWV0ZXIsIERhdGFUeXBlQ29uc3QgfSBmcm9tICdAZWNwLWNhZi9jb21tb24tc3RydWN0dXJlJztcbmltcG9ydCB7IEJhc2VQYXJhbURhdGEgfSBmcm9tICcuLi9jb21tb24vcGFyYW1ldGVyLWRhdGEvYmFzZS1wYXJhbS1kYXRhJztcbmltcG9ydCB7IEhlbHBEYXRhSXRlbSB9IGZyb20gJy4uL2NvbW1vbi9oZWxwLWRhdGEtaXRlbS9oZWxwLWRhdGEtaXRlbSc7XG5pbXBvcnQgeyBVYmNjUGFyYW1EYXRhVXRpbHMgfSBmcm9tICcuLi91dGlscy9wYXJhbS1kYXRhLXV0aWxzJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsaWItdWJjYy1wYXJhbS1kYXRhLXVpLWRpYWxvZycsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3ViY2MtcGFyYW0tZGF0YS11aS1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3ViY2MtcGFyYW0tZGF0YS11aS1kaWFsb2cuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIFViY2NQYXJhbURhdGFVaURpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICB0ZW1wbGF0ZTogVWJjY1BhcmFtVGVtcGxhdGU7XG5cbiAgICBfZGF0YTogYW55O1xuXG4gICAgQElucHV0KCkgdGVtcGxhdGVJZDogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICog6L6T5YWl5pWw5o2u5Li6SlNPTuWvueixoVxuICAgICAqL1xuICAgIEBJbnB1dCgpIHNldCBkYXRhKGRhdGE6IGFueSkge1xuICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy5sb2FkUGFyYW1EYXRhKHRoaXMudGVtcGxhdGVJZCk7XG4gICAgfVxuXG4gICAgcGFyYW1EYXRhSXRlbXM6IEFycmF5PFBhcmFtZXRlcj4gPSBbXTtcblxuICAgIEBPdXRwdXQoKSBjb25maXJtRW1pdHRlcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIEBPdXRwdXQoKSBjbG9zZUVtaXR0ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgICBAVmlld0NoaWxkKCdidG5SZWYnKSBidG5SZWY6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgICBkaWFsb2c6IEJzTW9kYWxSZWY7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSB1dGlsczpVYmNjUGFyYW1EYXRhVXRpbHMsXG4gICAgICAgIHByaXZhdGUgaHR0cDogVWJjY1BhcmFtRGF0YU1hbmFuZ2VyU2VydmljZSkgeyB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGUgfHwgbmV3IFViY2NQYXJhbVRlbXBsYXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBsb2FkUGFyYW1EYXRhKHRlbXBsYXRlSWQ6IHN0cmluZykge1xuICAgICAgICBpZiAoIXRlbXBsYXRlSWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmh0dHAuZ2V0UGFyYW1UZW1wbGF0ZSh0ZW1wbGF0ZUlkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAodm86IFViY2NQYXJhbVRlbXBsYXRlVm8pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXZvLmNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgc2VyaWFsaXplciA9IG5ldyBVYmNjUGFyYW1UZW1wbGF0ZVNlcmlhbGl6ZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlID0gc2VyaWFsaXplci5kZXNlcmlhbGl6ZXIoSlNPTi5wYXJzZSh2by5jb250ZW50KSk7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRQYXJhbURhdGFJdGVtc1N0cnVjdHVyZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udmVydEpzb25Ub1BhcmFtRGF0YSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjb252ZXJ0SnNvblRvUGFyYW1EYXRhKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RhdGEgfHwgT2JqZWN0LmtleXModGhpcy5fZGF0YSkubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBhcmFtRGF0YUl0ZW1zLm1hcCgoaXRlbTogQmFzZVBhcmFtRGF0YSkgPT4ge1xuICAgICAgICAgICAgbGV0IGtleSA9IE9iamVjdC5rZXlzKHRoaXMuX2RhdGEpLmZpbmQoeCA9PiB4ID09PSBpdGVtLmNvZGUpO1xuICAgICAgICAgICAgaWYgKCFrZXkgfHwgIXRoaXMuX2RhdGFba2V5XSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ29sbGVjdGlvbihpdGVtKSkge1xuICAgICAgICAgICAgICAgIC8v5Y+C5pWw55qE5YC85aaC5p6c5piv5pWw57uE77yM5Lul6YCX5Y+36ZqU5byAXG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZSA9IHRoaXMuX2RhdGFba2V5XS5qb2luKCcsJyk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnV0aWxzLmlzSGVscFR5cGUoaXRlbS5wYXJhbWV0ZXJUeXBlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBoZWxwSWQgPSAodGhpcy51dGlscy5nZXRDb2xsZWN0aW9uRWxlbWVudFR5cGUoaXRlbS5wYXJhbWV0ZXJUeXBlKSBhcyBTdHJ1Y3R1cmVUeXBlUmVmKS5yZWZJZDtcbiAgICAgICAgICAgICAgICB0aGlzLmh0dHAuZ2V0SGVscERhdGEoaGVscElkLCB0aGlzLl9kYXRhW2tleV0pLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgKHJlc3VsdDogQXJyYXk8SGVscERhdGFJdGVtPikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm1hcChyZXNJdGVtID0+IHZhbHVlcy5wdXNoKHJlc0l0ZW0udGV4dCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS52YWx1ZVRleHQgPSB2YWx1ZXMuam9pbignLCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZSA9IHRoaXMuX2RhdGFba2V5XTtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5wYXJhbWV0ZXJUeXBlRGVzYyAhPT0gJ2hlbHAnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGhlbHBJZCA9IChpdGVtLnBhcmFtZXRlclR5cGUgYXMgU3RydWN0dXJlVHlwZVJlZikucmVmSWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5odHRwLmdldEhlbHBEYXRhKGhlbHBJZCwgW2l0ZW0udmFsdWVdKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChyZXN1bHQ6IEFycmF5PEhlbHBEYXRhSXRlbT4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWVUZXh0ID0gcmVzdWx0WzBdLnRleHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRQYXJhbURhdGFJdGVtc1N0cnVjdHVyZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnRlbXBsYXRlIHx8ICF0aGlzLnRlbXBsYXRlLnBhcmFtcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZS5wYXJhbXMubWFwKHggPT4gdGhpcy5wYXJhbURhdGFJdGVtcy5wdXNoKHgpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNvdmVydFBhcmFtRGF0YVRvSnNvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLnBhcmFtRGF0YUl0ZW1zIHx8IHRoaXMucGFyYW1EYXRhSXRlbXMubGVuZ3RoIDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCBvYmplY3QgPSBuZXcgT2JqZWN0KCk7XG4gICAgICAgIHRoaXMucGFyYW1EYXRhSXRlbXMubWFwKChpdGVtOiBCYXNlUGFyYW1EYXRhKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NvbGxlY3Rpb24oaXRlbSkpIHtcbiAgICAgICAgICAgICAgICBvYmplY3RbaXRlbS5jb2RlXSA9IFtdO1xuICAgICAgICAgICAgICAgIGxldCBpdGVtVmFsdWVzID0gaXRlbS52YWx1ZS5zcGxpdCgnLCcpO1xuICAgICAgICAgICAgICAgIGlmICghaXRlbVZhbHVlcyB8fCBpdGVtVmFsdWVzLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaXRlbVZhbHVlcy5tYXAoaXRlbVZhbHVlID0+IG9iamVjdFtpdGVtLmNvZGVdLnB1c2goaXRlbVZhbHVlKSk7XG4gICAgICAgICAgICAgICAgLy/luK7liqluYW1l6LWL5YC8XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucGFyYW1ldGVyVHlwZURlc2MgPT09ICdoZWxwJykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RbYCR7aXRlbS5jb2RlfV9uYW1lYF0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW1UZXh0VmFsdWVzID0gaXRlbS52YWx1ZVRleHQuc3BsaXQoJywnKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVtVGV4dFZhbHVlcyB8fCBpdGVtVGV4dFZhbHVlcy5sZW5ndGggPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1UZXh0VmFsdWVzLm1hcChpdGVtVGV4dFZhbHVlID0+IG9iamVjdFtgJHtpdGVtLmNvZGV9X25hbWVgXS5wdXNoKGl0ZW1UZXh0VmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvYmplY3RbaXRlbS5jb2RlXSA9IGl0ZW0udmFsdWU7XG4gICAgICAgICAgICAgICAgLy/luK7liqluYW1l6LWL5YC8XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucGFyYW1ldGVyVHlwZURlc2MgPT09ICdoZWxwJykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RbYCR7aXRlbS5jb2RlfV9uYW1lYF0gPSBpdGVtLnZhbHVlVGV4dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuXG4gICAgY2xvc2UgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmRpYWxvZykge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNsb3NlRW1pdHRlci5lbWl0KCk7XG4gICAgfVxuXG4gICAgY29uZmlybSgpIHtcbiAgICAgICAgbGV0IGpzb25EYXRhID0gdGhpcy5jb3ZlcnRQYXJhbURhdGFUb0pzb24oKTtcbiAgICAgICAgdGhpcy5jb25maXJtRW1pdHRlci5lbWl0KGpzb25EYXRhKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzQ29sbGVjdGlvbihwYXJhbTogYW55KSB7XG4gICAgICAgIGlmICghcGFyYW0gfHwgIXBhcmFtLnBhcmFtZXRlclR5cGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFyYW0ucGFyYW1ldGVyVHlwZS5nZXRLaW5kKCkgPT09IERhdGFUeXBlQ29uc3QuREVGQVVMVF9DT0xMRUNUSU9OKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxufVxuIl19
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/forms"),require("@farris/ui-splitter"),require("@farris/ui-draggable"),require("@farris/ui-datagrid"),require("@farris/ui-treetable"),require("@farris/ui-section"),require("@farris/ui-dialog"),require("@farris/ui-datepicker"),require("@ngx-translate/core"),require("@gsp-lcm/metadatart-selector"),require("date-fns"),require("@gsp-bef/gsp-cm-metadata"),require("@angular/common/locales/zh"),require("@ecp-caf/caf-common"),require("@farris/ui-modal"),require("@angular/core"),require("@farris/ui-messager"),require("@farris/ui-notify"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define("@gsp-cmp/chgdr",["exports","@angular/common","@angular/forms","@farris/ui-splitter","@farris/ui-draggable","@farris/ui-datagrid","@farris/ui-treetable","@farris/ui-section","@farris/ui-dialog","@farris/ui-datepicker","@ngx-translate/core","@gsp-lcm/metadatart-selector","date-fns","@gsp-bef/gsp-cm-metadata","@angular/common/locales/zh","@ecp-caf/caf-common","@farris/ui-modal","@angular/core","@farris/ui-messager","@farris/ui-notify","rxjs/operators","rxjs"],t):t((e["gsp-cmp"]=e["gsp-cmp"]||{},e["gsp-cmp"].chgdr={}),e.ng.common,e.ng.forms,e.uiSplitter,e.uiDraggable,e.uiDatagrid,e.uiTreetable,e.uiSection,e.uiDialog,e.uiDatepicker,e.core,e.i2,e.dateFns,e.gspCmMetadata,e.ng.common.locales.zh,e.i1,e.i1$1,e.ng.core,e.i2$1,e.uiNotify,e.rxjs.operators,e.rxjs)}(this,function(e,t,n,r,a,i,o,s,d,l,c,u,p,h,f,g,m,y,b,v,C,w){"use strict";f=f&&f.hasOwnProperty("default")?f["default"]:f;var D=function(){},I=function(){},T=function(){},S=function(){this.children=[]},M=function(){},x=new Map;x.set("en",{"chgdr-list-dialog-title":"Change data records","base-info-section-title":"Base info","change-detail-section-title":"Change detail","empty-data-text":"Empty Data","get-business-code-config-error":"Get business code config error: {{errorMessage}}","user-name-column-title":"User","change-time-column-title":"Time","change-time-column-format":"yyyy-MM-dd HH:mm:ss","operation-type-title":"Type","tech-pk-column-title":"Tech PK","operation-column-title":"Operation","can-not-found-change-record-by-id":"Can not found change record 【{{headerId}}】","query-change-data-record-error":"Query change data record error: {{errorMessage}}","show-change-detail-btn":"Detail","change-detail-dialog-title":"Change detail","start-time-label":"Start","end-time-label":"End","query-btn":"Query","technology-primary-key-label":"Tech PK","change-user-label":"User","change-time-label":"Time","change-operate-type":"Type","field-name-column-title":"Field","value-column-title":"Value","old-value-column-title":"Old value","new-value-column-title":"New value","operate-type-name-ADD":"Add","operate-type-name-MODIFY":"Modify","operate-type-name-DELETE":"Delete","yes-text":"Yes","no-text":"No","business-code-text":"Business code"}),x.set("zh-CHS",{"chgdr-list-dialog-title":"变更日志列表","base-info-section-title":"基本信息","change-detail-section-title":"变更详情","empty-data-text":"无数据","get-business-code-config-error":"获取业务编号配置失败：{{errorMessage}}","user-name-column-title":"用户","change-time-column-title":"时间","change-time-column-format":"yyyy年MM月dd日 HH:mm:ss","operation-type-title":"操作类型","tech-pk-column-title":"技术主键","operation-column-title":"操作","can-not-found-change-record-by-id":"未找到编号为【{{headerId}}】的变更日志","query-change-data-record-error":"查询业务变更日志出错：{{errorMessage}}","show-change-detail-btn":"变更详情","change-detail-dialog-title":"变更日志详情","start-time-label":"开始时间","end-time-label":"结束时间","query-btn":"查询","technology-primary-key-label":"技术主键","change-user-label":"变更人","change-time-label":"变更时间","change-operate-type":"变更方式","field-name-column-title":"字段名","value-column-title":"值","old-value-column-title":"原值","new-value-column-title":"变更值","operate-type-name-ADD":"新增","operate-type-name-MODIFY":"修改","operate-type-name-DELETE":"删除","yes-text":"是","no-text":"否","business-code-text":"业务编号"}),x.set("zh-CHT",{"chgdr-list-dialog-title":"變更日志列表","base-info-section-title":"基本信息","change-detail-section-title":"變更詳情","empty-data-text":"無數據","get-business-code-config-error":"獲取業務編號配置失敗：{{errorMessage}}","user-name-column-title":"用戶","change-time-column-title":"時間","change-time-column-format":"yyyy年MM月dd日 HH:mm:ss","operation-type-title":"操作類型","tech-pk-column-title":"技術主鍵","operation-column-title":"操作","can-not-found-change-record-by-id":"未找到編號爲【{{headerId}}】的變更日志","query-change-data-record-error":"查詢業務變更日志出錯：{{errorMessage}}","show-change-detail-btn":"變更詳情","change-detail-dialog-title":"變更日志詳情","start-time-label":"開始時間","end-time-label":"結束時間","query-btn":"查詢","technology-primary-key-label":"技術主鍵","change-user-label":"變更人","change-time-label":"變更時間","change-operate-type":"變更方式","field-name-column-title":"字段名","value-column-title":"值","old-value-column-title":"原值","new-value-column-title":"變更值","operate-type-name-ADD":"新增","operate-type-name-MODIFY":"修改","operate-type-name-DELETE":"刪除","yes-text":"是","no-text":"否","business-code-text":"業務編號"});var E=localStorage.getItem("languageCode");E||(E="zh-CHS",console.log("未找到设置的语言，默认使用"+E));var N=new c.TranslateDefaultParser,j=(O.instant=function(e,t){var n=O.getCurrentLangResource()[e];if(n===undefined||null===n)return e;t=N.interpolate(n,t);return t===undefined||null===t?e:t},O.getCurrentLangResource=function(){return x.get(E)||{}},O.instantOrDefault=function(e,t){e=O.getCurrentLangResource()[e];if(e===undefined||null===e)return t;e=N.interpolate(e);return e===undefined||null===e?t:e},O);function O(){}var P=(F.prototype.instant=function(e,t){return j.instant(e,t)},F.prototype.getCurrentLangResource=function(){return x.get(E)||{}},F.staticInstant=function(e,t){return j.instantOrDefault(e,t)},F.decorators=[{type:y.Injectable,args:[{providedIn:"root"}]}],F.ctorParameters=function(){return[]},F.ngInjectableDef=y.defineInjectable({factory:function(){return new F},token:F,providedIn:"root"}),F);function F(){}var R=(V.prototype.buildChgdrData=function(e,t){var i=this;this.handler=t;var r=new D;r.entityName=this.handler.getBeName(),r.operateType=e.operateType,r.userName=e.userName,r.dataId=e.dataId,r.dataCode=e.dataCode,r.dataCodes=this.buildDataCodes(e.dataCode,this.handler.getMainObjectCode()),r.reason=e.reason,r.changeTime=e.changeTime,r.entityNodes=[];var o=[];e.rows&&e.rows.forEach(function(r){var e,t,a,n;r&&((e=new T).id=r.id,e.parentDataId=r.parentDataId,e.dataId=r.dataId,e.dataCode=r.dataCode,e.dataCodes=i.buildDataCodes(r.dataCode,r.entityCode),e.entityCode=r.entityCode,e.entityName=i.handler.getEntityNameOrDefault(r.entityCode),e.operateType=r.operateType,e.entityNodes=[],t=i.extractChangeColumnKeys(r),a=[],t.forEach(function(e){var t=new S;t.fieldLabel=e,t.fieldName=i.handler.getEntityFieldNameOrDefault(r.entityCode,e),t.oldValue=i.handler.formatFieldValue(r.oldContent.get(e),r.entityCode,e),t.newValue=i.handler.formatFieldValue(r.newContent.get(e),r.entityCode,e);var n=i.handler.getElement(r.entityCode,e);n&&(t.hasAssociation="Association"==n.ObjectType&&0==n.IsUdt,t.isAssociationRefField=n.IsRefElement,(e=i.handler.getParentElement(r.entityCode,e))&&(t.belongFieldLabelId=e.LabelID)),a.push(t)}),i.handler.sort(a,r.entityCode,function(e){return e.fieldLabel}),n=new Map,a.forEach(function(e){n.set(e.fieldLabel,e)}),a=(a=a.filter(function(e){if(e.isAssociationRefField){var t=n.get(e.belongFieldLabelId);return!t||(t.children.push(e),!1)}return!0})).map(function(e){if(e.hasAssociation&&0<e.children.length){var t=Object.assign(new S,e);return t.originalColumnItem=e,t.oldValue=e.children.map(function(e){return e.oldValue}).join(";"),t.newValue=e.children.map(function(e){return e.newValue}).join(";"),t}return e}),e.changes=a,o.push(e))});var a=new Map;return o.forEach(function(e){return a.set(e.dataId,e)}),o.forEach(function(t){if(!t.parentDataId)return(e=i.genChgdrDataEntityNode(t.entityCode,t.entityName)).rows.push(t),void r.entityNodes.push(e);var e,n=a.get(t.parentDataId);n?((e=n.entityNodes.find(function(e){return e.entityCode==t.entityCode}))||(e=i.genChgdrDataEntityNode(t.entityCode,t.entityName),n.entityNodes.push(e)),e.rows.push(t)):((e=i.genChgdrDataEntityNode(t.entityCode,t.entityName)).rows.push(t),r.entityNodes.push(e))}),r},V.prototype.buildDataCodes=function(e,r){var a=this,i=[];return e&&e.forEach(function(e,t){var n=new M;"_$dataCode"==t?(n.fieldLabelId="dataCode",n.fieldName=j.instantOrDefault("business-code-text","业务编号"),n.fieldValue=e):(n.fieldLabelId=t,n.fieldName=a.handler.getEntityFieldNameOrDefault(r,t),n.fieldValue=a.handler.formatFieldValue(e,r,t)),i.push(n)}),this.handler.sort(i,r,function(e){return e.fieldLabelId}),i},V.prototype.extractChangeColumnKeys=function(e){var n=new Set;return e.oldContent&&e.oldContent.forEach(function(e,t){return n.add(t)}),e.newContent&&e.newContent.forEach(function(e,t){return n.add(t)}),Array.from(n.keys())},V.prototype.genChgdrDataEntityNode=function(e,t){var n=new I;return n.entityCode=e,n.entityName=t,n.rows=[],n},V);function V(){}var L=(k.newGuid=function(){var t=this;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){return t.convert(e)})},k.convert=function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)},k);function k(){}var H=function(){},q=(z.prototype.build=function(e){if(0==(this.chgdrData=e).entityNodes.length)return console.warn("无变更日志"),[];e=e.entityNodes[0].rows;if(0==e.length)return console.warn("无根变更日志行"),[];e=e[0],e=this.rowToNode(e);return e.isRoot=!0,e.expanded=!0,[e]},z.prototype.rowToNode=function(e){var t=this,n=new H;return n.id=L.newGuid(),n.name=this.buildTreeNodeName(e),n.data={id:n.id,name:n.name},n.chgdrRow=e,n.chgdrData=this.chgdrData,n.children=[],e.entityNodes.forEach(function(e){e.rows.forEach(function(e){e=t.rowToNode(e);(e.parent=n).children.push(e)})}),n},z.prototype.buildTreeNodeName=function(e){var t;return e.dataCodes&&0<e.dataCodes.length&&(t=e.dataCodes[0].fieldValue),t?e.entityName+"-"+t+"【"+e.operateType.name+"】":e.entityName+"【"+e.operateType.name+"】"},z);function z(){}var G=(B.prototype.getGSPBusinessEntity=function(t){var n=this;if(this.beMetadataCache.has(t)){var e=this.beMetadataCache.get(t);return w.of(e)}return this.metadataService.GetMetadataRT(t).pipe(C.map(function(e){e=JSON.parse(e.content);return n.beMetadataCache.set(t,e),e}))},B.decorators=[{type:y.Injectable,args:[{providedIn:"root"}]}],B.ctorParameters=function(){return[{type:g.HttpService},{type:g.SessionService},{type:u.GSPMetadataRTService},{type:y.Injector}]},B.ngInjectableDef=y.defineInjectable({factory:function(){return new B(y.inject(g.HttpService),y.inject(g.SessionService),y.inject(u.GSPMetadataRTService),y.inject(y.INJECTOR))},token:B,providedIn:"root"}),B);function B(e,t,n,r){this.http=e,this.sessionService=t,this.metadataService=n,this.injector=r,this.beMetadataCache=new Map}var A=(Q.prototype.getBeChgdrConfig=function(e){e="/api/runtime/chgdr/v1.0/config?beId="+e;return this.http.get(e).pipe(C.tap(function(e){(e||[]).forEach(function(e){var t=e.fields||[];t.forEach(function(e,t){e.showIndex!==undefined&&null!==e.showIndex||(e.showIndex=t)}),e.fields=t.sort(function(e,t){return e.showIndex-t.showIndex}),t.forEach(function(e,t){e.showIndex=t})})}))},Q.decorators=[{type:y.Injectable,args:[{providedIn:"root"}]}],Q.ctorParameters=function(){return[{type:g.HttpService},{type:g.SessionService},{type:y.Injector}]},Q.ngInjectableDef=y.defineInjectable({factory:function(){return new Q(y.inject(g.HttpService),y.inject(g.SessionService),y.inject(y.INJECTOR))},token:Q,providedIn:"root"}),Q);function Q(e,t,n){this.http=e,this.sessionService=t,this.injector=n}var J=(_.prototype.updateShowIndex=function(){var n=new Map;this.entityFieldMap.forEach(function(e,t){n.set(t,n.size)}),this.entityFieldConfigMap.forEach(function(e,t){e.showIndex!==undefined&&null!==e.showIndex&&n.set(t,e.showIndex)}),this.entityFieldShowOrderMap=n},_.prototype.updateEntityConfigs=function(){var r=new Map;this.entityConfigs.forEach(function(e){var n=e.tabCode;(e.fields||[]).forEach(function(e){var t=e.fieldLabelId,t=n+"#"+t;r.set(t,e)})}),this.entityFieldConfigMap=r},_.prototype.updateEntityMap=function(t,n,r){var e,a=this;t&&(n.set(t.Code,t),t.ContainElements.forEach(function(e){a.updateEntityFieldMap(t,e,null,r)}),(e=t.ContainChildObjects)&&e.length&&e.forEach(function(e){a.updateEntityMap(e,n,r)}))},_.prototype.updateEntityFieldMap=function(t,n,e,r){var a=this,i=t.Code+"#"+n.LabelID;r.set(i,n),e&&this.entityFieldParentMap.set(i,e);e=n.ChildAssociations;e&&0<e.length&&e.forEach(function(e){e=e.RefElementCollection;e&&0<e.length&&e.forEach(function(e){a.updateEntityFieldMap(t,e,n,r)})})},_.prototype.sort=function(e,n,r){var a=this;e.sort(function(e,t){e=n+"#"+r(e),t=n+"#"+r(t);return a.entityFieldShowOrderMap.has(e)||a.entityFieldShowOrderMap.has(t)?a.entityFieldShowOrderMap.has(e)?a.entityFieldShowOrderMap.has(t)?a.entityFieldShowOrderMap.get(e)-a.entityFieldShowOrderMap.get(t):1:-1:e.localeCompare(t)})},_.prototype.formatMainObjectFieldValue=function(e,t){var n=this.getMainObjectCode();return this.formatFieldValue(e,n,t)},_.prototype.formatFieldValue=function(t,e,n){var r=this.getElement(e,n);if(!r)return console.error("未找到业务实体【"+this.be.ID+"-"+this.be.Name+"】节点【"+e+"】的字段【"+n+"】"),t;if(!r)return t;try{if((r.MDataType==h.GSPElementDataType.Decimal||r.MDataType==h.GSPElementDataType.Integer)&&t&&t.toLowerCase().includes("e")){var a=Number(t);return isNaN(a)?(console.log("业务实体【"+this.be.ID+"-"+this.be.Name+"】节点【"+e+"】的字段【"+n+"】的值不是有效的数字格式："+t),t):this.toNonExponential(a)}if(r.MDataType==h.GSPElementDataType.Boolean)return null===t||t===undefined||0==t.length?t:"false"==t.toLowerCase()?j.instantOrDefault("no-text","否"):"true"==t.toLowerCase()?j.instantOrDefault("yes-text","是"):t;if(r.MDataType==h.GSPElementDataType.Date){if(null===t||t===undefined||0==t.length)return t;var i=new Date(t);return p.format(i,"yyyy-MM-dd")}if(r.MDataType==h.GSPElementDataType.DateTime){if(null===t||t===undefined||0==t.length)return t;i=new Date(t);return p.format(i,"yyyy-MM-dd HH:mm:ss")}if(r.ObjectType!=h.GSPElementObjectType.Enum)return t;i=(r.ContainEnumValues||[]).find(function(e){return e.Value==t});return i?i.Name:(null===t||t===undefined||0==t.length||console.log("业务实体【"+this.be.ID+"-"+this.be.Name+"】节点【"+e+"】的字段【"+n+"】的值未找到匹配的枚举项："+t),t)}catch(o){return console.error("业务实体【"+this.be.ID+"-"+this.be.Name+"】节点【"+e+"】的字段【"+n+"】的值【"+t+"】格式化出错：",o),t}},_.prototype.toNonExponential=function(e){var t=e.toExponential().match(/\d(?:\.(\d*))?e([+-]\d+)/);return e.toFixed(Math.max(0,(t[1]||"").length-t[2]))},_.prototype.getBeName=function(){return this.be?this.be.Name:null},_.prototype.getMainObjectCode=function(){return this.be&&this.be.MainObject?this.be.MainObject.Code:null},_.prototype.getElement=function(e,t){t=e+"#"+t;return this.entityFieldMap.get(t)},_.prototype.getParentElement=function(e,t){t=e+"#"+t;return this.entityFieldParentMap.get(t)},_.prototype.getEntityNameOrDefault=function(e){var t=this.entityCodeMap.get(e);return t?t.Name:e},_.prototype.getEntityFieldNameOrDefault=function(e,t){var n=e+"#"+t,e=this.entityFieldConfigMap.get(n);if(e&&e.fieldName&&""!=e.fieldName)return e.fieldName;n=this.entityFieldMap.get(n);return n?n.Name:t},_);function _(e,t){this.entityCodeMap=new Map,this.entityFieldMap=new Map,this.entityFieldShowOrderMap=new Map,this.entityFieldParentMap=new Map,this.entityFieldConfigMap=new Map,(this.be=e)&&(e=e.MainObject,this.updateEntityMap(e,this.entityCodeMap,this.entityFieldMap)),this.entityConfigs=t||[],this.updateEntityConfigs(),this.updateShowIndex()}var $=(U.prototype.getChgdrConfigHandler=function(n){var r=this;if(this.beMetadataCache.has(n)){var e=this.beMetadataCache.get(n);return w.of(e)}e=[];return e.push(this.chgdrMetadataService.getGSPBusinessEntity(n)),e.push(this.chgdrConfigService.getBeChgdrConfig(n)),w.forkJoin(e).pipe(C.map(function(e){var t=e[0],e=e[1]||[],e=new J(t,e);return r.beMetadataCache.set(n,e),e}))},U.decorators=[{type:y.Injectable,args:[{providedIn:"root"}]}],U.ctorParameters=function(){return[{type:g.HttpService},{type:g.SessionService},{type:u.GSPMetadataRTService},{type:G},{type:A},{type:y.Injector}]},U.ngInjectableDef=y.defineInjectable({factory:function(){return new U(y.inject(g.HttpService),y.inject(g.SessionService),y.inject(u.GSPMetadataRTService),y.inject(G),y.inject(A),y.inject(y.INJECTOR))},token:U,providedIn:"root"}),U);function U(e,t,n,r,a,i){this.http=e,this.sessionService=t,this.metadataService=n,this.chgdrMetadataService=r,this.chgdrConfigService=a,this.injector=i,this.beMetadataCache=new Map}var Y=(K.prototype.ngOnInit=function(){},K.prototype.ngOnChanges=function(e){var t,n=this;this.data&&(t=this.data.entityId,this.chgdrInnerService.getChgdrConfigHandler(t).subscribe(function(e){n.chgdrData=(new R).buildChgdrData(n.data,e),n.treeData=(new q).build(n.chgdrData),n.treeTableComponent&&n.treeTableComponent.clearSelections(),setTimeout(function(){n.treeTableComponent.selectNode(n.treeData[0].id)},0)}))},K.prototype.handleTreeSelection=function(e){e=e.node;null!=this.currentNode&&this.currentNode.id==e.id||(this.currentNode=e)},Object.defineProperty(K.prototype,"baseInfoSectionTitle",{get:function(){return j.instant("base-info-section-title")},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"changeDetailSectionTitle",{get:function(){return j.instant("change-detail-section-title")},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"emptyDataText",{get:function(){return j.instant("empty-data-text")},enumerable:!0,configurable:!0}),K.decorators=[{type:y.Component,args:[{selector:"chgdr-data-viewer",template:'<farris-splitter *ngIf="!!chgdrData" class="row flex-fill farris-split-section" style="margin: 0px;">\r\n  <farris-splitter-pane [ngResizable]=true [rzMinWidth]="250" [rzHandles]="\'e\'" style="padding:0.3rem 0 0.3rem 0.3rem;"\r\n    class="d-flex flex-column farris-lsection f-col-w4">\r\n    <farris-treetable #treeTable class="f-utils-fill" style="overflow-y: auto;" [columns]="treeConfig.columns" [showBorder]="false" [showHeader]="false"\r\n      [data]="treeData" [idField]="treeConfig.idField" [singleSelect]="true" [showCheckbox]="false"\r\n      [showIcon]="true" [disabled]="treeConfig.disabled" [checkOnSelect]="true"\r\n      (nodeSelected)="handleTreeSelection($event)" [leafIcon]="treeConfig.leafIcon"\r\n      [expandIcon]="treeConfig.expandIcon" [collapseIcon]="treeConfig.collapseIcon"\r\n      [selectValues]="treeConfig.selectValues">\r\n    </farris-treetable>\r\n  </farris-splitter-pane>\r\n  <farris-splitter-pane class="farris-rsection farris-overflow-y-auto f-utils-fill-flex-column" style="padding:0 0 0 0.3rem">\r\n    <farris-section [mainTitle]="baseInfoSectionTitle" [enableMaximize]="false" [enableAccordion]="\'default\'">\r\n      <lib-chgdr-row-baseinfo-form [chgdrTreeNode]="currentNode" [showDataId]="showDataId"></lib-chgdr-row-baseinfo-form>\r\n    </farris-section>\r\n    <farris-section [mainTitle]="changeDetailSectionTitle" [enableMaximize]="false" [fill]="true" class="pt-0">\r\n      <lib-chgdr-row-grid *ngIf="!!currentNode && currentNode.chgdrRow.changes.length>0" [chgdrTreeNode]="currentNode" class="f-utils-fill"></lib-chgdr-row-grid>\r\n      <div class="f-datagrid-norecords" *ngIf="!currentNode || currentNode.chgdrRow.changes.length==0" style="height: 250px;">\r\n        <div class="f-datagrid-norecords-content" style="width: 100%;">\r\n            {{emptyDataText}}\r\n        </div>\r\n      </div>\r\n    </farris-section>\r\n  </farris-splitter-pane>\r\n</farris-splitter>',styles:[":host{display:flex;height:100%}"]}]}],K.ctorParameters=function(){return[{type:u.GSPMetadataRTService},{type:y.Injector},{type:G},{type:A},{type:$}]},K.propDecorators={data:[{type:y.Input}],showDataId:[{type:y.Input}],treeTableComponent:[{type:y.ViewChild,args:["treeTable"]}]},K);function K(e,t,n,r,a){this.metadataService=e,this.injector=t,this.chgdrMetadataService=n,this.chgdrConfigService=r,this.chgdrInnerService=a,this.showDataId=!1,this.treeConfig={idField:"id",columns:[{field:"name",title:"Name",width:200}],leafIcon:"f-icon f-icon-page-title-type text-info mr-2",expandIcon:"f-icon f-icon-file-folder-open text-info mr-2",collapseIcon:"f-icon f-icon-file-folder-close text-info mr-2",showLevel:-1,disabled:!1,init:!1,selectValues:[]}}var W=(Object.defineProperty(X.prototype,"name",{get:function(){return j.instantOrDefault("operate-type-name-"+this.code,this.defaultName)},enumerable:!0,configurable:!0}),X.values=function(){return[X.ADD,X.MODIFY,X.DELETE]},X.prototype.toJson=function(){return this.code},X.parse=function(t){return t===undefined||null===t?null:t instanceof X?t:"string"==typeof t?X.values().find(function(e){return e.code==t}):"number"==typeof t?X.values().find(function(e){return e.ordinal==t}):t.code?X.values().find(function(e){return e.code==t.code}):null},X.ADD=new X(0,"ADD","新增"),X.MODIFY=new X(1,"MODIFY","修改"),X.DELETE=new X(2,"DELETE","删除"),X);function X(e,t,n){this.ordinal=e,this.code=t,this.defaultName=n}var Z=function(e,t){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var ee=(te.convertMapToObject=function(e){if(!e)return null;var n=Object.create(null);return e.forEach(function(e,t){n[t]=e}),n},te.convertObjectToMap=function(e){var t,n;if(e===undefined||null===e)return null;var r,a,i,o=new Map;try{for(var s=(r=Object.keys(e),a="function"==typeof Symbol&&r[Symbol.iterator],i=0,a?a.call(r):{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}}),d=s.next();!d.done;d=s.next()){var l=d.value;o.set(l,e[l])}}catch(c){t={error:c}}finally{try{d&&!d.done&&(n=s["return"])&&n.call(s)}finally{if(t)throw t.error}}return o},te);function te(){}var ne="/api/runtime/chgdr/v1.0",re=(ae.prototype.queryChangeDataHeader=function(e){var t=this,n=Object.assign({},e);e.dataCode&&(n.dataCode=ee.convertMapToObject(e.dataCode));n=JSON.stringify(n),n=encodeURIComponent(n),n=ne+"?queryParam="+n;return this.http.get(n).pipe(C.map(function(e){if(!e)return e;return e&&e.headers&&e.headers.forEach(function(e){"string"==typeof e.dataCode&&(e.dataCode=JSON.parse(e.dataCode)),e.dataCode=ee.convertObjectToMap(e.dataCode),e.changeTime=t.toDate(e.changeTime),e.operateType=W.parse(e.operateType)}),e}))},ae.prototype.getRootEntityDataCodeFields=function(t){var n=this;if(!t)return w.of([]);if(this.rootDataCodeFieldsMap.has(t))return w.of(this.rootDataCodeFieldsMap.get(t));var e=ne+"/rootDataCodeFields?beId="+t;return this.http.get(e).pipe(C.tap(function(e){return n.rootDataCodeFieldsMap.set(t,e)}))},ae.prototype.toDate=function(e){return"string"==typeof e||"number"==typeof e?new Date(e):e},ae.prototype.getChangeData=function(e,t){if(null==e)throw new Error("id can not be null");return e instanceof String||"string"==typeof e?this.getChangeDataById(e,t):this.getChangeDataByParam(e)},ae.prototype.getChangeDataById=function(e,t){var n=this,t=JSON.stringify(t),t=encodeURIComponent(t),t=ne+"/"+e+"?changeTime="+t;return this.http.get(t).pipe(C.map(function(e){return n.transChangeDataFromResponse(e)}))},ae.prototype.getChangeDataByParam=function(e){var t=this;if(null==e)throw new Error("ChgdrItemQueryParam can not be null");var n={};Object.assign(n,e),n.dataIds=ee.convertMapToObject(e.dataIds);return this.http.post("/api/runtime/chgdr/v1.0",n).pipe(C.map(function(e){return t.transChangeDataFromResponse(e)}))},ae.prototype.transChangeDataFromResponse=function(e){if(!e)return e;return"string"==typeof e.dataCode&&(e.dataCode=JSON.parse(e.dataCode)),e.dataCode=ee.convertObjectToMap(e.dataCode),e.changeTime=this.toDate(e.changeTime),e.operateType=W.parse(e.operateType),e.rows=this.transChangeDataRowsFromResponse(e.rows||[]),e},ae.prototype.transChangeDataRowsFromResponse=function(e){return e&&0!=e.length&&e.forEach(function(e){e&&(e.operateType=W.parse(e.operateType),"string"==typeof e.dataCode&&(e.dataCode=JSON.parse(e.dataCode)),e.dataCode=ee.convertObjectToMap(e.dataCode),e.oldContent=ee.convertObjectToMap(e.oldContent)||new Map,e.newContent=ee.convertObjectToMap(e.newContent)||new Map)}),e},ae.decorators=[{type:y.Injectable,args:[{providedIn:"root"}]}],ae.ctorParameters=function(){return[{type:g.HttpService},{type:g.SessionService},{type:y.Injector}]},ae.ngInjectableDef=y.defineInjectable({factory:function(){return new ae(y.inject(g.HttpService),y.inject(g.SessionService),y.inject(y.INJECTOR))},token:ae,providedIn:"root"}),ae);function ae(e,t,n){this.http=e,this.sessionService=t,this.injector=n,this.rootDataCodeFieldsMap=new Map}var ie=function(){},oe=function(){},se=(de.getErrorMessage=function(e){return e&&e.error&&e.error.Message||""},de);function de(){}var le=(ce.getStartTimeInDay=function(e){e=new Date(e);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},ce.getEndTimeInDay=function(e){e=new Date(e);return e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(999),e},ce);function ce(){}var ue=(pe.prototype.ngOnInit=function(){var e=new oe;e.total=0,e.pageSize=20,e.pageIndex=1,e.headers=[],this.chgdrs=e},pe.prototype.ngOnChanges=function(e){var t;this.changeTimeStart||this.changeTimeEnd?this.changeTimeEnd?this.changeTimeStart||(this.changeTimeStart=le.getEndTimeInDay(this.changeTimeEnd)):this.changeTimeEnd=le.getEndTimeInDay(this.changeTimeStart):(this.changeTimeEnd=le.getEndTimeInDay(new Date),this.changeTimeStart=le.getStartTimeInDay(new Date((new Date).getTime()-6048e5))),this.entityId&&(t=this.buildQueryParam(),this.doQuery(t))},pe.prototype.query=function(){var e=this.buildQueryParam();this.doQuery(e)},pe.prototype.buildQueryParam=function(){var e=new ie;return e.pageIndex=1,e.pageSize=20,e.entityId=this.entityId,e.dataId=this.dataId,e.changeTimeStart=this.changeTimeStart,e.changeTimeEnd=this.changeTimeEnd,e},pe.prototype.doQuery=function(t){var n=this;this.chgdrService.queryChangeDataHeader(t).subscribe(function(e){n.currentQueryParam=t,n.chgdrs=e},function(e){console.error("查询业务变更日志出错",e),n.messageService.error(j.instant("query-change-data-record-error",{errorMessage:se.getErrorMessage(e)}))})},pe.prototype.onPageChanged=function(e){e&&(e.pageIndex&&(this.currentQueryParam.pageIndex=e.pageIndex),e.pageSize&&(this.currentQueryParam.pageSize=e.pageSize),this.doQuery(this.currentQueryParam))},pe.prototype.onPageSizeChanged=function(e){this.currentQueryParam.pageSize=e,this.doQuery(this.currentQueryParam)},Object.defineProperty(pe.prototype,"startTimeLabel",{get:function(){return j.instant("start-time-label")},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"endTimeLabel",{get:function(){return j.instant("end-time-label")},enumerable:!0,configurable:!0}),Object.defineProperty(pe.prototype,"queryBtn",{get:function(){return j.instant("query-btn")},enumerable:!0,configurable:!0}),pe.decorators=[{type:y.Component,args:[{selector:"chgdr-list",template:'<div class="farris-form farris-form-controls-inline" style="background: #fff;">\n  <form class="f-section-formgroup" style="padding-top: 10px;">\n    <div class="f-section-formgroup-inputs">\n      <div class="col-12 row">\n        <div class="farris-group-wrap col-5">\n          <div class="form-group farris-form-group">\n            <label class="col-form-label">\n              <span class="farris-label-info text-danger">*</span><span class="farris-label-text">{{startTimeLabel}}</span>\n            </label>\n            <div class="farris-input-wrap">\n              <farris-datepicker [(ngModel)]="changeTimeStart" name="changeTimeStart"></farris-datepicker>\n            </div>\n          </div>\n        </div>\n        <div class="farris-group-wrap col-5">\n          <div class="form-group farris-form-group">\n            <label class="col-form-label">\n              <span class="farris-label-info text-danger">*</span><span class="farris-label-text">{{endTimeLabel}}</span>\n            </label>\n            <div class="farris-input-wrap">\n              <farris-datepicker [(ngModel)]="changeTimeEnd" name="changeTimeEnd"></farris-datepicker>\n            </div>\n          </div>\n        </div>\n        <div class="farris-group-wrap col-2">\n          <div class="form-group farris-form-group">\n            <label class="col-form-label">\n              <button class="btn btn-primary mr-2" (click)="query()">{{queryBtn}}</button>\n            </label>\n            <div class="farris-input-wrap">\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </form>\n</div>\n\n<lib-chgdr-header-datagrid\n  [chgdrs]="chgdrs" \n  (pageChanged)="onPageChanged($event)" \n  (pageSizeChanged)="onPageSizeChanged($event)"\n  [showDataId]="false"\n  [beforeShowChangeDetail]="beforeShowChangeDetail"\n></lib-chgdr-header-datagrid>\n\n\x3c!-- <div class="f-utils-fill">\n  <farris-datagrid #chgdrGrid idField="id" [columns]="columns" [data]="chgdrs.headers"\n  showLineNumber="true" [fit]="true" [fitColumns]="true" \n  [pagination]="true" [pageSize]="20" [showPageList]="false" [pageIndex]="chgdrs.pageIndex" [total]="chgdrs.total"\n  (pageChanged)="onPageChanged($event)" (pageSizeChanged)="onPageSizeChanged($event)"\n  >\n  </farris-datagrid>\n  <ng-template #opCell let-ctx>\n    <a href="javascript: void(0);" (click)="showChangeDetail(ctx)">变更详情</a>\n  </ng-template>\n</div> --\x3e\n\n\x3c!-- 查看变更日志的弹窗 --\x3e\n\x3c!-- <farris-dialog #chgdrInfoDialog\n  title="变更日志详情"\n  [width]="1100"\n  [height]="600"\n  [showMaxButton]="true"\n  [resizable]="true"\n  [showButtons]="false"\n>\n  <chgdr-data-viewer [data]="currentChgdrData"></chgdr-data-viewer>\n</farris-dialog> --\x3e',styles:[""]}]}],pe.ctorParameters=function(){return[{type:re},{type:b.MessagerService},{type:v.NotifyService},{type:y.Injector}]},pe.propDecorators={baseCls:[{type:y.HostBinding,args:["class.f-utils-fill-flex-column"]}],entityId:[{type:y.Input}],dataId:[{type:y.Input}],changeTimeStart:[{type:y.Input}],changeTimeEnd:[{type:y.Input}],beforeShowChangeDetail:[{type:y.Input}]},pe);function pe(e,t,n,r){this.chgdrService=e,this.messageService=t,this.notifyService=n,this.injector=r,this.baseCls=!0}var he=(fe.prototype.ngOnInit=function(){},Object.defineProperty(fe.prototype,"technologyPrimaryKeyLabel",{get:function(){return j.instant("technology-primary-key-label")},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"changeUserLabel",{get:function(){return j.instant("change-user-label")},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"changeTimeLabel",{get:function(){return j.instant("change-time-label")},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"changeOperateType",{get:function(){return j.instant("change-operate-type")},enumerable:!0,configurable:!0}),fe.decorators=[{type:y.Component,args:[{selector:"lib-chgdr-row-baseinfo-form",template:'<div *ngIf="!!chgdrTreeNode" class="farris-form farris-form-controls-inline">\r\n  <form class="f-section-formgroup">\r\n    <div class="f-section-formgroup-inputs">\r\n      <div class="col-12 row">\r\n\r\n        <div class="farris-group-wrap col-6" *ngIf="showDataId">\r\n          <div class="form-group farris-form-group">\r\n            <label class="col-form-label">\r\n              <span class="farris-label-text">{{technologyPrimaryKeyLabel}}</span>\r\n            </label>\r\n            <div class="farris-input-wrap">\r\n              <input type="text" class="form-control" [ngModel]="chgdrTreeNode.chgdrRow.dataId" name="dataId"\r\n                [readonly]="true">\r\n              <div class="farris-feedback valid-feedback"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="farris-group-wrap col-6" *ngFor="let field of chgdrTreeNode.chgdrRow.dataCodes">\r\n          <div class="form-group farris-form-group">\r\n            <label class="col-form-label">\r\n              <span class="farris-label-text">{{field.fieldName}}</span>\r\n            </label>\r\n            <div class="farris-input-wrap">\r\n              <input type="text" class="form-control" [ngModel]="field.fieldValue" name="dataCode-{{field.fieldName}}"\r\n                [readonly]="true">\r\n              <div class="farris-feedback valid-feedback"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div *ngIf="chgdrTreeNode.isRoot" class="farris-group-wrap col-6">\r\n          <div class="form-group farris-form-group">\r\n            <label class="col-form-label">\r\n              <span class="farris-label-text">{{changeUserLabel}}</span>\r\n            </label>\r\n            <div class="farris-input-wrap">\r\n              <input type="text" class="form-control" [ngModel]="chgdrTreeNode.chgdrData.userName" name="userName"\r\n                [readonly]="true">\r\n              <div class="farris-feedback valid-feedback"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div *ngIf="chgdrTreeNode.isRoot" class="farris-group-wrap col-6">\r\n          <div class="form-group farris-form-group">\r\n            <label class="col-form-label">\r\n              <span class="farris-label-text">{{changeTimeLabel}}</span>\r\n            </label>\r\n            <div class="farris-input-wrap">\r\n              <input type="text" class="form-control" value="{{chgdrTreeNode.chgdrData.changeTime | date:\'yyyy-MM-dd HH:mm:ss\'}}" name="changeTime"\r\n                [readonly]="true">\r\n              <div class="farris-feedback valid-feedback"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class="farris-group-wrap col-6">\r\n          <div class="form-group farris-form-group">\r\n            <label class="col-form-label">\r\n              <span class="farris-label-text">{{changeOperateType}}</span>\r\n            </label>\r\n            <div class="farris-input-wrap">\r\n              <input type="text" class="form-control" [ngModel]="chgdrTreeNode.chgdrRow.operateType.name" name="operateType"\r\n              [readonly]="true">\r\n              <div class="farris-feedback valid-feedback"></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n      </div>\r\n    </div>\r\n  </form>\r\n</div>',styles:[""]}]}],fe.ctorParameters=function(){return[{type:y.Injector}]},fe.propDecorators={chgdrTreeNode:[{type:y.Input}],showDataId:[{type:y.Input}]},fe);function fe(e){this.injector=e,this.showDataId=!1}var ge=(me.prototype.ngOnInit=function(){this.columns=[{field:"fieldName",width:130,title:this.fieldNameColumnTitle},{field:"oldValue",width:130,title:this.oldValueColumnTitle,showTips:!0},{field:"newValue",width:130,title:this.newValueColumnTitle,showTips:!0}];var e,t=this.columns[1],n=this.columns[2];this.chgdrTreeNode&&((e=this.chgdrTreeNode.chgdrRow.operateType)==W.ADD?(t.visible=!1,n.title=this.valueColumnTitle):e==W.DELETE&&(n.visible=!1,t.title=this.valueColumnTitle))},me.prototype.ngOnChanges=function(e){var t=e.chgdrTreeNode&&e.chgdrTreeNode.previousValue?e.chgdrTreeNode.previousValue.chgdrRow.operateType:null,n=e.chgdrTreeNode&&e.chgdrTreeNode.currentValue?e.chgdrTreeNode.currentValue.chgdrRow.operateType:null;t!=n&&this.dataGrid&&this.dataGrid.columns&&(n==W.ADD?(this.dataGrid.showColumn("newValue"),this.dataGrid.hideColumn("oldValue"),this.dataGrid.setColumnTitle("newValue",this.valueColumnTitle)):n==W.DELETE?(this.dataGrid.showColumn("oldValue"),this.dataGrid.hideColumn("newValue"),this.dataGrid.setColumnTitle("oldValue",this.valueColumnTitle)):(this.dataGrid.showColumn("oldValue"),this.dataGrid.showColumn("newValue"),this.dataGrid.setColumnTitle("oldValue",this.oldValueColumnTitle),this.dataGrid.setColumnTitle("newValue",this.newValueColumnTitle))),e.chgdrTreeNode&&e.chgdrTreeNode.currentValue&&(this.data=e.chgdrTreeNode.currentValue.chgdrRow.changes)},Object.defineProperty(me.prototype,"fieldNameColumnTitle",{get:function(){return j.instant("field-name-column-title")},enumerable:!0,configurable:!0}),Object.defineProperty(me.prototype,"valueColumnTitle",{get:function(){return j.instant("value-column-title")},enumerable:!0,configurable:!0}),Object.defineProperty(me.prototype,"oldValueColumnTitle",{get:function(){return j.instant("old-value-column-title")},enumerable:!0,configurable:!0}),Object.defineProperty(me.prototype,"newValueColumnTitle",{get:function(){return j.instant("new-value-column-title")},enumerable:!0,configurable:!0}),me.decorators=[{type:y.Component,args:[{selector:"lib-chgdr-row-grid",template:'<farris-datagrid \r\n   #chgdrRowGrid \r\n   idField="fieldLabel" \r\n   [columns]="columns" \r\n   [data]="data" \r\n   [fit]="true"\r\n   [fitColumns]="true"\r\n   [pagination]="false" \r\n>',styles:[""]}]}],me.ctorParameters=function(){return[{type:y.Injector}]},me.propDecorators={chgdrTreeNode:[{type:y.Input}],dataGrid:[{type:y.ViewChild,args:["chgdrRowGrid"]}]},me);function me(e){this.injector=e}var ye=(be.prototype.ngOnInit=function(){},be.decorators=[{type:y.Component,args:[{selector:"lib-chgdr-list-dialog-content",template:'<chgdr-list [entityId]="entityId" [dataId]="dataId" style="padding: 0.75rem 0.875rem;height:100%" [beforeShowChangeDetail]="beforeShowChangeDetail"></chgdr-list>',styles:[""]}]}],be.ctorParameters=function(){return[{type:y.Injector}]},be.propDecorators={entityId:[{type:y.Input}],dataId:[{type:y.Input}],beforeShowChangeDetail:[{type:y.Input}]},be);function be(e){this.injector=e}var ve=function(){},Ce=function(){},we=(De.prototype.showDialog=function(e,t){if(!e)throw console.error("创建业务变更日志列表组件失败，业务实体不能为空，请检查",e,t),new Error("创建业务变更日志列表组件失败，业务实体不能为空，请检查");var n;e instanceof String||"string"==typeof e?((n=new Ce).entityId=e.toString(),n.dataId=t,this.create(n)):this.create(e)},De.prototype.create=function(e){if(null==e.entityId)throw console.error("创建业务变更日志列表组件失败，业务实体不能为空，请检查",e),new Error("创建业务变更日志列表组件失败，业务实体不能为空，请检查");var t=this.resolver.resolveComponentFactory(ye).create(this.injector),n={title:j.instant("chgdr-list-dialog-title"),width:1e3,height:550,resizable:!0,showButtons:!1,showMaxButton:!0,beforeOpen:function(){return w.of(!0)}};t.instance.entityId=e.entityId,t.instance.dataId=e.dataId,t.instance.beforeShowChangeDetail=e.beforeShowChangeDetail;this.modalService.show(t,n)},De.decorators=[{type:y.Injectable,args:[{providedIn:"root"}]}],De.ctorParameters=function(){return[{type:y.ComponentFactoryResolver},{type:y.Injector},{type:m.BsModalService},{type:b.MessagerService}]},De.ngInjectableDef=y.defineInjectable({factory:function(){return new De(y.inject(y.ComponentFactoryResolver),y.inject(y.INJECTOR),y.inject(m.BsModalService),y.inject(b.MessagerService))},token:De,providedIn:"root"}),De);function De(e,t,n,r){this.resolver=e,this.injector=t,this.modalService=n,this.messagerService=r}var Ie=(Te.prototype.ngOnInit=function(){this.resetColumnAndData(null,[])},Te.prototype.ngOnChanges=function(n){var r,a,e,i=this;n.chgdrs&&(r=this.getEntityId(n.chgdrs.previousValue),a=this.getEntityId(n.chgdrs.currentValue),e=[this.updateChgdrConfigHandler(a),this.updateDataCodeFields(r,a)],w.forkJoin(e).subscribe(function(e){var t=n.chgdrs.currentValue;t&&i.formatHeaders(t.headers),null!=a&&a!=r?i.resetColumnAndData(a,t.headers):i.headers=t.headers},function(e){console.error("获取BE【"+a+"】的配置的业务变更日志的业务编号失败：",e),i.messageService.error(j.instant("get-business-code-config-error",{errorMessage:se.getErrorMessage(e)}))}))},Te.prototype.updateChgdrConfigHandler=function(e){var t=this;return e?this.chgdrInnerService.getChgdrConfigHandler(e).pipe(C.tap(function(e){return t.chgdrConfigHandler=e})):w.of(this.chgdrConfigHandler)},Te.prototype.updateDataCodeFields=function(e,t){var n=this;return null!=t&&t!=e?this.chgdrService.getRootEntityDataCodeFields(t).pipe(C.tap(function(e){return n.dataCodeFields=e||[]})):w.of(this.dataCodeFields)},Te.prototype.formatHeaders=function(e){var n=this;e&&e.forEach(function(e){var t;n.formatDataCodeMap(e.dataCode),e.dataCode&&1==e.dataCode.size&&e.dataCode.has("_$dataCode")?(t={},n.dataCodeFields&&0<n.dataCodeFields.length&&(t[n.dataCodeFields[0].fieldLabelId]=e.dataCode.get("_$dataCode"))):t=ee.convertMapToObject(e.dataCode),e.dataCodeObj=t})},Te.prototype.formatDataCodeMap=function(n){var r=this;n&&this.chgdrConfigHandler&&Array.from(n.keys()).forEach(function(e){var t=n.get(e),t=r.chgdrConfigHandler.formatMainObjectFieldValue(t,e);n.set(e,t)})},Te.prototype.getEntityId=function(e){return e&&e.headers&&0!=e.headers.length?e.headers[0].entityId:null},Te.prototype.resetColumnAndData=function(e,t){var n=[{field:"userName",width:130,title:j.instant("user-name-column-title")},{field:"changeTime",width:130,title:j.instant("change-time-column-title"),formatter:{type:"datetime",options:{format:j.instant("change-time-column-format")}}},{field:"operateType.name",width:60,title:j.instant("operation-type-title")},{field:"dataId",width:130,title:j.instant("tech-pk-column-title"),visible:this.showDataId}];this.dataCodeFields.forEach(function(e){e={field:"dataCodeObj."+e.fieldLabelId,title:e.fieldName,width:130};n.push(e)});var r={title:j.instant("operation-column-title"),width:130,template:this.opCell,halign:"center",align:"center"};n.push(r),this.columns=n,this.headers=t},Te.prototype.onPageChanged=function(e){this.pageChanged.emit(e)},Te.prototype.onPageSizeChanged=function(e){this.pageSizeChanged.emit(e)},Te.prototype.clickShowChangeDetail=function(e){var t=this,n=e.rowData;n&&(this.beforeShowChangeDetail?((e=new ve).header=n,this.beforeShowChangeDetail(e).subscribe(function(e){e&&t.showChangeDetail(n)},function(e){console.error("执行业务变更详情打开前事件报错：",e),t.messageService.error("执行业务变更详情打开前事件报错："+se.getErrorMessage(e))})):this.showChangeDetail(n))},Te.prototype.showChangeDetail=function(t){var n=this;this.chgdrService.getChangeData(t.id,t.changeTime).subscribe(function(e){e?(n.currentChgdrData=e,n.chgdrInfoDialog.show()):n.notifyService.error(j.instant("can-not-found-change-record-by-id",{headerId:t.id}))},function(e){console.error("查询业务变更日志出错",e),n.messageService.error(j.instant("query-change-data-record-error",{errorMessage:se.getErrorMessage(e)}))})},Object.defineProperty(Te.prototype,"showChangeDetailBtn",{get:function(){return j.instant("show-change-detail-btn")},enumerable:!0,configurable:!0}),Object.defineProperty(Te.prototype,"changeDetailDialogTitle",{get:function(){return j.instant("change-detail-dialog-title")},enumerable:!0,configurable:!0}),Te.decorators=[{type:y.Component,args:[{selector:"lib-chgdr-header-datagrid",template:'<farris-datagrid #chgdrGrid idField="id" [columns]="columns" [data]="headers"\n  showLineNumber="true" [fit]="true" [fitColumns]="true" \n  [pagination]="true" [pageSize]="20" [showPageList]="false" [pageIndex]="chgdrs.pageIndex" [total]="chgdrs.total"\n  (pageChanged)="onPageChanged($event)" (pageSizeChanged)="onPageSizeChanged($event)"\n>\n</farris-datagrid>\n<ng-template #opCell let-ctx>\n  <a href="javascript: void(0);" (click)="clickShowChangeDetail(ctx)">{{showChangeDetailBtn}}</a>\n</ng-template>\n\n\x3c!-- 查看变更日志的弹窗 --\x3e\n<farris-dialog #chgdrInfoDialog\n  [title]="changeDetailDialogTitle"\n  [width]="1100"\n  [height]="600"\n  [showMaxButton]="true"\n  [resizable]="true"\n  [showButtons]="false"\n>\n  <chgdr-data-viewer [data]="currentChgdrData"></chgdr-data-viewer>\n</farris-dialog>',styles:[""]}]}],Te.ctorParameters=function(){return[{type:re},{type:b.MessagerService},{type:v.NotifyService},{type:y.ChangeDetectorRef},{type:$},{type:y.Injector}]},Te.propDecorators={baseCls:[{type:y.HostBinding,args:["class.f-utils-fill"]}],chgdrs:[{type:y.Input}],showDataId:[{type:y.Input}],beforeShowChangeDetail:[{type:y.Input}],pageChanged:[{type:y.Output}],pageSizeChanged:[{type:y.Output}],opCell:[{type:y.ViewChild,args:["opCell"]}],chgdrInfoDialog:[{type:y.ViewChild,args:["chgdrInfoDialog"]}]},Te);function Te(e,t,n,r,a,i){this.chgdrService=e,this.messageService=t,this.notifyService=n,this.ref=r,this.chgdrInnerService=a,this.injector=i,this.baseCls=!0,this.showDataId=!0,this.headers=[],this.dataCodeFields=[],this.pageChanged=new y.EventEmitter,this.pageSizeChanged=new y.EventEmitter}t.registerLocaleData(f);Se.decorators=[{type:y.NgModule,args:[{declarations:[Y,ue,he,ge,ye,Ie],imports:[t.CommonModule,n.FormsModule,c.TranslateModule.forRoot(),r.SplitterModule,a.AngularDraggableModule,i.DatagridModule,o.TreeTableModule,s.FarrisSectionModule,b.MessagerModule.forRoot(),v.NotifyModule,d.FarrisDialogModule,l.FarrisDatePickerModule,u.MetadataRTSelectModule,u.GSPMetadataRTServiceModule.forRoot("")],providers:[b.MessagerService,v.NotifyService,g.HttpService,g.SessionService,g.CacheService,we,G,A,$,re,P],entryComponents:[Y,ue,ye],exports:[Y,ue,Ie]}]}],o=Se;function Se(){}var Me,xe,Ee,Ne=function(){},s=(Z(xe=Oe,Ee=Me=Ne),xe.prototype=null===Ee?Object.create(Ee):(je.prototype=Ee.prototype,new je),Oe);function je(){this.constructor=xe}function Oe(){return null!==Me&&Me.apply(this,arguments)||this}d=function(){},l=function(){};e.ChgdrModule=o,e.ChgdrService=re,e.ChgdrDataViewerComponent=Y,e.ChgdrHeaderDatagridComponent=Ie,e.ChgdrListComponent=ue,e.ChangeDataHeader=Ne,e.ChangeDataCompHeader=s,e.ChangeDataRow=d,e.OperateType=W,e.ChangeDataQueryParam=ie,e.ChangeDataQueryResult=oe,e.BeforeShowChangeDetailEvent=ve,e.ChgdrListDialogConfig=Ce,e.ChgdrItemQueryParam=l,e.ChgdrListUiService=we,e.ɵf=ye,e.ɵd=he,e.ɵe=ge,e.ɵb=A,e.ɵc=$,e.ɵa=G,e.ɵh=P,e.ɵg=j,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-cmp-chgdr.umd.min.js.map
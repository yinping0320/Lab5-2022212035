/**
 * @fileoverview added by tsickle
 * Generated from: lib/service/chgdr-config-handler.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { format } from 'date-fns';
import { GSPElementDataType, GSPElementObjectType } from '@gsp-bef/gsp-cm-metadata';
import { I18nUtil } from './i18n-service';
export class ChgdrConfigHandler {
    /**
     * @param {?} be
     * @param {?} entityConfigs
     */
    constructor(be, entityConfigs) {
        this.entityCodeMap = new Map();
        this.entityFieldMap = new Map();
        this.entityFieldShowOrderMap = new Map();
        this.entityFieldParentMap = new Map();
        this.entityFieldConfigMap = new Map();
        //初始化所有BE对象信息
        this.be = be;
        if (!!be) {
            /** @type {?} */
            let mainObject = be.MainObject;
            this.updateEntityMap(mainObject, this.entityCodeMap, this.entityFieldMap);
        }
        //初始化配置信息
        this.entityConfigs = entityConfigs || [];
        this.updateEntityConfigs();
        //更新显示顺序
        this.updateShowIndex();
    }
    /**
     * 更新显示顺序号
     * @private
     * @return {?}
     */
    updateShowIndex() {
        /** @type {?} */
        let entityFieldShowOrderMap = new Map();
        //首先用BE字段顺序赋予初始顺序，避免配置中无顺序号造成显示错乱
        this.entityFieldMap.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            entityFieldShowOrderMap.set(key, entityFieldShowOrderMap.size);
        }));
        //然后用配置顺序替代初始顺序
        this.entityFieldConfigMap.forEach((/**
         * @param {?} value
         * @param {?} key
         * @return {?}
         */
        (value, key) => {
            if (value.showIndex !== undefined && value.showIndex !== null) {
                entityFieldShowOrderMap.set(key, value.showIndex);
            }
        }));
        this.entityFieldShowOrderMap = entityFieldShowOrderMap;
    }
    /**
     * 更新配置信息的相关数据
     * @private
     * @return {?}
     */
    updateEntityConfigs() {
        /** @type {?} */
        let fieldConfigMap = new Map();
        this.entityConfigs.forEach((/**
         * @param {?} entityConfig
         * @return {?}
         */
        entityConfig => {
            /** @type {?} */
            let tabCode = entityConfig.tabCode;
            (entityConfig.fields || []).forEach((/**
             * @param {?} field
             * @return {?}
             */
            field => {
                /** @type {?} */
                let fieldLabel = field.fieldLabelId;
                /** @type {?} */
                let key = tabCode + "#" + fieldLabel;
                fieldConfigMap.set(key, field);
            }));
        }));
        this.entityFieldConfigMap = fieldConfigMap;
    }
    /**
     * @private
     * @param {?} entity
     * @param {?} entityCodeMap
     * @param {?} entityFieldMap
     * @return {?}
     */
    updateEntityMap(entity, entityCodeMap, entityFieldMap) {
        if (!entity) {
            return;
        }
        entityCodeMap.set(entity.Code, entity);
        //实体对象的字段信息
        entity.ContainElements.forEach((/**
         * @param {?} ele
         * @return {?}
         */
        ele => {
            this.updateEntityFieldMap(entity, ele, null, entityFieldMap);
        }));
        //处理子节点信息
        /** @type {?} */
        let children = entity.ContainChildObjects;
        if (!children || !children.length) {
            return;
        }
        children.forEach((/**
         * @param {?} childEntity
         * @return {?}
         */
        childEntity => {
            this.updateEntityMap(childEntity, entityCodeMap, entityFieldMap);
        }));
    }
    /**
     * 更新BE节点的指定字段信息，如果该字段是关联字段，同时更新其带出字段
     * @private
     * @param {?} entity
     * @param {?} element
     * @param {?} parentElement
     * @param {?} entityFieldMap
     * @return {?}
     */
    updateEntityFieldMap(entity, element, parentElement, entityFieldMap) {
        /** @type {?} */
        let key = entity.Code + "#" + element.LabelID;
        entityFieldMap.set(key, element);
        if (parentElement) {
            this.entityFieldParentMap.set(key, parentElement);
        }
        /** @type {?} */
        const childAssociations = element.ChildAssociations;
        if (!!childAssociations && childAssociations.length > 0) {
            childAssociations.forEach((/**
             * @param {?} childAssociation
             * @return {?}
             */
            childAssociation => {
                /** @type {?} */
                const refElementCollection = childAssociation.RefElementCollection;
                if (!!refElementCollection && refElementCollection.length > 0) {
                    refElementCollection.forEach((/**
                     * @param {?} rele
                     * @return {?}
                     */
                    rele => {
                        this.updateEntityFieldMap(entity, rele, element, entityFieldMap);
                    }));
                }
            }));
        }
    }
    /**
     * @param {?} items
     * @param {?} entityCode
     * @param {?} fieldLabelIdFunc
     * @return {?}
     */
    sort(items, entityCode, fieldLabelIdFunc) {
        items.sort((/**
         * @param {?} a
         * @param {?} b
         * @return {?}
         */
        (a, b) => {
            /** @type {?} */
            const aKey = entityCode + "#" + fieldLabelIdFunc(a);
            /** @type {?} */
            const bKey = entityCode + "#" + fieldLabelIdFunc(b);
            if (!this.entityFieldShowOrderMap.has(aKey) && !this.entityFieldShowOrderMap.has(bKey)) {
                //如果双方均无顺序号，则按照自然排序
                return aKey.localeCompare(bKey);
            }
            else if (!this.entityFieldShowOrderMap.has(aKey)) {
                //如果有一方无顺序号，则无顺序号的靠后
                return -1;
            }
            else if (!this.entityFieldShowOrderMap.has(bKey)) {
                //如果有一方无顺序号，则无顺序号的靠后
                return 1;
            }
            else {
                //如果两方都有顺序号，则按照顺序号排序
                /** @type {?} */
                const aOrder = this.entityFieldShowOrderMap.get(aKey);
                /** @type {?} */
                const bOrder = this.entityFieldShowOrderMap.get(bKey);
                return aOrder - bOrder;
            }
        }));
    }
    /**
     * 格式化主对象节点中字段的值
     * @param {?} originalValue
     * @param {?} fieldLabelId
     * @return {?}
     */
    formatMainObjectFieldValue(originalValue, fieldLabelId) {
        /** @type {?} */
        let entityCode = this.getMainObjectCode();
        return this.formatFieldValue(originalValue, entityCode, fieldLabelId);
    }
    /**
     * 格式化字段值
     * @param {?} originalValue
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    formatFieldValue(originalValue, entityCode, fieldLabelId) {
        /** @type {?} */
        let element = this.getElement(entityCode, fieldLabelId);
        if (!element) {
            console.error("未找到业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】");
            return originalValue;
        }
        if (!element) {
            return originalValue;
        }
        try {
            //处理历史遗留的数字格式
            if ((element.MDataType == GSPElementDataType.Decimal || element.MDataType == GSPElementDataType.Integer)
                && originalValue && originalValue.toLowerCase().includes("e")) {
                //如果字段是数字类型，且是科学计数法格式
                //转为十进制格式显示
                /** @type {?} */
                let num = Number(originalValue);
                if (isNaN(num)) {
                    console.log("业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】的值不是有效的数字格式：" + originalValue);
                    return originalValue;
                }
                else {
                    /** @type {?} */
                    let result = this.toNonExponential(num);
                    return result;
                }
            }
            //处理布尔值类型
            if (element.MDataType == GSPElementDataType.Boolean) {
                //注意：new Boolean("false") == true
                if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    return originalValue;
                }
                else if (originalValue.toLowerCase() == "false") {
                    return I18nUtil.instantOrDefault("no-text", "否");
                }
                else if (originalValue.toLowerCase() == "true") {
                    return I18nUtil.instantOrDefault("yes-text", "是");
                }
                else {
                    return originalValue;
                }
            }
            //处理日期格式
            if (element.MDataType == GSPElementDataType.Date) {
                if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    //不包含值，直接返回原始值
                    return originalValue;
                }
                else {
                    /** @type {?} */
                    let date = new Date(originalValue);
                    /** @type {?} */
                    let str = format(date, "yyyy-MM-dd");
                    return str;
                }
            }
            //处理日期时间格式
            if (element.MDataType == GSPElementDataType.DateTime) {
                if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    //不包含值，直接返回原始值
                    return originalValue;
                }
                else {
                    /** @type {?} */
                    let date = new Date(originalValue);
                    /** @type {?} */
                    let str = format(date, "yyyy-MM-dd HH:mm:ss");
                    return str;
                }
            }
            //处理枚举格式
            if (element.ObjectType == GSPElementObjectType.Enum) {
                /** @type {?} */
                let enumValues = element.ContainEnumValues || [];
                /** @type {?} */
                let enumValue = enumValues.find((/**
                 * @param {?} item
                 * @return {?}
                 */
                item => item.Value == originalValue));
                if (enumValue) {
                    return enumValue.Name;
                }
                else if (originalValue === null || originalValue === undefined || originalValue.length == 0) {
                    //如果找不到对应的枚举项，并且原始值为空，说明未赋值，不报错
                    return originalValue;
                }
                else {
                    //打印异常
                    console.log("业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】的值未找到匹配的枚举项：" + originalValue);
                    return originalValue;
                }
            }
            return originalValue;
        }
        catch (error) {
            console.error("业务实体【" + this.be.ID + "-" + this.be.Name + "】节点【" + entityCode + "】的字段【" + fieldLabelId + "】的值【" + originalValue + "】格式化出错：", error);
            return originalValue;
        }
    }
    /**
     * JavaScript中科学计数法转化为数值字符串形式。
     * 以下两种情况，JavaScript 会自动将数值转为科学计数法表示
     * (1) 小于1且小数点后面带有6个0以上的浮点数值：
     * (2) 整数位数字多于21位：
     * 首先看看整数位数字多于21位的情况，其实这个一般不会碰到，整数位数字多于21位已经超出了 JavaScript 精确整数范围。
     * 这个方法用于处理小数问题
     * from：https://www.cnblogs.com/xianfengzhike/p/9939029.html
     * @private
     * @param {?} num
     * @return {?}
     */
    toNonExponential(num) {
        /** @type {?} */
        var m = num.toExponential().match(/\d(?:\.(\d*))?e([+-]\d+)/);
        return num.toFixed(Math.max(0, (m[1] || '').length - m[2]));
    }
    /**
     * @return {?}
     */
    getBeName() {
        return this.be ? this.be.Name : null;
    }
    /**
     * @return {?}
     */
    getMainObjectCode() {
        return this.be && this.be.MainObject ? this.be.MainObject.Code : null;
    }
    /**
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    getElement(entityCode, fieldLabelId) {
        /** @type {?} */
        let key = entityCode + "#" + fieldLabelId;
        return this.entityFieldMap.get(key);
    }
    /**
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    getParentElement(entityCode, fieldLabelId) {
        /** @type {?} */
        let key = entityCode + "#" + fieldLabelId;
        return this.entityFieldParentMap.get(key);
    }
    /**
     * @param {?} entityCode
     * @return {?}
     */
    getEntityNameOrDefault(entityCode) {
        /** @type {?} */
        let entity = this.entityCodeMap.get(entityCode);
        return !!entity ? entity.Name : entityCode;
    }
    /**
     * @param {?} entityCode
     * @param {?} fieldLabelId
     * @return {?}
     */
    getEntityFieldNameOrDefault(entityCode, fieldLabelId) {
        /** @type {?} */
        let key = entityCode + "#" + fieldLabelId;
        /** @type {?} */
        let fieldConfig = this.entityFieldConfigMap.get(key);
        if (fieldConfig && fieldConfig.fieldName && fieldConfig.fieldName != "") {
            //优先返回配置的名称
            return fieldConfig.fieldName;
        }
        //如果不存在配置名称，则返回BE字段名称
        /** @type {?} */
        let ele = this.entityFieldMap.get(key);
        return !!ele ? ele.Name : fieldLabelId;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.be;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityCodeMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldShowOrderMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldParentMap;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityConfigs;
    /**
     * @type {?}
     * @private
     */
    ChgdrConfigHandler.prototype.entityFieldConfigMap;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hnZHItY29uZmlnLWhhbmRsZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NwLWNtcC9jaGdkci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2NoZ2RyLWNvbmZpZy1oYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFXLE1BQU0sRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUUzQyxPQUFPLEVBQXlFLGtCQUFrQixFQUFFLG9CQUFvQixFQUFnQixNQUFNLDBCQUEwQixDQUFDO0FBR3pLLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUxQyxNQUFNLE9BQU8sa0JBQWtCOzs7OztJQVUzQixZQUFtQixFQUFxQixFQUFFLGFBQW1DO1FBUnJFLGtCQUFhLEdBQWtDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDekQsbUJBQWMsR0FBbUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUMzRCw0QkFBdUIsR0FBd0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUN6RCx5QkFBb0IsR0FBbUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUdqRSx5QkFBb0IsR0FBbUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUdyRSxhQUFhO1FBQ2IsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsQ0FBQyxFQUFFLEVBQUU7O2dCQUNGLFVBQVUsR0FBRyxFQUFFLENBQUMsVUFBVTtZQUM5QixJQUFJLENBQUMsZUFBZSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztTQUM3RTtRQUVELFNBQVM7UUFDVCxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsSUFBSSxFQUFFLENBQUM7UUFDekMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7UUFFM0IsUUFBUTtRQUNSLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUMzQixDQUFDOzs7Ozs7SUFHTyxlQUFl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QUFXLENBQUMsU0FBUyxJQUFJLFdBQVcsQ0FBQyxTQUFTLElBQUksRUFBRSxFQUFFO1lBQ3JFLFdBQVc7WUFDWCxPQUFPLFdBQVcsQ0FBQyxTQUFTLENBQUM7U0FDaEM7OztZQUVHLEdBQUcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7UUFDdEMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUM7SUFDM0MsQ0FBQztDQUNKOzs7Ozs7SUF2UUcsZ0NBQThCOzs7OztJQUM5QiwyQ0FBaUU7Ozs7O0lBQ2pFLDRDQUFtRTs7Ozs7SUFDbkUscURBQWlFOzs7OztJQUNqRSxrREFBeUU7Ozs7O0lBRXpFLDJDQUE0Qzs7Ozs7SUFDNUMsa0RBQXlFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNUb2RheSwgZm9ybWF0IH0gZnJvbSAnZGF0ZS1mbnMnO1xyXG5pbXBvcnQgeyBHU1BCdXNpbmVzc0VudGl0eSB9IGZyb20gJ0Bnc3AtYmVmL2dzcC1iZS1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IElHU1BDb21tb25PYmplY3QsIElHU1BDb21tb25FbGVtZW50LCBHU1BBc3NvY2lhdGlvbiwgR1NQQ29tbW9uRWxlbWVudCwgR1NQRWxlbWVudERhdGFUeXBlLCBHU1BFbGVtZW50T2JqZWN0VHlwZSwgR1NQRW51bVZhbHVlIH0gZnJvbSAnQGdzcC1iZWYvZ3NwLWNtLW1ldGFkYXRhJztcclxuaW1wb3J0IHsgQ2hnTG9nQ29uZmlnRW50aXR5IH0gZnJvbSAnLi4vbW9kZWwvY2hnZHItY29uZmlnLWVudGl0eSc7XHJcbmltcG9ydCB7IENoZ0xvZ0NvbmZpZ0ZpZWxkIH0gZnJvbSAnLi4vbW9kZWwvY2hnZHItY29uZmlnLWZpZWxkJztcclxuaW1wb3J0IHsgSTE4blV0aWwgfSBmcm9tICcuL2kxOG4tc2VydmljZSc7XHJcblxyXG5leHBvcnQgY2xhc3MgQ2hnZHJDb25maWdIYW5kbGVyIHtcclxuICAgIHByaXZhdGUgYmU6IEdTUEJ1c2luZXNzRW50aXR5O1xyXG4gICAgcHJpdmF0ZSBlbnRpdHlDb2RlTWFwOiBNYXA8c3RyaW5nLCBJR1NQQ29tbW9uT2JqZWN0PiA9IG5ldyBNYXAoKTtcclxuICAgIHByaXZhdGUgZW50aXR5RmllbGRNYXA6IE1hcDxzdHJpbmcsIElHU1BDb21tb25FbGVtZW50PiA9IG5ldyBNYXAoKTtcclxuICAgIHByaXZhdGUgZW50aXR5RmllbGRTaG93T3JkZXJNYXA6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7XHJcbiAgICBwcml2YXRlIGVudGl0eUZpZWxkUGFyZW50TWFwOiBNYXA8c3RyaW5nLCBJR1NQQ29tbW9uRWxlbWVudD4gPSBuZXcgTWFwKCk7XHJcblxyXG4gICAgcHJpdmF0ZSBlbnRpdHlDb25maWdzOiBDaGdMb2dDb25maWdFbnRpdHlbXTtcclxuICAgIHByaXZhdGUgZW50aXR5RmllbGRDb25maWdNYXA6IE1hcDxzdHJpbmcsIENoZ0xvZ0NvbmZpZ0ZpZWxkPiA9IG5ldyBNYXAoKTtcclxuXHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoYmU6IEdTUEJ1c2luZXNzRW50aXR5LCBlbnRpdHlDb25maWdzOiBDaGdMb2dDb25maWdFbnRpdHlbXSkge1xyXG4gICAgICAgIC8v5Yid5aeL5YyW5omA5pyJQkXlr7nosaHkv6Hmga9cclxuICAgICAgICB0aGlzLmJlID0gYmU7XHJcbiAgICAgICAgaWYgKCEhYmUpIHtcclxuICAgICAgICAgICAgbGV0IG1haW5PYmplY3QgPSBiZS5NYWluT2JqZWN0O1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUVudGl0eU1hcChtYWluT2JqZWN0LCB0aGlzLmVudGl0eUNvZGVNYXAsIHRoaXMuZW50aXR5RmllbGRNYXApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy/liJ3lp4vljJbphY3nva7kv6Hmga9cclxuICAgICAgICB0aGlzLmVudGl0eUNvbmZpZ3MgPSBlbnRpdHlDb25maWdzIHx8IFtdO1xyXG4gICAgICAgIHRoaXMudXBkYXRlRW50aXR5Q29uZmlncygpO1xyXG5cclxuICAgICAgICAvL+abtOaWsOaYvuekuumhuuW6j1xyXG4gICAgICAgIHRoaXMudXBkYXRlU2hvd0luZGV4KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOabtOaWsOaYvuekuumhuuW6j+WPtyAqL1xyXG4gICAgcHJpdmF0ZSB1cGRhdGVTaG93SW5kZXgoKSB7XHJcbiAgICAgICAgbGV0IGVudGl0eUZpZWxkU2hvd09yZGVyTWFwOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIC8v6aaW5YWI55SoQkXlrZfmrrXpobrluo/otYvkuojliJ3lp4vpobrluo/vvIzpgb/lhY3phY3nva7kuK3ml6Dpobrluo/lj7fpgKDmiJDmmL7npLrplJnkubFcclxuICAgICAgICB0aGlzLmVudGl0eUZpZWxkTWFwLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgZW50aXR5RmllbGRTaG93T3JkZXJNYXAuc2V0KGtleSwgZW50aXR5RmllbGRTaG93T3JkZXJNYXAuc2l6ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy/nhLblkI7nlKjphY3nva7pobrluo/mm7/ku6PliJ3lp4vpobrluo9cclxuICAgICAgICB0aGlzLmVudGl0eUZpZWxkQ29uZmlnTWFwLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlLnNob3dJbmRleCAhPT0gdW5kZWZpbmVkICYmIHZhbHVlLnNob3dJbmRleCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgZW50aXR5RmllbGRTaG93T3JkZXJNYXAuc2V0KGtleSwgdmFsdWUuc2hvd0luZGV4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIHRoaXMuZW50aXR5RmllbGRTaG93T3JkZXJNYXAgPSBlbnRpdHlGaWVsZFNob3dPcmRlck1hcDtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5pu05paw6YWN572u5L+h5oGv55qE55u45YWz5pWw5o2uICovXHJcbiAgICBwcml2YXRlIHVwZGF0ZUVudGl0eUNvbmZpZ3MoKSB7XHJcbiAgICAgICAgbGV0IGZpZWxkQ29uZmlnTWFwOiBNYXA8c3RyaW5nLCBDaGdMb2dDb25maWdGaWVsZD4gPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5lbnRpdHlDb25maWdzLmZvckVhY2goZW50aXR5Q29uZmlnID0+IHtcclxuICAgICAgICAgICAgbGV0IHRhYkNvZGUgPSBlbnRpdHlDb25maWcudGFiQ29kZTtcclxuICAgICAgICAgICAgKGVudGl0eUNvbmZpZy5maWVsZHMgfHwgW10pLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGZpZWxkTGFiZWwgPSBmaWVsZC5maWVsZExhYmVsSWQ7XHJcbiAgICAgICAgICAgICAgICBsZXQga2V5ID0gdGFiQ29kZSArIFwiI1wiICsgZmllbGRMYWJlbDtcclxuICAgICAgICAgICAgICAgIGZpZWxkQ29uZmlnTWFwLnNldChrZXksIGZpZWxkKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmVudGl0eUZpZWxkQ29uZmlnTWFwID0gZmllbGRDb25maWdNYXA7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVFbnRpdHlNYXAoZW50aXR5OiBJR1NQQ29tbW9uT2JqZWN0LCBlbnRpdHlDb2RlTWFwOiBNYXA8c3RyaW5nLCBJR1NQQ29tbW9uT2JqZWN0PiwgZW50aXR5RmllbGRNYXA6IE1hcDxzdHJpbmcsIElHU1BDb21tb25FbGVtZW50Pikge1xyXG4gICAgICAgIGlmICghZW50aXR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW50aXR5Q29kZU1hcC5zZXQoZW50aXR5LkNvZGUsIGVudGl0eSk7XHJcblxyXG4gICAgICAgIC8v5a6e5L2T5a+56LGh55qE5a2X5q615L+h5oGvXHJcbiAgICAgICAgZW50aXR5LkNvbnRhaW5FbGVtZW50cy5mb3JFYWNoKGVsZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRW50aXR5RmllbGRNYXAoZW50aXR5LCBlbGUsIG51bGwsIGVudGl0eUZpZWxkTWFwKTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAvL+WkhOeQhuWtkOiKgueCueS/oeaBr1xyXG4gICAgICAgIGxldCBjaGlsZHJlbjogSUdTUENvbW1vbk9iamVjdFtdID0gZW50aXR5LkNvbnRhaW5DaGlsZE9iamVjdHM7XHJcbiAgICAgICAgaWYgKCFjaGlsZHJlbiB8fCAhY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goY2hpbGRFbnRpdHkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUVudGl0eU1hcChjaGlsZEVudGl0eSwgZW50aXR5Q29kZU1hcCwgZW50aXR5RmllbGRNYXApO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOabtOaWsEJF6IqC54K555qE5oyH5a6a5a2X5q615L+h5oGv77yM5aaC5p6c6K+l5a2X5q615piv5YWz6IGU5a2X5q6177yM5ZCM5pe25pu05paw5YW25bim5Ye65a2X5q61ICovXHJcbiAgICBwcml2YXRlIHVwZGF0ZUVudGl0eUZpZWxkTWFwKGVudGl0eTogSUdTUENvbW1vbk9iamVjdCwgZWxlbWVudDogSUdTUENvbW1vbkVsZW1lbnQsIHBhcmVudEVsZW1lbnQ6IElHU1BDb21tb25FbGVtZW50LCBlbnRpdHlGaWVsZE1hcDogTWFwPHN0cmluZywgSUdTUENvbW1vbkVsZW1lbnQ+KTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGtleSA9IGVudGl0eS5Db2RlICsgXCIjXCIgKyBlbGVtZW50LkxhYmVsSUQ7XHJcbiAgICAgICAgZW50aXR5RmllbGRNYXAuc2V0KGtleSwgZWxlbWVudCk7XHJcbiAgICAgICAgaWYgKHBhcmVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHlGaWVsZFBhcmVudE1hcC5zZXQoa2V5LCBwYXJlbnRFbGVtZW50KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNoaWxkQXNzb2NpYXRpb25zOiBHU1BBc3NvY2lhdGlvbltdID0gZWxlbWVudC5DaGlsZEFzc29jaWF0aW9ucztcclxuICAgICAgICBpZiAoISFjaGlsZEFzc29jaWF0aW9ucyAmJiBjaGlsZEFzc29jaWF0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNoaWxkQXNzb2NpYXRpb25zLmZvckVhY2goY2hpbGRBc3NvY2lhdGlvbiA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZWZFbGVtZW50Q29sbGVjdGlvbjogR1NQQ29tbW9uRWxlbWVudFtdID0gY2hpbGRBc3NvY2lhdGlvbi5SZWZFbGVtZW50Q29sbGVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGlmICghIXJlZkVsZW1lbnRDb2xsZWN0aW9uICYmIHJlZkVsZW1lbnRDb2xsZWN0aW9uLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZWZFbGVtZW50Q29sbGVjdGlvbi5mb3JFYWNoKHJlbGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUVudGl0eUZpZWxkTWFwKGVudGl0eSwgcmVsZSwgZWxlbWVudCwgZW50aXR5RmllbGRNYXApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc29ydChpdGVtczogYW55W10sIGVudGl0eUNvZGU6IHN0cmluZywgZmllbGRMYWJlbElkRnVuYzogKGl0ZW06IGFueSkgPT4gc3RyaW5nKSB7XHJcbiAgICAgICAgaXRlbXMuc29ydCgoYSwgYikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBhS2V5ID0gZW50aXR5Q29kZSArIFwiI1wiICsgZmllbGRMYWJlbElkRnVuYyhhKTtcclxuICAgICAgICAgICAgY29uc3QgYktleSA9IGVudGl0eUNvZGUgKyBcIiNcIiArIGZpZWxkTGFiZWxJZEZ1bmMoYik7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5lbnRpdHlGaWVsZFNob3dPcmRlck1hcC5oYXMoYUtleSkgJiYgIXRoaXMuZW50aXR5RmllbGRTaG93T3JkZXJNYXAuaGFzKGJLZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAvL+WmguaenOWPjOaWueWdh+aXoOmhuuW6j+WPt++8jOWImeaMieeFp+iHqueEtuaOkuW6j1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFLZXkubG9jYWxlQ29tcGFyZShiS2V5KTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5lbnRpdHlGaWVsZFNob3dPcmRlck1hcC5oYXMoYUtleSkpIHtcclxuICAgICAgICAgICAgICAgIC8v5aaC5p6c5pyJ5LiA5pa55peg6aG65bqP5Y+377yM5YiZ5peg6aG65bqP5Y+355qE6Z2g5ZCOXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuZW50aXR5RmllbGRTaG93T3JkZXJNYXAuaGFzKGJLZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAvL+WmguaenOacieS4gOaWueaXoOmhuuW6j+WPt++8jOWImeaXoOmhuuW6j+WPt+eahOmdoOWQjlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL+WmguaenOS4pOaWuemDveaciemhuuW6j+WPt++8jOWImeaMieeFp+mhuuW6j+WPt+aOkuW6j1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYU9yZGVyID0gdGhpcy5lbnRpdHlGaWVsZFNob3dPcmRlck1hcC5nZXQoYUtleSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBiT3JkZXIgPSB0aGlzLmVudGl0eUZpZWxkU2hvd09yZGVyTWFwLmdldChiS2V5KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhT3JkZXIgLSBiT3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5qC85byP5YyW5Li75a+56LGh6IqC54K55Lit5a2X5q6155qE5YC8ICovXHJcbiAgICBwdWJsaWMgZm9ybWF0TWFpbk9iamVjdEZpZWxkVmFsdWUob3JpZ2luYWxWYWx1ZTogc3RyaW5nLCBmaWVsZExhYmVsSWQ6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBlbnRpdHlDb2RlID0gdGhpcy5nZXRNYWluT2JqZWN0Q29kZSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZvcm1hdEZpZWxkVmFsdWUob3JpZ2luYWxWYWx1ZSwgZW50aXR5Q29kZSwgZmllbGRMYWJlbElkKTtcclxuICAgIH1cclxuXHJcbiAgICAvKiog5qC85byP5YyW5a2X5q615YC8ICovXHJcbiAgICBwdWJsaWMgZm9ybWF0RmllbGRWYWx1ZShvcmlnaW5hbFZhbHVlOiBzdHJpbmcsIGVudGl0eUNvZGU6IHN0cmluZywgZmllbGRMYWJlbElkOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBlbGVtZW50OiBJR1NQQ29tbW9uRWxlbWVudCA9IHRoaXMuZ2V0RWxlbWVudChlbnRpdHlDb2RlLCBmaWVsZExhYmVsSWQpO1xyXG4gICAgICAgIGlmICghZWxlbWVudCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5pyq5om+5Yiw5Lia5Yqh5a6e5L2T44CQXCIgKyB0aGlzLmJlLklEICsgXCItXCIgKyB0aGlzLmJlLk5hbWUgKyBcIuOAkeiKgueCueOAkFwiICsgZW50aXR5Q29kZSArIFwi44CR55qE5a2X5q6144CQXCIgKyBmaWVsZExhYmVsSWQgKyBcIuOAkVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghZWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8v5aSE55CG5Y6G5Y+y6YGX55WZ55qE5pWw5a2X5qC85byPXHJcbiAgICAgICAgICAgIGlmICgoZWxlbWVudC5NRGF0YVR5cGUgPT0gR1NQRWxlbWVudERhdGFUeXBlLkRlY2ltYWwgfHwgZWxlbWVudC5NRGF0YVR5cGUgPT0gR1NQRWxlbWVudERhdGFUeXBlLkludGVnZXIpXHJcbiAgICAgICAgICAgICAgICAmJiBvcmlnaW5hbFZhbHVlICYmIG9yaWdpbmFsVmFsdWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImVcIikpIHtcclxuICAgICAgICAgICAgICAgIC8v5aaC5p6c5a2X5q615piv5pWw5a2X57G75Z6L77yM5LiU5piv56eR5a2m6K6h5pWw5rOV5qC85byPXHJcbiAgICAgICAgICAgICAgICAvL+i9rOS4uuWNgei/m+WItuagvOW8j+aYvuekulxyXG4gICAgICAgICAgICAgICAgbGV0IG51bSA9IE51bWJlcihvcmlnaW5hbFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChpc05hTihudW0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLkuJrliqHlrp7kvZPjgJBcIiArIHRoaXMuYmUuSUQgKyBcIi1cIiArIHRoaXMuYmUuTmFtZSArIFwi44CR6IqC54K544CQXCIgKyBlbnRpdHlDb2RlICsgXCLjgJHnmoTlrZfmrrXjgJBcIiArIGZpZWxkTGFiZWxJZCArIFwi44CR55qE5YC85LiN5piv5pyJ5pWI55qE5pWw5a2X5qC85byP77yaXCIgKyBvcmlnaW5hbFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHRoaXMudG9Ob25FeHBvbmVudGlhbChudW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8v5aSE55CG5biD5bCU5YC857G75Z6LXHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50Lk1EYXRhVHlwZSA9PSBHU1BFbGVtZW50RGF0YVR5cGUuQm9vbGVhbikge1xyXG4gICAgICAgICAgICAgICAgLy/ms6jmhI/vvJpuZXcgQm9vbGVhbihcImZhbHNlXCIpID09IHRydWVcclxuICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbFZhbHVlID09PSBudWxsIHx8IG9yaWdpbmFsVmFsdWUgPT09IHVuZGVmaW5lZCB8fCBvcmlnaW5hbFZhbHVlLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9yaWdpbmFsVmFsdWUudG9Mb3dlckNhc2UoKSA9PSBcImZhbHNlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gSTE4blV0aWwuaW5zdGFudE9yRGVmYXVsdChcIm5vLXRleHRcIiwgXCLlkKZcIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9yaWdpbmFsVmFsdWUudG9Mb3dlckNhc2UoKSA9PSBcInRydWVcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBJMThuVXRpbC5pbnN0YW50T3JEZWZhdWx0KFwieWVzLXRleHRcIiwgXCLmmK9cIik7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL+WkhOeQhuaXpeacn+agvOW8j1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5NRGF0YVR5cGUgPT0gR1NQRWxlbWVudERhdGFUeXBlLkRhdGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvcmlnaW5hbFZhbHVlID09PSBudWxsIHx8IG9yaWdpbmFsVmFsdWUgPT09IHVuZGVmaW5lZCB8fCBvcmlnaW5hbFZhbHVlLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/kuI3ljIXlkKvlgLzvvIznm7TmjqXov5Tlm57ljp/lp4vlgLxcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShvcmlnaW5hbFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3RyID0gZm9ybWF0KGRhdGUsIFwieXl5eS1NTS1kZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL+WkhOeQhuaXpeacn+aXtumXtOagvOW8j1xyXG4gICAgICAgICAgICBpZiAoZWxlbWVudC5NRGF0YVR5cGUgPT0gR1NQRWxlbWVudERhdGFUeXBlLkRhdGVUaW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWxWYWx1ZSA9PT0gbnVsbCB8fCBvcmlnaW5hbFZhbHVlID09PSB1bmRlZmluZWQgfHwgb3JpZ2luYWxWYWx1ZS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5LiN5YyF5ZCr5YC877yM55u05o6l6L+U5Zue5Y6f5aeL5YC8XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUob3JpZ2luYWxWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0ciA9IGZvcm1hdChkYXRlLCBcInl5eXktTU0tZGQgSEg6bW06c3NcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy/lpITnkIbmnprkuL7moLzlvI9cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuT2JqZWN0VHlwZSA9PSBHU1BFbGVtZW50T2JqZWN0VHlwZS5FbnVtKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZW51bVZhbHVlczogR1NQRW51bVZhbHVlW10gPSBlbGVtZW50LkNvbnRhaW5FbnVtVmFsdWVzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgbGV0IGVudW1WYWx1ZSA9IGVudW1WYWx1ZXMuZmluZChpdGVtID0+IGl0ZW0uVmFsdWUgPT0gb3JpZ2luYWxWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZW51bVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVudW1WYWx1ZS5OYW1lO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcmlnaW5hbFZhbHVlID09PSBudWxsIHx8IG9yaWdpbmFsVmFsdWUgPT09IHVuZGVmaW5lZCB8fCBvcmlnaW5hbFZhbHVlLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/lpoLmnpzmib7kuI3liLDlr7nlupTnmoTmnprkuL7pobnvvIzlubbkuJTljp/lp4vlgLzkuLrnqbrvvIzor7TmmI7mnKrotYvlgLzvvIzkuI3miqXplJlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/miZPljbDlvILluLhcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIuS4muWKoeWunuS9k+OAkFwiICsgdGhpcy5iZS5JRCArIFwiLVwiICsgdGhpcy5iZS5OYW1lICsgXCLjgJHoioLngrnjgJBcIiArIGVudGl0eUNvZGUgKyBcIuOAkeeahOWtl+auteOAkFwiICsgZmllbGRMYWJlbElkICsgXCLjgJHnmoTlgLzmnKrmib7liLDljLnphY3nmoTmnprkuL7pobnvvJpcIiArIG9yaWdpbmFsVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWx1ZTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5Lia5Yqh5a6e5L2T44CQXCIgKyB0aGlzLmJlLklEICsgXCItXCIgKyB0aGlzLmJlLk5hbWUgKyBcIuOAkeiKgueCueOAkFwiICsgZW50aXR5Q29kZSArIFwi44CR55qE5a2X5q6144CQXCIgKyBmaWVsZExhYmVsSWQgKyBcIuOAkeeahOWAvOOAkFwiICsgb3JpZ2luYWxWYWx1ZSArIFwi44CR5qC85byP5YyW5Ye66ZSZ77yaXCIsIGVycm9yKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgLyoqIEphdmFTY3JpcHTkuK3np5HlraborqHmlbDms5XovazljJbkuLrmlbDlgLzlrZfnrKbkuLLlvaLlvI/jgIJcclxuICAgICAqIOS7peS4i+S4pOenjeaDheWGte+8jEphdmFTY3JpcHQg5Lya6Ieq5Yqo5bCG5pWw5YC86L2s5Li656eR5a2m6K6h5pWw5rOV6KGo56S6XHJcbiAgICAgKiAoMSkg5bCP5LqOMeS4lOWwj+aVsOeCueWQjumdouW4puaciTbkuKow5Lul5LiK55qE5rWu54K55pWw5YC877yaXHJcbiAgICAgKiAoMikg5pW05pWw5L2N5pWw5a2X5aSa5LqOMjHkvY3vvJpcclxuICAgICAqIOmmluWFiOeci+eci+aVtOaVsOS9jeaVsOWtl+WkmuS6jjIx5L2N55qE5oOF5Ya177yM5YW25a6e6L+Z5Liq5LiA6Iis5LiN5Lya56Kw5Yiw77yM5pW05pWw5L2N5pWw5a2X5aSa5LqOMjHkvY3lt7Lnu4/otoXlh7rkuoYgSmF2YVNjcmlwdCDnsr7noa7mlbTmlbDojIPlm7TjgIJcclxuICAgICAqIOi/meS4quaWueazleeUqOS6juWkhOeQhuWwj+aVsOmXrumimFxyXG4gICAgICogZnJvbe+8mmh0dHBzOi8vd3d3LmNuYmxvZ3MuY29tL3hpYW5mZW5nemhpa2UvcC85OTM5MDI5Lmh0bWwgKi9cclxuICAgIHByaXZhdGUgdG9Ob25FeHBvbmVudGlhbChudW0pIHtcclxuICAgICAgICB2YXIgbSA9IG51bS50b0V4cG9uZW50aWFsKCkubWF0Y2goL1xcZCg/OlxcLihcXGQqKSk/ZShbKy1dXFxkKykvKTtcclxuICAgICAgICByZXR1cm4gbnVtLnRvRml4ZWQoTWF0aC5tYXgoMCwgKG1bMV0gfHwgJycpLmxlbmd0aCAtIG1bMl0pKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0QmVOYW1lKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmUgPyB0aGlzLmJlLk5hbWUgOiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRNYWluT2JqZWN0Q29kZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJlICYmIHRoaXMuYmUuTWFpbk9iamVjdCA/IHRoaXMuYmUuTWFpbk9iamVjdC5Db2RlIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RWxlbWVudChlbnRpdHlDb2RlOiBzdHJpbmcsIGZpZWxkTGFiZWxJZDogc3RyaW5nKTogSUdTUENvbW1vbkVsZW1lbnQge1xyXG4gICAgICAgIGxldCBrZXkgPSBlbnRpdHlDb2RlICsgXCIjXCIgKyBmaWVsZExhYmVsSWQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZW50aXR5RmllbGRNYXAuZ2V0KGtleSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldFBhcmVudEVsZW1lbnQoZW50aXR5Q29kZTogc3RyaW5nLCBmaWVsZExhYmVsSWQ6IHN0cmluZyk6IElHU1BDb21tb25FbGVtZW50IHtcclxuICAgICAgICBsZXQga2V5ID0gZW50aXR5Q29kZSArIFwiI1wiICsgZmllbGRMYWJlbElkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVudGl0eUZpZWxkUGFyZW50TWFwLmdldChrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRFbnRpdHlOYW1lT3JEZWZhdWx0KGVudGl0eUNvZGU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBlbnRpdHkgPSB0aGlzLmVudGl0eUNvZGVNYXAuZ2V0KGVudGl0eUNvZGUpO1xyXG4gICAgICAgIHJldHVybiAhIWVudGl0eSA/IGVudGl0eS5OYW1lIDogZW50aXR5Q29kZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RW50aXR5RmllbGROYW1lT3JEZWZhdWx0KGVudGl0eUNvZGU6IHN0cmluZywgZmllbGRMYWJlbElkOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQga2V5ID0gZW50aXR5Q29kZSArIFwiI1wiICsgZmllbGRMYWJlbElkO1xyXG4gICAgICAgIGxldCBmaWVsZENvbmZpZyA9IHRoaXMuZW50aXR5RmllbGRDb25maWdNYXAuZ2V0KGtleSk7XHJcbiAgICAgICAgaWYgKGZpZWxkQ29uZmlnICYmIGZpZWxkQ29uZmlnLmZpZWxkTmFtZSAmJiBmaWVsZENvbmZpZy5maWVsZE5hbWUgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAvL+S8mOWFiOi/lOWbnumFjee9rueahOWQjeensFxyXG4gICAgICAgICAgICByZXR1cm4gZmllbGRDb25maWcuZmllbGROYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL+WmguaenOS4jeWtmOWcqOmFjee9ruWQjeensO+8jOWImei/lOWbnkJF5a2X5q615ZCN56ewXHJcbiAgICAgICAgbGV0IGVsZSA9IHRoaXMuZW50aXR5RmllbGRNYXAuZ2V0KGtleSk7XHJcbiAgICAgICAgcmV0dXJuICEhZWxlID8gZWxlLk5hbWUgOiBmaWVsZExhYmVsSWQ7XHJcbiAgICB9XHJcbn0iXX0=
/**
 * @fileoverview added by tsickle
 * Generated from: lib/chgdr-data-viewer/chgdr-data-viewer.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Injector, Input, ViewChild } from '@angular/core';
import { GSPMetadataRTService } from '@gsp-lcm/metadatart-selector';
import { ChangeDataHeader } from '../model/change-data-header';
import { ChgdrDataBuilder } from './chgdr-data-builder';
import { ChgdrTreeBuilder } from './chgdr-tree-builder';
import { TreeTableComponent } from '@farris/ui-treetable';
import { ChgdrMetadataService } from '../service/chgdr-metadata.service';
import { ChgdrConfigService } from '../service/chgdr-config.service';
import { ChgdrInnerService } from '../service/chgdr-inner.service';
import { I18nUtil } from '../service/i18n-service';
export class ChgdrDataViewerComponent {
    /**
     * @param {?} metadataService
     * @param {?} injector
     * @param {?} chgdrMetadataService
     * @param {?} chgdrConfigService
     * @param {?} chgdrInnerService
     */
    constructor(metadataService, injector, chgdrMetadataService, chgdrConfigService, chgdrInnerService) {
        this.metadataService = metadataService;
        this.injector = injector;
        this.chgdrMetadataService = chgdrMetadataService;
        this.chgdrConfigService = chgdrConfigService;
        this.chgdrInnerService = chgdrInnerService;
        this.showDataId = false;
        this.treeConfig = {
            idField: 'id',
            columns: [
                { field: 'name', title: 'Name', width: 200 }
            ],
            /**
             * 叶子节点图标
             */
            leafIcon: 'f-icon f-icon-page-title-type text-info mr-2',
            /**
             * 节点展开图标
             */
            expandIcon: 'f-icon f-icon-file-folder-open text-info mr-2',
            /**
             * 节点折叠图标
             */
            collapseIcon: 'f-icon f-icon-file-folder-close text-info mr-2',
            showLevel: -1,
            disabled: false,
            init: false,
            selectValues: []
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (!!this.data) {
            /** @type {?} */
            let beId = this.data.entityId;
            this.chgdrInnerService.getChgdrConfigHandler(beId).subscribe((/**
             * @param {?} handler
             * @return {?}
             */
            handler => {
                this.chgdrData = new ChgdrDataBuilder().buildChgdrData(this.data, handler);
                this.treeData = new ChgdrTreeBuilder().build(this.chgdrData);
                if (this.treeTableComponent) {
                    //移除已选中项。
                    //避免更换数据源后，treeGrid找不到之前的选中数据，导致控制台告警
                    this.treeTableComponent.clearSelections();
                }
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.treeTableComponent.selectNode(this.treeData[0].id);
                }), 0);
            }));
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    handleTreeSelection($event) {
        /** @type {?} */
        const node = $event.node;
        if (this.currentNode != null && this.currentNode.id == node.id) {
            //如果选中相同节点，直接返回
            return;
        }
        this.currentNode = node;
    }
    /**
     * @return {?}
     */
    get baseInfoSectionTitle() {
        return I18nUtil.instant("base-info-section-title");
    }
    /**
     * @return {?}
     */
    get changeDetailSectionTitle() {
        return I18nUtil.instant("change-detail-section-title");
    }
    /**
     * @return {?}
     */
    get emptyDataText() {
        return I18nUtil.instant("empty-data-text");
    }
}
ChgdrDataViewerComponent.decorators = [
    { type: Component, args: [{
                selector: 'chgdr-data-viewer',
                template: "<farris-splitter *ngIf=\"!!chgdrData\" class=\"row flex-fill farris-split-section\" style=\"margin: 0px;\">\r\n  <farris-splitter-pane [ngResizable]=true [rzMinWidth]=\"250\" [rzHandles]=\"'e'\" style=\"padding:0.3rem 0 0.3rem 0.3rem;\"\r\n    class=\"d-flex flex-column farris-lsection f-col-w4\">\r\n    <farris-treetable #treeTable class=\"f-utils-fill\" style=\"overflow-y: auto;\" [columns]=\"treeConfig.columns\" [showBorder]=\"false\" [showHeader]=\"false\"\r\n      [data]=\"treeData\" [idField]=\"treeConfig.idField\" [singleSelect]=\"true\" [showCheckbox]=\"false\"\r\n      [showIcon]=\"true\" [disabled]=\"treeConfig.disabled\" [checkOnSelect]=\"true\"\r\n      (nodeSelected)=\"handleTreeSelection($event)\" [leafIcon]=\"treeConfig.leafIcon\"\r\n      [expandIcon]=\"treeConfig.expandIcon\" [collapseIcon]=\"treeConfig.collapseIcon\"\r\n      [selectValues]=\"treeConfig.selectValues\">\r\n    </farris-treetable>\r\n  </farris-splitter-pane>\r\n  <farris-splitter-pane class=\"farris-rsection farris-overflow-y-auto f-utils-fill-flex-column\" style=\"padding:0 0 0 0.3rem\">\r\n    <farris-section [mainTitle]=\"baseInfoSectionTitle\" [enableMaximize]=\"false\" [enableAccordion]=\"'default'\">\r\n      <lib-chgdr-row-baseinfo-form [chgdrTreeNode]=\"currentNode\" [showDataId]=\"showDataId\"></lib-chgdr-row-baseinfo-form>\r\n    </farris-section>\r\n    <farris-section [mainTitle]=\"changeDetailSectionTitle\" [enableMaximize]=\"false\" [fill]=\"true\" class=\"pt-0\">\r\n      <lib-chgdr-row-grid *ngIf=\"!!currentNode && currentNode.chgdrRow.changes.length>0\" [chgdrTreeNode]=\"currentNode\" class=\"f-utils-fill\"></lib-chgdr-row-grid>\r\n      <div class=\"f-datagrid-norecords\" *ngIf=\"!currentNode || currentNode.chgdrRow.changes.length==0\" style=\"height: 250px;\">\r\n        <div class=\"f-datagrid-norecords-content\" style=\"width: 100%;\">\r\n            {{emptyDataText}}\r\n        </div>\r\n      </div>\r\n    </farris-section>\r\n  </farris-splitter-pane>\r\n</farris-splitter>",
                styles: [":host{display:flex;height:100%}"]
            }] }
];
/** @nocollapse */
ChgdrDataViewerComponent.ctorParameters = () => [
    { type: GSPMetadataRTService },
    { type: Injector },
    { type: ChgdrMetadataService },
    { type: ChgdrConfigService },
    { type: ChgdrInnerService }
];
ChgdrDataViewerComponent.propDecorators = {
    data: [{ type: Input }],
    showDataId: [{ type: Input }],
    treeTableComponent: [{ type: ViewChild, args: ["treeTable",] }]
};
if (false) {
    /** @type {?} */
    ChgdrDataViewerComponent.prototype.data;
    /** @type {?} */
    ChgdrDataViewerComponent.prototype.showDataId;
    /**
     * @type {?}
     * @private
     */
    ChgdrDataViewerComponent.prototype.treeTableComponent;
    /** @type {?} */
    ChgdrDataViewerComponent.prototype.treeConfig;
    /** @type {?} */
    ChgdrDataViewerComponent.prototype.chgdrData;
    /** @type {?} */
    ChgdrDataViewerComponent.prototype.treeData;
    /** @type {?} */
    ChgdrDataViewerComponent.prototype.currentNode;
    /**
     * @type {?}
     * @private
     */
    ChgdrDataViewerComponent.prototype.metadataService;
    /**
     * @type {?}
     * @private
     */
    ChgdrDataViewerComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ChgdrDataViewerComponent.prototype.chgdrMetadataService;
    /**
     * @type {?}
     * @private
     */
    ChgdrDataViewerComponent.prototype.chgdrConfigService;
    /**
     * @type {?}
     * @private
     */
    ChgdrDataViewerComponent.prototype.chgdrInnerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hnZHItZGF0YS12aWV3ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGdzcC1jbXAvY2hnZHIvIiwic291cmNlcyI6WyJsaWIvY2hnZHItZGF0YS12aWV3ZXIvY2hnZHItZGF0YS12aWV3ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFvQyxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEcsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFcEUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFJL0QsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGdCQUFnQixFQUFpQixNQUFNLHNCQUFzQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzFELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBR3JFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ25FLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQU9uRCxNQUFNLE9BQU8sd0JBQXdCOzs7Ozs7OztJQTRCbkMsWUFBb0IsZUFBcUMsRUFDL0MsUUFBa0IsRUFDbEIsb0JBQTBDLEVBQzFDLGtCQUFzQyxFQUN0QyxpQkFBb0M7UUFKMUIsb0JBQWUsR0FBZixlQUFlLENBQXNCO1FBQy9DLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUMxQyx1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBQ3RDLHNCQUFpQixHQUFqQixpQkFB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Ozs7O0lBQzFCLHdEQUFrRDs7Ozs7SUFDbEQsc0RBQThDOzs7OztJQUM5QyxxREFBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEluamVjdG9yLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIFNpbXBsZUNoYW5nZXMsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBHU1BNZXRhZGF0YVJUU2VydmljZSB9IGZyb20gJ0Bnc3AtbGNtL21ldGFkYXRhcnQtc2VsZWN0b3InO1xyXG5pbXBvcnQgeyBHU1BCdXNpbmVzc0VudGl0eSB9IGZyb20gJ0Bnc3AtYmVmL2dzcC1iZS1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IENoYW5nZURhdGFIZWFkZXIgfSBmcm9tICcuLi9tb2RlbC9jaGFuZ2UtZGF0YS1oZWFkZXInO1xyXG5pbXBvcnQgeyBDaGFuZ2VDb2x1bW5JdGVtLCBDaGdkckRhdGEsIENoZ2RyRGF0YUVudGl0eU5vZGUsIENoZ2RyRGF0YVJvd05vZGUgfSBmcm9tICcuL2NoZ2RyLWRhdGEnO1xyXG5pbXBvcnQgeyBHU1BBc3NvY2lhdGlvbiwgR1NQQ29tbW9uRWxlbWVudCwgR1NQQ29tbW9uT2JqZWN0LCBJR1NQQ29tbW9uRWxlbWVudCwgSUdTUENvbW1vbk9iamVjdCB9IGZyb20gJ0Bnc3AtYmVmL2dzcC1jbS1tZXRhZGF0YSc7XHJcbmltcG9ydCB7IENoYW5nZURhdGFSb3cgfSBmcm9tICcuLi9tb2RlbC9jaGFuZ2UtZGF0YS1yb3cnO1xyXG5pbXBvcnQgeyBDaGdkckRhdGFCdWlsZGVyIH0gZnJvbSAnLi9jaGdkci1kYXRhLWJ1aWxkZXInO1xyXG5pbXBvcnQgeyBDaGdkclRyZWVCdWlsZGVyLCBDaGdkclRyZWVOb2RlIH0gZnJvbSAnLi9jaGdkci10cmVlLWJ1aWxkZXInO1xyXG5pbXBvcnQgeyBUcmVlVGFibGVDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLXRyZWV0YWJsZSc7XHJcbmltcG9ydCB7IENoZ2RyTWV0YWRhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS9jaGdkci1tZXRhZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ2hnZHJDb25maWdTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZS9jaGdkci1jb25maWcuc2VydmljZSc7XHJcbmltcG9ydCB7IGZvcmtKb2luIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENoZ0xvZ0NvbmZpZ0VudGl0eSB9IGZyb20gJy4uL21vZGVsL2NoZ2RyLWNvbmZpZy1lbnRpdHknO1xyXG5pbXBvcnQgeyBDaGdkcklubmVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2UvY2hnZHItaW5uZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IEkxOG5VdGlsIH0gZnJvbSAnLi4vc2VydmljZS9pMThuLXNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdjaGdkci1kYXRhLXZpZXdlcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NoZ2RyLWRhdGEtdmlld2VyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9jaGdkci1kYXRhLXZpZXdlci5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIENoZ2RyRGF0YVZpZXdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoKVxyXG4gIGRhdGE6IENoYW5nZURhdGFIZWFkZXI7XHJcbiAgQElucHV0KCkgc2hvd0RhdGFJZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIEBWaWV3Q2hpbGQoXCJ0cmVlVGFibGVcIilcclxuICBwcml2YXRlIHRyZWVUYWJsZUNvbXBvbmVudDogVHJlZVRhYmxlQ29tcG9uZW50XHJcblxyXG4gIHRyZWVDb25maWc6IGFueSA9IHtcclxuICAgIGlkRmllbGQ6ICdpZCcsXHJcbiAgICBjb2x1bW5zOiBbXHJcbiAgICAgIHsgZmllbGQ6ICduYW1lJywgdGl0bGU6ICdOYW1lJywgd2lkdGg6IDIwMCB9XHJcbiAgICBdLFxyXG4gICAgLyoqIOWPtuWtkOiKgueCueWbvuaghyAqL1xyXG4gICAgbGVhZkljb246ICdmLWljb24gZi1pY29uLXBhZ2UtdGl0bGUtdHlwZSB0ZXh0LWluZm8gbXItMicsXHJcbiAgICAvKiog6IqC54K55bGV5byA5Zu+5qCHICovXHJcbiAgICBleHBhbmRJY29uOiAnZi1pY29uwqBmLWljb24tZmlsZS1mb2xkZXItb3BlbiB0ZXh0LWluZm8gbXItMicsXHJcbiAgICAvKiog6IqC54K55oqY5Y+g5Zu+5qCHICovXHJcbiAgICBjb2xsYXBzZUljb246ICdmLWljb27CoGYtaWNvbi1maWxlLWZvbGRlci1jbG9zZSB0ZXh0LWluZm8gbXItMicsXHJcbiAgICBzaG93TGV2ZWw6IC0xLFxyXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxyXG4gICAgaW5pdDogZmFsc2UsXHJcbiAgICBzZWxlY3RWYWx1ZXM6IFtdXHJcbiAgfTtcclxuXHJcbiAgY2hnZHJEYXRhOiBDaGdkckRhdGE7XHJcbiAgdHJlZURhdGE6IENoZ2RyVHJlZU5vZGVbXTtcclxuICBjdXJyZW50Tm9kZTogQ2hnZHJUcmVlTm9kZTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBtZXRhZGF0YVNlcnZpY2U6IEdTUE1ldGFkYXRhUlRTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIGNoZ2RyTWV0YWRhdGFTZXJ2aWNlOiBDaGdkck1ldGFkYXRhU2VydmljZSxcclxuICAgIHByaXZhdGUgY2hnZHJDb25maWdTZXJ2aWNlOiBDaGdkckNvbmZpZ1NlcnZpY2UsXHJcbiAgICBwcml2YXRlIGNoZ2RySW5uZXJTZXJ2aWNlOiBDaGdkcklubmVyU2VydmljZSkge1xyXG4gICAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmICghIXRoaXMuZGF0YSkge1xyXG4gICAgICBsZXQgYmVJZCA9IHRoaXMuZGF0YS5lbnRpdHlJZDtcclxuICAgICAgdGhpcy5jaGdkcklubmVyU2VydmljZS5nZXRDaGdkckNvbmZpZ0hhbmRsZXIoYmVJZCkuc3Vic2NyaWJlKGhhbmRsZXI9PntcclxuICAgICAgICB0aGlzLmNoZ2RyRGF0YSA9IG5ldyBDaGdkckRhdGFCdWlsZGVyKCkuYnVpbGRDaGdkckRhdGEodGhpcy5kYXRhLCBoYW5kbGVyKTtcclxuICAgICAgICB0aGlzLnRyZWVEYXRhID0gbmV3IENoZ2RyVHJlZUJ1aWxkZXIoKS5idWlsZCh0aGlzLmNoZ2RyRGF0YSk7XHJcbiAgICAgICAgaWYgKHRoaXMudHJlZVRhYmxlQ29tcG9uZW50KSB7XHJcbiAgICAgICAgICAvL+enu+mZpOW3sumAieS4remhueOAglxyXG4gICAgICAgICAgLy/pgb/lhY3mm7TmjaLmlbDmja7mupDlkI7vvIx0cmVlR3JpZOaJvuS4jeWIsOS5i+WJjeeahOmAieS4reaVsOaNru+8jOWvvOiHtOaOp+WItuWPsOWRiuitplxyXG4gICAgICAgICAgdGhpcy50cmVlVGFibGVDb21wb25lbnQuY2xlYXJTZWxlY3Rpb25zKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy50cmVlVGFibGVDb21wb25lbnQuc2VsZWN0Tm9kZSh0aGlzLnRyZWVEYXRhWzBdLmlkKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBoYW5kbGVUcmVlU2VsZWN0aW9uKCRldmVudCk6IHZvaWQge1xyXG4gICAgY29uc3Qgbm9kZTogQ2hnZHJUcmVlTm9kZSA9ICRldmVudC5ub2RlO1xyXG4gICAgaWYgKHRoaXMuY3VycmVudE5vZGUgIT0gbnVsbCAmJiB0aGlzLmN1cnJlbnROb2RlLmlkID09IG5vZGUuaWQpIHtcclxuICAgICAgLy/lpoLmnpzpgInkuK3nm7jlkIzoioLngrnvvIznm7TmjqXov5Tlm55cclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jdXJyZW50Tm9kZSA9IG5vZGU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGJhc2VJbmZvU2VjdGlvblRpdGxlKCl7XHJcbiAgICByZXR1cm4gSTE4blV0aWwuaW5zdGFudChcImJhc2UtaW5mby1zZWN0aW9uLXRpdGxlXCIpXHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGNoYW5nZURldGFpbFNlY3Rpb25UaXRsZSgpe1xyXG4gICAgcmV0dXJuIEkxOG5VdGlsLmluc3RhbnQoXCJjaGFuZ2UtZGV0YWlsLXNlY3Rpb24tdGl0bGVcIik7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0ICBlbXB0eURhdGFUZXh0KCl7XHJcbiAgICByZXR1cm4gSTE4blV0aWwuaW5zdGFudChcImVtcHR5LWRhdGEtdGV4dFwiKTtcclxuICB9XHJcbn1cclxuIl19
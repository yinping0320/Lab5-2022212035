!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@ecp-caf/common-structure")):"function"==typeof define&&define.amd?define("@gsp-cmp/common-component",["exports","@angular/common","@angular/core","@angular/common/http","rxjs","rxjs/operators","@ecp-caf/common-structure"],t):t((e["gsp-cmp"]=e["gsp-cmp"]||{},e["gsp-cmp"]["common-component"]={}),e.ng.common,e.ng.core,e.ng.common.http,e.rxjs,e.rxjs.operators,e.commonStructure)}(this,function(e,t,r,o,f,n,m){"use strict";var i=function x(){},a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var c=(p.CMP_STRUCTURED_TYPE_REF="CmpStructureTypeRef",p);function p(){}var u,y=(function U(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(s,u=m.DataType),s.prototype.getKeys=function(){throw new Error("Method not implemented.")},s.prototype.getValue=function(e){throw new Error("Method not implemented.")},s);function s(){var e=u.call(this)||this;return e.kind=c.CMP_STRUCTURED_TYPE_REF,e}var d=function k(){},l=(h.convertToObject=function(e){var t=new Object;return t.id=e.id,t.referId=e.referId,t.referType=e.referType,t.referCode=e.referCode,t.structuredTypeId=e.structuredTypeId,t.code=e.code,t.name=e.name,t},h.initFromObject=function(e){var t=new d;return t.id=e.id,t.referId=e.referId,t.referType=e.referType,t.referCode=e.referCode,t.structuredTypeId=e.structuredTypeId,t.code=e.code,t.name=e.name,t},h);function h(){}var v=(T.prototype.convertToObject=function(o,e,n){o.id=e.id,o.code=e.code,o.name=e.name,o.description=e.description,o.application=e.application,o.serviceUnit=e.serviceUnit,o.version=e.version,o.operations=new Array,e.operations&&e.operations.forEach(function(e){var t=e.kind,r=n.getOperationSerializerFactory().get(t).serialize(e,n);o.operations.push(r)}),o.refStructures=new Array,e.refStructures&&e.refStructures.forEach(function(e){var t=l.convertToObject(e);o.refStructures.push(t)})},T.prototype.initFromObject=function(o,e,n){o.id=e.id,o.code=e.code,o.name=e.name,o.description=e.description,o.application=e.application,o.serviceUnit=e.serviceUnit,o.version=e.version,e.operations&&(o.operations=new Array,e.operations.forEach(function(e){var t=e.kind,r=n.getOperationSerializerFactory().get(t).deserialize(e,n);o.operations.push(r)})),e.refStructures&&(o.refStructures=new Array,e.refStructures.forEach(function(e){var t=l.initFromObject(e);o.refStructures.push(t)}))},T);function T(){}var g=(S.prototype.convertToObject=function(e,t,r){var o=t;e.kind=o.getKind(),e.referId=o.referId,e.code=o.code,e.name=o.name},S.prototype.initFromObject=function(e,t,r){var o=e;o.kind=t.kind,o.referId=t.referId,o.code=t.code,o.name=t.name},S);function S(){}var w=(C.prototype.serialize=function(e,t){var r=new Object;return(new g).convertToObject(r,e,t),r},C.prototype.deserialize=function(e,t){var r=new y;return(new g).initFromObject(r,e,t),r},C);function C(){}var F=(z.prototype.get=function(e){switch(e){case c.CMP_STRUCTURED_TYPE_REF:return this.serializer||(this.serializer=new w),this.serializer;default:return(new m.DefaultDataTypeSerializerFactory).get(e)}},z);function z(){}var O=(_.prototype.getDataTypeSerializerFactory=function(){return this.dataTypeFactory||(this.dataTypeFactory=new F),this.dataTypeFactory},_.prototype.getOperationSerializerFactory=function(){return this.operationFactory||(this.operationFactory=new m.DefaultOperationSerializerFactory),this.operationFactory},_.prototype.getParameterSerializerFactory=function(){return this.parameterFactory||(this.parameterFactory=new m.DefaultParameterSerializerFactory),this.parameterFactory},_.prototype.getPropertySerializerFactory=function(){return this.propertyFactory||(this.propertyFactory=new m.DefaultPropertySerializerFactory),this.propertyFactory},_);function _(){}var j=(D.prototype.serialize=function(e,t){var r=new Object;return(new v).convertToObject(r,e,t),r},D.prototype.deserialize=function(e,t){var r=new i;return(new v).initFromObject(r,e,t),r},D);function D(){}var E=(b.prototype.get=function(e){switch(e){case"Default":if(!this.serializerDict[e]){var t=new j;this.serializerDict[e]=t}break;default:throw new Error("未匹配到类型为"+e+"的序列化器!")}return this.serializerDict[e]},b);function b(){this.serializerDict={}}var I=(R.prototype.getComponent=function(e,t){var r=this.commom_component_url+"?componentId="+e;return this.http.get(r,{headers:t}).pipe(n.map(function(e){var t=new j,r=new O;return t.deserialize(e,r)}))},R.prototype.getParamSchema=function(e,c,p,u){var s=this,t=this.commom_component_url+"?componentId="+e;return this.http.get(t,{headers:u}).pipe(n.mergeMap(function(e){var t=new j,r=new O,o=t.deserialize(e,r),n=o.operations.find(function(e){return e.code==c});if(null==n)throw new Error("CommonComponent Operation NotFound，OperationCode: "+c);var i=n.parameters.find(function(e){return e.code==p});if(null==i)throw new Error("CommonComponent Parameter NotFound，ParameterCode: "+p);var a=i.parameterType;return a instanceof y?s.getStructureReferType(o,a,u):a instanceof m.CollectionType?s.getCollectionType(o,a,u):a instanceof m.MapType?s.getMapType(o,a,u):f.of(a)}))},R.prototype.getReturnValueSchema=function(e,a,c){var p=this,t=this.commom_component_url+"?componentId="+e;return this.http.get(t,{headers:c}).pipe(n.mergeMap(function(e){var t=new j,r=new O,o=t.deserialize(e,r),n=o.operations.find(function(e){return e.code==a});if(null==n)throw new Error("CommonComponent Operation NotFound，OperationCode: "+a);var i=n.returnType;return i instanceof y?p.getStructureReferType(o,i,c):i instanceof m.CollectionType?p.getCollectionType(o,i,c):i instanceof m.MapType?p.getMapType(o,i,c):f.of(i)}))},R.prototype.getCollectionType=function(e,t,r){var o=t.elementType;if(o instanceof y)return this.getStructureReferType(e,o,r).pipe(n.map(function(e){return t.elementType=e,t}));if(o instanceof m.PrimitiveType)return f.of(t);throw new Error("不支持的列表项类型: "+o.getKind())},R.prototype.getMapType=function(e,t,r){var o=t.valueType;if(o instanceof y)return this.getStructureReferType(e,o,r).pipe(n.map(function(e){return t.valueType=e,t}));if(o instanceof m.PrimitiveType)return f.of(t);if(o instanceof m.CollectionType)return this.getCollectionType(e,o,r).pipe(n.map(function(e){return t.valueType=e,t}));throw new Error("不支持的列表项类型: "+o.getKind())},R.prototype.getStructureReferType=function(e,t,r){var i=this,a=e.refStructures.find(function(e){return e.id==t.referId});return this.structureSvc.get(a.referType,a.referId,r).pipe(n.map(function(e){var t=new m.DefaultSerializeContext,r=e.kind,o=t.getStructureSerializerFactory().get(r).deserialize(e,t),n=a.structuredTypeId;return i.getAllStructures(o).find(function(e){return e.id==n})}))},R.prototype.getAllStructures=function(e){var t=new Array;return null!=e.structuredTypes&&(t=t.concat(e.structuredTypes)),null!=e.refStructures&&e.refStructures.forEach(function(e){null!=e.structuredTypes&&(t=t.concat(e.structuredTypes))}),t},R.decorators=[{type:r.Injectable}],R.ctorParameters=function(){return[{type:o.HttpClient},{type:m.CommonStructureDTService}]},R);function R(e,t){this.http=e,this.structureSvc=t,this.commom_component_url="/api/runtime/sys/v1.0/common-component"}var P=(M.decorators=[{type:r.NgModule,args:[{imports:[t.CommonModule,o.HttpClientModule],declarations:[],providers:[I],exports:[]}]}],M);function M(){}e.GspComponent=i,e.StructureReferType=y,e.RefStructureInfo=d,e.GspComponentConstant=c,e.GspComponentConvertor=v,e.RefStructureUtil=l,e.StructureReferTypeConvertor=g,e.DefaultGspComponentSerializeContext=O,e.DefaultGspComponentDataTypeSerializerFactory=F,e.DefaultGspComponentSerializerFactory=E,e.DefaultGspComponentDataTypeSerializer=w,e.DefaultGspComponentSerializer=j,e.CommonComponentModule=P,e.CommonComponentService=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gsp-cmp-common-component.umd.min.js.map
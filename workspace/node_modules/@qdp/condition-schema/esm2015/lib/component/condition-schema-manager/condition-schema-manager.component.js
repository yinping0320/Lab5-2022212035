/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, Optional, Injector } from '@angular/core';
import { Repository } from '@farris/devkit';
import { DialogComponent } from '@farris/ui-dialog';
import { NotifyService } from '@farris/ui-notify';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { DatagridComponent } from '@farris/ui-datagrid';
import { ConditionSchemaService } from '../../service/condition-schema.service';
import { FinishLoadService } from '../../service/finish-load.service';
import { LocalizeService } from '@qdp/localize';
import { EventBus, SchemaManagerService } from '@qdp/common';
import { MessagerService } from '@farris/ui-messager';
export class ConditionSchemaManagerComponent {
    /**
     * @param {?} repository
     * @param {?} conditionSchemaService
     * @param {?} notifyService
     * @param {?} finishLoasService
     * @param {?} injector
     */
    constructor(repository, conditionSchemaService, notifyService, finishLoasService, injector) {
        this.repository = repository;
        this.conditionSchemaService = conditionSchemaService;
        this.notifyService = notifyService;
        this.finishLoasService = finishLoasService;
        this.injector = injector;
        this.bindingSchema = {
            // 用于绑定保存界面
            isDefault: false,
            schemaName: '',
            schemaType: false,
            // 0公共，1是个人
            schemavalue: {}
        };
        // 当前应用方案的名称
        this.columns = [];
        this.total = 0;
        this.editMode = 'row';
        this.pageSize = 200;
        this.pageIndex = 1;
        this.schemaTypeData = [
            { name: '公共', value: 0 },
            { name: '单位', value: 2 },
            { name: '个人', value: 1 }
        ];
        this.size = {};
        this.colDefault = 'colDefault' + EventBus.guid();
        this.colPublic = 'colPublic' + EventBus.guid();
        this.operations = {};
        this.subscriptions = [];
        if (this.injector) {
            this.localizeService = this.injector.get(LocalizeService);
            this.schemaService = this.injector.get(SchemaManagerService);
            this.msgService = this.injector.get(MessagerService);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const self = this;
        /** @type {?} */
        let defaultSchema;
        // 从服务端获取当前用户的所有条件方案
        this.conditionSchemaService.getSchemaList(this.queryId, '', '').subscribe((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            this.schemaData = value && value.length ? value : [];
            defaultSchema = this.schemaData.find((/**
             * @param {?} schema
             * @return {?}
             */
            schema => {
                return schema.isDefault === 1;
            }));
            this.schemaData.forEach((/**
             * @param {?} item
             * @return {?}
             */
            (item) => {
                item.isDefault = item.isDefault === 1;
            }));
            if (defaultSchema) { // 预制默认对象
                this.currentSchemaName = defaultSchema.schemaName;
                this.finishLoasService.finish.subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                data => {
                    if (defaultSchema && defaultSchema.schemaValue && this.repository.entityCollection.getAllEntities() && this.repository.entityCollection.getAllEntities().length) {
                        defaultSchema.schemaValue.id = this.repository.entityCollection.getAllEntities()[0]['id'];
                    }
                    this.repository.entityCollection.getAllEntities()[0].load(defaultSchema.schemaValue);
                }));
            }
        }));
        this.gridInit();
        this.subscriptions.push(self.schemaService.operationChange.subscribe((/**
         * @param {?} value
         * @return {?}
         */
        (value) => {
            if (value) {
                self.operations = value;
            }
            // console.log(value);
        })));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.subscriptions && this.subscriptions.length) {
            for (const subscription of this.subscriptions) {
                subscription.unsubscribe();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    gridInit() {
        /** @type {?} */
        const self = this;
        /** @type {?} */
        const enumOpts = { valueField: 'value', textField: 'name', data: this.schemaTypeData };
        this.columns = [
            {
                field: 'schemaName', width: 100, title: self.localizeService.getValue('ideCmp.conditionSchemaManager.schemeName')
            },
            {
                field: 'schemaType', width: 100, title: self.localizeService.getValue('ideCmp.conditionSchemaManager.schemeType'), formatter: { type: 'enum', options: enumOpts },
            },
            {
                field: 'isDefault', width: 100, title: self.localizeService.getValue('ideCmp.conditionSchemaManager.default'),
                editor: {
                    type: EditorTypes.CHECKBOX,
                    options: {},
                },
                formatter: { type: 'boolean', options: { trueText: self.localizeService.getValue('ideCmp.conditionSchemaManager.default'), falseText: self.localizeService.getValue('ideCmp.conditionSchemaManager.noDefault') } }
            }
        ];
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onResized(event) {
        this.size.height = event.newHeight;
        this.size.width = event.newWidth;
    }
    /**
     * 处理保存格式方案
     * @return {?}
     */
    handleSaveClick() {
        if (!this.isSchemaNameValid(this.bindingSchema.schemaName)) {
            return;
        }
        /** @type {?} */
        const currentSchema = {};
        currentSchema['isDefault'] = this.bindingSchema.isDefault ? 1 : 0;
        currentSchema['queryId'] = this.queryId;
        currentSchema['schemaName'] = this.bindingSchema.schemaName;
        currentSchema['schemaType'] = this.bindingSchema.schemaType ? 0 : 1;
        /** @type {?} */
        const schemaValue = this.repository.entityCollection.toArray()[0].toJSON();
        delete schemaValue['id']; // 删除条件方案中的id字段(如果有)
        currentSchema['schemaValue'] = JSON.stringify(schemaValue);
        if (this.operations['QdpModifyPublicSchema'] === false && currentSchema['schemaType'] === 0) {
            this.msgService.warning(this.localizeService.getValue('ideCmp.schemaManager.message.validate.qdpModifyPublicSchema'));
            return;
        }
        if (this.schemaData && currentSchema['isDefault']) { // 将当前默认条件方案设为0
            // 将当前默认条件方案设为0
            /** @type {?} */
            const currentDefaultSchema = this.schemaData.find((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                return value.isDefault === 1;
            }));
            if (currentDefaultSchema) {
                currentDefaultSchema.isDefault = 0;
            }
        }
        this.schemaData.push(currentSchema);
        // 数据库新增一条数据，并返回所有格式方案
        this.conditionSchemaService.saveSchema(currentSchema).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (value) {
                this.schemaData = value;
                this.notifyService.success(this.localizeService.getValue('ideCmp.conditionSchemaManager.message.save.success'));
            }
            else {
                this.notifyService.error(this.localizeService.getValue('ideCmp.conditionSchemaManager.message.save.error'));
            }
        }));
        this.savingManagerDiglog.close();
    }
    /**
     * 处理方案管理页面点击事件，更改默认方案
     * @param {?} dataItem
     * @return {?}
     */
    handleDefault(dataItem) {
        /** @type {?} */
        const self = this;
        if (dataItem.isDefault === true) {
            /** @type {?} */
            const currentDefaultSchema = self.schemaData.find((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                return value.isDefault === true && value.id !== dataItem.id;
            }));
            if (currentDefaultSchema) {
                currentDefaultSchema.isDefault = false;
            }
            // this.schemaData = JSON.parse(JSON.stringify(this.schemaData));
            // this.dg.refresh();
        }
        /** @type {?} */
        const schema = JSON.parse(JSON.stringify(self.schemaData.find((/**
         * @param {?} value
         * @return {?}
         */
        value => value.id === dataItem.id))));
        if (this.operations['QdpModifyPublicSchema'] === false && schema.schemaType === 0) {
            this.msgService.warning(this.localizeService.getValue('ideCmp.schemaManager.message.validate.qdpModifyPublicSchema'));
            return;
        }
        schema.isDefault = schema.isDefault === false ? 0 : 1;
        schema.schemaValue = JSON.stringify(schema.schemaValue);
        self.conditionSchemaService.saveSchema(schema).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (value) {
                self.notifyService.success(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.update.success'));
                self.conditionSchemaService.getSchemaList(self.queryId, '', '').subscribe((/**
                 * @param {?} schemaList
                 * @return {?}
                 */
                schemaList => {
                    self.schemaData = schemaList && schemaList.length ? schemaList : [];
                    /** @type {?} */
                    const defaultSchema = self.schemaData.find((/**
                     * @param {?} schema
                     * @return {?}
                     */
                    schema => {
                        return schema.isDefault === 1;
                    }));
                    self.schemaData.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    (item) => {
                        item.isDefault = item.isDefault === 1;
                    }));
                    if (defaultSchema) { // 预制默认对象
                        self.currentSchemaName = defaultSchema.schemaName;
                    }
                }));
            }
            else {
                self.notifyService.error(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.update.error'));
            }
        })); // 将schemavalue转成string类型
    }
    /**
     * @return {?}
     */
    saveDefaultSchemaHandler() {
        this.dg.endRowEdit();
    }
    /**
     * @param {?} data
     * @return {?}
     */
    endEdit(data) {
        // console.log(data);
        this.handleDefault(data.rowData || undefined);
    }
    /**
     * 处理主页选中某个条件方案事件
     * @param {?} item 条件方案
     * @return {?}
     */
    handleDropDownItemClick(item) {
        this.currentSchemaName = item.schemaName;
        this.bindingSchema.schemaName = item.schemaName;
        if (item && item.schemaValue && this.repository.entityCollection.getAllEntities() && this.repository.entityCollection.getAllEntities().length) {
            item.schemaValue.id = this.repository.entityCollection.getAllEntities()[0]['id'];
        }
        this.repository.entityCollection.getAllEntities()[0].load(item.schemaValue);
    }
    /**
     * 删除解决方案
     * @return {?}
     */
    deleteSchemerHandler() {
        /** @type {?} */
        const self = this;
        if (self.dg.selectedRow) {
            /** @type {?} */
            const index = self.schemaData.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            (n) => n.id === self.dg.selectedRow.id));
            self.dg.refresh();
            if (this.operations['QdpModifyPublicSchema'] === false && self.schemaData[index].schemaType === 0) {
                this.msgService.warning(this.localizeService.getValue('ideCmp.schemaManager.message.validate.qdpModifyPublicSchema'));
                return;
            }
            if (self.schemaData[index].isDefault === 1) { // 判断是否为默认方案
                self.notifyService.warning(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.delete'));
                return;
            }
            /** @type {?} */
            const schemaId = self.schemaData[index].id;
            self.schemaData.splice(index, 1);
            // TODO 调用服务端接口
            self.conditionSchemaService.deleteSchema(schemaId, self.queryId).subscribe((/**
             * @param {?} value
             * @return {?}
             */
            value => {
                if (value) {
                    self.notifyService.success(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.delete.success'));
                }
                else {
                    self.notifyService.error(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.delete.error'));
                }
            }));
        }
        else {
            self.notifyService.info(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.select'));
        }
    }
    /**
     * 判断条件方案名称是否重复
     * @private
     * @param {?} schemaName 条件方案名称
     * @return {?}
     */
    isSchemaNameValid(schemaName) {
        if ((schemaName.length) >= 100) {
            this.notifyService.warning(this.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.longLimit'));
            return false;
        }
        /** @type {?} */
        const repeatSchema = this.schemaData.find((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            return value.schemaName === schemaName;
        }));
        if (repeatSchema) {
            this.notifyService.warning(this.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.repeatName'));
            return false;
        }
        return true;
    }
}
ConditionSchemaManagerComponent.decorators = [
    { type: Component, args: [{
                selector: 'condition-schema-manager',
                template: "<div class=\"btn-group mr-3\" fDropdown>\r\n  <button class=\"btn f-rt-btn f-btn-ml btn-secondary dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\"\r\n    fDropdownToggle>\r\n    <span class=\"f-icon f-icon-indent\" role=\"presentation\"></span>&nbsp;{{localizeService.getValue('ideCmp.conditionSchemaManager.conditionSchemeManagerName')}}\r\n  </button>\r\n  <div class=\"dropdown-menu\" fDropdownMenu>\r\n    <a class=\"dropdown-item\" href=\"javascript:void(0);\" (click)=\"savingManager.show()\">\r\n      <span class=\"k-icon\"></span>{{localizeService.getValue('ideCmp.conditionSchemaManager.schemeSave')}}</a>\r\n    <div class=\"dropdown-divider\"></div>\r\n\r\n    <a class=\"dropdown-item\" href=\"javascript:void(0);\" (click)=\"schemaManager.show()\">\r\n      <span class=\"k-icon\"></span>{{localizeService.getValue('ideCmp.conditionSchemaManager.schemeManagement')}}</a>\r\n    <div class=\"dropdown-divider\"></div>\r\n\r\n    <a *ngFor=\"let item of schemaData\" class=\"dropdown-item\" href=\"javascript:void(0);\"\r\n      (click)=\"handleDropDownItemClick(item)\">\r\n      <span [class.k-i-check]=\"currentSchemaName==item.schemaName\" class=\"k-icon\"></span>&nbsp;{{item.schemaName}}</a>\r\n  </div>\r\n</div>\r\n\r\n<!-- \u65B9\u6848\u7BA1\u7406Diglog -->\r\n<farris-dialog #schemaManager [title]=\"localizeService.getValue('ideCmp.conditionSchemaManager.schemeManagement')\" [showButtons]=\"false\" [width]=\"700\" [height]=\"500\">\r\n  <div class=\"d-flex flex-column flex-fill position-relative h-100 m-0\">\r\n    <div class=\"flex-fill farris-split-section m-1 farris-overflow-hidden\" (resized)=\"onResized($event)\">\r\n      <div class=\"farris-form farris-card-content-bg\">\r\n        <fieldSet farrisFold [style.height.px]=\"size.height\">\r\n          <button class=\"btn btn-primary mr-1 mb-1\" id=\"button-edit\" (click)=\"saveDefaultSchemaHandler()\">{{localizeService.getValue('ideCmp.conditionSchemaManager.btnSave')}}</button>\r\n          <button class=\"btn btn-secondary mr-1 mb-1\" id=\"button-edit\" (click)=\"deleteSchemerHandler()\">{{localizeService.getValue('ideCmp.conditionSchemaManager.btnDelete')}}</button>\r\n          <farris-datagrid #dg [data]=\"schemaData\" [columns]=\"columns\" #dg=\"datagrid\" [fit]=\"true\" [editable]=\"true\"\r\n            [editMode]=\"editMode\" [showCheckbox]=\"false\" [fitColumns]=\"true\" [showLineNumber]=\"true\" [striped]=\"true\"\r\n            [total]=\"total\" [pageSize]=\"100\" [virtualized]=\"true\" [pagination]=\"false\" (endEdit)=\"endEdit($event)\">\r\n          </farris-datagrid>\r\n        </fieldSet>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n\r\n<!-- \u4FDD\u5B58\u65B9\u6848Diglog -->\r\n<farris-dialog #savingManager [title]=\"localizeService.getValue('ideCmp.conditionSchemaManager.schemeManagement')\" [showButtons]=\"false\" [width]=\"350\" [height]=\"210\">\r\n  <div class=\"flex-fill farris-split-section m-1 farris-overflow-hidden\">\r\n    <div class=\"farris-form farris-card-content-bg\">\r\n      <div class=\"d-flex flex-wrap mb-2\">\r\n        <div class=\"col-12 col-md-12 col-lg-12\">\r\n          <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n            <div class=\"form-group farris-form-group\">\r\n              <label class=\"col-form-label\" for=\"colName\" style=\"width: 5rem; min-width: 5rem;\">\r\n                <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.conditionSchemaManager.schemeName')}}:</span>\r\n              </label>\r\n              <div class=\"farris-input-wrap\">\r\n                <input type=\"text\" [(ngModel)]=\"bindingSchema.schemaName\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-12 col-md-12 col-lg-12\">\r\n          <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n            <div class=\"form-group farris-form-group\">\r\n              <label class=\"col-form-label\" for=\"{{colDefault}}\" style=\"width: 5rem; min-width: 5rem;\">\r\n                <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.conditionSchemaManager.default')}}:</span>\r\n              </label>\r\n              <div class=\"farris-input-wrap farris-checkradio-hor\">\r\n                <div class=\"custom-control custom-checkbox mb-0\">\r\n                  <input type=\"checkbox\" [(ngModel)]=\"bindingSchema.isDefault\" class=\"custom-control-input\"\r\n                    id=\"{{colDefault}}\" checked=\"\">\r\n                  <label class=\"custom-control-label\" for=\"{{colDefault}}\"></label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-12 col-md-12 col-lg-12\">\r\n          <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n            <div class=\"form-group farris-form-group\">\r\n              <label class=\"col-form-label\" for=\"{{colPublic}}\" style=\"width: 5rem; min-width: 5rem;\">\r\n                <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.conditionSchemaManager.public')}}:</span>\r\n              </label>\r\n              <div class=\"farris-input-wrap farris-checkradio-hor\">\r\n                <div class=\"custom-control custom-checkbox mb-0\">\r\n                  <input type=\"checkbox\" [(ngModel)]=\"bindingSchema.schemaType\" class=\"custom-control-input\"\r\n                    id=\"{{colPublic}}\" checked=\"\">\r\n                  <label class=\"custom-control-label\" for=\"{{colPublic}}\"></label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div style=\"padding:0px 34px\">\r\n    <button class=\"btn btn-primary mr-1\" id=\"button-edit\" (click)=\"handleSaveClick()\">{{localizeService.getValue('ideCmp.conditionSchemaManager.btnSave')}}</button>\r\n  </div>\r\n</farris-dialog>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
ConditionSchemaManagerComponent.ctorParameters = () => [
    { type: Repository },
    { type: ConditionSchemaService },
    { type: NotifyService },
    { type: FinishLoadService },
    { type: Injector, decorators: [{ type: Optional }] }
];
ConditionSchemaManagerComponent.propDecorators = {
    queryId: [{ type: Input }],
    savingManagerDiglog: [{ type: ViewChild, args: ['savingManager',] }],
    dg: [{ type: ViewChild, args: ['dg',] }]
};
if (false) {
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.queryId;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.savingManagerDiglog;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.schemaData;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.bindingSchema;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.currentSchemaName;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.columns;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.total;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.editMode;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.pageSize;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.pageIndex;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.schemaTypeData;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.size;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.dg;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.localizeService;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.colDefault;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.colPublic;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.schemaService;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.operations;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.subscriptions;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.repository;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.conditionSchemaService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.finishLoasService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZGl0aW9uLXNjaGVtYS1tYW5hZ2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvY29uZGl0aW9uLXNjaGVtYS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnQvY29uZGl0aW9uLXNjaGVtYS1tYW5hZ2VyL2NvbmRpdGlvbi1zY2hlbWEtbWFuYWdlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ25HLE9BQU8sRUFBRSxVQUFVLEVBQVUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUNoRixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUN0RSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDN0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBTXRELE1BQU0sT0FBTywrQkFBK0I7Ozs7Ozs7O0lBaUMxQyxZQUNVLFVBQThCLEVBQzlCLHNCQUE4QyxFQUM5QyxhQUE0QixFQUM1QixpQkFBb0MsRUFDeEIsUUFBa0I7UUFKOUIsZUFBVSxHQUFWLFVBQVUsQ0FBb0I7UUFDOUIsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF3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QUM7UUFDRixJQUFJLFlBQVksRUFBRTtZQUNoQixJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQywyREFBMkQsQ0FBQyxDQUFDLENBQUM7WUFDdkgsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7O1lBalJGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsMEJBQTBCO2dCQUNwQyw2NExBQXdEOzthQUV6RDs7OztZQWRRLFVBQVU7WUFLVixzQkFBc0I7WUFIdEIsYUFBYTtZQUliLGlCQUFpQjtZQVA4QixRQUFRLHVCQXNEM0QsUUFBUTs7O3NCQXBDVixLQUFLO2tDQUNMLFNBQVMsU0FBQyxlQUFlO2lCQXFCekIsU0FBUyxTQUFDLElBQUk7Ozs7SUF0QmYsa0RBQTZCOzs7OztJQUM3Qiw4REFBeUU7O0lBQ3pFLHFEQUF5Qjs7SUFDekIsd0RBS0U7O0lBQ0YsNERBQWlDOztJQUVqQyxrREFBYTs7SUFDYixnREFBVTs7SUFDVixtREFBaUI7O0lBQ2pCLG1EQUFlOztJQUNmLG9EQUFjOztJQUNkLHlEQUlFOztJQUNGLCtDQUFlOztJQUNmLDZDQUF1Qzs7SUFDdkMsMERBQWlDOztJQUNqQyxxREFBaUQ7O0lBQ2pELG9EQUErQzs7SUFDL0Msd0RBQW9DOztJQUNwQyxxREFBcUI7Ozs7O0lBQ3JCLHdEQUEyQjs7SUFDM0IscURBQTRCOzs7OztJQUcxQixxREFBc0M7Ozs7O0lBQ3RDLGlFQUFzRDs7Ozs7SUFDdEQsd0RBQW9DOzs7OztJQUNwQyw0REFBNEM7Ozs7O0lBQzVDLG1EQUFzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgVmlld0NoaWxkLCBPcHRpb25hbCwgSW5qZWN0b3IsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBFbnRpdHkgfSBmcm9tICdAZmFycmlzL2RldmtpdCc7XHJcbmltcG9ydCB7IERpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGlhbG9nJztcclxuaW1wb3J0IHsgTm90aWZ5U2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbm90aWZ5JztcclxuaW1wb3J0IHsgRWRpdG9yVHlwZXMgfSBmcm9tICdAZmFycmlzL3VpLWRhdGFncmlkLWVkaXRvcnMnO1xyXG5pbXBvcnQgeyBEYXRhZ3JpZENvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBDb25kaXRpb25TY2hlbWFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9jb25kaXRpb24tc2NoZW1hLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBGaW5pc2hMb2FkU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2UvZmluaXNoLWxvYWQuc2VydmljZSc7XHJcbmltcG9ydCB7IExvY2FsaXplU2VydmljZSB9IGZyb20gJ0BxZHAvbG9jYWxpemUnO1xyXG5pbXBvcnQgeyBFdmVudEJ1cywgU2NoZW1hTWFuYWdlclNlcnZpY2UgfSBmcm9tICdAcWRwL2NvbW1vbic7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2NvbmRpdGlvbi1zY2hlbWEtbWFuYWdlcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbmRpdGlvbi1zY2hlbWEtbWFuYWdlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vY29uZGl0aW9uLXNjaGVtYS1tYW5hZ2VyLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29uZGl0aW9uU2NoZW1hTWFuYWdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgQElucHV0KCkgcHVibGljIHF1ZXJ5SWQ6IGFueTtcclxuICBAVmlld0NoaWxkKCdzYXZpbmdNYW5hZ2VyJykgcHJpdmF0ZSBzYXZpbmdNYW5hZ2VyRGlnbG9nOiBEaWFsb2dDb21wb25lbnQ7XHJcbiAgcHVibGljIHNjaGVtYURhdGE6IGFueVtdO1xyXG4gIHB1YmxpYyBiaW5kaW5nU2NoZW1hID0geyAvLyDnlKjkuo7nu5Hlrprkv53lrZjnlYzpnaJcclxuICAgIGlzRGVmYXVsdDogZmFsc2UsXHJcbiAgICBzY2hlbWFOYW1lOiAnJyxcclxuICAgIHNjaGVtYVR5cGU6IGZhbHNlLCAvLyAw5YWs5YWx77yMMeaYr+S4quS6ulxyXG4gICAgc2NoZW1hdmFsdWU6IHt9XHJcbiAgfTtcclxuICBwdWJsaWMgY3VycmVudFNjaGVtYU5hbWU6IHN0cmluZzsgLy8g5b2T5YmN5bqU55So5pa55qGI55qE5ZCN56ewXHJcblxyXG4gIGNvbHVtbnMgPSBbXTtcclxuICB0b3RhbCA9IDA7XHJcbiAgZWRpdE1vZGUgPSAncm93JztcclxuICBwYWdlU2l6ZSA9IDIwMDtcclxuICBwYWdlSW5kZXggPSAxO1xyXG4gIHNjaGVtYVR5cGVEYXRhOiBhbnkgPSBbXHJcbiAgICB7IG5hbWU6ICflhazlhbEnLCB2YWx1ZTogMCB9LFxyXG4gICAgeyBuYW1lOiAn5Y2V5L2NJywgdmFsdWU6IDIgfSxcclxuICAgIHsgbmFtZTogJ+S4quS6uicsIHZhbHVlOiAxIH1cclxuICBdO1xyXG4gIHNpemU6IGFueSA9IHt9O1xyXG4gIEBWaWV3Q2hpbGQoJ2RnJykgZGc6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIGxvY2FsaXplU2VydmljZTogTG9jYWxpemVTZXJ2aWNlO1xyXG4gIGNvbERlZmF1bHQ6IGFueSA9ICdjb2xEZWZhdWx0JyArIEV2ZW50QnVzLmd1aWQoKTtcclxuICBjb2xQdWJsaWM6IGFueSA9ICdjb2xQdWJsaWMnICsgRXZlbnRCdXMuZ3VpZCgpO1xyXG4gIHNjaGVtYVNlcnZpY2U6IFNjaGVtYU1hbmFnZXJTZXJ2aWNlO1xyXG4gIG9wZXJhdGlvbnM6IGFueSA9IHt9O1xyXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9ucyA9IFtdO1xyXG4gIG1zZ1NlcnZpY2U6IE1lc3NhZ2VyU2VydmljZTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8RW50aXR5PixcclxuICAgIHByaXZhdGUgY29uZGl0aW9uU2NoZW1hU2VydmljZTogQ29uZGl0aW9uU2NoZW1hU2VydmljZSxcclxuICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZSxcclxuICAgIHByaXZhdGUgZmluaXNoTG9hc1NlcnZpY2U6IEZpbmlzaExvYWRTZXJ2aWNlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcclxuICApIHtcclxuICAgIGlmICh0aGlzLmluamVjdG9yKSB7XHJcbiAgICAgIHRoaXMubG9jYWxpemVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxpemVTZXJ2aWNlKTtcclxuICAgICAgdGhpcy5zY2hlbWFTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoU2NoZW1hTWFuYWdlclNlcnZpY2UpO1xyXG4gICAgICB0aGlzLm1zZ1NlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChNZXNzYWdlclNlcnZpY2UpO1xyXG4gICAgfVxyXG4gIH1cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgbGV0IGRlZmF1bHRTY2hlbWE7XHJcbiAgICAvLyDku47mnI3liqHnq6/ojrflj5blvZPliY3nlKjmiLfnmoTmiYDmnInmnaHku7bmlrnmoYhcclxuICAgIHRoaXMuY29uZGl0aW9uU2NoZW1hU2VydmljZS5nZXRTY2hlbWFMaXN0KHRoaXMucXVlcnlJZCwgJycsICcnKS5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICB0aGlzLnNjaGVtYURhdGEgPSB2YWx1ZSAmJiB2YWx1ZS5sZW5ndGggPyB2YWx1ZSA6IFtdO1xyXG4gICAgICBkZWZhdWx0U2NoZW1hID0gdGhpcy5zY2hlbWFEYXRhLmZpbmQoc2NoZW1hID0+IHtcclxuICAgICAgICByZXR1cm4gc2NoZW1hLmlzRGVmYXVsdCA9PT0gMTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMuc2NoZW1hRGF0YS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICBpdGVtLmlzRGVmYXVsdCA9IGl0ZW0uaXNEZWZhdWx0ID09PSAxO1xyXG4gICAgICB9KTtcclxuICAgICAgaWYgKGRlZmF1bHRTY2hlbWEpIHsgLy8g6aKE5Yi26buY6K6k5a+56LGhXHJcbiAgICAgICAgdGhpcy5jdXJyZW50U2NoZW1hTmFtZSA9IGRlZmF1bHRTY2hlbWEuc2NoZW1hTmFtZTtcclxuICAgICAgICB0aGlzLmZpbmlzaExvYXNTZXJ2aWNlLmZpbmlzaC5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICBpZiAoZGVmYXVsdFNjaGVtYSAmJiBkZWZhdWx0U2NoZW1hLnNjaGVtYVZhbHVlICYmIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKCkgJiYgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgZGVmYXVsdFNjaGVtYS5zY2hlbWFWYWx1ZS5pZCA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKClbMF1bJ2lkJ107XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpWzBdLmxvYWQoZGVmYXVsdFNjaGVtYS5zY2hlbWFWYWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5ncmlkSW5pdCgpO1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goc2VsZi5zY2hlbWFTZXJ2aWNlLm9wZXJhdGlvbkNoYW5nZS5zdWJzY3JpYmUoKHZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgc2VsZi5vcGVyYXRpb25zID0gdmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgLy8gY29uc29sZS5sb2codmFsdWUpO1xyXG4gICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zdWJzY3JpcHRpb25zICYmIHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgZm9yIChjb25zdCBzdWJzY3JpcHRpb24gb2YgdGhpcy5zdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ3JpZEluaXQoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGNvbnN0IGVudW1PcHRzID0geyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICduYW1lJywgZGF0YTogdGhpcy5zY2hlbWFUeXBlRGF0YSB9O1xyXG4gICAgdGhpcy5jb2x1bW5zID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdzY2hlbWFOYW1lJywgd2lkdGg6IDEwMCwgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5zY2hlbWVOYW1lJylcclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiAnc2NoZW1hVHlwZScsIHdpZHRoOiAxMDAsIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIuc2NoZW1lVHlwZScpLCBmb3JtYXR0ZXI6IHsgdHlwZTogJ2VudW0nLCBvcHRpb25zOiBlbnVtT3B0cyB9LFxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdpc0RlZmF1bHQnLCB3aWR0aDogMTAwLCB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLmRlZmF1bHQnKSxcclxuICAgICAgICBlZGl0b3I6IHtcclxuICAgICAgICAgIHR5cGU6IEVkaXRvclR5cGVzLkNIRUNLQk9YLFxyXG4gICAgICAgICAgb3B0aW9uczoge30sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBmb3JtYXR0ZXI6IHsgdHlwZTogJ2Jvb2xlYW4nLCBvcHRpb25zOiB7IHRydWVUZXh0OiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIuZGVmYXVsdCcpLCBmYWxzZVRleHQ6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5ub0RlZmF1bHQnKSB9IH1cclxuICAgICAgfVxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIG9uUmVzaXplZChldmVudDogYW55KTogdm9pZCB7XHJcbiAgICB0aGlzLnNpemUuaGVpZ2h0ID0gZXZlbnQubmV3SGVpZ2h0O1xyXG4gICAgdGhpcy5zaXplLndpZHRoID0gZXZlbnQubmV3V2lkdGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbkv53lrZjmoLzlvI/mlrnmoYhcclxuICAgKi9cclxuICBwdWJsaWMgaGFuZGxlU2F2ZUNsaWNrKCkge1xyXG4gICAgaWYgKCF0aGlzLmlzU2NoZW1hTmFtZVZhbGlkKHRoaXMuYmluZGluZ1NjaGVtYS5zY2hlbWFOYW1lKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBjdXJyZW50U2NoZW1hID0ge307XHJcbiAgICBjdXJyZW50U2NoZW1hWydpc0RlZmF1bHQnXSA9IHRoaXMuYmluZGluZ1NjaGVtYS5pc0RlZmF1bHQgPyAxIDogMDtcclxuICAgIGN1cnJlbnRTY2hlbWFbJ3F1ZXJ5SWQnXSA9IHRoaXMucXVlcnlJZDtcclxuICAgIGN1cnJlbnRTY2hlbWFbJ3NjaGVtYU5hbWUnXSA9IHRoaXMuYmluZGluZ1NjaGVtYS5zY2hlbWFOYW1lO1xyXG4gICAgY3VycmVudFNjaGVtYVsnc2NoZW1hVHlwZSddID0gdGhpcy5iaW5kaW5nU2NoZW1hLnNjaGVtYVR5cGUgPyAwIDogMTtcclxuICAgIGNvbnN0IHNjaGVtYVZhbHVlID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24udG9BcnJheSgpWzBdLnRvSlNPTigpO1xyXG4gICAgZGVsZXRlIHNjaGVtYVZhbHVlWydpZCddOyAvLyDliKDpmaTmnaHku7bmlrnmoYjkuK3nmoRpZOWtl+autSjlpoLmnpzmnIkpXHJcbiAgICBjdXJyZW50U2NoZW1hWydzY2hlbWFWYWx1ZSddID0gSlNPTi5zdHJpbmdpZnkoc2NoZW1hVmFsdWUpO1xyXG5cclxuICAgIGlmICh0aGlzLm9wZXJhdGlvbnNbJ1FkcE1vZGlmeVB1YmxpY1NjaGVtYSddID09PSBmYWxzZSAmJiBjdXJyZW50U2NoZW1hWydzY2hlbWFUeXBlJ10gPT09IDApIHtcclxuICAgICAgdGhpcy5tc2dTZXJ2aWNlLndhcm5pbmcodGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5zY2hlbWFNYW5hZ2VyLm1lc3NhZ2UudmFsaWRhdGUucWRwTW9kaWZ5UHVibGljU2NoZW1hJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuc2NoZW1hRGF0YSAmJiBjdXJyZW50U2NoZW1hWydpc0RlZmF1bHQnXSkgeyAvLyDlsIblvZPliY3pu5jorqTmnaHku7bmlrnmoYjorr7kuLowXHJcbiAgICAgIGNvbnN0IGN1cnJlbnREZWZhdWx0U2NoZW1hID0gdGhpcy5zY2hlbWFEYXRhLmZpbmQodmFsdWUgPT4ge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZS5pc0RlZmF1bHQgPT09IDE7XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAoY3VycmVudERlZmF1bHRTY2hlbWEpIHtcclxuICAgICAgICBjdXJyZW50RGVmYXVsdFNjaGVtYS5pc0RlZmF1bHQgPSAwO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLnNjaGVtYURhdGEucHVzaChjdXJyZW50U2NoZW1hKTtcclxuICAgIC8vIOaVsOaNruW6k+aWsOWinuS4gOadoeaVsOaNru+8jOW5tui/lOWbnuaJgOacieagvOW8j+aWueahiFxyXG4gICAgdGhpcy5jb25kaXRpb25TY2hlbWFTZXJ2aWNlLnNhdmVTY2hlbWEoY3VycmVudFNjaGVtYSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5zY2hlbWFEYXRhID0gdmFsdWU7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3ModGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLm1lc3NhZ2Uuc2F2ZS5zdWNjZXNzJykpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubm90aWZ5U2VydmljZS5lcnJvcih0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS5zYXZlLmVycm9yJykpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc2F2aW5nTWFuYWdlckRpZ2xvZy5jbG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5aSE55CG5pa55qGI566h55CG6aG16Z2i54K55Ye75LqL5Lu277yM5pu05pS56buY6K6k5pa55qGIXHJcbiAgICovXHJcbiAgcHVibGljIGhhbmRsZURlZmF1bHQoZGF0YUl0ZW06IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBpZiAoZGF0YUl0ZW0uaXNEZWZhdWx0ID09PSB0cnVlKSB7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnREZWZhdWx0U2NoZW1hID0gc2VsZi5zY2hlbWFEYXRhLmZpbmQodmFsdWUgPT4ge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZS5pc0RlZmF1bHQgPT09IHRydWUgJiYgdmFsdWUuaWQgIT09IGRhdGFJdGVtLmlkO1xyXG4gICAgICB9KTtcclxuICAgICAgaWYgKGN1cnJlbnREZWZhdWx0U2NoZW1hKSB7XHJcbiAgICAgICAgY3VycmVudERlZmF1bHRTY2hlbWEuaXNEZWZhdWx0ID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgLy8gdGhpcy5zY2hlbWFEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnNjaGVtYURhdGEpKTtcclxuICAgICAgLy8gdGhpcy5kZy5yZWZyZXNoKCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzY2hlbWEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHNlbGYuc2NoZW1hRGF0YS5maW5kKHZhbHVlID0+IHZhbHVlLmlkID09PSBkYXRhSXRlbS5pZCkpKTtcclxuICAgIGlmICh0aGlzLm9wZXJhdGlvbnNbJ1FkcE1vZGlmeVB1YmxpY1NjaGVtYSddID09PSBmYWxzZSAmJiBzY2hlbWEuc2NoZW1hVHlwZSA9PT0gMCkge1xyXG4gICAgICB0aGlzLm1zZ1NlcnZpY2Uud2FybmluZyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5xZHBNb2RpZnlQdWJsaWNTY2hlbWEnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHNjaGVtYS5pc0RlZmF1bHQgPSBzY2hlbWEuaXNEZWZhdWx0ID09PSBmYWxzZSA/IDAgOiAxO1xyXG4gICAgc2NoZW1hLnNjaGVtYVZhbHVlID0gSlNPTi5zdHJpbmdpZnkoc2NoZW1hLnNjaGVtYVZhbHVlKTtcclxuXHJcbiAgICBzZWxmLmNvbmRpdGlvblNjaGVtYVNlcnZpY2Uuc2F2ZVNjaGVtYShzY2hlbWEpLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgIHNlbGYubm90aWZ5U2VydmljZS5zdWNjZXNzKHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5tZXNzYWdlLnVwZGF0ZS5zdWNjZXNzJykpO1xyXG4gICAgICAgIHNlbGYuY29uZGl0aW9uU2NoZW1hU2VydmljZS5nZXRTY2hlbWFMaXN0KHNlbGYucXVlcnlJZCwgJycsICcnKS5zdWJzY3JpYmUoc2NoZW1hTGlzdCA9PiB7XHJcbiAgICAgICAgICBzZWxmLnNjaGVtYURhdGEgPSBzY2hlbWFMaXN0ICYmIHNjaGVtYUxpc3QubGVuZ3RoID8gc2NoZW1hTGlzdCA6IFtdO1xyXG4gICAgICAgICAgY29uc3QgZGVmYXVsdFNjaGVtYSA9IHNlbGYuc2NoZW1hRGF0YS5maW5kKHNjaGVtYSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBzY2hlbWEuaXNEZWZhdWx0ID09PSAxO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBzZWxmLnNjaGVtYURhdGEuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGl0ZW0uaXNEZWZhdWx0ID0gaXRlbS5pc0RlZmF1bHQgPT09IDE7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGlmIChkZWZhdWx0U2NoZW1hKSB7IC8vIOmihOWItum7mOiupOWvueixoVxyXG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRTY2hlbWFOYW1lID0gZGVmYXVsdFNjaGVtYS5zY2hlbWFOYW1lO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNlbGYubm90aWZ5U2VydmljZS5lcnJvcihzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS51cGRhdGUuZXJyb3InKSk7XHJcbiAgICAgIH1cclxuICAgIH0pOyAvLyDlsIZzY2hlbWF2YWx1Zei9rOaIkHN0cmluZ+exu+Wei1xyXG4gIH1cclxuXHJcbiAgc2F2ZURlZmF1bHRTY2hlbWFIYW5kbGVyKCkge1xyXG4gICAgdGhpcy5kZy5lbmRSb3dFZGl0KCk7XHJcbiAgfVxyXG5cclxuICBlbmRFZGl0KGRhdGE6IGFueSkge1xyXG4gICAgLy8gY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICB0aGlzLmhhbmRsZURlZmF1bHQoZGF0YS5yb3dEYXRhIHx8IHVuZGVmaW5lZCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbkuLvpobXpgInkuK3mn5DkuKrmnaHku7bmlrnmoYjkuovku7ZcclxuICAgKiBAcGFyYW0gaXRlbSDmnaHku7bmlrnmoYhcclxuICAgKi9cclxuICBwdWJsaWMgaGFuZGxlRHJvcERvd25JdGVtQ2xpY2soaXRlbTogYW55KSB7XHJcbiAgICB0aGlzLmN1cnJlbnRTY2hlbWFOYW1lID0gaXRlbS5zY2hlbWFOYW1lO1xyXG4gICAgdGhpcy5iaW5kaW5nU2NoZW1hLnNjaGVtYU5hbWUgPSBpdGVtLnNjaGVtYU5hbWU7XHJcbiAgICBpZiAoaXRlbSAmJiBpdGVtLnNjaGVtYVZhbHVlICYmIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKCkgJiYgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKS5sZW5ndGgpIHtcclxuICAgICAgaXRlbS5zY2hlbWFWYWx1ZS5pZCA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKClbMF1bJ2lkJ107XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpWzBdLmxvYWQoaXRlbS5zY2hlbWFWYWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDliKDpmaTop6PlhrPmlrnmoYhcclxuICAgKi9cclxuICBwdWJsaWMgZGVsZXRlU2NoZW1lckhhbmRsZXIoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGlmIChzZWxmLmRnLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gc2VsZi5zY2hlbWFEYXRhLmZpbmRJbmRleCgobjogYW55KSA9PiBuLmlkID09PSBzZWxmLmRnLnNlbGVjdGVkUm93LmlkKTtcclxuICAgICAgc2VsZi5kZy5yZWZyZXNoKCk7XHJcbiAgICAgIGlmICh0aGlzLm9wZXJhdGlvbnNbJ1FkcE1vZGlmeVB1YmxpY1NjaGVtYSddID09PSBmYWxzZSAmJiBzZWxmLnNjaGVtYURhdGFbaW5kZXhdLnNjaGVtYVR5cGUgPT09IDApIHtcclxuICAgICAgICB0aGlzLm1zZ1NlcnZpY2Uud2FybmluZyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5xZHBNb2RpZnlQdWJsaWNTY2hlbWEnKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChzZWxmLnNjaGVtYURhdGFbaW5kZXhdLmlzRGVmYXVsdCA9PT0gMSkgeyAvLyDliKTmlq3mmK/lkKbkuLrpu5jorqTmlrnmoYhcclxuICAgICAgICBzZWxmLm5vdGlmeVNlcnZpY2Uud2FybmluZyhzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5kZWxldGUnKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHNjaGVtYUlkID0gc2VsZi5zY2hlbWFEYXRhW2luZGV4XS5pZDtcclxuICAgICAgc2VsZi5zY2hlbWFEYXRhLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgIC8vIFRPRE8g6LCD55So5pyN5Yqh56uv5o6l5Y+jXHJcbiAgICAgIHNlbGYuY29uZGl0aW9uU2NoZW1hU2VydmljZS5kZWxldGVTY2hlbWEoc2NoZW1hSWQsIHNlbGYucXVlcnlJZCkuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgIHNlbGYubm90aWZ5U2VydmljZS5zdWNjZXNzKHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5tZXNzYWdlLmRlbGV0ZS5zdWNjZXNzJykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBzZWxmLm5vdGlmeVNlcnZpY2UuZXJyb3Ioc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLm1lc3NhZ2UuZGVsZXRlLmVycm9yJykpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5vdGlmeVNlcnZpY2UuaW5mbyhzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5zZWxlY3QnKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICog5Yik5pat5p2h5Lu25pa55qGI5ZCN56ew5piv5ZCm6YeN5aSNXHJcbiAgICogQHBhcmFtIHNjaGVtYU5hbWUg5p2h5Lu25pa55qGI5ZCN56ewXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1NjaGVtYU5hbWVWYWxpZChzY2hlbWFOYW1lOiBhbnkpIHtcclxuICAgIGlmICgoc2NoZW1hTmFtZS5sZW5ndGgpID49IDEwMCkge1xyXG4gICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5sb25nTGltaXQnKSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcGVhdFNjaGVtYSA9IHRoaXMuc2NoZW1hRGF0YS5maW5kKHZhbHVlID0+IHtcclxuICAgICAgcmV0dXJuIHZhbHVlLnNjaGVtYU5hbWUgPT09IHNjaGVtYU5hbWU7XHJcbiAgICB9KTtcclxuICAgIGlmIChyZXBlYXRTY2hlbWEpIHtcclxuICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLndhcm5pbmcodGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLm1lc3NhZ2UudmFsaWRhdGUucmVwZWF0TmFtZScpKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, ViewChild, Optional, Injector } from '@angular/core';
import { Repository } from '@farris/devkit';
import { DialogComponent } from '@farris/ui-dialog';
import { NotifyService } from '@farris/ui-notify';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { DatagridComponent } from '@farris/ui-datagrid';
import { ConditionSchemaService } from '../../service/condition-schema.service';
import { FinishLoadService } from '../../service/finish-load.service';
import { LocalizeService } from '@qdp/localize';
import { EventBus, SchemaManagerService } from '@qdp/common';
import { MessagerService } from '@farris/ui-messager';
var ConditionSchemaManagerComponent = /** @class */ (function () {
    function ConditionSchemaManagerComponent(repository, conditionSchemaService, notifyService, finishLoasService, injector) {
        this.repository = repository;
        this.conditionSchemaService = conditionSchemaService;
        this.notifyService = notifyService;
        this.finishLoasService = finishLoasService;
        this.injector = injector;
        this.bindingSchema = {
            // 用于绑定保存界面
            isDefault: false,
            schemaName: '',
            schemaType: false,
            // 0公共，1是个人
            schemavalue: {}
        };
        // 当前应用方案的名称
        this.columns = [];
        this.total = 0;
        this.editMode = 'row';
        this.pageSize = 200;
        this.pageIndex = 1;
        this.schemaTypeData = [
            { name: '公共', value: 0 },
            { name: '单位', value: 2 },
            { name: '个人', value: 1 }
        ];
        this.size = {};
        this.colDefault = 'colDefault' + EventBus.guid();
        this.colPublic = 'colPublic' + EventBus.guid();
        this.operations = {};
        this.subscriptions = [];
        if (this.injector) {
            this.localizeService = this.injector.get(LocalizeService);
            this.schemaService = this.injector.get(SchemaManagerService);
            this.msgService = this.injector.get(MessagerService);
        }
    }
    /**
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var defaultSchema;
        // 从服务端获取当前用户的所有条件方案
        this.conditionSchemaService.getSchemaList(this.queryId, '', '').subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            _this.schemaData = value && value.length ? value : [];
            defaultSchema = _this.schemaData.find((/**
             * @param {?} schema
             * @return {?}
             */
            function (schema) {
                return schema.isDefault === 1;
            }));
            _this.schemaData.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                item.isDefault = item.isDefault === 1;
            }));
            if (defaultSchema) { // 预制默认对象
                _this.currentSchemaName = defaultSchema.schemaName;
                _this.finishLoasService.finish.subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    if (defaultSchema && defaultSchema.schemaValue && _this.repository.entityCollection.getAllEntities() && _this.repository.entityCollection.getAllEntities().length) {
                        defaultSchema.schemaValue.id = _this.repository.entityCollection.getAllEntities()[0]['id'];
                    }
                    _this.repository.entityCollection.getAllEntities()[0].load(defaultSchema.schemaValue);
                }));
            }
        }));
        this.gridInit();
        this.subscriptions.push(self.schemaService.operationChange.subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value) {
                self.operations = value;
            }
            // console.log(value);
        })));
    };
    /**
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (this.subscriptions && this.subscriptions.length) {
            try {
                for (var _b = tslib_1.__values(this.subscriptions), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var subscription = _c.value;
                    subscription.unsubscribe();
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.gridInit = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var enumOpts = { valueField: 'value', textField: 'name', data: this.schemaTypeData };
        this.columns = [
            {
                field: 'schemaName', width: 100, title: self.localizeService.getValue('ideCmp.conditionSchemaManager.schemeName')
            },
            {
                field: 'schemaType', width: 100, title: self.localizeService.getValue('ideCmp.conditionSchemaManager.schemeType'), formatter: { type: 'enum', options: enumOpts },
            },
            {
                field: 'isDefault', width: 100, title: self.localizeService.getValue('ideCmp.conditionSchemaManager.default'),
                editor: {
                    type: EditorTypes.CHECKBOX,
                    options: {},
                },
                formatter: { type: 'boolean', options: { trueText: self.localizeService.getValue('ideCmp.conditionSchemaManager.default'), falseText: self.localizeService.getValue('ideCmp.conditionSchemaManager.noDefault') } }
            }
        ];
    };
    /**
     * @param {?} event
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.onResized = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.size.height = event.newHeight;
        this.size.width = event.newWidth;
    };
    /**
     * 处理保存格式方案
     */
    /**
     * 处理保存格式方案
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.handleSaveClick = /**
     * 处理保存格式方案
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.isSchemaNameValid(this.bindingSchema.schemaName)) {
            return;
        }
        /** @type {?} */
        var currentSchema = {};
        currentSchema['isDefault'] = this.bindingSchema.isDefault ? 1 : 0;
        currentSchema['queryId'] = this.queryId;
        currentSchema['schemaName'] = this.bindingSchema.schemaName;
        currentSchema['schemaType'] = this.bindingSchema.schemaType ? 0 : 1;
        /** @type {?} */
        var schemaValue = this.repository.entityCollection.toArray()[0].toJSON();
        delete schemaValue['id']; // 删除条件方案中的id字段(如果有)
        currentSchema['schemaValue'] = JSON.stringify(schemaValue);
        if (this.operations['QdpModifyPublicSchema'] === false && currentSchema['schemaType'] === 0) {
            this.msgService.warning(this.localizeService.getValue('ideCmp.schemaManager.message.validate.qdpModifyPublicSchema'));
            return;
        }
        if (this.schemaData && currentSchema['isDefault']) { // 将当前默认条件方案设为0
            // 将当前默认条件方案设为0
            /** @type {?} */
            var currentDefaultSchema = this.schemaData.find((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                return value.isDefault === 1;
            }));
            if (currentDefaultSchema) {
                currentDefaultSchema.isDefault = 0;
            }
        }
        this.schemaData.push(currentSchema);
        // 数据库新增一条数据，并返回所有格式方案
        this.conditionSchemaService.saveSchema(currentSchema).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value) {
                _this.schemaData = value;
                _this.notifyService.success(_this.localizeService.getValue('ideCmp.conditionSchemaManager.message.save.success'));
            }
            else {
                _this.notifyService.error(_this.localizeService.getValue('ideCmp.conditionSchemaManager.message.save.error'));
            }
        }));
        this.savingManagerDiglog.close();
    };
    /**
     * 处理方案管理页面点击事件，更改默认方案
     */
    /**
     * 处理方案管理页面点击事件，更改默认方案
     * @param {?} dataItem
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.handleDefault = /**
     * 处理方案管理页面点击事件，更改默认方案
     * @param {?} dataItem
     * @return {?}
     */
    function (dataItem) {
        /** @type {?} */
        var self = this;
        if (dataItem.isDefault === true) {
            /** @type {?} */
            var currentDefaultSchema = self.schemaData.find((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                return value.isDefault === true && value.id !== dataItem.id;
            }));
            if (currentDefaultSchema) {
                currentDefaultSchema.isDefault = false;
            }
            // this.schemaData = JSON.parse(JSON.stringify(this.schemaData));
            // this.dg.refresh();
        }
        /** @type {?} */
        var schema = JSON.parse(JSON.stringify(self.schemaData.find((/**
         * @param {?} value
         * @return {?}
         */
        function (value) { return value.id === dataItem.id; }))));
        if (this.operations['QdpModifyPublicSchema'] === false && schema.schemaType === 0) {
            this.msgService.warning(this.localizeService.getValue('ideCmp.schemaManager.message.validate.qdpModifyPublicSchema'));
            return;
        }
        schema.isDefault = schema.isDefault === false ? 0 : 1;
        schema.schemaValue = JSON.stringify(schema.schemaValue);
        self.conditionSchemaService.saveSchema(schema).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value) {
                self.notifyService.success(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.update.success'));
                self.conditionSchemaService.getSchemaList(self.queryId, '', '').subscribe((/**
                 * @param {?} schemaList
                 * @return {?}
                 */
                function (schemaList) {
                    self.schemaData = schemaList && schemaList.length ? schemaList : [];
                    /** @type {?} */
                    var defaultSchema = self.schemaData.find((/**
                     * @param {?} schema
                     * @return {?}
                     */
                    function (schema) {
                        return schema.isDefault === 1;
                    }));
                    self.schemaData.forEach((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) {
                        item.isDefault = item.isDefault === 1;
                    }));
                    if (defaultSchema) { // 预制默认对象
                        self.currentSchemaName = defaultSchema.schemaName;
                    }
                }));
            }
            else {
                self.notifyService.error(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.update.error'));
            }
        })); // 将schemavalue转成string类型
    };
    /**
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.saveDefaultSchemaHandler = /**
     * @return {?}
     */
    function () {
        this.dg.endRowEdit();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.endEdit = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        // console.log(data);
        this.handleDefault(data.rowData || undefined);
    };
    /**
     * 处理主页选中某个条件方案事件
     * @param item 条件方案
     */
    /**
     * 处理主页选中某个条件方案事件
     * @param {?} item 条件方案
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.handleDropDownItemClick = /**
     * 处理主页选中某个条件方案事件
     * @param {?} item 条件方案
     * @return {?}
     */
    function (item) {
        this.currentSchemaName = item.schemaName;
        this.bindingSchema.schemaName = item.schemaName;
        if (item && item.schemaValue && this.repository.entityCollection.getAllEntities() && this.repository.entityCollection.getAllEntities().length) {
            item.schemaValue.id = this.repository.entityCollection.getAllEntities()[0]['id'];
        }
        this.repository.entityCollection.getAllEntities()[0].load(item.schemaValue);
    };
    /**
     * 删除解决方案
     */
    /**
     * 删除解决方案
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.deleteSchemerHandler = /**
     * 删除解决方案
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        if (self.dg.selectedRow) {
            /** @type {?} */
            var index = self.schemaData.findIndex((/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.id === self.dg.selectedRow.id; }));
            self.dg.refresh();
            if (this.operations['QdpModifyPublicSchema'] === false && self.schemaData[index].schemaType === 0) {
                this.msgService.warning(this.localizeService.getValue('ideCmp.schemaManager.message.validate.qdpModifyPublicSchema'));
                return;
            }
            if (self.schemaData[index].isDefault === 1) { // 判断是否为默认方案
                self.notifyService.warning(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.delete'));
                return;
            }
            /** @type {?} */
            var schemaId = self.schemaData[index].id;
            self.schemaData.splice(index, 1);
            // TODO 调用服务端接口
            self.conditionSchemaService.deleteSchema(schemaId, self.queryId).subscribe((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                if (value) {
                    self.notifyService.success(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.delete.success'));
                }
                else {
                    self.notifyService.error(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.delete.error'));
                }
            }));
        }
        else {
            self.notifyService.info(self.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.select'));
        }
    };
    /**
     * 判断条件方案名称是否重复
     * @param schemaName 条件方案名称
     */
    /**
     * 判断条件方案名称是否重复
     * @private
     * @param {?} schemaName 条件方案名称
     * @return {?}
     */
    ConditionSchemaManagerComponent.prototype.isSchemaNameValid = /**
     * 判断条件方案名称是否重复
     * @private
     * @param {?} schemaName 条件方案名称
     * @return {?}
     */
    function (schemaName) {
        if ((schemaName.length) >= 100) {
            this.notifyService.warning(this.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.longLimit'));
            return false;
        }
        /** @type {?} */
        var repeatSchema = this.schemaData.find((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            return value.schemaName === schemaName;
        }));
        if (repeatSchema) {
            this.notifyService.warning(this.localizeService.getValue('ideCmp.conditionSchemaManager.message.validate.repeatName'));
            return false;
        }
        return true;
    };
    ConditionSchemaManagerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'condition-schema-manager',
                    template: "<div class=\"btn-group mr-3\" fDropdown>\r\n  <button class=\"btn f-rt-btn f-btn-ml btn-secondary dropdown-toggle\" type=\"button\" id=\"dropdownMenuButton\"\r\n    fDropdownToggle>\r\n    <span class=\"f-icon f-icon-indent\" role=\"presentation\"></span>&nbsp;{{localizeService.getValue('ideCmp.conditionSchemaManager.conditionSchemeManagerName')}}\r\n  </button>\r\n  <div class=\"dropdown-menu\" fDropdownMenu>\r\n    <a class=\"dropdown-item\" href=\"javascript:void(0);\" (click)=\"savingManager.show()\">\r\n      <span class=\"k-icon\"></span>{{localizeService.getValue('ideCmp.conditionSchemaManager.schemeSave')}}</a>\r\n    <div class=\"dropdown-divider\"></div>\r\n\r\n    <a class=\"dropdown-item\" href=\"javascript:void(0);\" (click)=\"schemaManager.show()\">\r\n      <span class=\"k-icon\"></span>{{localizeService.getValue('ideCmp.conditionSchemaManager.schemeManagement')}}</a>\r\n    <div class=\"dropdown-divider\"></div>\r\n\r\n    <a *ngFor=\"let item of schemaData\" class=\"dropdown-item\" href=\"javascript:void(0);\"\r\n      (click)=\"handleDropDownItemClick(item)\">\r\n      <span [class.k-i-check]=\"currentSchemaName==item.schemaName\" class=\"k-icon\"></span>&nbsp;{{item.schemaName}}</a>\r\n  </div>\r\n</div>\r\n\r\n<!-- \u65B9\u6848\u7BA1\u7406Diglog -->\r\n<farris-dialog #schemaManager [title]=\"localizeService.getValue('ideCmp.conditionSchemaManager.schemeManagement')\" [showButtons]=\"false\" [width]=\"700\" [height]=\"500\">\r\n  <div class=\"d-flex flex-column flex-fill position-relative h-100 m-0\">\r\n    <div class=\"flex-fill farris-split-section m-1 farris-overflow-hidden\" (resized)=\"onResized($event)\">\r\n      <div class=\"farris-form farris-card-content-bg\">\r\n        <fieldSet farrisFold [style.height.px]=\"size.height\">\r\n          <button class=\"btn btn-primary mr-1 mb-1\" id=\"button-edit\" (click)=\"saveDefaultSchemaHandler()\">{{localizeService.getValue('ideCmp.conditionSchemaManager.btnSave')}}</button>\r\n          <button class=\"btn btn-secondary mr-1 mb-1\" id=\"button-edit\" (click)=\"deleteSchemerHandler()\">{{localizeService.getValue('ideCmp.conditionSchemaManager.btnDelete')}}</button>\r\n          <farris-datagrid #dg [data]=\"schemaData\" [columns]=\"columns\" #dg=\"datagrid\" [fit]=\"true\" [editable]=\"true\"\r\n            [editMode]=\"editMode\" [showCheckbox]=\"false\" [fitColumns]=\"true\" [showLineNumber]=\"true\" [striped]=\"true\"\r\n            [total]=\"total\" [pageSize]=\"100\" [virtualized]=\"true\" [pagination]=\"false\" (endEdit)=\"endEdit($event)\">\r\n          </farris-datagrid>\r\n        </fieldSet>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n\r\n<!-- \u4FDD\u5B58\u65B9\u6848Diglog -->\r\n<farris-dialog #savingManager [title]=\"localizeService.getValue('ideCmp.conditionSchemaManager.schemeManagement')\" [showButtons]=\"false\" [width]=\"350\" [height]=\"210\">\r\n  <div class=\"flex-fill farris-split-section m-1 farris-overflow-hidden\">\r\n    <div class=\"farris-form farris-card-content-bg\">\r\n      <div class=\"d-flex flex-wrap mb-2\">\r\n        <div class=\"col-12 col-md-12 col-lg-12\">\r\n          <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n            <div class=\"form-group farris-form-group\">\r\n              <label class=\"col-form-label\" for=\"colName\" style=\"width: 5rem; min-width: 5rem;\">\r\n                <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.conditionSchemaManager.schemeName')}}:</span>\r\n              </label>\r\n              <div class=\"farris-input-wrap\">\r\n                <input type=\"text\" [(ngModel)]=\"bindingSchema.schemaName\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-12 col-md-12 col-lg-12\">\r\n          <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n            <div class=\"form-group farris-form-group\">\r\n              <label class=\"col-form-label\" for=\"{{colDefault}}\" style=\"width: 5rem; min-width: 5rem;\">\r\n                <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.conditionSchemaManager.default')}}:</span>\r\n              </label>\r\n              <div class=\"farris-input-wrap farris-checkradio-hor\">\r\n                <div class=\"custom-control custom-checkbox mb-0\">\r\n                  <input type=\"checkbox\" [(ngModel)]=\"bindingSchema.isDefault\" class=\"custom-control-input\"\r\n                    id=\"{{colDefault}}\" checked=\"\">\r\n                  <label class=\"custom-control-label\" for=\"{{colDefault}}\"></label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-12 col-md-12 col-lg-12\">\r\n          <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n            <div class=\"form-group farris-form-group\">\r\n              <label class=\"col-form-label\" for=\"{{colPublic}}\" style=\"width: 5rem; min-width: 5rem;\">\r\n                <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.conditionSchemaManager.public')}}:</span>\r\n              </label>\r\n              <div class=\"farris-input-wrap farris-checkradio-hor\">\r\n                <div class=\"custom-control custom-checkbox mb-0\">\r\n                  <input type=\"checkbox\" [(ngModel)]=\"bindingSchema.schemaType\" class=\"custom-control-input\"\r\n                    id=\"{{colPublic}}\" checked=\"\">\r\n                  <label class=\"custom-control-label\" for=\"{{colPublic}}\"></label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div style=\"padding:0px 34px\">\r\n    <button class=\"btn btn-primary mr-1\" id=\"button-edit\" (click)=\"handleSaveClick()\">{{localizeService.getValue('ideCmp.conditionSchemaManager.btnSave')}}</button>\r\n  </div>\r\n</farris-dialog>\r\n",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    ConditionSchemaManagerComponent.ctorParameters = function () { return [
        { type: Repository },
        { type: ConditionSchemaService },
        { type: NotifyService },
        { type: FinishLoadService },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    ConditionSchemaManagerComponent.propDecorators = {
        queryId: [{ type: Input }],
        savingManagerDiglog: [{ type: ViewChild, args: ['savingManager',] }],
        dg: [{ type: ViewChild, args: ['dg',] }]
    };
    return ConditionSchemaManagerComponent;
}());
export { ConditionSchemaManagerComponent };
if (false) {
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.queryId;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.savingManagerDiglog;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.schemaData;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.bindingSchema;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.currentSchemaName;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.columns;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.total;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.editMode;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.pageSize;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.pageIndex;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.schemaTypeData;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.size;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.dg;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.localizeService;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.colDefault;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.colPublic;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.schemaService;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.operations;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.subscriptions;
    /** @type {?} */
    ConditionSchemaManagerComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.repository;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.conditionSchemaService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.finishLoasService;
    /**
     * @type {?}
     * @private
     */
    ConditionSchemaManagerComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZGl0aW9uLXNjaGVtYS1tYW5hZ2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvY29uZGl0aW9uLXNjaGVtYS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnQvY29uZGl0aW9uLXNjaGVtYS1tYW5hZ2VyL2NvbmRpdGlvbi1zY2hlbWEtbWFuYWdlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUNuRyxPQUFPLEVBQUUsVUFBVSxFQUFVLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDeEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDaEYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDdEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRCxPQUFPLEVBQUUsUUFBUSxFQUFFLG9CQUFvQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQzdELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RDtJQXNDRSx5Q0FDVSxVQUE4QixFQUM5QixzQkFBOEMsRUFDOUMsYUFBNEIsRUFDNUIsaUJBQW9DLEVBQ3hCLFFBQWtCO1FBSjlCLGVBQVUsR0FBVixVQUFVLENBQW9CO1FBQzlCLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7UUFDOUMsa0JBQWEsR0FBYixhQUFh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SUFDNUMsbURBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBWaWV3Q2hpbGQsIE9wdGlvbmFsLCBJbmplY3RvciwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFJlcG9zaXRvcnksIEVudGl0eSB9IGZyb20gJ0BmYXJyaXMvZGV2a2l0JztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBFZGl0b3JUeXBlcyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycyc7XHJcbmltcG9ydCB7IERhdGFncmlkQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kYXRhZ3JpZCc7XHJcbmltcG9ydCB7IENvbmRpdGlvblNjaGVtYVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL2NvbmRpdGlvbi1zY2hlbWEuc2VydmljZSc7XHJcbmltcG9ydCB7IEZpbmlzaExvYWRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9maW5pc2gtbG9hZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTG9jYWxpemVTZXJ2aWNlIH0gZnJvbSAnQHFkcC9sb2NhbGl6ZSc7XHJcbmltcG9ydCB7IEV2ZW50QnVzLCBTY2hlbWFNYW5hZ2VyU2VydmljZSB9IGZyb20gJ0BxZHAvY29tbW9uJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnY29uZGl0aW9uLXNjaGVtYS1tYW5hZ2VyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vY29uZGl0aW9uLXNjaGVtYS1tYW5hZ2VyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9jb25kaXRpb24tc2NoZW1hLW1hbmFnZXIuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb25kaXRpb25TY2hlbWFNYW5hZ2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICBASW5wdXQoKSBwdWJsaWMgcXVlcnlJZDogYW55O1xyXG4gIEBWaWV3Q2hpbGQoJ3NhdmluZ01hbmFnZXInKSBwcml2YXRlIHNhdmluZ01hbmFnZXJEaWdsb2c6IERpYWxvZ0NvbXBvbmVudDtcclxuICBwdWJsaWMgc2NoZW1hRGF0YTogYW55W107XHJcbiAgcHVibGljIGJpbmRpbmdTY2hlbWEgPSB7IC8vIOeUqOS6jue7keWumuS/neWtmOeVjOmdolxyXG4gICAgaXNEZWZhdWx0OiBmYWxzZSxcclxuICAgIHNjaGVtYU5hbWU6ICcnLFxyXG4gICAgc2NoZW1hVHlwZTogZmFsc2UsIC8vIDDlhazlhbHvvIwx5piv5Liq5Lq6XHJcbiAgICBzY2hlbWF2YWx1ZToge31cclxuICB9O1xyXG4gIHB1YmxpYyBjdXJyZW50U2NoZW1hTmFtZTogc3RyaW5nOyAvLyDlvZPliY3lupTnlKjmlrnmoYjnmoTlkI3np7BcclxuXHJcbiAgY29sdW1ucyA9IFtdO1xyXG4gIHRvdGFsID0gMDtcclxuICBlZGl0TW9kZSA9ICdyb3cnO1xyXG4gIHBhZ2VTaXplID0gMjAwO1xyXG4gIHBhZ2VJbmRleCA9IDE7XHJcbiAgc2NoZW1hVHlwZURhdGE6IGFueSA9IFtcclxuICAgIHsgbmFtZTogJ+WFrOWFsScsIHZhbHVlOiAwIH0sXHJcbiAgICB7IG5hbWU6ICfljZXkvY0nLCB2YWx1ZTogMiB9LFxyXG4gICAgeyBuYW1lOiAn5Liq5Lq6JywgdmFsdWU6IDEgfVxyXG4gIF07XHJcbiAgc2l6ZTogYW55ID0ge307XHJcbiAgQFZpZXdDaGlsZCgnZGcnKSBkZzogRGF0YWdyaWRDb21wb25lbnQ7XHJcbiAgbG9jYWxpemVTZXJ2aWNlOiBMb2NhbGl6ZVNlcnZpY2U7XHJcbiAgY29sRGVmYXVsdDogYW55ID0gJ2NvbERlZmF1bHQnICsgRXZlbnRCdXMuZ3VpZCgpO1xyXG4gIGNvbFB1YmxpYzogYW55ID0gJ2NvbFB1YmxpYycgKyBFdmVudEJ1cy5ndWlkKCk7XHJcbiAgc2NoZW1hU2VydmljZTogU2NoZW1hTWFuYWdlclNlcnZpY2U7XHJcbiAgb3BlcmF0aW9uczogYW55ID0ge307XHJcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zID0gW107XHJcbiAgbXNnU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgcmVwb3NpdG9yeTogUmVwb3NpdG9yeTxFbnRpdHk+LFxyXG4gICAgcHJpdmF0ZSBjb25kaXRpb25TY2hlbWFTZXJ2aWNlOiBDb25kaXRpb25TY2hlbWFTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmaW5pc2hMb2FzU2VydmljZTogRmluaXNoTG9hZFNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvclxyXG4gICkge1xyXG4gICAgaWYgKHRoaXMuaW5qZWN0b3IpIHtcclxuICAgICAgdGhpcy5sb2NhbGl6ZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGl6ZVNlcnZpY2UpO1xyXG4gICAgICB0aGlzLnNjaGVtYVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChTY2hlbWFNYW5hZ2VyU2VydmljZSk7XHJcbiAgICAgIHRoaXMubXNnU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KE1lc3NhZ2VyU2VydmljZSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIG5nT25Jbml0KCk6IHZvaWQge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBsZXQgZGVmYXVsdFNjaGVtYTtcclxuICAgIC8vIOS7juacjeWKoeerr+iOt+WPluW9k+WJjeeUqOaIt+eahOaJgOacieadoeS7tuaWueahiFxyXG4gICAgdGhpcy5jb25kaXRpb25TY2hlbWFTZXJ2aWNlLmdldFNjaGVtYUxpc3QodGhpcy5xdWVyeUlkLCAnJywgJycpLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgIHRoaXMuc2NoZW1hRGF0YSA9IHZhbHVlICYmIHZhbHVlLmxlbmd0aCA/IHZhbHVlIDogW107XHJcbiAgICAgIGRlZmF1bHRTY2hlbWEgPSB0aGlzLnNjaGVtYURhdGEuZmluZChzY2hlbWEgPT4ge1xyXG4gICAgICAgIHJldHVybiBzY2hlbWEuaXNEZWZhdWx0ID09PSAxO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5zY2hlbWFEYXRhLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgIGl0ZW0uaXNEZWZhdWx0ID0gaXRlbS5pc0RlZmF1bHQgPT09IDE7XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAoZGVmYXVsdFNjaGVtYSkgeyAvLyDpooTliLbpu5jorqTlr7nosaFcclxuICAgICAgICB0aGlzLmN1cnJlbnRTY2hlbWFOYW1lID0gZGVmYXVsdFNjaGVtYS5zY2hlbWFOYW1lO1xyXG4gICAgICAgIHRoaXMuZmluaXNoTG9hc1NlcnZpY2UuZmluaXNoLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgIGlmIChkZWZhdWx0U2NoZW1hICYmIGRlZmF1bHRTY2hlbWEuc2NoZW1hVmFsdWUgJiYgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKSAmJiB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBkZWZhdWx0U2NoZW1hLnNjaGVtYVZhbHVlLmlkID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKVswXVsnaWQnXTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKClbMF0ubG9hZChkZWZhdWx0U2NoZW1hLnNjaGVtYVZhbHVlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLmdyaWRJbml0KCk7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzZWxmLnNjaGVtYVNlcnZpY2Uub3BlcmF0aW9uQ2hhbmdlLnN1YnNjcmliZSgodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICBzZWxmLm9wZXJhdGlvbnMgPSB2YWx1ZTtcclxuICAgICAgfVxyXG4gICAgICAvLyBjb25zb2xlLmxvZyh2YWx1ZSk7XHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnMgJiYgdGhpcy5zdWJzY3JpcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHN1YnNjcmlwdGlvbiBvZiB0aGlzLnN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBncmlkSW5pdCgpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgY29uc3QgZW51bU9wdHMgPSB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ25hbWUnLCBkYXRhOiB0aGlzLnNjaGVtYVR5cGVEYXRhIH07XHJcbiAgICB0aGlzLmNvbHVtbnMgPSBbXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ3NjaGVtYU5hbWUnLCB3aWR0aDogMTAwLCB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLnNjaGVtZU5hbWUnKVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdzY2hlbWFUeXBlJywgd2lkdGg6IDEwMCwgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5zY2hlbWVUeXBlJyksIGZvcm1hdHRlcjogeyB0eXBlOiAnZW51bScsIG9wdGlvbnM6IGVudW1PcHRzIH0sXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ2lzRGVmYXVsdCcsIHdpZHRoOiAxMDAsIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIuZGVmYXVsdCcpLFxyXG4gICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ0hFQ0tCT1gsXHJcbiAgICAgICAgICBvcHRpb25zOiB7fSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGZvcm1hdHRlcjogeyB0eXBlOiAnYm9vbGVhbicsIG9wdGlvbnM6IHsgdHJ1ZVRleHQ6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5kZWZhdWx0JyksIGZhbHNlVGV4dDogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLm5vRGVmYXVsdCcpIH0gfVxyXG4gICAgICB9XHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgb25SZXNpemVkKGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgIHRoaXMuc2l6ZS5oZWlnaHQgPSBldmVudC5uZXdIZWlnaHQ7XHJcbiAgICB0aGlzLnNpemUud2lkdGggPSBldmVudC5uZXdXaWR0aDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuS/neWtmOagvOW8j+aWueahiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYW5kbGVTYXZlQ2xpY2soKSB7XHJcbiAgICBpZiAoIXRoaXMuaXNTY2hlbWFOYW1lVmFsaWQodGhpcy5iaW5kaW5nU2NoZW1hLnNjaGVtYU5hbWUpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGN1cnJlbnRTY2hlbWEgPSB7fTtcclxuICAgIGN1cnJlbnRTY2hlbWFbJ2lzRGVmYXVsdCddID0gdGhpcy5iaW5kaW5nU2NoZW1hLmlzRGVmYXVsdCA/IDEgOiAwO1xyXG4gICAgY3VycmVudFNjaGVtYVsncXVlcnlJZCddID0gdGhpcy5xdWVyeUlkO1xyXG4gICAgY3VycmVudFNjaGVtYVsnc2NoZW1hTmFtZSddID0gdGhpcy5iaW5kaW5nU2NoZW1hLnNjaGVtYU5hbWU7XHJcbiAgICBjdXJyZW50U2NoZW1hWydzY2hlbWFUeXBlJ10gPSB0aGlzLmJpbmRpbmdTY2hlbWEuc2NoZW1hVHlwZSA/IDAgOiAxO1xyXG4gICAgY29uc3Qgc2NoZW1hVmFsdWUgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi50b0FycmF5KClbMF0udG9KU09OKCk7XHJcbiAgICBkZWxldGUgc2NoZW1hVmFsdWVbJ2lkJ107IC8vIOWIoOmZpOadoeS7tuaWueahiOS4reeahGlk5a2X5q61KOWmguaenOaciSlcclxuICAgIGN1cnJlbnRTY2hlbWFbJ3NjaGVtYVZhbHVlJ10gPSBKU09OLnN0cmluZ2lmeShzY2hlbWFWYWx1ZSk7XHJcblxyXG4gICAgaWYgKHRoaXMub3BlcmF0aW9uc1snUWRwTW9kaWZ5UHVibGljU2NoZW1hJ10gPT09IGZhbHNlICYmIGN1cnJlbnRTY2hlbWFbJ3NjaGVtYVR5cGUnXSA9PT0gMCkge1xyXG4gICAgICB0aGlzLm1zZ1NlcnZpY2Uud2FybmluZyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5xZHBNb2RpZnlQdWJsaWNTY2hlbWEnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5zY2hlbWFEYXRhICYmIGN1cnJlbnRTY2hlbWFbJ2lzRGVmYXVsdCddKSB7IC8vIOWwhuW9k+WJjem7mOiupOadoeS7tuaWueahiOiuvuS4ujBcclxuICAgICAgY29uc3QgY3VycmVudERlZmF1bHRTY2hlbWEgPSB0aGlzLnNjaGVtYURhdGEuZmluZCh2YWx1ZSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlLmlzRGVmYXVsdCA9PT0gMTtcclxuICAgICAgfSk7XHJcbiAgICAgIGlmIChjdXJyZW50RGVmYXVsdFNjaGVtYSkge1xyXG4gICAgICAgIGN1cnJlbnREZWZhdWx0U2NoZW1hLmlzRGVmYXVsdCA9IDA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuc2NoZW1hRGF0YS5wdXNoKGN1cnJlbnRTY2hlbWEpO1xyXG4gICAgLy8g5pWw5o2u5bqT5paw5aKe5LiA5p2h5pWw5o2u77yM5bm26L+U5Zue5omA5pyJ5qC85byP5pa55qGIXHJcbiAgICB0aGlzLmNvbmRpdGlvblNjaGVtYVNlcnZpY2Uuc2F2ZVNjaGVtYShjdXJyZW50U2NoZW1hKS5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLnNjaGVtYURhdGEgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uuc3VjY2Vzcyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS5zYXZlLnN1Y2Nlc3MnKSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlLmVycm9yKHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5tZXNzYWdlLnNhdmUuZXJyb3InKSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5zYXZpbmdNYW5hZ2VyRGlnbG9nLmNsb3NlKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDlpITnkIbmlrnmoYjnrqHnkIbpobXpnaLngrnlh7vkuovku7bvvIzmm7TmlLnpu5jorqTmlrnmoYhcclxuICAgKi9cclxuICBwdWJsaWMgaGFuZGxlRGVmYXVsdChkYXRhSXRlbTogYW55KSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGlmIChkYXRhSXRlbS5pc0RlZmF1bHQgPT09IHRydWUpIHtcclxuICAgICAgY29uc3QgY3VycmVudERlZmF1bHRTY2hlbWEgPSBzZWxmLnNjaGVtYURhdGEuZmluZCh2YWx1ZSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlLmlzRGVmYXVsdCA9PT0gdHJ1ZSAmJiB2YWx1ZS5pZCAhPT0gZGF0YUl0ZW0uaWQ7XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAoY3VycmVudERlZmF1bHRTY2hlbWEpIHtcclxuICAgICAgICBjdXJyZW50RGVmYXVsdFNjaGVtYS5pc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICAvLyB0aGlzLnNjaGVtYURhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuc2NoZW1hRGF0YSkpO1xyXG4gICAgICAvLyB0aGlzLmRnLnJlZnJlc2goKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHNjaGVtYSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoc2VsZi5zY2hlbWFEYXRhLmZpbmQodmFsdWUgPT4gdmFsdWUuaWQgPT09IGRhdGFJdGVtLmlkKSkpO1xyXG4gICAgaWYgKHRoaXMub3BlcmF0aW9uc1snUWRwTW9kaWZ5UHVibGljU2NoZW1hJ10gPT09IGZhbHNlICYmIHNjaGVtYS5zY2hlbWFUeXBlID09PSAwKSB7XHJcbiAgICAgIHRoaXMubXNnU2VydmljZS53YXJuaW5nKHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuc2NoZW1hTWFuYWdlci5tZXNzYWdlLnZhbGlkYXRlLnFkcE1vZGlmeVB1YmxpY1NjaGVtYScpKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgc2NoZW1hLmlzRGVmYXVsdCA9IHNjaGVtYS5pc0RlZmF1bHQgPT09IGZhbHNlID8gMCA6IDE7XHJcbiAgICBzY2hlbWEuc2NoZW1hVmFsdWUgPSBKU09OLnN0cmluZ2lmeShzY2hlbWEuc2NoZW1hVmFsdWUpO1xyXG5cclxuICAgIHNlbGYuY29uZGl0aW9uU2NoZW1hU2VydmljZS5zYXZlU2NoZW1hKHNjaGVtYSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgc2VsZi5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3Moc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLm1lc3NhZ2UudXBkYXRlLnN1Y2Nlc3MnKSk7XHJcbiAgICAgICAgc2VsZi5jb25kaXRpb25TY2hlbWFTZXJ2aWNlLmdldFNjaGVtYUxpc3Qoc2VsZi5xdWVyeUlkLCAnJywgJycpLnN1YnNjcmliZShzY2hlbWFMaXN0ID0+IHtcclxuICAgICAgICAgIHNlbGYuc2NoZW1hRGF0YSA9IHNjaGVtYUxpc3QgJiYgc2NoZW1hTGlzdC5sZW5ndGggPyBzY2hlbWFMaXN0IDogW107XHJcbiAgICAgICAgICBjb25zdCBkZWZhdWx0U2NoZW1hID0gc2VsZi5zY2hlbWFEYXRhLmZpbmQoc2NoZW1hID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHNjaGVtYS5pc0RlZmF1bHQgPT09IDE7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHNlbGYuc2NoZW1hRGF0YS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaXRlbS5pc0RlZmF1bHQgPSBpdGVtLmlzRGVmYXVsdCA9PT0gMTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgaWYgKGRlZmF1bHRTY2hlbWEpIHsgLy8g6aKE5Yi26buY6K6k5a+56LGhXHJcbiAgICAgICAgICAgIHNlbGYuY3VycmVudFNjaGVtYU5hbWUgPSBkZWZhdWx0U2NoZW1hLnNjaGVtYU5hbWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc2VsZi5ub3RpZnlTZXJ2aWNlLmVycm9yKHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5tZXNzYWdlLnVwZGF0ZS5lcnJvcicpKTtcclxuICAgICAgfVxyXG4gICAgfSk7IC8vIOWwhnNjaGVtYXZhbHVl6L2s5oiQc3RyaW5n57G75Z6LXHJcbiAgfVxyXG5cclxuICBzYXZlRGVmYXVsdFNjaGVtYUhhbmRsZXIoKSB7XHJcbiAgICB0aGlzLmRnLmVuZFJvd0VkaXQoKTtcclxuICB9XHJcblxyXG4gIGVuZEVkaXQoZGF0YTogYW55KSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgIHRoaXMuaGFuZGxlRGVmYXVsdChkYXRhLnJvd0RhdGEgfHwgdW5kZWZpbmVkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWkhOeQhuS4u+mhtemAieS4reafkOS4quadoeS7tuaWueahiOS6i+S7tlxyXG4gICAqIEBwYXJhbSBpdGVtIOadoeS7tuaWueahiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBoYW5kbGVEcm9wRG93bkl0ZW1DbGljayhpdGVtOiBhbnkpIHtcclxuICAgIHRoaXMuY3VycmVudFNjaGVtYU5hbWUgPSBpdGVtLnNjaGVtYU5hbWU7XHJcbiAgICB0aGlzLmJpbmRpbmdTY2hlbWEuc2NoZW1hTmFtZSA9IGl0ZW0uc2NoZW1hTmFtZTtcclxuICAgIGlmIChpdGVtICYmIGl0ZW0uc2NoZW1hVmFsdWUgJiYgdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKSAmJiB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpLmxlbmd0aCkge1xyXG4gICAgICBpdGVtLnNjaGVtYVZhbHVlLmlkID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKVswXVsnaWQnXTtcclxuICAgIH1cclxuICAgIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKClbMF0ubG9hZChpdGVtLnNjaGVtYVZhbHVlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOino+WGs+aWueahiFxyXG4gICAqL1xyXG4gIHB1YmxpYyBkZWxldGVTY2hlbWVySGFuZGxlcigpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKHNlbGYuZGcuc2VsZWN0ZWRSb3cpIHtcclxuICAgICAgY29uc3QgaW5kZXggPSBzZWxmLnNjaGVtYURhdGEuZmluZEluZGV4KChuOiBhbnkpID0+IG4uaWQgPT09IHNlbGYuZGcuc2VsZWN0ZWRSb3cuaWQpO1xyXG4gICAgICBzZWxmLmRnLnJlZnJlc2goKTtcclxuICAgICAgaWYgKHRoaXMub3BlcmF0aW9uc1snUWRwTW9kaWZ5UHVibGljU2NoZW1hJ10gPT09IGZhbHNlICYmIHNlbGYuc2NoZW1hRGF0YVtpbmRleF0uc2NoZW1hVHlwZSA9PT0gMCkge1xyXG4gICAgICAgIHRoaXMubXNnU2VydmljZS53YXJuaW5nKHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuc2NoZW1hTWFuYWdlci5tZXNzYWdlLnZhbGlkYXRlLnFkcE1vZGlmeVB1YmxpY1NjaGVtYScpKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHNlbGYuc2NoZW1hRGF0YVtpbmRleF0uaXNEZWZhdWx0ID09PSAxKSB7IC8vIOWIpOaWreaYr+WQpuS4uum7mOiupOaWueahiFxyXG4gICAgICAgIHNlbGYubm90aWZ5U2VydmljZS53YXJuaW5nKHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5tZXNzYWdlLnZhbGlkYXRlLmRlbGV0ZScpKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY29uc3Qgc2NoZW1hSWQgPSBzZWxmLnNjaGVtYURhdGFbaW5kZXhdLmlkO1xyXG4gICAgICBzZWxmLnNjaGVtYURhdGEuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgLy8gVE9ETyDosIPnlKjmnI3liqHnq6/mjqXlj6NcclxuICAgICAgc2VsZi5jb25kaXRpb25TY2hlbWFTZXJ2aWNlLmRlbGV0ZVNjaGVtYShzY2hlbWFJZCwgc2VsZi5xdWVyeUlkKS5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgc2VsZi5ub3RpZnlTZXJ2aWNlLnN1Y2Nlc3Moc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5jb25kaXRpb25TY2hlbWFNYW5hZ2VyLm1lc3NhZ2UuZGVsZXRlLnN1Y2Nlc3MnKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHNlbGYubm90aWZ5U2VydmljZS5lcnJvcihzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS5kZWxldGUuZXJyb3InKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubm90aWZ5U2VydmljZS5pbmZvKHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5tZXNzYWdlLnZhbGlkYXRlLnNlbGVjdCcpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICAvKipcclxuICAgKiDliKTmlq3mnaHku7bmlrnmoYjlkI3np7DmmK/lkKbph43lpI1cclxuICAgKiBAcGFyYW0gc2NoZW1hTmFtZSDmnaHku7bmlrnmoYjlkI3np7BcclxuICAgKi9cclxuICBwcml2YXRlIGlzU2NoZW1hTmFtZVZhbGlkKHNjaGVtYU5hbWU6IGFueSkge1xyXG4gICAgaWYgKChzY2hlbWFOYW1lLmxlbmd0aCkgPj0gMTAwKSB7XHJcbiAgICAgIHRoaXMubm90aWZ5U2VydmljZS53YXJuaW5nKHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuY29uZGl0aW9uU2NoZW1hTWFuYWdlci5tZXNzYWdlLnZhbGlkYXRlLmxvbmdMaW1pdCcpKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVwZWF0U2NoZW1hID0gdGhpcy5zY2hlbWFEYXRhLmZpbmQodmFsdWUgPT4ge1xyXG4gICAgICByZXR1cm4gdmFsdWUuc2NoZW1hTmFtZSA9PT0gc2NoZW1hTmFtZTtcclxuICAgIH0pO1xyXG4gICAgaWYgKHJlcGVhdFNjaGVtYSkge1xyXG4gICAgICB0aGlzLm5vdGlmeVNlcnZpY2Uud2FybmluZyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLmNvbmRpdGlvblNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5yZXBlYXROYW1lJykpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn1cclxuIl19
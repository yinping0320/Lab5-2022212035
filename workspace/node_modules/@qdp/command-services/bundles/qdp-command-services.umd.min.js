!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/devkit"),require("@ecp-caf/caf-common"),require("@angular/router"),require("@gsp-sys/rtf-common"),require("@qdp/common"),require("@angular/core"),require("@qdp/condition-schema")):"function"==typeof define&&define.amd?define("@qdp/command-services",["exports","@farris/devkit","@ecp-caf/caf-common","@angular/router","@gsp-sys/rtf-common","@qdp/common","@angular/core","@qdp/condition-schema"],t):t((e.qdp=e.qdp||{},e.qdp["command-services"]={}),e.devkit,e.cafCommon,e.ng.router,e.rtfCommon,e.common,e.ng.core,e.conditionSchema)}(this,function(e,t,r,n,a,f,i,u){"use strict";var o=function(){function e(e,t,r,n,a){this.repository=e,this.cacheService=t,this.router=r,this.frameworkService=n,this.filterManagerService=a,window.excuteQDPQuery=this.filterManagerService.isFilterQDP}return e.prototype.route=function(e,t){var r,n=this.repository.entityCollection.getAllEntities();if(n&&n.length){r=n[0].toJSON(),this.cacheService.set(f.RtfServices.getTabId(e),r);var a="qdpview";t&&(a=t),this.router.navigateByUrl(a)}},e.prototype.routeEx=function(e,t,r,n,a){var i,u=this.repository.entityCollection.getAllEntities();if(u&&u.length){var o=f.EventBus.guid();i=u[0].toJSON();var l={appType:t,appId:r,appEntrance:n,funcId:a,tabId:o},c=f.RtfServices.getFuncId(l);this.cacheService.set(c+"renderMode","queryIndex"),this.cacheService.set(c,i);var s=Object.assign({},f.RtfServices.getMenuSwitchControlParameter(c));l.entityParams=s,this.frameworkService.openMenu(l)}},e.prototype.queryRefresh=function(){this.filterManagerService.isFilterQDP.next(!0)},e.prototype.filterQDP=function(e,t){var c=this,s=this;t=this.context.eventParam;var d={id:"undefined_null"};t&&t.forEach(function(e){var t=e.fieldCode,r=e.value;if(r&&(r.dateValue||r.value||r.numValue||r.yearValue||r.startTime||r.endTime||r.startValue||r.endValue||r.monthValue||r.datetimeValue)){switch(e.control.getControlType()){case 0:case 14:case 15:"string"==typeof r.value&&(r=r.value);break;case 1:r=r.dateValue;break;case 2:if(r&&r.value&&r.value.length){var n=[];r.value.forEach(function(e){r.isInputText?n.push(e):n.push(s.getValue(r.valueField,e))}),r=n.join(",")}else r=null;break;case 3:if(r&&r.value&&r.value.length){var a=[];r.value.forEach(function(e){a.push(e.value)}),r=a.join(",")}else r=null;break;case 4:case 11:r={beginValue:r.startTime?r.startTime:null,endValue:r.endTime?r.endTime:null};break;case 5:r={beginValue:r.startValue?r.startValue:null,endValue:r.endValue?r.endValue:null};break;case 6:r=r.numValue;break;case 7:r=r.yearValue;break;case 8:r=r.value&&r.value.length?r.value[0]:null;break;case 9:r={beginValue:r.startTime?r.startTime:null,endValue:r.endTime?r.endTime:null};break;case 10:r=r.monthValue;break;case 12:r=r.datetimeValue}var i=d;if(t&&0<=t.indexOf(";")){var u=t.split(";")[0].split("."),o=t.split(";")[1].split(".");null!=r.beginValue&&r.beginValue!==undefined&&c.setEntityData(u,i,r.beginValue),null!=r.endValue&&r.endValue!==undefined&&c.setEntityData(o,i,r.endValue)}else{var l=t.split(".");null!=r&&r!==undefined&&c.setEntityData(l,i,r)}}}),this.cacheService.set(f.RtfServices.getTabId(e),d),this.filterManagerService.isFilterQDP.next(!0)},e.prototype.setEntityData=function(e,t,r){if(e.length&&1<e.length)for(var n=0;n<e.length;n++)t=0===n?this.getEntityData(e[n],t):this.getEntityData(e[n],t[e[n-1]]),n+1===e.length&&(t[e[n]]=r);else t[e[0]]=r},e.prototype.getEntityData=function(e,t){return t.hasOwnProperty(e)||(t[e]={}),t},e.prototype.getValue=function(e,t,r){if(void 0===r&&(r=!1),!t)return"";var n="";return n=-1===e.indexOf(".")?t[e]:e.split(".").reduce(function(e,t){return e?e[t]:null},t),r?this.formatterValue(n):n},e.prototype.formatterValue=function(e){return null===e||e===undefined||""===e?"":"string"==typeof e?this.escapeHtml(e):e},e.prototype.escapeHtml=function(e){return null===e||e===undefined?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;")},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:t.Repository},{type:r.CacheService},{type:n.Router},{type:a.FrameworkService},{type:f.FilterManagerService}]},e}(),l=function(){function e(e){this.finishLoadService=e}return e.prototype.SendEvent=function(){this.finishLoadService.finish.next("finished")},e.decorators=[{type:i.Injectable}],e.ctorParameters=function(){return[{type:u.FinishLoadService}]},e}(),c=[o,l];e.QueryIndexService=o,e.FinishEventService=l,e.QDP_COMMAND_SERVICE_PROVIDERS=c,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=qdp-command-services.umd.min.js.map
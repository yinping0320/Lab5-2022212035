/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { RtfServices } from "@qdp/common";
import { of } from "rxjs";
import { switchMap } from "rxjs/operators";
export class SchemaUtils {
    /**
     * @param {?} _serviceCache
     */
    constructor(_serviceCache) {
        this.init(_serviceCache);
    }
    /**
     * @private
     * @param {?} _serviceCache
     * @return {?}
     */
    init(_serviceCache) {
        this.schemaManager = _serviceCache.schemaManagerService;
        this.cacheService = _serviceCache.cacheService;
    }
    /**
     * 获取格式方案信息
     * @param {?} option 参数配置项
     * { schemaId: 方案ID, schemaValue: 格式方案（交叉表時快速設置時使用）, controlType: 查询类型：list  treelist  crosstab, queryId: 查询ID, queryRelativeUrl：eapi基础uri, groupType: 方案分组标识 }
     * @return {?} 方案列表
     */
    getSchemaInfo(option) {
        /** @type {?} */
        const self = this;
        option.schemaId = option.schemaId === 'prefab' || option.schemaId === '1'
            ? '1'
            : option.schemaValue && option.schemaValue.id && option.controlType === 'crosstab'
                ? option.schemaValue.id
                : option.schemaId;
        if (!option.schemaId) {
            return self.getDefaultSchemaInfo(option);
        }
        else {
            /** @type {?} */
            const organizationId = this.cacheService.get(RtfServices.getTabId(option.queryId) + 'organizationId') || '';
            /** @type {?} */
            const result$ = this.schemaManager.getSchema(option.schemaId, option.queryId, option.queryRelativeUrl, option.groupType, organizationId, option.fromCache);
            return result$.pipe(switchMap((/**
             * @param {?} schemaValue
             * @return {?}
             */
            (schemaValue) => {
                if (schemaValue && schemaValue['id']) {
                    return of(schemaValue);
                }
            })));
        }
    }
    /**
     * 获取默认格式方案
     * @param {?} option 参数配置项
     * { queryId：查询ID, queryRelativeUrl：eapi基础uri, groupType: 方案分组标识 }
     * @return {?} 默认格式方案
     */
    getDefaultSchemaInfo(option) {
        /** @type {?} */
        const organizationId = this.cacheService.get(RtfServices.getTabId(option.queryId) + 'organizationId') || '';
        return this.schemaManager.getDefaultSchema(option.queryId, option.queryRelativeUrl, option.groupType, organizationId);
    }
}
if (false) {
    /** @type {?} */
    SchemaUtils.prototype.schemaManager;
    /** @type {?} */
    SchemaUtils.prototype.cacheService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZW1hLnV0aWxzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHFkcC9zcHJlYWQvIiwic291cmNlcyI6WyJsaWIvdXRpbC9zY2hlbWEudXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQXdCLE1BQU0sYUFBYSxDQUFDO0FBQ2hFLE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE1BQU0sT0FBTyxXQUFXOzs7O0lBSXBCLFlBQVksYUFBa0I7UUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUM3QixDQUFDOzs7Ozs7SUFFTyxJQUFJLENBQUMsYUFBa0I7UUFDM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUMsb0JBQW9CLENBQUM7UUFDeEQsSUFBSSxDQUFDLFlBQVksR0FBRyxhQUFhLENBQUMsWUFBWSxDQUFDO0lBQ25ELENBQUM7Ozs7Ozs7SUFPRCxhQUFhLENBQUMsTUFBVzs7Y0FDZixJQUFJLEdBQUcsSUFBSTtRQUNqQixNQUFNLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEtBQUssR0FBRztZQUNyRSxDQUFDLENBQUMsR0FBRztZQUNMLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxJQUFJLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxJQUFJLE1BQU0sQ0FBQyxXQUFXLEtBQUssVUFBVTtnQkFDOUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDdkIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDMUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDbEIsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDNUM7YUFBTTs7a0JBQ0csY0FBYyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLGdCQUFnQixDQUFDLElBQUksRUFBRTs7a0JBQ3JHLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixFQUFFLE1BQU0sQ0FBQyxTQUFTLEVBQUUsY0FBYyxFQUFFLE1BQU0sQ0FBQyxTQUFTLENBQUM7WUFDMUosT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNmLFNBQVM7Ozs7WUFBQyxDQUFDLFdBQWdCLEVBQUUsRUFBRTtnQkFDM0IsSUFBSSxXQUFXLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUNsQyxPQUFPLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztpQkFDMUI7WUFDTCxDQUFDLEVBQUMsQ0FDTCxDQUFDO1NBQ0w7SUFDTCxDQUFDOzs7Ozs7O0lBUUQsb0JBQW9CLENBQUMsTUFBVzs7Y0FDdEIsY0FBYyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLGdCQUFnQixDQUFDLElBQUksRUFBRTtRQUMzRyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLFNBQVMsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUMxSCxDQUFDO0NBQ0o7OztJQWpERyxvQ0FBb0M7O0lBQ3BDLG1DQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJ0ZlNlcnZpY2VzLCBTY2hlbWFNYW5hZ2VyU2VydmljZSB9IGZyb20gXCJAcWRwL2NvbW1vblwiO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gXCJyeGpzXCI7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gXCJyeGpzL29wZXJhdG9yc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNjaGVtYVV0aWxzIHtcclxuICAgIHNjaGVtYU1hbmFnZXI6IFNjaGVtYU1hbmFnZXJTZXJ2aWNlO1xyXG4gICAgY2FjaGVTZXJ2aWNlOiBhbnk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoX3NlcnZpY2VDYWNoZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5pbml0KF9zZXJ2aWNlQ2FjaGUpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwcml2YXRlIGluaXQoX3NlcnZpY2VDYWNoZTogYW55KSB7XHJcbiAgICAgICAgdGhpcy5zY2hlbWFNYW5hZ2VyID0gX3NlcnZpY2VDYWNoZS5zY2hlbWFNYW5hZ2VyU2VydmljZTtcclxuICAgICAgICB0aGlzLmNhY2hlU2VydmljZSA9IF9zZXJ2aWNlQ2FjaGUuY2FjaGVTZXJ2aWNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiDojrflj5bmoLzlvI/mlrnmoYjkv6Hmga9cclxuICAgICAqIEBwYXJhbSBvcHRpb24g5Y+C5pWw6YWN572u6aG5IFxyXG4gICAgICogeyBzY2hlbWFJZDog5pa55qGISUQsIHNjaGVtYVZhbHVlOiDmoLzlvI/mlrnmoYjvvIjkuqTlj4nooajmmYLlv6vpgJ/oqK3nva7mmYLkvb/nlKjvvIksIGNvbnRyb2xUeXBlOiDmn6Xor6LnsbvlnovvvJpsaXN0ICB0cmVlbGlzdCAgY3Jvc3N0YWIsIHF1ZXJ5SWQ6IOafpeivoklELCBxdWVyeVJlbGF0aXZlVXJs77yaZWFwaeWfuuehgHVyaSwgZ3JvdXBUeXBlOiDmlrnmoYjliIbnu4TmoIfor4YgfVxyXG4gICAgICogQHJldHVybnMg5pa55qGI5YiX6KGoXHJcbiAgICAgKi9cclxuICAgIGdldFNjaGVtYUluZm8ob3B0aW9uOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIG9wdGlvbi5zY2hlbWFJZCA9IG9wdGlvbi5zY2hlbWFJZCA9PT0gJ3ByZWZhYicgfHwgb3B0aW9uLnNjaGVtYUlkID09PSAnMSdcclxuICAgICAgICAgICAgPyAnMSdcclxuICAgICAgICAgICAgOiBvcHRpb24uc2NoZW1hVmFsdWUgJiYgb3B0aW9uLnNjaGVtYVZhbHVlLmlkICYmIG9wdGlvbi5jb250cm9sVHlwZSA9PT0gJ2Nyb3NzdGFiJ1xyXG4gICAgICAgICAgICAgICAgPyBvcHRpb24uc2NoZW1hVmFsdWUuaWRcclxuICAgICAgICAgICAgICAgIDogb3B0aW9uLnNjaGVtYUlkO1xyXG4gICAgICAgIGlmICghb3B0aW9uLnNjaGVtYUlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldERlZmF1bHRTY2hlbWFJbmZvKG9wdGlvbik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPSB0aGlzLmNhY2hlU2VydmljZS5nZXQoUnRmU2VydmljZXMuZ2V0VGFiSWQob3B0aW9uLnF1ZXJ5SWQpICsgJ29yZ2FuaXphdGlvbklkJykgfHwgJyc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnNjaGVtYU1hbmFnZXIuZ2V0U2NoZW1hKG9wdGlvbi5zY2hlbWFJZCwgb3B0aW9uLnF1ZXJ5SWQsIG9wdGlvbi5xdWVyeVJlbGF0aXZlVXJsLCBvcHRpb24uZ3JvdXBUeXBlLCBvcmdhbml6YXRpb25JZCwgb3B0aW9uLmZyb21DYWNoZSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKHNjaGVtYVZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZW1hVmFsdWUgJiYgc2NoZW1hVmFsdWVbJ2lkJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9mKHNjaGVtYVZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlum7mOiupOagvOW8j+aWueahiFxyXG4gICAgICogQHBhcmFtIG9wdGlvbiDlj4LmlbDphY3nva7pobkgXHJcbiAgICAgKiB7IHF1ZXJ5SWTvvJrmn6Xor6JJRCwgcXVlcnlSZWxhdGl2ZVVybO+8mmVhcGnln7rnoYB1cmksIGdyb3VwVHlwZTog5pa55qGI5YiG57uE5qCH6K+GIH1cclxuICAgICAqIEByZXR1cm5zIOm7mOiupOagvOW8j+aWueahiFxyXG4gICAgICovXHJcbiAgICBnZXREZWZhdWx0U2NoZW1hSW5mbyhvcHRpb246IGFueSkge1xyXG4gICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gdGhpcy5jYWNoZVNlcnZpY2UuZ2V0KFJ0ZlNlcnZpY2VzLmdldFRhYklkKG9wdGlvbi5xdWVyeUlkKSArICdvcmdhbml6YXRpb25JZCcpIHx8ICcnO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNjaGVtYU1hbmFnZXIuZ2V0RGVmYXVsdFNjaGVtYShvcHRpb24ucXVlcnlJZCwgb3B0aW9uLnF1ZXJ5UmVsYXRpdmVVcmwsIG9wdGlvbi5ncm91cFR5cGUsIG9yZ2FuaXphdGlvbklkKTtcclxuICAgIH1cclxufSJdfQ==
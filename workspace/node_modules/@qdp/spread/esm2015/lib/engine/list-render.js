/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventBus, RtfServices } from "@qdp/common";
import { BaseRender } from "./base-render";
export class ListTreeRender extends BaseRender {
    /**
     * @param {?} _queryId
     * @param {?} _controlType
     * @param {?=} _jointsearchInfoList
     * @param {?=} _funcInfoCache
     * @param {?=} _serviceCache
     */
    constructor(_queryId, _controlType, _jointsearchInfoList, _funcInfoCache, _serviceCache) {
        super(_queryId, _controlType, _jointsearchInfoList, _funcInfoCache, _serviceCache);
        this.listRenderInit(_queryId, _controlType);
    }
    /**
     * @param {?} _queryId
     * @param {?} _controlType
     * @return {?}
     */
    listRenderInit(_queryId, _controlType) {
        this.type = _controlType;
        this.queryId = _queryId;
    }
    /**
     * 渲染
     * @param {?} obj 参数配置项
     * @return {?}
     */
    render(obj) {
        /** @type {?} */
        const self = this;
        this.queryId = obj.queryId;
        this.type = obj.controlType;
        obj.schemaId = obj.schemaId === 'prefab' ? '1' : obj.schemaId;
        this.utils.get('schema').getSchemaInfo(obj).subscribe((/**
         * @param {?} schemaValue
         * @return {?}
         */
        (schemaValue) => {
            if (schemaValue) {
                obj['schemaId'] = schemaValue.id;
                obj['schemaValue'] = schemaValue;
                // this.currentSchemaValueChanger.next(schemaValue);
                EventBus.dispatch('schemaValueChanged', schemaValue);
                /** @type {?} */
                let delay = schemaValue.schemaValue.otherOption.delay;
                /** @type {?} */
                const interval = schemaValue.schemaValue.otherOption.interval;
                /** @type {?} */
                const funcId = RtfServices.getTabId(obj.queryId);
                /** @type {?} */
                const index = self.funcInfoCache.firstLoadCache.findIndex((/**
                 * @param {?} el
                 * @return {?}
                 */
                el => el === funcId));
                /** @type {?} */
                const firstLoad = schemaValue.schemaValue.otherOption.firstLoad;
                if (index < 0 && this.isSchemaSelectChanged === false) {
                    if (firstLoad === false) {
                        self.funcInfoCache.firstLoadCache.push(funcId);
                        obj.loading.close();
                        if (obj.spread.getActiveSheet()) {
                            obj.spread.getActiveSheet().deleteRows(0, obj.spread.getActiveSheet().getRowCount());
                            obj.spread.getActiveSheet().options.colHeaderVisible = false;
                            obj.spread.invalidateLayout();
                            obj.spread.repaint();
                            self.serviceCache.lcpService.pageInfoChange.next({
                                pageCount: 1,
                                pageIndex: 1,
                                pageSize: schemaValue.schemaValue.otherOption.pageSize || 20,
                                totalCount: 1
                            });
                        }
                        return;
                    }
                }
                if (!delay) {
                    delay = 0;
                }
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.getRenderDataForList.call(this, Object.assign({}, obj));
                    if (interval > 0) {
                        setInterval((/**
                         * @return {?}
                         */
                        () => {
                            this.getRenderDataForList.call(this, Object.assign({}, obj));
                        }), interval * 1000);
                    }
                }), delay * 1000);
            }
            else {
                obj['schemaId'] = '1';
                this.getRenderDataForList.call(this, Object.assign({}, obj));
            }
        }));
    }
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    getRenderDataForList(obj) {
        /** @type {?} */
        const self = this;
        obj.schemaId = obj.schemaId ? obj.schemaId : (obj.schemaValue && obj.schemaValue.id ? obj.schemaValue.id : '1');
        if (!obj.formData) {
            /** @type {?} */
            let params = this.utils.get('parameter').createParameters(Object.assign({}, obj, { pageIndex: 0, pageSize: 0 }));
            params['queryId'] = obj.queryId ? obj.queryId : '';
            self.operatePagination(obj, params);
            // 查询数据前事件
            params = this.utils.get('renderExtends').runRenderExtends('beforeQueryData', this.localizeService.getValue('spread.message.extend.query.before'), params, obj.spread);
            try {
                /** @type {?} */
                const tab = RtfServices.getTabId(obj.queryId);
                this.cache.set(tab, JSON.parse(params['entityData']));
                this.cache.set(tab + 'extendCond', params['extendCond']);
            }
            catch (e) { }
            self.getData(params, obj.queryRelativeUrl).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                data = data || { data: [], dynamicCols: [] };
                if (obj.schemaId !== '1' || (data && data.dynamicCols && data.dynamicCols.length)) {
                    self.schemaManager.dynamicCols[obj.groupType ? obj.groupType : obj.queryId] = data.dynamicCols || [];
                    self.schemaManager.dynamicCols[obj.schemaId] = data.dynamicCols || [];
                    self.schemaManager.operateDynamicColsForSchema(obj.schemaValue, obj.groupType ? obj.groupType : obj.queryId, obj.schemaId);
                    self.schemaManager.schemaInfoChange.next({ schemaList: self.schemaManager.schemaInfo, isDefaultSchema: self.schemaManager.isDefaultSchema && self.schemaManager.isDefaultSchema[obj.queryId] ? self.schemaManager.isDefaultSchema[obj.queryId] : null, preSchema: self.schemaManager.preSchema });
                }
                if (!obj.schemaValue || obj.schemaId == '1') {
                    self.operateCustomFormatSchema(data, obj);
                }
                // 数据加载前事件
                this.utils.get('renderExtends').runRenderExtends('beforeLoadData', self.localizeService.getValue('spread.message.extend.dataLoading.before'), data, obj.spread);
                self.lcpService.getCol(params, obj.queryRelativeUrl).subscribe((/**
                 * @param {?} resultData
                 * @return {?}
                 */
                resultData => {
                    if (obj.schemaId === '1') {
                        if (!data.dynamicCols.length) {
                            data.dynamicCols = resultData.dynamicCols || [];
                        }
                    }
                    obj.frozenCols = (resultData && resultData.dynamicCols) || [];
                    obj['data'] = data;
                    self.getListRenderTemplate(obj);
                    // { schemaId: _schemaId, queryId, data, queryRelativeUrl, spread, schemaValue, pageIndex, controlType, loading }
                }));
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                self.formErrorService.exception(error.Message, error);
                obj.loading.close();
            }));
            this.cache.set('schema_schemaid' + obj.queryId, obj.schemaId);
            // EventBus.dispatch('schema_schemaid', _schemaId);
        }
        else {
            obj['data'] = obj.formData;
            obj['frozenCols'] = obj.formData.dynamicCols;
            self.getListRenderTemplate(obj);
            // { schemaId: _schemaId, queryId, formData, queryRelativeUrl, spread, schemaValue, pageIndex, controlType, loading }
        }
    }
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    getListRenderTemplate(obj) {
        /** @type {?} */
        const self = this;
        self.schemaManager.getSpreadTemplate(obj.schemaId, obj.queryId, obj.data && obj.data.dynamicCols ? obj.data.dynamicCols : [], obj.queryRelativeUrl, obj.customFormatScheme, obj.frozenCols, obj.groupType).subscribe((/**
         * @param {?} template
         * @return {?}
         */
        template => {
            template = template.returnValue ? JSON.parse(template.returnValue) : template;
            self.renderList.call(self, Object.assign({}, obj, { template }));
            self.utils.get('spreadStyle').bindSelectChanged(obj.spread, obj.queryId);
            /** @type {?} */
            const event = RtfServices.getMenuSwitchControlEvent();
            if (event && typeof event === 'object') {
                event.next('ok');
            }
            EventBus.dispatch(self.queryId + 'spread_init', {});
            obj.loading.close();
        }), (/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            self.formErrorService.exception(error.Message, error);
            obj.loading.close();
        }));
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    renderList(obj) {
        /** @type {?} */
        const self = this;
        this.type = obj.controlType;
        obj.spread.suspendEvent();
        obj.spread.suspendPaint();
        obj.spread.fromJSON(obj.template);
        /** @type {?} */
        const sheet = obj.spread.getActiveSheet();
        // 储粮需求，多sheet页
        if (obj.curSheet && obj.multiSheets.length) {
            sheet.name(obj.curSheet);
            for (let i = 0; i < obj.multiSheets.length; i++) {
                if (obj.curSheet !== obj.multiSheets[i]) {
                    obj.spread.addSheet(i, new GC.Spread.Sheets.Worksheet(obj.multiSheets[i]));
                    obj.spread.sheets[i].deleteRows(0, obj.spread.sheets[i].getRowCount());
                    obj.spread.sheets[i].deleteColumns(0, obj.spread.sheets[i].getColumnCount());
                }
            }
            obj.spread.setActiveSheet(obj.curSheet);
            obj.spread.options.tabStripVisible = true;
            obj.spread.options.tabEditable = false;
        }
        // 储粮需求，多sheet页
        this.utils.get('spreadStyle').cacheStyle(sheet);
        /** @type {?} */
        let showZero = true;
        if (obj.schemaValue && obj.schemaValue.schemaValue && obj.schemaValue.schemaValue.otherOption) {
            if (obj.schemaValue.schemaValue.otherOption.showZero != null && obj.schemaValue.schemaValue.otherOption.showZero !== undefined) {
                showZero = obj.schemaValue.schemaValue.otherOption.showZero;
            }
        }
        if (obj.data && obj.data.data && obj.data.data.length) {
            obj.data.data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            (item) => {
                if (item.dynamicPropSet) {
                    for (const key in item.dynamicPropSet) {
                        item[key] = item.dynamicPropSet[key];
                    }
                }
            }));
            // 修改枚举字段显示
            self.changeData(obj.data, obj.schemaValue);
            sheet.setDataSource(obj.data.data);
            sheet.bindColumns(this.utils.get('spreadStyle').dataColInfoArray);
            sheet.options.isProtected = true;
            sheet.options.protectionOptions = {
                allowSelectLockedCells: true,
                allowSelectUnlockedCells: true,
                allowFilter: true,
                allowSort: true,
                allowResizeRows: true,
                allowResizeColumns: true,
                allowEditObjects: false
            };
            obj.spread.options.allowCopyPasteExcelStyle = true;
            obj.spread.options.allowExtendPasteRange = true;
            obj.spread.options.copyPasteHeaderOptions = GC.Spread.Sheets.CopyPasteHeaderOptions.allHeaders;
            sheet.rowOutlines.direction(GC.Spread.Sheets.Outlines.OutlineDirection.backward);
            try {
                if (!obj.schemaValue && obj.customFormatScheme) {
                    if (typeof obj.customFormatScheme == 'string') {
                        obj.schemaValue = {};
                        obj.schemaValue['schemaValue'] = JSON.parse(obj.customFormatScheme);
                    }
                }
            }
            catch (e) { }
            this.utils.get('spreadStyle').applyStyle(sheet, obj.schemaValue, showZero);
            this.utils.get('spreadStyle').linkField(obj.spread, sheet);
            try {
                /** @type {?} */
                let extObj = gspframeworkService.rtf.extendMethod.getExtObj();
                if (extObj) {
                    this.utils.get('spreadStyle').inSuiteLinkField(obj.spread, sheet, extObj);
                }
            }
            catch (e) {
            }
            this.footerVariablesReplace(sheet, obj.data);
        }
        else {
            this.footerVariablesReplace(sheet, obj.data);
            sheet.deleteRows(0, 1);
        }
        this.titleVariablesReplace(sheet, obj.data);
        this.utils.get('spreadStyle').setAutoFitColumn(obj.schemaValue, sheet);
        if (this.utils.get('spreadStyle').getShowHeaderSort(obj.schemaValue)) {
            this.utils.get('spreadStyle').setSortCellType(sheet, obj.schemaValue, obj.qdpView);
        }
        if (obj.controlType == 'list') {
            this.utils.get('spreadStyle').mergeCell(sheet, obj.schemaValue);
        }
        sheet.clearSelection();
        // 页面渲染后事件
        this.utils.get('renderExtends').runRenderExtends('afterLoadData', this.localizeService.getValue('spread.message.extend.dataLoading.after'), obj.data, obj.spread);
        obj.spread.resumePaint();
        obj.spread.resumeEvent();
        // 增加当前单元格联查参数缓存
        this.utils.get('spreadStyle').joinParam['controlType'] = this.type;
        this.cache.set(RtfServices.getTabId(obj.queryId) + 'joinSearch', this.utils.get('spreadStyle').joinParam);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1yZW5kZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcWRwL3NwcmVhZC8iLCJzb3VyY2VzIjpbImxpYi9lbmdpbmUvbGlzdC1yZW5kZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXBELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJM0MsTUFBTSxPQUFPLGNBQWUsU0FBUSxVQUFVOzs7Ozs7OztJQUMxQyxZQUFZLFFBQWEsRUFBRSxZQUFpQixFQUFFLG9CQUEwQixFQUFFLGNBQW9CLEVBQUUsYUFBbUI7UUFDL0csS0FBSyxDQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUUsb0JBQW9CLEVBQUUsY0FBYyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ2hELENBQUM7Ozs7OztJQUVELGNBQWMsQ0FBQyxRQUFhLEVBQUUsWUFBaUI7UUFDM0MsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUM7SUFDNUIsQ0FBQzs7Ozs7O0lBTUQsTUFBTSxDQUFDLEdBQWlCOztjQUNkLElBQUksR0FBRyxJQUFJO1FBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUM7UUFDNUIsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDO1FBQzlELElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FB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QUFXLEVBQUUsQ0FBQztRQUN6QixnQkFBZ0I7UUFDaEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDbkUsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlHLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFueUNoYW5nZWQgfSBmcm9tIFwiQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItZ3JpZC9kaXN0L2VzMjAxNS91dGlsc1wiO1xyXG5pbXBvcnQgeyBFdmVudEJ1cywgUnRmU2VydmljZXMgfSBmcm9tIFwiQHFkcC9jb21tb25cIjtcclxuaW1wb3J0IHsgUmVuZGVyT3B0aW9uIH0gZnJvbSBcIi4uL2VudGl0eS9SZW5kZXJPcHRpb25cIjtcclxuaW1wb3J0IHsgQmFzZVJlbmRlciB9IGZyb20gXCIuL2Jhc2UtcmVuZGVyXCI7XHJcblxyXG5kZWNsYXJlIHZhciBHQzogYW55O1xyXG5kZWNsYXJlIHZhciBnc3BmcmFtZXdvcmtTZXJ2aWNlOiBhbnk7XHJcbmV4cG9ydCBjbGFzcyBMaXN0VHJlZVJlbmRlciBleHRlbmRzIEJhc2VSZW5kZXIge1xyXG4gICAgY29uc3RydWN0b3IoX3F1ZXJ5SWQ6IGFueSwgX2NvbnRyb2xUeXBlOiBhbnksIF9qb2ludHNlYXJjaEluZm9MaXN0PzogYW55LCBfZnVuY0luZm9DYWNoZT86IGFueSwgX3NlcnZpY2VDYWNoZT86IGFueSkge1xyXG4gICAgICAgIHN1cGVyKF9xdWVyeUlkLCBfY29udHJvbFR5cGUsIF9qb2ludHNlYXJjaEluZm9MaXN0LCBfZnVuY0luZm9DYWNoZSwgX3NlcnZpY2VDYWNoZSk7XHJcbiAgICAgICAgdGhpcy5saXN0UmVuZGVySW5pdChfcXVlcnlJZCwgX2NvbnRyb2xUeXBlKTtcclxuICAgIH1cclxuXHJcbiAgICBsaXN0UmVuZGVySW5pdChfcXVlcnlJZDogYW55LCBfY29udHJvbFR5cGU6IGFueSkge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IF9jb250cm9sVHlwZTtcclxuICAgICAgICB0aGlzLnF1ZXJ5SWQgPSBfcXVlcnlJZDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa4suafk1xyXG4gICAgICogQHBhcmFtIG9iaiDlj4LmlbDphY3nva7poblcclxuICAgICAqL1xyXG4gICAgcmVuZGVyKG9iajogUmVuZGVyT3B0aW9uKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5xdWVyeUlkID0gb2JqLnF1ZXJ5SWQ7XHJcbiAgICAgICAgdGhpcy50eXBlID0gb2JqLmNvbnRyb2xUeXBlO1xyXG4gICAgICAgIG9iai5zY2hlbWFJZCA9IG9iai5zY2hlbWFJZCA9PT0gJ3ByZWZhYicgPyAnMScgOiBvYmouc2NoZW1hSWQ7XHJcbiAgICAgICAgdGhpcy51dGlscy5nZXQoJ3NjaGVtYScpLmdldFNjaGVtYUluZm8ob2JqKS5zdWJzY3JpYmUoKHNjaGVtYVZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgaWYgKHNjaGVtYVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBvYmpbJ3NjaGVtYUlkJ10gPSBzY2hlbWFWYWx1ZS5pZDtcclxuICAgICAgICAgICAgICAgIG9ialsnc2NoZW1hVmFsdWUnXSA9IHNjaGVtYVZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy8gdGhpcy5jdXJyZW50U2NoZW1hVmFsdWVDaGFuZ2VyLm5leHQoc2NoZW1hVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgRXZlbnRCdXMuZGlzcGF0Y2goJ3NjaGVtYVZhbHVlQ2hhbmdlZCcsIHNjaGVtYVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGxldCBkZWxheSA9IHNjaGVtYVZhbHVlLnNjaGVtYVZhbHVlLm90aGVyT3B0aW9uLmRlbGF5O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzY2hlbWFWYWx1ZS5zY2hlbWFWYWx1ZS5vdGhlck9wdGlvbi5pbnRlcnZhbDtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBmdW5jSWQgPSBSdGZTZXJ2aWNlcy5nZXRUYWJJZChvYmoucXVlcnlJZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHNlbGYuZnVuY0luZm9DYWNoZS5maXJzdExvYWRDYWNoZS5maW5kSW5kZXgoZWwgPT4gZWwgPT09IGZ1bmNJZCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdExvYWQgPSBzY2hlbWFWYWx1ZS5zY2hlbWFWYWx1ZS5vdGhlck9wdGlvbi5maXJzdExvYWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwICYmIHRoaXMuaXNTY2hlbWFTZWxlY3RDaGFuZ2VkID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaXJzdExvYWQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZnVuY0luZm9DYWNoZS5maXJzdExvYWRDYWNoZS5wdXNoKGZ1bmNJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5sb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmouc3ByZWFkLmdldEFjdGl2ZVNoZWV0KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcHJlYWQuZ2V0QWN0aXZlU2hlZXQoKS5kZWxldGVSb3dzKDAsIG9iai5zcHJlYWQuZ2V0QWN0aXZlU2hlZXQoKS5nZXRSb3dDb3VudCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcHJlYWQuZ2V0QWN0aXZlU2hlZXQoKS5vcHRpb25zLmNvbEhlYWRlclZpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcHJlYWQuaW52YWxpZGF0ZUxheW91dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNwcmVhZC5yZXBhaW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNlcnZpY2VDYWNoZS5sY3BTZXJ2aWNlLnBhZ2VJbmZvQ2hhbmdlLm5leHQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VDb3VudDogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXg6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHNjaGVtYVZhbHVlLnNjaGVtYVZhbHVlLm90aGVyT3B0aW9uLnBhZ2VTaXplIHx8IDIwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQ291bnQ6IDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIWRlbGF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsYXkgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRSZW5kZXJEYXRhRm9yTGlzdC5jYWxsKHRoaXMsIE9iamVjdC5hc3NpZ24oe30sIG9iaikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnRlcnZhbCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRSZW5kZXJEYXRhRm9yTGlzdC5jYWxsKHRoaXMsIE9iamVjdC5hc3NpZ24oe30sIG9iaikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBpbnRlcnZhbCAqIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGRlbGF5ICogMTAwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvYmpbJ3NjaGVtYUlkJ10gPSAnMSc7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldFJlbmRlckRhdGFGb3JMaXN0LmNhbGwodGhpcywgT2JqZWN0LmFzc2lnbih7fSwgb2JqKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFJlbmRlckRhdGFGb3JMaXN0KG9iajogUmVuZGVyT3B0aW9uKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgb2JqLnNjaGVtYUlkID0gb2JqLnNjaGVtYUlkID8gb2JqLnNjaGVtYUlkIDogKG9iai5zY2hlbWFWYWx1ZSAmJiBvYmouc2NoZW1hVmFsdWUuaWQgPyBvYmouc2NoZW1hVmFsdWUuaWQgOiAnMScpO1xyXG4gICAgICAgIGlmICghb2JqLmZvcm1EYXRhKSB7XHJcbiAgICAgICAgICAgIGxldCBwYXJhbXMgPSB0aGlzLnV0aWxzLmdldCgncGFyYW1ldGVyJykuY3JlYXRlUGFyYW1ldGVycyhPYmplY3QuYXNzaWduKHt9LCBvYmosIHsgcGFnZUluZGV4OiAwLCBwYWdlU2l6ZTogMCB9KSk7XHJcbiAgICAgICAgICAgIHBhcmFtc1sncXVlcnlJZCddID0gb2JqLnF1ZXJ5SWQgPyBvYmoucXVlcnlJZCA6ICcnO1xyXG4gICAgICAgICAgICBzZWxmLm9wZXJhdGVQYWdpbmF0aW9uKG9iaiwgcGFyYW1zKTtcclxuICAgICAgICAgICAgLy8g5p+l6K+i5pWw5o2u5YmN5LqL5Lu2XHJcbiAgICAgICAgICAgIHBhcmFtcyA9IHRoaXMudXRpbHMuZ2V0KCdyZW5kZXJFeHRlbmRzJykucnVuUmVuZGVyRXh0ZW5kcygnYmVmb3JlUXVlcnlEYXRhJywgdGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3NwcmVhZC5tZXNzYWdlLmV4dGVuZC5xdWVyeS5iZWZvcmUnKSwgcGFyYW1zLCBvYmouc3ByZWFkKTtcclxuXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0YWIgPSBSdGZTZXJ2aWNlcy5nZXRUYWJJZChvYmoucXVlcnlJZCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLnNldCh0YWIsIEpTT04ucGFyc2UocGFyYW1zWydlbnRpdHlEYXRhJ10pKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FjaGUuc2V0KHRhYiArICdleHRlbmRDb25kJywgcGFyYW1zWydleHRlbmRDb25kJ10pO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7IH1cclxuXHJcbiAgICAgICAgICAgIHNlbGYuZ2V0RGF0YShwYXJhbXMsIG9iai5xdWVyeVJlbGF0aXZlVXJsKS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEgfHwgeyBkYXRhOiBbXSwgZHluYW1pY0NvbHM6IFtdIH07XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqLnNjaGVtYUlkICE9PSAnMScgfHwgKGRhdGEgJiYgZGF0YS5keW5hbWljQ29scyAmJiBkYXRhLmR5bmFtaWNDb2xzLmxlbmd0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNjaGVtYU1hbmFnZXIuZHluYW1pY0NvbHNbb2JqLmdyb3VwVHlwZSA/IG9iai5ncm91cFR5cGUgOiBvYmoucXVlcnlJZF0gPSBkYXRhLmR5bmFtaWNDb2xzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2NoZW1hTWFuYWdlci5keW5hbWljQ29sc1tvYmouc2NoZW1hSWRdID0gZGF0YS5keW5hbWljQ29scyB8fCBbXTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNjaGVtYU1hbmFnZXIub3BlcmF0ZUR5bmFtaWNDb2xzRm9yU2NoZW1hKG9iai5zY2hlbWFWYWx1ZSwgb2JqLmdyb3VwVHlwZSA/IG9iai5ncm91cFR5cGUgOiBvYmoucXVlcnlJZCwgb2JqLnNjaGVtYUlkKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNjaGVtYU1hbmFnZXIuc2NoZW1hSW5mb0NoYW5nZS5uZXh0KHsgc2NoZW1hTGlzdDogc2VsZi5zY2hlbWFNYW5hZ2VyLnNjaGVtYUluZm8sIGlzRGVmYXVsdFNjaGVtYTogc2VsZi5zY2hlbWFNYW5hZ2VyLmlzRGVmYXVsdFNjaGVtYSAmJiBzZWxmLnNjaGVtYU1hbmFnZXIuaXNEZWZhdWx0U2NoZW1hW29iai5xdWVyeUlkXSA/IHNlbGYuc2NoZW1hTWFuYWdlci5pc0RlZmF1bHRTY2hlbWFbb2JqLnF1ZXJ5SWRdIDogbnVsbCwgcHJlU2NoZW1hOiBzZWxmLnNjaGVtYU1hbmFnZXIucHJlU2NoZW1hIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFvYmouc2NoZW1hVmFsdWUgfHwgb2JqLnNjaGVtYUlkID09ICcxJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYub3BlcmF0ZUN1c3RvbUZvcm1hdFNjaGVtYShkYXRhLCBvYmopO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8g5pWw5o2u5Yqg6L295YmN5LqL5Lu2XHJcbiAgICAgICAgICAgICAgICB0aGlzLnV0aWxzLmdldCgncmVuZGVyRXh0ZW5kcycpLnJ1blJlbmRlckV4dGVuZHMoJ2JlZm9yZUxvYWREYXRhJywgc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3NwcmVhZC5tZXNzYWdlLmV4dGVuZC5kYXRhTG9hZGluZy5iZWZvcmUnKSwgZGF0YSwgb2JqLnNwcmVhZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZi5sY3BTZXJ2aWNlLmdldENvbChwYXJhbXMsIG9iai5xdWVyeVJlbGF0aXZlVXJsKS5zdWJzY3JpYmUocmVzdWx0RGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5zY2hlbWFJZCA9PT0gJzEnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGF0YS5keW5hbWljQ29scy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZHluYW1pY0NvbHMgPSByZXN1bHREYXRhLmR5bmFtaWNDb2xzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG9iai5mcm96ZW5Db2xzID0gKHJlc3VsdERhdGEgJiYgcmVzdWx0RGF0YS5keW5hbWljQ29scykgfHwgW107XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqWydkYXRhJ10gPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0TGlzdFJlbmRlclRlbXBsYXRlKG9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8geyBzY2hlbWFJZDogX3NjaGVtYUlkLCBxdWVyeUlkLCBkYXRhLCBxdWVyeVJlbGF0aXZlVXJsLCBzcHJlYWQsIHNjaGVtYVZhbHVlLCBwYWdlSW5kZXgsIGNvbnRyb2xUeXBlLCBsb2FkaW5nIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICBvYmoubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGUuc2V0KCdzY2hlbWFfc2NoZW1haWQnICsgb2JqLnF1ZXJ5SWQsIG9iai5zY2hlbWFJZCk7XHJcbiAgICAgICAgICAgIC8vIEV2ZW50QnVzLmRpc3BhdGNoKCdzY2hlbWFfc2NoZW1haWQnLCBfc2NoZW1hSWQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9ialsnZGF0YSddID0gb2JqLmZvcm1EYXRhO1xyXG4gICAgICAgICAgICBvYmpbJ2Zyb3plbkNvbHMnXSA9IG9iai5mb3JtRGF0YS5keW5hbWljQ29scztcclxuICAgICAgICAgICAgc2VsZi5nZXRMaXN0UmVuZGVyVGVtcGxhdGUob2JqKTtcclxuICAgICAgICAgICAgLy8geyBzY2hlbWFJZDogX3NjaGVtYUlkLCBxdWVyeUlkLCBmb3JtRGF0YSwgcXVlcnlSZWxhdGl2ZVVybCwgc3ByZWFkLCBzY2hlbWFWYWx1ZSwgcGFnZUluZGV4LCBjb250cm9sVHlwZSwgbG9hZGluZyB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0TGlzdFJlbmRlclRlbXBsYXRlKG9iajogUmVuZGVyT3B0aW9uKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5zY2hlbWFNYW5hZ2VyLmdldFNwcmVhZFRlbXBsYXRlKG9iai5zY2hlbWFJZCwgb2JqLnF1ZXJ5SWQsIG9iai5kYXRhICYmIG9iai5kYXRhLmR5bmFtaWNDb2xzID8gb2JqLmRhdGEuZHluYW1pY0NvbHMgOiBbXSwgb2JqLnF1ZXJ5UmVsYXRpdmVVcmwsIG9iai5jdXN0b21Gb3JtYXRTY2hlbWUsIG9iai5mcm96ZW5Db2xzLCBvYmouZ3JvdXBUeXBlKS5zdWJzY3JpYmUodGVtcGxhdGUgPT4ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJldHVyblZhbHVlID8gSlNPTi5wYXJzZSh0ZW1wbGF0ZS5yZXR1cm5WYWx1ZSkgOiB0ZW1wbGF0ZTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYucmVuZGVyTGlzdC5jYWxsKHNlbGYsIE9iamVjdC5hc3NpZ24oe30sIG9iaiwgeyB0ZW1wbGF0ZSB9KSk7XHJcbiAgICAgICAgICAgIHNlbGYudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLmJpbmRTZWxlY3RDaGFuZ2VkKG9iai5zcHJlYWQsIG9iai5xdWVyeUlkKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gUnRmU2VydmljZXMuZ2V0TWVudVN3aXRjaENvbnRyb2xFdmVudCgpO1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQgJiYgdHlwZW9mIGV2ZW50ID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQubmV4dCgnb2snKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgRXZlbnRCdXMuZGlzcGF0Y2goc2VsZi5xdWVyeUlkICsgJ3NwcmVhZF9pbml0Jywge30pO1xyXG5cclxuICAgICAgICAgICAgb2JqLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgICAgICB9LCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKGVycm9yLk1lc3NhZ2UsIGVycm9yKTtcclxuICAgICAgICAgICAgb2JqLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJMaXN0KG9iajogUmVuZGVyT3B0aW9uKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy50eXBlID0gb2JqLmNvbnRyb2xUeXBlO1xyXG4gICAgICAgIG9iai5zcHJlYWQuc3VzcGVuZEV2ZW50KCk7XHJcbiAgICAgICAgb2JqLnNwcmVhZC5zdXNwZW5kUGFpbnQoKTtcclxuICAgICAgICBvYmouc3ByZWFkLmZyb21KU09OKG9iai50ZW1wbGF0ZSk7XHJcbiAgICAgICAgY29uc3Qgc2hlZXQgPSBvYmouc3ByZWFkLmdldEFjdGl2ZVNoZWV0KCk7XHJcbiAgICAgICAgLy8g5YKo57Ku6ZyA5rGC77yM5aSac2hlZXTpobVcclxuICAgICAgICBpZiAob2JqLmN1clNoZWV0ICYmIG9iai5tdWx0aVNoZWV0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgc2hlZXQubmFtZShvYmouY3VyU2hlZXQpO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9iai5tdWx0aVNoZWV0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5jdXJTaGVldCAhPT0gb2JqLm11bHRpU2hlZXRzW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNwcmVhZC5hZGRTaGVldChpLCBuZXcgR0MuU3ByZWFkLlNoZWV0cy5Xb3Jrc2hlZXQob2JqLm11bHRpU2hlZXRzW2ldKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNwcmVhZC5zaGVldHNbaV0uZGVsZXRlUm93cygwLCBvYmouc3ByZWFkLnNoZWV0c1tpXS5nZXRSb3dDb3VudCgpKTtcclxuICAgICAgICAgICAgICAgICAgICBvYmouc3ByZWFkLnNoZWV0c1tpXS5kZWxldGVDb2x1bW5zKDAsIG9iai5zcHJlYWQuc2hlZXRzW2ldLmdldENvbHVtbkNvdW50KCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9iai5zcHJlYWQuc2V0QWN0aXZlU2hlZXQob2JqLmN1clNoZWV0KTtcclxuICAgICAgICAgICAgb2JqLnNwcmVhZC5vcHRpb25zLnRhYlN0cmlwVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIG9iai5zcHJlYWQub3B0aW9ucy50YWJFZGl0YWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyDlgqjnsq7pnIDmsYLvvIzlpJpzaGVldOmhtVxyXG4gICAgICAgIHRoaXMudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLmNhY2hlU3R5bGUoc2hlZXQpO1xyXG4gICAgICAgIGxldCBzaG93WmVybyA9IHRydWU7XHJcbiAgICAgICAgaWYgKG9iai5zY2hlbWFWYWx1ZSAmJiBvYmouc2NoZW1hVmFsdWUuc2NoZW1hVmFsdWUgJiYgb2JqLnNjaGVtYVZhbHVlLnNjaGVtYVZhbHVlLm90aGVyT3B0aW9uKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmouc2NoZW1hVmFsdWUuc2NoZW1hVmFsdWUub3RoZXJPcHRpb24uc2hvd1plcm8gIT0gbnVsbCAmJiBvYmouc2NoZW1hVmFsdWUuc2NoZW1hVmFsdWUub3RoZXJPcHRpb24uc2hvd1plcm8gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgc2hvd1plcm8gPSBvYmouc2NoZW1hVmFsdWUuc2NoZW1hVmFsdWUub3RoZXJPcHRpb24uc2hvd1plcm87XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9iai5kYXRhICYmIG9iai5kYXRhLmRhdGEgJiYgb2JqLmRhdGEuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgb2JqLmRhdGEuZGF0YS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmR5bmFtaWNQcm9wU2V0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gaXRlbS5keW5hbWljUHJvcFNldCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtW2tleV0gPSBpdGVtLmR5bmFtaWNQcm9wU2V0W2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8g5L+u5pS55p6a5Li+5a2X5q615pi+56S6XHJcbiAgICAgICAgICAgIHNlbGYuY2hhbmdlRGF0YShvYmouZGF0YSwgb2JqLnNjaGVtYVZhbHVlKTtcclxuICAgICAgICAgICAgc2hlZXQuc2V0RGF0YVNvdXJjZShvYmouZGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgc2hlZXQuYmluZENvbHVtbnModGhpcy51dGlscy5nZXQoJ3NwcmVhZFN0eWxlJykuZGF0YUNvbEluZm9BcnJheSk7XHJcbiAgICAgICAgICAgIHNoZWV0Lm9wdGlvbnMuaXNQcm90ZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBzaGVldC5vcHRpb25zLnByb3RlY3Rpb25PcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgYWxsb3dTZWxlY3RMb2NrZWRDZWxsczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGFsbG93U2VsZWN0VW5sb2NrZWRDZWxsczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGFsbG93RmlsdGVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dTb3J0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dSZXNpemVSb3dzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dSZXNpemVDb2x1bW5zOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dFZGl0T2JqZWN0czogZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgb2JqLnNwcmVhZC5vcHRpb25zLmFsbG93Q29weVBhc3RlRXhjZWxTdHlsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIG9iai5zcHJlYWQub3B0aW9ucy5hbGxvd0V4dGVuZFBhc3RlUmFuZ2UgPSB0cnVlO1xyXG4gICAgICAgICAgICBvYmouc3ByZWFkLm9wdGlvbnMuY29weVBhc3RlSGVhZGVyT3B0aW9ucyA9IEdDLlNwcmVhZC5TaGVldHMuQ29weVBhc3RlSGVhZGVyT3B0aW9ucy5hbGxIZWFkZXJzO1xyXG4gICAgICAgICAgICBzaGVldC5yb3dPdXRsaW5lcy5kaXJlY3Rpb24oR0MuU3ByZWFkLlNoZWV0cy5PdXRsaW5lcy5PdXRsaW5lRGlyZWN0aW9uLmJhY2t3YXJkKTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGlmICghb2JqLnNjaGVtYVZhbHVlICYmIG9iai5jdXN0b21Gb3JtYXRTY2hlbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9iai5jdXN0b21Gb3JtYXRTY2hlbWUgPT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnNjaGVtYVZhbHVlID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zY2hlbWFWYWx1ZVsnc2NoZW1hVmFsdWUnXSA9IEpTT04ucGFyc2Uob2JqLmN1c3RvbUZvcm1hdFNjaGVtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7IH1cclxuICAgICAgICAgICAgdGhpcy51dGlscy5nZXQoJ3NwcmVhZFN0eWxlJykuYXBwbHlTdHlsZShzaGVldCwgb2JqLnNjaGVtYVZhbHVlLCBzaG93WmVybyk7XHJcbiAgICAgICAgICAgIHRoaXMudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLmxpbmtGaWVsZChvYmouc3ByZWFkLCBzaGVldCk7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZXh0T2JqID0gZ3NwZnJhbWV3b3JrU2VydmljZS5ydGYuZXh0ZW5kTWV0aG9kLmdldEV4dE9iaigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4dE9iaikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLmluU3VpdGVMaW5rRmllbGQob2JqLnNwcmVhZCwgc2hlZXQsIGV4dE9iaik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmZvb3RlclZhcmlhYmxlc1JlcGxhY2Uoc2hlZXQsIG9iai5kYXRhKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmZvb3RlclZhcmlhYmxlc1JlcGxhY2Uoc2hlZXQsIG9iai5kYXRhKTtcclxuICAgICAgICAgICAgc2hlZXQuZGVsZXRlUm93cygwLCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50aXRsZVZhcmlhYmxlc1JlcGxhY2Uoc2hlZXQsIG9iai5kYXRhKTtcclxuICAgICAgICB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5zZXRBdXRvRml0Q29sdW1uKG9iai5zY2hlbWFWYWx1ZSwgc2hlZXQpO1xyXG4gICAgICAgIGlmICh0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5nZXRTaG93SGVhZGVyU29ydChvYmouc2NoZW1hVmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLnNldFNvcnRDZWxsVHlwZShzaGVldCwgb2JqLnNjaGVtYVZhbHVlLCBvYmoucWRwVmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvYmouY29udHJvbFR5cGUgPT0gJ2xpc3QnKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLm1lcmdlQ2VsbChzaGVldCwgb2JqLnNjaGVtYVZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2hlZXQuY2xlYXJTZWxlY3Rpb24oKTtcclxuICAgICAgICAvLyDpobXpnaLmuLLmn5PlkI7kuovku7ZcclxuICAgICAgICB0aGlzLnV0aWxzLmdldCgncmVuZGVyRXh0ZW5kcycpLnJ1blJlbmRlckV4dGVuZHMoJ2FmdGVyTG9hZERhdGEnLCB0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnc3ByZWFkLm1lc3NhZ2UuZXh0ZW5kLmRhdGFMb2FkaW5nLmFmdGVyJyksIG9iai5kYXRhLCBvYmouc3ByZWFkKTtcclxuXHJcbiAgICAgICAgb2JqLnNwcmVhZC5yZXN1bWVQYWludCgpO1xyXG4gICAgICAgIG9iai5zcHJlYWQucmVzdW1lRXZlbnQoKTtcclxuICAgICAgICAvLyDlop7liqDlvZPliY3ljZXlhYPmoLzogZTmn6Xlj4LmlbDnvJPlrZhcclxuICAgICAgICB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5qb2luUGFyYW1bJ2NvbnRyb2xUeXBlJ10gPSB0aGlzLnR5cGU7XHJcbiAgICAgICAgdGhpcy5jYWNoZS5zZXQoUnRmU2VydmljZXMuZ2V0VGFiSWQob2JqLnF1ZXJ5SWQpICsgJ2pvaW5TZWFyY2gnLCB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5qb2luUGFyYW0pO1xyXG4gICAgfVxyXG59Il19
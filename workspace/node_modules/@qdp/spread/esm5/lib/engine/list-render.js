/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventBus, RtfServices } from "@qdp/common";
import { BaseRender } from "./base-render";
var ListTreeRender = /** @class */ (function (_super) {
    tslib_1.__extends(ListTreeRender, _super);
    function ListTreeRender(_queryId, _controlType, _jointsearchInfoList, _funcInfoCache, _serviceCache) {
        var _this = _super.call(this, _queryId, _controlType, _jointsearchInfoList, _funcInfoCache, _serviceCache) || this;
        _this.listRenderInit(_queryId, _controlType);
        return _this;
    }
    /**
     * @param {?} _queryId
     * @param {?} _controlType
     * @return {?}
     */
    ListTreeRender.prototype.listRenderInit = /**
     * @param {?} _queryId
     * @param {?} _controlType
     * @return {?}
     */
    function (_queryId, _controlType) {
        this.type = _controlType;
        this.queryId = _queryId;
    };
    /**
     * 渲染
     * @param obj 参数配置项
     */
    /**
     * 渲染
     * @param {?} obj 参数配置项
     * @return {?}
     */
    ListTreeRender.prototype.render = /**
     * 渲染
     * @param {?} obj 参数配置项
     * @return {?}
     */
    function (obj) {
        var _this = this;
        /** @type {?} */
        var self = this;
        this.queryId = obj.queryId;
        this.type = obj.controlType;
        obj.schemaId = obj.schemaId === 'prefab' ? '1' : obj.schemaId;
        this.utils.get('schema').getSchemaInfo(obj).subscribe((/**
         * @param {?} schemaValue
         * @return {?}
         */
        function (schemaValue) {
            if (schemaValue) {
                obj['schemaId'] = schemaValue.id;
                obj['schemaValue'] = schemaValue;
                // this.currentSchemaValueChanger.next(schemaValue);
                EventBus.dispatch('schemaValueChanged', schemaValue);
                /** @type {?} */
                var delay = schemaValue.schemaValue.otherOption.delay;
                /** @type {?} */
                var interval_1 = schemaValue.schemaValue.otherOption.interval;
                /** @type {?} */
                var funcId_1 = RtfServices.getTabId(obj.queryId);
                /** @type {?} */
                var index = self.funcInfoCache.firstLoadCache.findIndex((/**
                 * @param {?} el
                 * @return {?}
                 */
                function (el) { return el === funcId_1; }));
                /** @type {?} */
                var firstLoad = schemaValue.schemaValue.otherOption.firstLoad;
                if (index < 0 && _this.isSchemaSelectChanged === false) {
                    if (firstLoad === false) {
                        self.funcInfoCache.firstLoadCache.push(funcId_1);
                        obj.loading.close();
                        if (obj.spread.getActiveSheet()) {
                            obj.spread.getActiveSheet().deleteRows(0, obj.spread.getActiveSheet().getRowCount());
                            obj.spread.getActiveSheet().options.colHeaderVisible = false;
                            obj.spread.invalidateLayout();
                            obj.spread.repaint();
                            self.serviceCache.lcpService.pageInfoChange.next({
                                pageCount: 1,
                                pageIndex: 1,
                                pageSize: schemaValue.schemaValue.otherOption.pageSize || 20,
                                totalCount: 1
                            });
                        }
                        return;
                    }
                }
                if (!delay) {
                    delay = 0;
                }
                setTimeout((/**
                 * @return {?}
                 */
                function () {
                    _this.getRenderDataForList.call(_this, Object.assign({}, obj));
                    if (interval_1 > 0) {
                        setInterval((/**
                         * @return {?}
                         */
                        function () {
                            _this.getRenderDataForList.call(_this, Object.assign({}, obj));
                        }), interval_1 * 1000);
                    }
                }), delay * 1000);
            }
            else {
                obj['schemaId'] = '1';
                _this.getRenderDataForList.call(_this, Object.assign({}, obj));
            }
        }));
    };
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    ListTreeRender.prototype.getRenderDataForList = /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        var _this = this;
        /** @type {?} */
        var self = this;
        obj.schemaId = obj.schemaId ? obj.schemaId : (obj.schemaValue && obj.schemaValue.id ? obj.schemaValue.id : '1');
        if (!obj.formData) {
            /** @type {?} */
            var params_1 = this.utils.get('parameter').createParameters(Object.assign({}, obj, { pageIndex: 0, pageSize: 0 }));
            params_1['queryId'] = obj.queryId ? obj.queryId : '';
            self.operatePagination(obj, params_1);
            // 查询数据前事件
            params_1 = this.utils.get('renderExtends').runRenderExtends('beforeQueryData', this.localizeService.getValue('spread.message.extend.query.before'), params_1, obj.spread);
            try {
                /** @type {?} */
                var tab = RtfServices.getTabId(obj.queryId);
                this.cache.set(tab, JSON.parse(params_1['entityData']));
                this.cache.set(tab + 'extendCond', params_1['extendCond']);
            }
            catch (e) { }
            self.getData(params_1, obj.queryRelativeUrl).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                data = data || { data: [], dynamicCols: [] };
                if (obj.schemaId !== '1' || (data && data.dynamicCols && data.dynamicCols.length)) {
                    self.schemaManager.dynamicCols[obj.groupType ? obj.groupType : obj.queryId] = data.dynamicCols || [];
                    self.schemaManager.dynamicCols[obj.schemaId] = data.dynamicCols || [];
                    self.schemaManager.operateDynamicColsForSchema(obj.schemaValue, obj.groupType ? obj.groupType : obj.queryId, obj.schemaId);
                    self.schemaManager.schemaInfoChange.next({ schemaList: self.schemaManager.schemaInfo, isDefaultSchema: self.schemaManager.isDefaultSchema && self.schemaManager.isDefaultSchema[obj.queryId] ? self.schemaManager.isDefaultSchema[obj.queryId] : null, preSchema: self.schemaManager.preSchema });
                }
                if (!obj.schemaValue || obj.schemaId == '1') {
                    self.operateCustomFormatSchema(data, obj);
                }
                // 数据加载前事件
                _this.utils.get('renderExtends').runRenderExtends('beforeLoadData', self.localizeService.getValue('spread.message.extend.dataLoading.before'), data, obj.spread);
                self.lcpService.getCol(params_1, obj.queryRelativeUrl).subscribe((/**
                 * @param {?} resultData
                 * @return {?}
                 */
                function (resultData) {
                    if (obj.schemaId === '1') {
                        if (!data.dynamicCols.length) {
                            data.dynamicCols = resultData.dynamicCols || [];
                        }
                    }
                    obj.frozenCols = (resultData && resultData.dynamicCols) || [];
                    obj['data'] = data;
                    self.getListRenderTemplate(obj);
                    // { schemaId: _schemaId, queryId, data, queryRelativeUrl, spread, schemaValue, pageIndex, controlType, loading }
                }));
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                self.formErrorService.exception(error.Message, error);
                obj.loading.close();
            }));
            this.cache.set('schema_schemaid' + obj.queryId, obj.schemaId);
            // EventBus.dispatch('schema_schemaid', _schemaId);
        }
        else {
            obj['data'] = obj.formData;
            obj['frozenCols'] = obj.formData.dynamicCols;
            self.getListRenderTemplate(obj);
            // { schemaId: _schemaId, queryId, formData, queryRelativeUrl, spread, schemaValue, pageIndex, controlType, loading }
        }
    };
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    ListTreeRender.prototype.getListRenderTemplate = /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var self = this;
        self.schemaManager.getSpreadTemplate(obj.schemaId, obj.queryId, obj.data && obj.data.dynamicCols ? obj.data.dynamicCols : [], obj.queryRelativeUrl, obj.customFormatScheme, obj.frozenCols, obj.groupType).subscribe((/**
         * @param {?} template
         * @return {?}
         */
        function (template) {
            template = template.returnValue ? JSON.parse(template.returnValue) : template;
            self.renderList.call(self, Object.assign({}, obj, { template: template }));
            self.utils.get('spreadStyle').bindSelectChanged(obj.spread, obj.queryId);
            /** @type {?} */
            var event = RtfServices.getMenuSwitchControlEvent();
            if (event && typeof event === 'object') {
                event.next('ok');
            }
            EventBus.dispatch(self.queryId + 'spread_init', {});
            obj.loading.close();
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            self.formErrorService.exception(error.Message, error);
            obj.loading.close();
        }));
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    ListTreeRender.prototype.renderList = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var self = this;
        this.type = obj.controlType;
        obj.spread.suspendEvent();
        obj.spread.suspendPaint();
        obj.spread.fromJSON(obj.template);
        /** @type {?} */
        var sheet = obj.spread.getActiveSheet();
        // 储粮需求，多sheet页
        if (obj.curSheet && obj.multiSheets.length) {
            sheet.name(obj.curSheet);
            for (var i = 0; i < obj.multiSheets.length; i++) {
                if (obj.curSheet !== obj.multiSheets[i]) {
                    obj.spread.addSheet(i, new GC.Spread.Sheets.Worksheet(obj.multiSheets[i]));
                    obj.spread.sheets[i].deleteRows(0, obj.spread.sheets[i].getRowCount());
                    obj.spread.sheets[i].deleteColumns(0, obj.spread.sheets[i].getColumnCount());
                }
            }
            obj.spread.setActiveSheet(obj.curSheet);
            obj.spread.options.tabStripVisible = true;
            obj.spread.options.tabEditable = false;
        }
        // 储粮需求，多sheet页
        this.utils.get('spreadStyle').cacheStyle(sheet);
        /** @type {?} */
        var showZero = true;
        if (obj.schemaValue && obj.schemaValue.schemaValue && obj.schemaValue.schemaValue.otherOption) {
            if (obj.schemaValue.schemaValue.otherOption.showZero != null && obj.schemaValue.schemaValue.otherOption.showZero !== undefined) {
                showZero = obj.schemaValue.schemaValue.otherOption.showZero;
            }
        }
        if (obj.data && obj.data.data && obj.data.data.length) {
            obj.data.data.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item.dynamicPropSet) {
                    for (var key in item.dynamicPropSet) {
                        item[key] = item.dynamicPropSet[key];
                    }
                }
            }));
            // 修改枚举字段显示
            self.changeData(obj.data, obj.schemaValue);
            sheet.setDataSource(obj.data.data);
            sheet.bindColumns(this.utils.get('spreadStyle').dataColInfoArray);
            sheet.options.isProtected = true;
            sheet.options.protectionOptions = {
                allowSelectLockedCells: true,
                allowSelectUnlockedCells: true,
                allowFilter: true,
                allowSort: true,
                allowResizeRows: true,
                allowResizeColumns: true,
                allowEditObjects: false
            };
            obj.spread.options.allowCopyPasteExcelStyle = true;
            obj.spread.options.allowExtendPasteRange = true;
            obj.spread.options.copyPasteHeaderOptions = GC.Spread.Sheets.CopyPasteHeaderOptions.allHeaders;
            sheet.rowOutlines.direction(GC.Spread.Sheets.Outlines.OutlineDirection.backward);
            try {
                if (!obj.schemaValue && obj.customFormatScheme) {
                    if (typeof obj.customFormatScheme == 'string') {
                        obj.schemaValue = {};
                        obj.schemaValue['schemaValue'] = JSON.parse(obj.customFormatScheme);
                    }
                }
            }
            catch (e) { }
            this.utils.get('spreadStyle').applyStyle(sheet, obj.schemaValue, showZero);
            this.utils.get('spreadStyle').linkField(obj.spread, sheet);
            try {
                /** @type {?} */
                var extObj = gspframeworkService.rtf.extendMethod.getExtObj();
                if (extObj) {
                    this.utils.get('spreadStyle').inSuiteLinkField(obj.spread, sheet, extObj);
                }
            }
            catch (e) {
            }
            this.footerVariablesReplace(sheet, obj.data);
        }
        else {
            this.footerVariablesReplace(sheet, obj.data);
            sheet.deleteRows(0, 1);
        }
        this.titleVariablesReplace(sheet, obj.data);
        this.utils.get('spreadStyle').setAutoFitColumn(obj.schemaValue, sheet);
        if (this.utils.get('spreadStyle').getShowHeaderSort(obj.schemaValue)) {
            this.utils.get('spreadStyle').setSortCellType(sheet, obj.schemaValue, obj.qdpView);
        }
        if (obj.controlType == 'list') {
            this.utils.get('spreadStyle').mergeCell(sheet, obj.schemaValue);
        }
        sheet.clearSelection();
        // 页面渲染后事件
        this.utils.get('renderExtends').runRenderExtends('afterLoadData', this.localizeService.getValue('spread.message.extend.dataLoading.after'), obj.data, obj.spread);
        obj.spread.resumePaint();
        obj.spread.resumeEvent();
        // 增加当前单元格联查参数缓存
        this.utils.get('spreadStyle').joinParam['controlType'] = this.type;
        this.cache.set(RtfServices.getTabId(obj.queryId) + 'joinSearch', this.utils.get('spreadStyle').joinParam);
    };
    return ListTreeRender;
}(BaseRender));
export { ListTreeRender };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC1yZW5kZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcWRwL3NwcmVhZC8iLCJzb3VyY2VzIjpbImxpYi9lbmdpbmUvbGlzdC1yZW5kZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSxPQUFPLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUVwRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBSTNDO0lBQW9DLDBDQUFVO0lBQzFDLHdCQUFZLFFBQWEsRUFBRSxZQUFpQixFQUFFLG9CQUEwQixFQUFFLGNBQW9CLEVBQUUsYUFBbUI7UUFBbkgsWUFDSSxrQkFBTSxRQUFRLEVBQUUsWUFBWSxFQUFFLG9CQUFvQixFQUFFLGNBQWMsRUFBRSxhQUFhLENBQUMsU0FFckY7UUFERyxLQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQzs7SUFDaEQsQ0FBQzs7Ozs7O0lBRUQsdUNBQWM7Ozs7O0lBQWQsVUFBZSxRQUFhLEVBQUUsWUFBaUI7UUFDM0MsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUM7UUFDekIsSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUM7SUFDNUIsQ0FBQztJQUVEOzs7T0FHRzs7Ozs7O0lBQ0gsK0JBQU07Ozs7O0lBQU4sVUFBTyxHQUFpQjtRQUF4QixpQkFvREM7O1lBbkRTLElBQUksR0FBRyxJQUFJO1FBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUM7UUFDNUIsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDO1FBQzlELElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FB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QU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN6QixnQkFBZ0I7UUFDaEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDbkUsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlHLENBQUM7SUFDTCxxQkFBQztBQUFELENBQUMsQUFsUEQsQ0FBb0MsVUFBVSxHQWtQN0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhbnlDaGFuZ2VkIH0gZnJvbSBcIkBwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWdyaWQvZGlzdC9lczIwMTUvdXRpbHNcIjtcclxuaW1wb3J0IHsgRXZlbnRCdXMsIFJ0ZlNlcnZpY2VzIH0gZnJvbSBcIkBxZHAvY29tbW9uXCI7XHJcbmltcG9ydCB7IFJlbmRlck9wdGlvbiB9IGZyb20gXCIuLi9lbnRpdHkvUmVuZGVyT3B0aW9uXCI7XHJcbmltcG9ydCB7IEJhc2VSZW5kZXIgfSBmcm9tIFwiLi9iYXNlLXJlbmRlclwiO1xyXG5cclxuZGVjbGFyZSB2YXIgR0M6IGFueTtcclxuZGVjbGFyZSB2YXIgZ3NwZnJhbWV3b3JrU2VydmljZTogYW55O1xyXG5leHBvcnQgY2xhc3MgTGlzdFRyZWVSZW5kZXIgZXh0ZW5kcyBCYXNlUmVuZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKF9xdWVyeUlkOiBhbnksIF9jb250cm9sVHlwZTogYW55LCBfam9pbnRzZWFyY2hJbmZvTGlzdD86IGFueSwgX2Z1bmNJbmZvQ2FjaGU/OiBhbnksIF9zZXJ2aWNlQ2FjaGU/OiBhbnkpIHtcclxuICAgICAgICBzdXBlcihfcXVlcnlJZCwgX2NvbnRyb2xUeXBlLCBfam9pbnRzZWFyY2hJbmZvTGlzdCwgX2Z1bmNJbmZvQ2FjaGUsIF9zZXJ2aWNlQ2FjaGUpO1xyXG4gICAgICAgIHRoaXMubGlzdFJlbmRlckluaXQoX3F1ZXJ5SWQsIF9jb250cm9sVHlwZSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGlzdFJlbmRlckluaXQoX3F1ZXJ5SWQ6IGFueSwgX2NvbnRyb2xUeXBlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLnR5cGUgPSBfY29udHJvbFR5cGU7XHJcbiAgICAgICAgdGhpcy5xdWVyeUlkID0gX3F1ZXJ5SWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmuLLmn5NcclxuICAgICAqIEBwYXJhbSBvYmog5Y+C5pWw6YWN572u6aG5XHJcbiAgICAgKi9cclxuICAgIHJlbmRlcihvYmo6IFJlbmRlck9wdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucXVlcnlJZCA9IG9iai5xdWVyeUlkO1xyXG4gICAgICAgIHRoaXMudHlwZSA9IG9iai5jb250cm9sVHlwZTtcclxuICAgICAgICBvYmouc2NoZW1hSWQgPSBvYmouc2NoZW1hSWQgPT09ICdwcmVmYWInID8gJzEnIDogb2JqLnNjaGVtYUlkO1xyXG4gICAgICAgIHRoaXMudXRpbHMuZ2V0KCdzY2hlbWEnKS5nZXRTY2hlbWFJbmZvKG9iaikuc3Vic2NyaWJlKChzY2hlbWFWYWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChzY2hlbWFWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgb2JqWydzY2hlbWFJZCddID0gc2NoZW1hVmFsdWUuaWQ7XHJcbiAgICAgICAgICAgICAgICBvYmpbJ3NjaGVtYVZhbHVlJ10gPSBzY2hlbWFWYWx1ZTtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuY3VycmVudFNjaGVtYVZhbHVlQ2hhbmdlci5uZXh0KHNjaGVtYVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIEV2ZW50QnVzLmRpc3BhdGNoKCdzY2hlbWFWYWx1ZUNoYW5nZWQnLCBzY2hlbWFWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGVsYXkgPSBzY2hlbWFWYWx1ZS5zY2hlbWFWYWx1ZS5vdGhlck9wdGlvbi5kZWxheTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGludGVydmFsID0gc2NoZW1hVmFsdWUuc2NoZW1hVmFsdWUub3RoZXJPcHRpb24uaW50ZXJ2YWw7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgZnVuY0lkID0gUnRmU2VydmljZXMuZ2V0VGFiSWQob2JqLnF1ZXJ5SWQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBzZWxmLmZ1bmNJbmZvQ2FjaGUuZmlyc3RMb2FkQ2FjaGUuZmluZEluZGV4KGVsID0+IGVsID09PSBmdW5jSWQpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmlyc3RMb2FkID0gc2NoZW1hVmFsdWUuc2NoZW1hVmFsdWUub3RoZXJPcHRpb24uZmlyc3RMb2FkO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMCAmJiB0aGlzLmlzU2NoZW1hU2VsZWN0Q2hhbmdlZCA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RMb2FkID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZ1bmNJbmZvQ2FjaGUuZmlyc3RMb2FkQ2FjaGUucHVzaChmdW5jSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoubG9hZGluZy5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnNwcmVhZC5nZXRBY3RpdmVTaGVldCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc3ByZWFkLmdldEFjdGl2ZVNoZWV0KCkuZGVsZXRlUm93cygwLCBvYmouc3ByZWFkLmdldEFjdGl2ZVNoZWV0KCkuZ2V0Um93Q291bnQoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc3ByZWFkLmdldEFjdGl2ZVNoZWV0KCkub3B0aW9ucy5jb2xIZWFkZXJWaXNpYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouc3ByZWFkLmludmFsaWRhdGVMYXlvdXQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zcHJlYWQucmVwYWludCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXJ2aWNlQ2FjaGUubGNwU2VydmljZS5wYWdlSW5mb0NoYW5nZS5uZXh0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlQ291bnQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUluZGV4OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VTaXplOiBzY2hlbWFWYWx1ZS5zY2hlbWFWYWx1ZS5vdGhlck9wdGlvbi5wYWdlU2l6ZSB8fCAyMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbENvdW50OiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFkZWxheSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlbGF5ID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVuZGVyRGF0YUZvckxpc3QuY2FsbCh0aGlzLCBPYmplY3QuYXNzaWduKHt9LCBvYmopKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVuZGVyRGF0YUZvckxpc3QuY2FsbCh0aGlzLCBPYmplY3QuYXNzaWduKHt9LCBvYmopKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgaW50ZXJ2YWwgKiAxMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBkZWxheSAqIDEwMDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb2JqWydzY2hlbWFJZCddID0gJzEnO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRSZW5kZXJEYXRhRm9yTGlzdC5jYWxsKHRoaXMsIE9iamVjdC5hc3NpZ24oe30sIG9iaikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRSZW5kZXJEYXRhRm9yTGlzdChvYmo6IFJlbmRlck9wdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIG9iai5zY2hlbWFJZCA9IG9iai5zY2hlbWFJZCA/IG9iai5zY2hlbWFJZCA6IChvYmouc2NoZW1hVmFsdWUgJiYgb2JqLnNjaGVtYVZhbHVlLmlkID8gb2JqLnNjaGVtYVZhbHVlLmlkIDogJzEnKTtcclxuICAgICAgICBpZiAoIW9iai5mb3JtRGF0YSkge1xyXG4gICAgICAgICAgICBsZXQgcGFyYW1zID0gdGhpcy51dGlscy5nZXQoJ3BhcmFtZXRlcicpLmNyZWF0ZVBhcmFtZXRlcnMoT2JqZWN0LmFzc2lnbih7fSwgb2JqLCB7IHBhZ2VJbmRleDogMCwgcGFnZVNpemU6IDAgfSkpO1xyXG4gICAgICAgICAgICBwYXJhbXNbJ3F1ZXJ5SWQnXSA9IG9iai5xdWVyeUlkID8gb2JqLnF1ZXJ5SWQgOiAnJztcclxuICAgICAgICAgICAgc2VsZi5vcGVyYXRlUGFnaW5hdGlvbihvYmosIHBhcmFtcyk7XHJcbiAgICAgICAgICAgIC8vIOafpeivouaVsOaNruWJjeS6i+S7tlxyXG4gICAgICAgICAgICBwYXJhbXMgPSB0aGlzLnV0aWxzLmdldCgncmVuZGVyRXh0ZW5kcycpLnJ1blJlbmRlckV4dGVuZHMoJ2JlZm9yZVF1ZXJ5RGF0YScsIHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdzcHJlYWQubWVzc2FnZS5leHRlbmQucXVlcnkuYmVmb3JlJyksIHBhcmFtcywgb2JqLnNwcmVhZCk7XHJcblxyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGFiID0gUnRmU2VydmljZXMuZ2V0VGFiSWQob2JqLnF1ZXJ5SWQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZS5zZXQodGFiLCBKU09OLnBhcnNlKHBhcmFtc1snZW50aXR5RGF0YSddKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLnNldCh0YWIgKyAnZXh0ZW5kQ29uZCcsIHBhcmFtc1snZXh0ZW5kQ29uZCddKTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB9XHJcblxyXG4gICAgICAgICAgICBzZWxmLmdldERhdGEocGFyYW1zLCBvYmoucXVlcnlSZWxhdGl2ZVVybCkuc3Vic2NyaWJlKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhIHx8IHsgZGF0YTogW10sIGR5bmFtaWNDb2xzOiBbXSB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKG9iai5zY2hlbWFJZCAhPT0gJzEnIHx8IChkYXRhICYmIGRhdGEuZHluYW1pY0NvbHMgJiYgZGF0YS5keW5hbWljQ29scy5sZW5ndGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zY2hlbWFNYW5hZ2VyLmR5bmFtaWNDb2xzW29iai5ncm91cFR5cGUgPyBvYmouZ3JvdXBUeXBlIDogb2JqLnF1ZXJ5SWRdID0gZGF0YS5keW5hbWljQ29scyB8fCBbXTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNjaGVtYU1hbmFnZXIuZHluYW1pY0NvbHNbb2JqLnNjaGVtYUlkXSA9IGRhdGEuZHluYW1pY0NvbHMgfHwgW107XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zY2hlbWFNYW5hZ2VyLm9wZXJhdGVEeW5hbWljQ29sc0ZvclNjaGVtYShvYmouc2NoZW1hVmFsdWUsIG9iai5ncm91cFR5cGUgPyBvYmouZ3JvdXBUeXBlIDogb2JqLnF1ZXJ5SWQsIG9iai5zY2hlbWFJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zY2hlbWFNYW5hZ2VyLnNjaGVtYUluZm9DaGFuZ2UubmV4dCh7IHNjaGVtYUxpc3Q6IHNlbGYuc2NoZW1hTWFuYWdlci5zY2hlbWFJbmZvLCBpc0RlZmF1bHRTY2hlbWE6IHNlbGYuc2NoZW1hTWFuYWdlci5pc0RlZmF1bHRTY2hlbWEgJiYgc2VsZi5zY2hlbWFNYW5hZ2VyLmlzRGVmYXVsdFNjaGVtYVtvYmoucXVlcnlJZF0gPyBzZWxmLnNjaGVtYU1hbmFnZXIuaXNEZWZhdWx0U2NoZW1hW29iai5xdWVyeUlkXSA6IG51bGwsIHByZVNjaGVtYTogc2VsZi5zY2hlbWFNYW5hZ2VyLnByZVNjaGVtYSB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghb2JqLnNjaGVtYVZhbHVlIHx8IG9iai5zY2hlbWFJZCA9PSAnMScpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wZXJhdGVDdXN0b21Gb3JtYXRTY2hlbWEoZGF0YSwgb2JqKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIOaVsOaNruWKoOi9veWJjeS6i+S7tlxyXG4gICAgICAgICAgICAgICAgdGhpcy51dGlscy5nZXQoJ3JlbmRlckV4dGVuZHMnKS5ydW5SZW5kZXJFeHRlbmRzKCdiZWZvcmVMb2FkRGF0YScsIHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdzcHJlYWQubWVzc2FnZS5leHRlbmQuZGF0YUxvYWRpbmcuYmVmb3JlJyksIGRhdGEsIG9iai5zcHJlYWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGYubGNwU2VydmljZS5nZXRDb2wocGFyYW1zLCBvYmoucXVlcnlSZWxhdGl2ZVVybCkuc3Vic2NyaWJlKHJlc3VsdERhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouc2NoZW1hSWQgPT09ICcxJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEuZHluYW1pY0NvbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmR5bmFtaWNDb2xzID0gcmVzdWx0RGF0YS5keW5hbWljQ29scyB8fCBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBvYmouZnJvemVuQ29scyA9IChyZXN1bHREYXRhICYmIHJlc3VsdERhdGEuZHluYW1pY0NvbHMpIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialsnZGF0YSddID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdldExpc3RSZW5kZXJUZW1wbGF0ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHsgc2NoZW1hSWQ6IF9zY2hlbWFJZCwgcXVlcnlJZCwgZGF0YSwgcXVlcnlSZWxhdGl2ZVVybCwgc3ByZWFkLCBzY2hlbWFWYWx1ZSwgcGFnZUluZGV4LCBjb250cm9sVHlwZSwgbG9hZGluZyB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHNlbGYuZm9ybUVycm9yU2VydmljZS5leGNlcHRpb24oZXJyb3IuTWVzc2FnZSwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgb2JqLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNhY2hlLnNldCgnc2NoZW1hX3NjaGVtYWlkJyArIG9iai5xdWVyeUlkLCBvYmouc2NoZW1hSWQpO1xyXG4gICAgICAgICAgICAvLyBFdmVudEJ1cy5kaXNwYXRjaCgnc2NoZW1hX3NjaGVtYWlkJywgX3NjaGVtYUlkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBvYmpbJ2RhdGEnXSA9IG9iai5mb3JtRGF0YTtcclxuICAgICAgICAgICAgb2JqWydmcm96ZW5Db2xzJ10gPSBvYmouZm9ybURhdGEuZHluYW1pY0NvbHM7XHJcbiAgICAgICAgICAgIHNlbGYuZ2V0TGlzdFJlbmRlclRlbXBsYXRlKG9iaik7XHJcbiAgICAgICAgICAgIC8vIHsgc2NoZW1hSWQ6IF9zY2hlbWFJZCwgcXVlcnlJZCwgZm9ybURhdGEsIHF1ZXJ5UmVsYXRpdmVVcmwsIHNwcmVhZCwgc2NoZW1hVmFsdWUsIHBhZ2VJbmRleCwgY29udHJvbFR5cGUsIGxvYWRpbmcgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldExpc3RSZW5kZXJUZW1wbGF0ZShvYmo6IFJlbmRlck9wdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuc2NoZW1hTWFuYWdlci5nZXRTcHJlYWRUZW1wbGF0ZShvYmouc2NoZW1hSWQsIG9iai5xdWVyeUlkLCBvYmouZGF0YSAmJiBvYmouZGF0YS5keW5hbWljQ29scyA/IG9iai5kYXRhLmR5bmFtaWNDb2xzIDogW10sIG9iai5xdWVyeVJlbGF0aXZlVXJsLCBvYmouY3VzdG9tRm9ybWF0U2NoZW1lLCBvYmouZnJvemVuQ29scywgb2JqLmdyb3VwVHlwZSkuc3Vic2NyaWJlKHRlbXBsYXRlID0+IHtcclxuICAgICAgICAgICAgdGVtcGxhdGUgPSB0ZW1wbGF0ZS5yZXR1cm5WYWx1ZSA/IEpTT04ucGFyc2UodGVtcGxhdGUucmV0dXJuVmFsdWUpIDogdGVtcGxhdGU7XHJcblxyXG4gICAgICAgICAgICBzZWxmLnJlbmRlckxpc3QuY2FsbChzZWxmLCBPYmplY3QuYXNzaWduKHt9LCBvYmosIHsgdGVtcGxhdGUgfSkpO1xyXG4gICAgICAgICAgICBzZWxmLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5iaW5kU2VsZWN0Q2hhbmdlZChvYmouc3ByZWFkLCBvYmoucXVlcnlJZCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBldmVudCA9IFJ0ZlNlcnZpY2VzLmdldE1lbnVTd2l0Y2hDb250cm9sRXZlbnQoKTtcclxuICAgICAgICAgICAgaWYgKGV2ZW50ICYmIHR5cGVvZiBldmVudCA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50Lm5leHQoJ29rJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIEV2ZW50QnVzLmRpc3BhdGNoKHNlbGYucXVlcnlJZCArICdzcHJlYWRfaW5pdCcsIHt9KTtcclxuXHJcbiAgICAgICAgICAgIG9iai5sb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICAgICAgICAgIG9iai5sb2FkaW5nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmVuZGVyTGlzdChvYmo6IFJlbmRlck9wdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMudHlwZSA9IG9iai5jb250cm9sVHlwZTtcclxuICAgICAgICBvYmouc3ByZWFkLnN1c3BlbmRFdmVudCgpO1xyXG4gICAgICAgIG9iai5zcHJlYWQuc3VzcGVuZFBhaW50KCk7XHJcbiAgICAgICAgb2JqLnNwcmVhZC5mcm9tSlNPTihvYmoudGVtcGxhdGUpO1xyXG4gICAgICAgIGNvbnN0IHNoZWV0ID0gb2JqLnNwcmVhZC5nZXRBY3RpdmVTaGVldCgpO1xyXG4gICAgICAgIC8vIOWCqOeyrumcgOaxgu+8jOWkmnNoZWV06aG1XHJcbiAgICAgICAgaWYgKG9iai5jdXJTaGVldCAmJiBvYmoubXVsdGlTaGVldHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHNoZWV0Lm5hbWUob2JqLmN1clNoZWV0KTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvYmoubXVsdGlTaGVldHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmouY3VyU2hlZXQgIT09IG9iai5tdWx0aVNoZWV0c1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zcHJlYWQuYWRkU2hlZXQoaSwgbmV3IEdDLlNwcmVhZC5TaGVldHMuV29ya3NoZWV0KG9iai5tdWx0aVNoZWV0c1tpXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iai5zcHJlYWQuc2hlZXRzW2ldLmRlbGV0ZVJvd3MoMCwgb2JqLnNwcmVhZC5zaGVldHNbaV0uZ2V0Um93Q291bnQoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLnNwcmVhZC5zaGVldHNbaV0uZGVsZXRlQ29sdW1ucygwLCBvYmouc3ByZWFkLnNoZWV0c1tpXS5nZXRDb2x1bW5Db3VudCgpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvYmouc3ByZWFkLnNldEFjdGl2ZVNoZWV0KG9iai5jdXJTaGVldCk7XHJcbiAgICAgICAgICAgIG9iai5zcHJlYWQub3B0aW9ucy50YWJTdHJpcFZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBvYmouc3ByZWFkLm9wdGlvbnMudGFiRWRpdGFibGUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5YKo57Ku6ZyA5rGC77yM5aSac2hlZXTpobVcclxuICAgICAgICB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5jYWNoZVN0eWxlKHNoZWV0KTtcclxuICAgICAgICBsZXQgc2hvd1plcm8gPSB0cnVlO1xyXG4gICAgICAgIGlmIChvYmouc2NoZW1hVmFsdWUgJiYgb2JqLnNjaGVtYVZhbHVlLnNjaGVtYVZhbHVlICYmIG9iai5zY2hlbWFWYWx1ZS5zY2hlbWFWYWx1ZS5vdGhlck9wdGlvbikge1xyXG4gICAgICAgICAgICBpZiAob2JqLnNjaGVtYVZhbHVlLnNjaGVtYVZhbHVlLm90aGVyT3B0aW9uLnNob3daZXJvICE9IG51bGwgJiYgb2JqLnNjaGVtYVZhbHVlLnNjaGVtYVZhbHVlLm90aGVyT3B0aW9uLnNob3daZXJvICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHNob3daZXJvID0gb2JqLnNjaGVtYVZhbHVlLnNjaGVtYVZhbHVlLm90aGVyT3B0aW9uLnNob3daZXJvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvYmouZGF0YSAmJiBvYmouZGF0YS5kYXRhICYmIG9iai5kYXRhLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIG9iai5kYXRhLmRhdGEuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5keW5hbWljUHJvcFNldCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIGl0ZW0uZHluYW1pY1Byb3BTZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVtrZXldID0gaXRlbS5keW5hbWljUHJvcFNldFtrZXldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIC8vIOS/ruaUueaemuS4vuWtl+auteaYvuekulxyXG4gICAgICAgICAgICBzZWxmLmNoYW5nZURhdGEob2JqLmRhdGEsIG9iai5zY2hlbWFWYWx1ZSk7XHJcbiAgICAgICAgICAgIHNoZWV0LnNldERhdGFTb3VyY2Uob2JqLmRhdGEuZGF0YSk7XHJcbiAgICAgICAgICAgIHNoZWV0LmJpbmRDb2x1bW5zKHRoaXMudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLmRhdGFDb2xJbmZvQXJyYXkpO1xyXG4gICAgICAgICAgICBzaGVldC5vcHRpb25zLmlzUHJvdGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2hlZXQub3B0aW9ucy5wcm90ZWN0aW9uT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGFsbG93U2VsZWN0TG9ja2VkQ2VsbHM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBhbGxvd1NlbGVjdFVubG9ja2VkQ2VsbHM6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBhbGxvd0ZpbHRlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGFsbG93U29ydDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGFsbG93UmVzaXplUm93czogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGFsbG93UmVzaXplQ29sdW1uczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGFsbG93RWRpdE9iamVjdHM6IGZhbHNlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIG9iai5zcHJlYWQub3B0aW9ucy5hbGxvd0NvcHlQYXN0ZUV4Y2VsU3R5bGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBvYmouc3ByZWFkLm9wdGlvbnMuYWxsb3dFeHRlbmRQYXN0ZVJhbmdlID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2JqLnNwcmVhZC5vcHRpb25zLmNvcHlQYXN0ZUhlYWRlck9wdGlvbnMgPSBHQy5TcHJlYWQuU2hlZXRzLkNvcHlQYXN0ZUhlYWRlck9wdGlvbnMuYWxsSGVhZGVycztcclxuICAgICAgICAgICAgc2hlZXQucm93T3V0bGluZXMuZGlyZWN0aW9uKEdDLlNwcmVhZC5TaGVldHMuT3V0bGluZXMuT3V0bGluZURpcmVjdGlvbi5iYWNrd2FyZCk7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW9iai5zY2hlbWFWYWx1ZSAmJiBvYmouY3VzdG9tRm9ybWF0U2NoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmouY3VzdG9tRm9ybWF0U2NoZW1lID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5zY2hlbWFWYWx1ZSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouc2NoZW1hVmFsdWVbJ3NjaGVtYVZhbHVlJ10gPSBKU09OLnBhcnNlKG9iai5jdXN0b21Gb3JtYXRTY2hlbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB9XHJcbiAgICAgICAgICAgIHRoaXMudXRpbHMuZ2V0KCdzcHJlYWRTdHlsZScpLmFwcGx5U3R5bGUoc2hlZXQsIG9iai5zY2hlbWFWYWx1ZSwgc2hvd1plcm8pO1xyXG4gICAgICAgICAgICB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5saW5rRmllbGQob2JqLnNwcmVhZCwgc2hlZXQpO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGV4dE9iaiA9IGdzcGZyYW1ld29ya1NlcnZpY2UucnRmLmV4dGVuZE1ldGhvZC5nZXRFeHRPYmooKTtcclxuICAgICAgICAgICAgICAgIGlmIChleHRPYmopIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5pblN1aXRlTGlua0ZpZWxkKG9iai5zcHJlYWQsIHNoZWV0LCBleHRPYmopO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5mb290ZXJWYXJpYWJsZXNSZXBsYWNlKHNoZWV0LCBvYmouZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5mb290ZXJWYXJpYWJsZXNSZXBsYWNlKHNoZWV0LCBvYmouZGF0YSk7XHJcbiAgICAgICAgICAgIHNoZWV0LmRlbGV0ZVJvd3MoMCwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudGl0bGVWYXJpYWJsZXNSZXBsYWNlKHNoZWV0LCBvYmouZGF0YSk7XHJcbiAgICAgICAgdGhpcy51dGlscy5nZXQoJ3NwcmVhZFN0eWxlJykuc2V0QXV0b0ZpdENvbHVtbihvYmouc2NoZW1hVmFsdWUsIHNoZWV0KTtcclxuICAgICAgICBpZiAodGhpcy51dGlscy5nZXQoJ3NwcmVhZFN0eWxlJykuZ2V0U2hvd0hlYWRlclNvcnQob2JqLnNjaGVtYVZhbHVlKSkge1xyXG4gICAgICAgICAgICB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5zZXRTb3J0Q2VsbFR5cGUoc2hlZXQsIG9iai5zY2hlbWFWYWx1ZSwgb2JqLnFkcFZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob2JqLmNvbnRyb2xUeXBlID09ICdsaXN0Jykge1xyXG4gICAgICAgICAgICB0aGlzLnV0aWxzLmdldCgnc3ByZWFkU3R5bGUnKS5tZXJnZUNlbGwoc2hlZXQsIG9iai5zY2hlbWFWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNoZWV0LmNsZWFyU2VsZWN0aW9uKCk7XHJcbiAgICAgICAgLy8g6aG16Z2i5riy5p+T5ZCO5LqL5Lu2XHJcbiAgICAgICAgdGhpcy51dGlscy5nZXQoJ3JlbmRlckV4dGVuZHMnKS5ydW5SZW5kZXJFeHRlbmRzKCdhZnRlckxvYWREYXRhJywgdGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3NwcmVhZC5tZXNzYWdlLmV4dGVuZC5kYXRhTG9hZGluZy5hZnRlcicpLCBvYmouZGF0YSwgb2JqLnNwcmVhZCk7XHJcblxyXG4gICAgICAgIG9iai5zcHJlYWQucmVzdW1lUGFpbnQoKTtcclxuICAgICAgICBvYmouc3ByZWFkLnJlc3VtZUV2ZW50KCk7XHJcbiAgICAgICAgLy8g5aKe5Yqg5b2T5YmN5Y2V5YWD5qC86IGU5p+l5Y+C5pWw57yT5a2YXHJcbiAgICAgICAgdGhpcy51dGlscy5nZXQoJ3NwcmVhZFN0eWxlJykuam9pblBhcmFtWydjb250cm9sVHlwZSddID0gdGhpcy50eXBlO1xyXG4gICAgICAgIHRoaXMuY2FjaGUuc2V0KFJ0ZlNlcnZpY2VzLmdldFRhYklkKG9iai5xdWVyeUlkKSArICdqb2luU2VhcmNoJywgdGhpcy51dGlscy5nZXQoJ3NwcmVhZFN0eWxlJykuam9pblBhcmFtKTtcclxuICAgIH1cclxufSJdfQ==
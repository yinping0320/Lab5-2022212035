/**
 * @fileoverview added by tsickle
 * Generated from: lib/component/formular-select/formular-select.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Output, EventEmitter } from '@angular/core';
import { MessagerService } from '@farris/ui-messager';
import { CacheService } from '@ecp-caf/caf-common';
import { RestfulService } from '../../service/restful.service';
import { EntityDataService } from '../../service/entitydata.service';
import { LocalizeService } from '@qdp/localize';
var FormularSelectComponent = /** @class */ (function () {
    function FormularSelectComponent(restfulService, cacheService, msgService, entityDataService, localizeService) {
        var _this = this;
        this.restfulService = restfulService;
        this.cacheService = cacheService;
        this.msgService = msgService;
        this.entityDataService = entityDataService;
        this.localizeService = localizeService;
        this.data = [];
        this.changeStep = new EventEmitter();
        this.formularWizard = '0'; // 公式向导类型 0公式选择 1公式新增
        // 公式向导类型 0公式选择 1公式新增
        this.ddlFormularData = []; // 下拉公示信息
        // 下拉公示信息
        this.formularDatas = []; // 所有的公式信息
        // 所有的公式信息
        this.currentFormularId = ''; // 当前选中的公式Id
        // 当前选中的公式Id
        this.currentFormularName = ''; // 当前选中的公式名称
        /**
         * 点击下一步前汇总数据
         */
        this.clickNextStep = (/**
         * @return {?}
         */
        function () {
            if (_this.formularWizard === '0' && _this.currentFormularId) {
                /** @type {?} */
                var formularData = _this.formularDatas.find((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return x.id === _this.currentFormularId; }));
                if (formularData) {
                    _this.data.formularData = formularData;
                    _this.data.currentFormularName = formularData.name;
                }
                _this.data.ddlFormularData = _this.ddlFormularData;
                _this.entityDataService.setFormularState(true, { id: _this.currentFormularId, name: _this.data.currentFormularName ? _this.data.currentFormularName : '公式' });
            }
            else if (_this.formularWizard === '0' && !_this.currentFormularId) {
                _this.entityDataService.setFormularState(false, {});
                _this.msgService.info(_this.localizeService.getValue('formular.formularSelect.messageAlert.formularSelectVerify'));
                return false;
            }
            else {
                _this.entityDataService.setFormularState(false, {});
                _this.data.ddlFormularData = '';
                // this.data.formularSelectData = [];
            }
            _this.data.currentFormularId = _this.currentFormularId ? _this.currentFormularId : _this.data.currentFormularId;
            _this.data.formularWizard = _this.formularWizard;
            _this.cacheService.set('formularParam', _this.data);
            return true;
        });
        this.beforeFinish = (/**
         * @return {?}
         */
        function () {
            if (_this.formularWizard === '0' && _this.currentFormularId) {
                /** @type {?} */
                var name_1 = _this.ddlFormularData.find((/**
                 * @param {?} x
                 * @return {?}
                 */
                function (x) { return x.id === _this.currentFormularId; })).label;
                _this.entityDataService.setFormularState(true, { id: _this.currentFormularId, name: name_1 });
                // this.cacheService.set('formularResult', {id: this.currentFormularId, name: name});
                return true;
            }
            else if (_this.formularWizard === '0' && !_this.currentFormularId) {
                _this.entityDataService.setFormularState(false, {});
                _this.msgService.info(_this.localizeService.getValue('formular.formularSelect.messageAlert.formularSelectVerify'));
                return false;
            }
            else {
                _this.entityDataService.setFormularState(false, {});
                _this.msgService.info(_this.localizeService.getValue('formular.formularSelect.messageAlert.formularDefineVerify'));
                return false;
            }
        });
        this.selectionFormular = JSON.parse(this.localizeService.getValue('formular.formularSelect.selectionFormular'));
        this.lableQdpFormular = this.localizeService.getValue('formular.formularSelect.lableQdpFormular');
    }
    /**
     * @return {?}
     */
    FormularSelectComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        self.data = self.cacheService.get('formularParam');
        this.getFormularInfo(self);
        // if (self.data && self.data.ddlFormularData && self.data.ddlFormularData.length >0) {
        //   self.ddlFormularData = self.data.ddlFormularData;
        // } 
        if (self.data) {
            self.currentFormularId = self.data.currentFormularId ? self.data.currentFormularId : '';
            self.currentFormularName = self.data.currentFormularName ? self.data.currentFormularName : '';
            self.formularWizard = self.data.formularWizard ? self.data.formularWizard : '0';
        }
    };
    /**
     * @return {?}
     */
    FormularSelectComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @private
     * @param {?} self
     * @return {?}
     */
    FormularSelectComponent.prototype.getFormularInfo = /**
     * @private
     * @param {?} self
     * @return {?}
     */
    function (self) {
        this.createHeaderSessionId().then((/**
         * @param {?} value
         * @return {?}
         */
        function success(value) {
            /** @type {?} */
            var uri = self.data.serverHost;
            // tslint:disable-next-line: align
            /** @type {?} */
            var options = {
                headers: {
                    'SessionId': value,
                    'Content-Type': 'application/json'
                }
            };
            self.data.sessionId = value;
            /** @type {?} */
            var entityFilter = {
                FilterConditions: [{ 'FilterField': 'CurSU', 'Value': self.data.currentSU, 'Lbracket': null, 'Rbracket': null, 'Relation': 0, 'Expresstype': 0, 'Compare': 6 }],
                SortConditions: [],
                IsUsePagination: false,
                Pagination: {
                    PageIndex: 0,
                    PageSize: 0,
                    PageCount: 0,
                    TotalCount: 0
                }
            };
            uri += '/api/gsp/bcc/v1.0/querygetdatadefine_frm/extension/query?entityFilter=' + JSON.stringify(entityFilter);
            /** @type {?} */
            var ddlFormularData = [];
            self.restfulService.put(uri, {}, {}, options).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                /** @type {?} */
                var funcDatas = data.returnValue.result;
                if (funcDatas && funcDatas.length > 0) {
                    funcDatas.forEach((/**
                     * @param {?} x
                     * @return {?}
                     */
                    function (x) {
                        ddlFormularData.push({ label: x.name, id: x.id });
                    }));
                    self.ddlFormularData = tslib_1.__spread(ddlFormularData);
                }
                self.formularDatas = funcDatas;
            }));
        }));
    };
    /**
     * @private
     * @return {?}
     */
    FormularSelectComponent.prototype.createHeaderSessionId = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var options = {
            headers: {
                'Content-Type': 'application/json'
            },
            responseType: 'text'
        };
        /** @type {?} */
        var createSessionUrl = this.data.serverHost + '/api/gsp/bcc/v1.0/queryfuncdetail_frm/service/createsession';
        return this.restfulService.post(createSessionUrl, {}, {}, options).toPromise();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FormularSelectComponent.prototype.changeValue = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.entityDataService.setStepType($event);
        if ($event !== '0') {
            this.data.currentFormularId = '';
            this.currentFormularId = '';
            this.data.formularData = '';
            this.entityDataService.setFormularState(false, {});
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FormularSelectComponent.prototype.selectChange = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if ($event) {
            this.entityDataService.setFormularState(true, { id: this.currentFormularId, name: $event.data.label });
        }
        else {
            this.entityDataService.setFormularState(false, {});
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    FormularSelectComponent.prototype.clear = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.entityDataService.setFormularState(false, {});
    };
    FormularSelectComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-formular-select',
                    template: "<div>\r\n  <farris-radiogroup #FarrisRadioGroupComponent [(ngModel)]=\"formularWizard\" [horizontal]=\"true\"\r\n    (changeValue)=\"changeValue($event)\" [data]=\"selectionFormular\">\r\n\r\n  </farris-radiogroup>\r\n</div>\r\n<div *ngIf=\"formularWizard === '0'\">\r\n  <label class=\"col-form-label\" for=\"colFunction\" style=\"width: 6rem; min-width: 6rem;\">\r\n    <span class=\"farris-label-text\">{{lableQdpFormular}}:</span>\r\n  </label>\r\n  <div class=\"farris-input-wrap\">\r\n    <!-- <farris-combo-lookup [(ngModel)]=\"currentFormularId\" [idField]=\"'id'\" [textField]=\"'name'\"\r\n      [displayType]=\"'LOOKUPLIST'\" [multiSelect]=\"false\" [data]=\"ddlFormularData\"></farris-combo-lookup> -->\r\n    <farris-combo-list [(ngModel)]=\"currentFormularId\" (selectChange)=\"selectChange($event)\" (clear)=\"clear($event)\"\r\n      [idField]=\"'id'\" [textField]=\"'label'\" [data]=\"ddlFormularData\"></farris-combo-list>\r\n  </div>\r\n</div>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    FormularSelectComponent.ctorParameters = function () { return [
        { type: RestfulService },
        { type: CacheService },
        { type: MessagerService },
        { type: EntityDataService },
        { type: LocalizeService }
    ]; };
    FormularSelectComponent.propDecorators = {
        changeStep: [{ type: Output }]
    };
    return FormularSelectComponent;
}());
export { FormularSelectComponent };
if (false) {
    /** @type {?} */
    FormularSelectComponent.prototype.data;
    /** @type {?} */
    FormularSelectComponent.prototype.changeStep;
    /** @type {?} */
    FormularSelectComponent.prototype.formularWizard;
    /** @type {?} */
    FormularSelectComponent.prototype.ddlFormularData;
    /** @type {?} */
    FormularSelectComponent.prototype.formularDatas;
    /** @type {?} */
    FormularSelectComponent.prototype.currentFormularId;
    /** @type {?} */
    FormularSelectComponent.prototype.currentFormularName;
    /** @type {?} */
    FormularSelectComponent.prototype.selectionFormular;
    /** @type {?} */
    FormularSelectComponent.prototype.lableQdpFormular;
    /**
     * 点击下一步前汇总数据
     * @type {?}
     */
    FormularSelectComponent.prototype.clickNextStep;
    /** @type {?} */
    FormularSelectComponent.prototype.beforeFinish;
    /**
     * @type {?}
     * @private
     */
    FormularSelectComponent.prototype.restfulService;
    /**
     * @type {?}
     * @private
     */
    FormularSelectComponent.prototype.cacheService;
    /**
     * @type {?}
     * @private
     */
    FormularSelectComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    FormularSelectComponent.prototype.entityDataService;
    /**
     * @type {?}
     * @private
     */
    FormularSelectComponent.prototype.localizeService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybXVsYXItc2VsZWN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvZm9ybXVsYXIvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50L2Zvcm11bGFyLXNlbGVjdC9mb3JtdWxhci1zZWxlY3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQWlCLE1BQU0sRUFBRSxZQUFZLEVBQXlDLE1BQU0sZUFBZSxDQUFDO0FBRXRILE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQWtCLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUUvRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNyRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWhEO0lBU0UsaUNBQW9CLGNBQThCLEVBQ3RDLFlBQTBCLEVBQzFCLFVBQTJCLEVBQzNCLGlCQUFvQyxFQUNwQyxlQUFnQztRQUo1QyxpQkFPSTtRQVBnQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDdEMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFDM0Isc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFONUMsU0FBSSxHQUFRLEVBQUUsQ0FBQztRQUNMLGVBQVUsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBUy9DLG1CQUFjLEdBQVEsR0FBRyxDQUFDLENBQUMscUJBQXFCOztRQUNoRCxvQkFBZSxHQUFRLEVBQUUsQ0FBQyxDQUFDLFNBQVM7O1FBQ3BDLGtCQUFhLEdBQVEsRUFBRSxDQUFDLENBQUMsVUFBVTs7UUFDbkMsc0JBQWlCLEdBQVEsRUFBRSxDQUFDLENB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OztJQUVsQyx1Q0FBZTs7SUFDZiw2Q0FBK0M7O0lBUy9DLGlEQUEwQjs7SUFDMUIsa0RBQTBCOztJQUMxQixnREFBd0I7O0lBQ3hCLG9EQUE0Qjs7SUFDNUIsc0RBQThCOztJQUU5QixvREFBd0I7O0lBQ3hCLG1EQUFzQjs7Ozs7SUE0RnRCLGdEQXNCQzs7SUFFRCwrQ0FlQzs7Ozs7SUFsSlcsaURBQXNDOzs7OztJQUM5QywrQ0FBa0M7Ozs7O0lBQ2xDLDZDQUFtQzs7Ozs7SUFDbkMsb0RBQTRDOzs7OztJQUM1QyxrREFBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBBZnRlclZpZXdJbml0LCBWaWV3Q2hpbGQsIFRlbXBsYXRlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGlhbG9nJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UsIE5vdGlmeU9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IFNlc3Npb25TZXJ2aWNlLCBDYWNoZVNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgUmVzdGZ1bFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3Jlc3RmdWwuc2VydmljZSc7XHJcbmltcG9ydCB7IG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEVudGl0eURhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9lbnRpdHlkYXRhLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMb2NhbGl6ZVNlcnZpY2UgfSBmcm9tICdAcWRwL2xvY2FsaXplJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnbGliLWZvcm11bGFyLXNlbGVjdCcsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2Zvcm11bGFyLXNlbGVjdC5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vZm9ybXVsYXItc2VsZWN0LmNvbXBvbmVudC5jc3MnXSxcclxufSlcclxuZXhwb3J0IGNsYXNzIEZvcm11bGFyU2VsZWN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcclxuXHJcbiAgZGF0YTogYW55ID0gW107XHJcbiAgQE91dHB1dCgpIGNoYW5nZVN0ZXAgPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlc3RmdWxTZXJ2aWNlOiBSZXN0ZnVsU2VydmljZVxyXG4gICAgLCBwcml2YXRlIGNhY2hlU2VydmljZTogQ2FjaGVTZXJ2aWNlXHJcbiAgICAsIHByaXZhdGUgbXNnU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlXHJcbiAgICAsIHByaXZhdGUgZW50aXR5RGF0YVNlcnZpY2U6IEVudGl0eURhdGFTZXJ2aWNlXHJcbiAgICAsIHByaXZhdGUgbG9jYWxpemVTZXJ2aWNlOiBMb2NhbGl6ZVNlcnZpY2UpIHtcclxuICAgICAgdGhpcy5zZWxlY3Rpb25Gb3JtdWxhciA9IEpTT04ucGFyc2UodGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2Zvcm11bGFyLmZvcm11bGFyU2VsZWN0LnNlbGVjdGlvbkZvcm11bGFyJykpO1xyXG4gICAgICB0aGlzLmxhYmxlUWRwRm9ybXVsYXIgPSB0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnZm9ybXVsYXIuZm9ybXVsYXJTZWxlY3QubGFibGVRZHBGb3JtdWxhcicpO1xyXG4gICAgIH1cclxuICBmb3JtdWxhcldpemFyZDogYW55ID0gJzAnOyAvLyDlhazlvI/lkJHlr7znsbvlnosgMOWFrOW8j+mAieaLqSAx5YWs5byP5paw5aKeXHJcbiAgZGRsRm9ybXVsYXJEYXRhOiBhbnkgPSBbXTsgLy8g5LiL5ouJ5YWs56S65L+h5oGvXHJcbiAgZm9ybXVsYXJEYXRhczogYW55ID0gW107IC8vIOaJgOacieeahOWFrOW8j+S/oeaBr1xyXG4gIGN1cnJlbnRGb3JtdWxhcklkOiBhbnkgPSAnJzsgLy8g5b2T5YmN6YCJ5Lit55qE5YWs5byPSWRcclxuICBjdXJyZW50Rm9ybXVsYXJOYW1lOiBhbnkgPSAnJzsgLy8g5b2T5YmN6YCJ5Lit55qE5YWs5byP5ZCN56ewXHJcblxyXG4gIHNlbGVjdGlvbkZvcm11bGFyOiBhbnkgO1xyXG4gIGxhYmxlUWRwRm9ybXVsYXI6IGFueTtcclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIHNlbGYuZGF0YSA9IHNlbGYuY2FjaGVTZXJ2aWNlLmdldCgnZm9ybXVsYXJQYXJhbScpO1xyXG4gICAgdGhpcy5nZXRGb3JtdWxhckluZm8oc2VsZik7XHJcbiAgICAvLyBpZiAoc2VsZi5kYXRhICYmIHNlbGYuZGF0YS5kZGxGb3JtdWxhckRhdGEgJiYgc2VsZi5kYXRhLmRkbEZvcm11bGFyRGF0YS5sZW5ndGggPjApIHtcclxuICAgIC8vICAgc2VsZi5kZGxGb3JtdWxhckRhdGEgPSBzZWxmLmRhdGEuZGRsRm9ybXVsYXJEYXRhO1xyXG4gICAgLy8gfSBcclxuICAgIGlmIChzZWxmLmRhdGEpIHtcclxuICAgICAgc2VsZi5jdXJyZW50Rm9ybXVsYXJJZCA9IHNlbGYuZGF0YS5jdXJyZW50Rm9ybXVsYXJJZCA/IHNlbGYuZGF0YS5jdXJyZW50Rm9ybXVsYXJJZCA6ICcnO1xyXG4gICAgICBzZWxmLmN1cnJlbnRGb3JtdWxhck5hbWUgPSBzZWxmLmRhdGEuY3VycmVudEZvcm11bGFyTmFtZSA/IHNlbGYuZGF0YS5jdXJyZW50Rm9ybXVsYXJOYW1lIDogJyc7XHJcbiAgICAgIHNlbGYuZm9ybXVsYXJXaXphcmQgPSBzZWxmLmRhdGEuZm9ybXVsYXJXaXphcmQgPyBzZWxmLmRhdGEuZm9ybXVsYXJXaXphcmQgOiAnMCc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEZvcm11bGFySW5mbyhzZWxmOiB0aGlzKSB7XHJcbiAgICB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpLnRoZW4oZnVuY3Rpb24gc3VjY2Vzcyh2YWx1ZSkge1xyXG4gICAgICBsZXQgdXJpID0gc2VsZi5kYXRhLnNlcnZlckhvc3Q7XHJcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogYWxpZ25cclxuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAnU2Vzc2lvbklkJzogdmFsdWUsXHJcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICBzZWxmLmRhdGEuc2Vzc2lvbklkID0gdmFsdWU7XHJcbiAgICAgIGNvbnN0IGVudGl0eUZpbHRlciA9IHtcclxuICAgICAgICBGaWx0ZXJDb25kaXRpb25zOiBbeyAnRmlsdGVyRmllbGQnOiAnQ3VyU1UnLCAnVmFsdWUnOiBzZWxmLmRhdGEuY3VycmVudFNVLCAnTGJyYWNrZXQnOiBudWxsLCAnUmJyYWNrZXQnOiBudWxsLCAnUmVsYXRpb24nOiAwLCAnRXhwcmVzc3R5cGUnOiAwLCAnQ29tcGFyZSc6IDYgfV0sXHJcbiAgICAgICAgU29ydENvbmRpdGlvbnM6IFtdLFxyXG4gICAgICAgIElzVXNlUGFnaW5hdGlvbjogZmFsc2UsXHJcbiAgICAgICAgUGFnaW5hdGlvbjoge1xyXG4gICAgICAgICAgUGFnZUluZGV4OiAwLFxyXG4gICAgICAgICAgUGFnZVNpemU6IDAsXHJcbiAgICAgICAgICBQYWdlQ291bnQ6IDAsXHJcbiAgICAgICAgICBUb3RhbENvdW50OiAwXHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICB1cmkgKz0gJy9hcGkvZ3NwL2JjYy92MS4wL3F1ZXJ5Z2V0ZGF0YWRlZmluZV9mcm0vZXh0ZW5zaW9uL3F1ZXJ5P2VudGl0eUZpbHRlcj0nICsgSlNPTi5zdHJpbmdpZnkoZW50aXR5RmlsdGVyKTtcclxuICAgICAgY29uc3QgZGRsRm9ybXVsYXJEYXRhID0gW107XHJcbiAgICAgIHNlbGYucmVzdGZ1bFNlcnZpY2UucHV0KHVyaSwge30sIHt9LCBvcHRpb25zKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgY29uc3QgZnVuY0RhdGFzID0gZGF0YS5yZXR1cm5WYWx1ZS5yZXN1bHQ7XHJcbiAgICAgICAgaWYgKGZ1bmNEYXRhcyAmJiBmdW5jRGF0YXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgZnVuY0RhdGFzLmZvckVhY2goeCA9PiB7XHJcbiAgICAgICAgICAgIGRkbEZvcm11bGFyRGF0YS5wdXNoKHsgbGFiZWw6IHgubmFtZSwgaWQ6IHguaWQgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHNlbGYuZGRsRm9ybXVsYXJEYXRhID0gWy4uLmRkbEZvcm11bGFyRGF0YV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlbGYuZm9ybXVsYXJEYXRhcyA9IGZ1bmNEYXRhcztcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkge1xyXG4gICAgY29uc3Qgb3B0aW9uczogYW55ID0ge1xyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICB9LFxyXG4gICAgICByZXNwb25zZVR5cGU6ICd0ZXh0J1xyXG4gICAgfTtcclxuICAgIGNvbnN0IGNyZWF0ZVNlc3Npb25VcmwgPSB0aGlzLmRhdGEuc2VydmVySG9zdCArICcvYXBpL2dzcC9iY2MvdjEuMC9xdWVyeWZ1bmNkZXRhaWxfZnJtL3NlcnZpY2UvY3JlYXRlc2Vzc2lvbic7XHJcbiAgICByZXR1cm4gdGhpcy5yZXN0ZnVsU2VydmljZS5wb3N0KGNyZWF0ZVNlc3Npb25VcmwsIHt9LCB7fSwgb3B0aW9ucykudG9Qcm9taXNlKCk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VWYWx1ZSgkZXZlbnQpIHtcclxuICAgIHRoaXMuZW50aXR5RGF0YVNlcnZpY2Uuc2V0U3RlcFR5cGUoJGV2ZW50KTtcclxuICAgIGlmICgkZXZlbnQgIT09ICcwJykge1xyXG4gICAgICB0aGlzLmRhdGEuY3VycmVudEZvcm11bGFySWQgPSAnJztcclxuICAgICAgdGhpcy5jdXJyZW50Rm9ybXVsYXJJZCA9ICcnO1xyXG4gICAgICB0aGlzLmRhdGEuZm9ybXVsYXJEYXRhID0gJyc7XHJcbiAgICAgIHRoaXMuZW50aXR5RGF0YVNlcnZpY2Uuc2V0Rm9ybXVsYXJTdGF0ZShmYWxzZSwge30pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2VsZWN0Q2hhbmdlKCRldmVudCkge1xyXG4gICAgaWYgKCRldmVudCkge1xyXG4gICAgICB0aGlzLmVudGl0eURhdGFTZXJ2aWNlLnNldEZvcm11bGFyU3RhdGUodHJ1ZSwgeyBpZDogdGhpcy5jdXJyZW50Rm9ybXVsYXJJZCwgbmFtZTogJGV2ZW50LmRhdGEubGFiZWwgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmVudGl0eURhdGFTZXJ2aWNlLnNldEZvcm11bGFyU3RhdGUoZmFsc2UsIHt9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsZWFyKCRldmVudCl7XHJcbiAgICB0aGlzLmVudGl0eURhdGFTZXJ2aWNlLnNldEZvcm11bGFyU3RhdGUoZmFsc2UsIHt9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOeCueWHu+S4i+S4gOatpeWJjeaxh+aAu+aVsOaNrlxyXG4gICAqL1xyXG4gIGNsaWNrTmV4dFN0ZXAgPSAoKSA9PiB7XHJcbiAgICBpZiAodGhpcy5mb3JtdWxhcldpemFyZCA9PT0gJzAnICYmIHRoaXMuY3VycmVudEZvcm11bGFySWQpIHtcclxuICAgICAgY29uc3QgZm9ybXVsYXJEYXRhID0gdGhpcy5mb3JtdWxhckRhdGFzLmZpbmQoeCA9PiB4LmlkID09PSB0aGlzLmN1cnJlbnRGb3JtdWxhcklkKTtcclxuICAgICAgaWYgKGZvcm11bGFyRGF0YSkge1xyXG4gICAgICAgIHRoaXMuZGF0YS5mb3JtdWxhckRhdGEgPSBmb3JtdWxhckRhdGE7XHJcbiAgICAgICAgdGhpcy5kYXRhLmN1cnJlbnRGb3JtdWxhck5hbWUgPSBmb3JtdWxhckRhdGEubmFtZTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmRhdGEuZGRsRm9ybXVsYXJEYXRhID0gdGhpcy5kZGxGb3JtdWxhckRhdGE7XHJcbiAgICAgIHRoaXMuZW50aXR5RGF0YVNlcnZpY2Uuc2V0Rm9ybXVsYXJTdGF0ZSh0cnVlLCB7IGlkOiB0aGlzLmN1cnJlbnRGb3JtdWxhcklkLCBuYW1lOiB0aGlzLmRhdGEuY3VycmVudEZvcm11bGFyTmFtZSA/IHRoaXMuZGF0YS5jdXJyZW50Rm9ybXVsYXJOYW1lIDogJ+WFrOW8jycgfSk7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuZm9ybXVsYXJXaXphcmQgPT09ICcwJyAmJiAhdGhpcy5jdXJyZW50Rm9ybXVsYXJJZCkge1xyXG4gICAgICB0aGlzLmVudGl0eURhdGFTZXJ2aWNlLnNldEZvcm11bGFyU3RhdGUoZmFsc2UsIHt9KTtcclxuICAgICAgdGhpcy5tc2dTZXJ2aWNlLmluZm8odGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2Zvcm11bGFyLmZvcm11bGFyU2VsZWN0Lm1lc3NhZ2VBbGVydC5mb3JtdWxhclNlbGVjdFZlcmlmeScpKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5lbnRpdHlEYXRhU2VydmljZS5zZXRGb3JtdWxhclN0YXRlKGZhbHNlLCB7fSk7XHJcbiAgICAgIHRoaXMuZGF0YS5kZGxGb3JtdWxhckRhdGEgPSAnJztcclxuICAgICAgLy8gdGhpcy5kYXRhLmZvcm11bGFyU2VsZWN0RGF0YSA9IFtdO1xyXG4gICAgfVxyXG4gICAgdGhpcy5kYXRhLmN1cnJlbnRGb3JtdWxhcklkID0gdGhpcy5jdXJyZW50Rm9ybXVsYXJJZCA/IHRoaXMuY3VycmVudEZvcm11bGFySWQgOiB0aGlzLmRhdGEuY3VycmVudEZvcm11bGFySWQ7XHJcbiAgICB0aGlzLmRhdGEuZm9ybXVsYXJXaXphcmQgPSB0aGlzLmZvcm11bGFyV2l6YXJkO1xyXG4gICAgdGhpcy5jYWNoZVNlcnZpY2Uuc2V0KCdmb3JtdWxhclBhcmFtJywgdGhpcy5kYXRhKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgYmVmb3JlRmluaXNoID0gKCkgPT4ge1xyXG4gICAgaWYgKHRoaXMuZm9ybXVsYXJXaXphcmQgPT09ICcwJyAmJiB0aGlzLmN1cnJlbnRGb3JtdWxhcklkKSB7XHJcbiAgICAgIGNvbnN0IG5hbWUgPSB0aGlzLmRkbEZvcm11bGFyRGF0YS5maW5kKHggPT4geC5pZCA9PT0gdGhpcy5jdXJyZW50Rm9ybXVsYXJJZCkubGFiZWw7XHJcbiAgICAgIHRoaXMuZW50aXR5RGF0YVNlcnZpY2Uuc2V0Rm9ybXVsYXJTdGF0ZSh0cnVlLCB7IGlkOiB0aGlzLmN1cnJlbnRGb3JtdWxhcklkLCBuYW1lOiBuYW1lIH0pO1xyXG4gICAgICAvLyB0aGlzLmNhY2hlU2VydmljZS5zZXQoJ2Zvcm11bGFyUmVzdWx0Jywge2lkOiB0aGlzLmN1cnJlbnRGb3JtdWxhcklkLCBuYW1lOiBuYW1lfSk7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmZvcm11bGFyV2l6YXJkID09PSAnMCcgJiYgIXRoaXMuY3VycmVudEZvcm11bGFySWQpIHtcclxuICAgICAgdGhpcy5lbnRpdHlEYXRhU2VydmljZS5zZXRGb3JtdWxhclN0YXRlKGZhbHNlLCB7fSk7XHJcbiAgICAgIHRoaXMubXNnU2VydmljZS5pbmZvKHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdmb3JtdWxhci5mb3JtdWxhclNlbGVjdC5tZXNzYWdlQWxlcnQuZm9ybXVsYXJTZWxlY3RWZXJpZnknKSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZW50aXR5RGF0YVNlcnZpY2Uuc2V0Rm9ybXVsYXJTdGF0ZShmYWxzZSwge30pO1xyXG4gICAgICB0aGlzLm1zZ1NlcnZpY2UuaW5mbyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnZm9ybXVsYXIuZm9ybXVsYXJTZWxlY3QubWVzc2FnZUFsZXJ0LmZvcm11bGFyRGVmaW5lVmVyaWZ5JykpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Directive, Input, Optional, Injector } from '@angular/core';
import { NgxEchartsDirective } from '../qdp-charts/qdp.charts.directive';
import { RestfulService, SchemaManagerService, DataRenderExtendService, Server_Host, EventBus, QDPCacheUtil } from '@qdp/common';
import { CacheService } from '@ecp-caf/caf-common';
import { of, Subject } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { SessionService } from '@ecp-caf/caf-common';
import { FilterManagerService, Load_Data_Uri, Load_Data_Col } from '@qdp/common';
import { RtfServices } from '@qdp/common';
import { map } from 'rxjs/operators';
export class LcpBindingDataDirective {
    /**
     * @param {?} serverHost
     * @param {?} restfulService
     * @param {?} sessionService
     * @param {?} cache
     * @param {?} schemaManager
     * @param {?} charts
     * @param {?} dataRenderExtendService
     * @param {?} filterService
     * @param {?} loadDataUri
     * @param {?} loadDataCol
     * @param {?} injector
     */
    constructor(serverHost, restfulService, sessionService, cache, schemaManager, charts, dataRenderExtendService, filterService, loadDataUri, loadDataCol, injector) {
        this.serverHost = serverHost;
        this.restfulService = restfulService;
        this.sessionService = sessionService;
        this.cache = cache;
        this.schemaManager = schemaManager;
        this.charts = charts;
        this.dataRenderExtendService = dataRenderExtendService;
        this.filterService = filterService;
        this.loadDataUri = loadDataUri;
        this.loadDataCol = loadDataCol;
        this.injector = injector;
        this.delay = 0;
        this.interval = 0;
        this.funcIds = [];
        this.pageInfoChange = new Subject();
    }
    /**
     * @private
     * @return {?}
     */
    bindCloseTabEvent() {
        try {
            /** @type {?} */
            const tab = gspframeworkService.rtf.session.getCommonVariable();
            gspframeworkService.rtf.frmEvent.eventListener('beforeFuncCloseEvent', this.clearParametersCache.bind(this), tab);
            this.funcIds.push(tab.tabId);
            return tab.tabId + RtfServices.getInSuiteFrmUUID();
        }
        catch (e) {
        }
    }
    /**
     * @private
     * @return {?}
     */
    clearParametersCache() {
        /** @type {?} */
        const tabId = arguments[0].tabId;
        this.cache.set(this.queryId, '');
        this.cache.set(arguments[0].tabId, '');
        this.cache.set(arguments[0].tabId + 'renderMode', '');
        /** @type {?} */
        const index = this.funcIds.findIndex((/**
         * @param {?} el
         * @return {?}
         */
        el => el === tabId));
        if (index >= 0) {
            this.funcIds.splice(index, 1);
            gspframeworkService.rtf.func.close(arguments[0]);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.tabId = RtfServices.getTabId(this.queryId);
        QDPCacheUtil.setCache(this.tabId + this.queryId + 'lcp-charts', this);
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        for (const changeName in changes) {
            /** @type {?} */
            const newValue = changes[changeName].currentValue;
            if (newValue !== null && newValue !== void 0) {
                /** @type {?} */
                const eventId = RtfServices.getTabId(this.queryId);
                switch (changeName) {
                    case 'queryId':
                        this.queryId = newValue;
                        QDPCacheUtil.setCache(eventId + this.queryId + 'lcp-charts', this);
                        break;
                    case 'eventType':
                        if (newValue) {
                            EventBus.register(newValue, this.handleLinkage, eventId);
                        }
                        break;
                }
            }
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        // if (this.qoId) { // 查询结果集过滤条件
        this.filterService.getFilter(this.qoManagerCode, this.queryId, this.queryRelativeUrl, 1).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        data => {
            if (data) {
                /** @type {?} */
                const conditionExpression = JSON.stringify(data.filter);
                this.render('', '', '', conditionExpression);
            }
            else {
                this.render('');
            }
        }));
        // } else {
        //   this.render('');
        // }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    handleLinkage($event) {
        try {
            /** @type {?} */
            const params = JSON.stringify($event);
            this.delayLoad('', {}, params, this.queryRelativeUrl);
        }
        catch (e) {
        }
    }
    /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    delayLoad(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression) {
        if (!this.delay) {
            this.delay = 0;
        }
        if (this.delay === 0) {
            this.bindData(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
            this.intervalLoad(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
        }
        else {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.bindData(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
                this.intervalLoad(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
            }), this.delay);
        }
    }
    /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    intervalLoad(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression) {
        if (this.interval) {
            this.myVar = setInterval((/**
             * @return {?}
             */
            () => {
                this.bindData(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
            }), this.interval);
        }
    }
    /**
     * @return {?}
     */
    clearIntervalLoad() {
        if (this.myVar) {
            clearInterval(this.myVar);
        }
    }
    /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} conditionExpression
     * @return {?}
     */
    render(schemaId, option, linkageParams, conditionExpression) {
        this.delayLoad(schemaId, option, linkageParams, this.queryRelativeUrl, conditionExpression);
    }
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    getData(params, queryRelativeUrl) {
        /** @type {?} */
        const self = this;
        /** @type {?} */
        let uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += (!queryRelativeUrl || queryRelativeUrl === '') ? '/api/runtime/bcc/v1.0/qdpsearch/query' : (queryRelativeUrl + 'querydata');
        }
        /** @type {?} */
        const result$ = !queryRelativeUrl ? this.restfulService.post(uri, queryRelativeUrl ? { 'Param': params } : params, {}, this.createHeaderSessionId())
            : this.restfulService.put(uri, queryRelativeUrl ? { 'Param': params } : params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data) {
                data = (!queryRelativeUrl || queryRelativeUrl === '') ? data : data.returnValue;
                if (data && data.pageInfo) {
                    self.pageInfoChange.next(data.pageInfo);
                }
            }
            return data;
        })));
    }
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    getCol(params, queryRelativeUrl) {
        /** @type {?} */
        let uri = this.serverHost;
        if (this.loadDataCol) {
            uri += this.loadDataCol;
        }
        else {
            uri += ((!queryRelativeUrl || queryRelativeUrl === '') ? '/api/runtime/bcc/v1.0/qdpsearch/' : queryRelativeUrl) + 'querycol';
        }
        params = (!queryRelativeUrl || queryRelativeUrl === '') ? params : { 'Param': params };
        /** @type {?} */
        const result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, this.createHeaderSessionId())
            : this.restfulService.put(uri, params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data) {
                data = (!queryRelativeUrl || queryRelativeUrl === '') ? data : data.returnValue;
            }
            return data;
        })));
    }
    /**
     * @private
     * @param {?} queryId
     * @param {?} controlType
     * @param {?} schemaId
     * @param {?} qoManagerCode
     * @param {?} extendCond
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?=} printIntegration
     * @param {?=} excelExportName
     * @param {?=} voId
     * @return {?}
     */
    createParameters(queryId, controlType, schemaId, qoManagerCode, extendCond, pageIndex, pageSize, printIntegration, excelExportName, voId) {
        /** @type {?} */
        let entityData;
        /** @type {?} */
        const tabId = this.bindCloseTabEvent();
        if (this.cache.get(tabId)) {
            entityData = JSON.stringify(this.cache.get(tabId));
        }
        else if (this.cache.get(queryId)) {
            entityData = JSON.stringify(this.cache.get(queryId));
        }
        else {
            entityData = JSON.stringify({ 'id': 'undefined_null' });
        }
        /** @type {?} */
        const params = {
            entityData: entityData,
            extendCond: extendCond,
            pageIndex: pageIndex,
            pageSize: pageSize,
            schemaId: schemaId && schemaId !== 'prefab' ? schemaId : '1',
            filterCond: this.cache.get(tabId + 'filtercondition') ? this.cache.get(tabId + 'filtercondition') : '',
            qoManagerCode: qoManagerCode ? qoManagerCode : '',
            voCode: voId ? voId : ''
        };
        try {
            /** @type {?} */
            const parameterEntityData = JSON.parse(entityData);
            if (parameterEntityData.hasOwnProperty('@filterExpressionString@')) {
                /** @type {?} */
                const filterExpression = params && params.filterCond ? JSON.parse(params.filterCond) : null;
                if (!filterExpression) {
                    params.filterCond = parameterEntityData['@filterExpressionString@'];
                }
                else {
                    /** @type {?} */
                    const advanceFilterExpression = JSON.parse(parameterEntityData['@filterExpressionString@']);
                    advanceFilterExpression.expressItems = advanceFilterExpression.expressItems.concat(filterExpression.expressItems);
                    params.filterCond = JSON.stringify(advanceFilterExpression);
                }
            }
        }
        catch (e) {
        }
        if (controlType) {
            params['controlType'] = controlType;
        }
        if (excelExportName) {
            params['excelExportName'] = excelExportName;
        }
        if (printIntegration) {
            params['printIntegration'] = printIntegration ? JSON.stringify(printIntegration) : '';
        }
        return params;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    getSchemaInfo(obj) {
        /** @type {?} */
        const self = this;
        obj.schemaId = obj.schemaId === 'prefab' ? '1' : obj.schemaId;
        if (!obj.schemaId) {
            return self.getDefaultSchemaInfo(obj);
        }
        else {
            /** @type {?} */
            const organizationId = this.cache.get(RtfServices.getTabId(obj.queryId) + 'organizationId') || '';
            /** @type {?} */
            const result$ = this.schemaManager.getSchema(obj.schemaId, obj.queryId, obj.queryRelativeUrl, obj.groupType, organizationId);
            return result$.pipe(switchMap((/**
             * @param {?} schemaValue
             * @return {?}
             */
            (schemaValue) => {
                if (schemaValue && schemaValue['id']) {
                    return of(schemaValue);
                }
                //  else {
                //   return self.getDefaultSchemaInfo(obj);
                // }
            })));
        }
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    getDefaultSchemaInfo(obj) {
        /** @type {?} */
        const organizationId = this.cache.get(RtfServices.getTabId(obj.queryId) + 'organizationId') || '';
        return this.schemaManager.getDefaultSchema(obj.queryId, obj.queryRelativeUrl, obj.groupType, organizationId);
    }
    /**
     * @private
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    bindData(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression) {
        /** @type {?} */
        let op = option;
        this.getSchemaInfo({ schemaId: schemaId, queryId: this.charts.queryId, queryRelativeUrl }).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            /** @type {?} */
            let _schemaId = '';
            if (schemaId) {
                _schemaId = schemaId;
            }
            if (value && !_schemaId) {
                _schemaId = value.id;
                if (value.schemaValue.chartsType.series.type && value.schemaValue.chartsType.series.type !== -1) {
                    op = Object.assign({}, value.schemaValue.chartsData, value.schemaValue.chartsStyle);
                    value.schemaValue.chartsType.series.type = value.schemaValue.chartsType.series.type.replace('1', '');
                    op.series.type = value.schemaValue.chartsType.series.type;
                    if (op.series.type !== 'line1') {
                        delete op.series.areaStyle;
                    }
                    else {
                        op.series.areaStyle = {};
                    }
                }
            }
            if (value && value.schemaValue && value.schemaValue.customOption) {
                try {
                    op = Object.assign({}, op, JSON.parse(value.schemaValue.customOption));
                }
                catch (e) {
                    op = Object.assign({}, op, value.schemaValue.customOption);
                }
            }
            /** @type {?} */
            let entityData = '';
            if (this.cache.get(this.charts.queryId)) {
                entityData = JSON.stringify(this.cache.get(this.charts.queryId));
            }
            if (linkageParams) {
                entityData = linkageParams;
            }
            // TODO: mork
            /** @type {?} */
            const params = this.createParameters(this.queryId, 'charts', _schemaId, this.qoManagerCode, '', 0, 0, undefined, undefined, this.voId);
            params['queryId'] = this.queryId ? this.queryId : '';
            if (this.qoManagerCode) {
                params['qoManagerCode'] = this.qoManagerCode;
            }
            if (_schemaId && _schemaId !== 'prefab') {
                params['schemaId'] = _schemaId;
            }
            else {
                params['schemaId'] = '1';
            }
            // 查询数据前事件
            if (this.dataRenderExtendService && this.dataRenderExtendService.beforeQueryData) {
                this.dataRenderExtendService.beforeQueryData(this.createEventParams('beforeQueryData', '查询数据前', params, this.charts));
                try {
                    this.cache.set(this.tabId, JSON.parse(params['entityData']));
                }
                catch (e) { }
            }
            // 添加列
            /** @type {?} */
            const self = this;
            self.getData(params, queryRelativeUrl).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                self.getCol(params, queryRelativeUrl).subscribe((/**
                 * @param {?} resultData
                 * @return {?}
                 */
                resultData => {
                    if (!data.dynamicCols || data.dynamicCols.length === 0) {
                        data.dynamicCols = resultData.dynamicCols || [];
                    }
                    else {
                        resultData.dynamicCols.forEach((/**
                         * @param {?} col
                         * @return {?}
                         */
                        col => {
                            data.dynamicCols.push(col);
                        }));
                    }
                    if (data && data.dynamicCols && data.dynamicCols.length) {
                        /** @type {?} */
                        const joinParam = {};
                        joinParam['controlType'] = 'charts';
                        joinParam['colList'] = data.dynamicCols;
                        self.cache.set(self.tabId + 'joinSearch', joinParam);
                        self.schemaManager.colList.next(data.dynamicCols);
                    }
                    // 数据加载前事件
                    if (op && op.series && op.series.type) {
                        op.series.type = op.series.type.replace('1', '');
                    }
                    if (data && data.data && data.data.length) {
                        self.charts.setData(data.data, op);
                    }
                    else {
                        self.charts.setData([], op);
                    }
                    // 页面渲染后事件
                    if (self.dataRenderExtendService && self.dataRenderExtendService.afterLoadData) {
                        self.dataRenderExtendService.beforeLoadData(self.createEventParams('afterLoadData', '渲染后事件', data, self.charts));
                    }
                    self.cache.set(self.charts.queryId + 'echartsconfig', op);
                }));
            }));
        }));
    }
    /**
     * @private
     * @return {?}
     */
    createHeaderSessionId() {
        return RtfServices.createHeaderSessionId(this.sessionService);
    }
    /**
     * @private
     * @param {?} eventCode
     * @param {?} eventName
     * @param {?} data
     * @param {?} control
     * @return {?}
     */
    createEventParams(eventCode, eventName, data, control) {
        return {
            eventCode,
            eventName,
            data,
            control
        };
    }
}
LcpBindingDataDirective.decorators = [
    { type: Directive, args: [{
                // tslint:disable-next-line:directive-selector
                selector: 'lcpBindingData, [lcpBindingData]',
            },] }
];
/** @nocollapse */
LcpBindingDataDirective.ctorParameters = () => [
    { type: String, decorators: [{ type: Inject, args: [Server_Host,] }, { type: Optional }] },
    { type: RestfulService },
    { type: SessionService },
    { type: CacheService },
    { type: SchemaManagerService },
    { type: NgxEchartsDirective, decorators: [{ type: Optional }] },
    { type: DataRenderExtendService, decorators: [{ type: Optional }] },
    { type: FilterManagerService },
    { type: String, decorators: [{ type: Inject, args: [Load_Data_Uri,] }, { type: Optional }] },
    { type: String, decorators: [{ type: Inject, args: [Load_Data_Col,] }, { type: Optional }] },
    { type: Injector, decorators: [{ type: Optional }] }
];
LcpBindingDataDirective.propDecorators = {
    qoManagerCode: [{ type: Input }],
    delay: [{ type: Input }],
    interval: [{ type: Input }],
    eventType: [{ type: Input }],
    queryRelativeUrl: [{ type: Input }],
    queryId: [{ type: Input }],
    controlType: [{ type: Input }],
    qoId: [{ type: Input }],
    voId: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    LcpBindingDataDirective.prototype.qoManagerCode;
    /** @type {?} */
    LcpBindingDataDirective.prototype.delay;
    /** @type {?} */
    LcpBindingDataDirective.prototype.interval;
    /** @type {?} */
    LcpBindingDataDirective.prototype.eventType;
    /** @type {?} */
    LcpBindingDataDirective.prototype.queryRelativeUrl;
    /** @type {?} */
    LcpBindingDataDirective.prototype.queryId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.controlType;
    /** @type {?} */
    LcpBindingDataDirective.prototype.qoId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.voId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.funcIds;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.myVar;
    /** @type {?} */
    LcpBindingDataDirective.prototype.tabId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.pageInfoChange;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.serverHost;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.restfulService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.cache;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.schemaManager;
    /** @type {?} */
    LcpBindingDataDirective.prototype.charts;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.dataRenderExtendService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.loadDataUri;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.loadDataCol;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGNwLmJpbmRpbmdkYXRhLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvZWNoYXJ0cy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmUvYmluZGluZ2RhdGEvbGNwLmJpbmRpbmdkYXRhLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFFBQVEsRUFBMkMsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlILE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxjQUFjLEVBQUUsb0JBQW9CLEVBQUUsdUJBQXVCLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDakksT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25ELE9BQU8sRUFBYyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLGFBQWEsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDakYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUMxQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFRckMsTUFBTSxPQUFPLHVCQUF1Qjs7Ozs7Ozs7Ozs7Ozs7SUFnQmxDLFlBQzJDLFVBQWtCLEVBQ25ELGNBQThCLEVBQzlCLGNBQThCLEVBQzlCLEtBQW1CLEVBQ25CLGFBQW1DLEVBQ3hCLE1BQTJCLEVBQzFCLHVCQUFnRCxFQUM1RCxhQUFtQyxFQUNBLFdBQW1CLEVBQ25CLFdBQW1CLEVBQzFDLFFB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REFBNEI7O0lBQzVCLHdDQUFtQjs7SUFDbkIsMkNBQXNCOztJQUN0Qiw0Q0FBMkI7O0lBQzNCLG1EQUFrQzs7SUFDbEMsMENBQXlCOztJQUN6Qiw4Q0FBMEI7O0lBQzFCLHVDQUFtQjs7SUFDbkIsdUNBQW1COztJQUNuQiwwQ0FBYTs7Ozs7SUFDYix3Q0FBbUI7O0lBQ25CLHdDQUFXOztJQUVYLGlEQUFvQzs7Ozs7SUFHbEMsNkNBQTJEOzs7OztJQUMzRCxpREFBc0M7Ozs7O0lBQ3RDLGlEQUFzQzs7Ozs7SUFDdEMsd0NBQTJCOzs7OztJQUMzQixnREFBMkM7O0lBQzNDLHlDQUE4Qzs7Ozs7SUFDOUMsMERBQW9FOzs7OztJQUNwRSxnREFBMkM7Ozs7O0lBQzNDLDhDQUE4RDs7Ozs7SUFDOUQsOENBQThEOzs7OztJQUM5RCwyQ0FBc0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIERpcmVjdGl2ZSwgT25Jbml0LCBJbnB1dCwgT3B0aW9uYWwsIEFmdGVyVmlld0luaXQsIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcywgSW5qZWN0b3IgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTmd4RWNoYXJ0c0RpcmVjdGl2ZSB9IGZyb20gJy4uL3FkcC1jaGFydHMvcWRwLmNoYXJ0cy5kaXJlY3RpdmUnO1xyXG5pbXBvcnQgeyBSZXN0ZnVsU2VydmljZSwgU2NoZW1hTWFuYWdlclNlcnZpY2UsIERhdGFSZW5kZXJFeHRlbmRTZXJ2aWNlLCBTZXJ2ZXJfSG9zdCwgRXZlbnRCdXMsIFFEUENhY2hlVXRpbCB9IGZyb20gJ0BxZHAvY29tbW9uJztcclxuaW1wb3J0IHsgQ2FjaGVTZXJ2aWNlIH0gZnJvbSAnQGVjcC1jYWYvY2FmLWNvbW1vbic7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgRmlsdGVyTWFuYWdlclNlcnZpY2UsIExvYWRfRGF0YV9VcmksIExvYWRfRGF0YV9Db2wgfSBmcm9tICdAcWRwL2NvbW1vbic7XHJcbmltcG9ydCB7IFJ0ZlNlcnZpY2VzIH0gZnJvbSAnQHFkcC9jb21tb24nO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5kZWNsYXJlIHZhciBnc3BmcmFtZXdvcmtTZXJ2aWNlOiBhbnk7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXHJcbiAgc2VsZWN0b3I6ICdsY3BCaW5kaW5nRGF0YSwgW2xjcEJpbmRpbmdEYXRhXScsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBMY3BCaW5kaW5nRGF0YURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoKSBxb01hbmFnZXJDb2RlOiBhbnk7XHJcbiAgQElucHV0KCkgZGVsYXkgPSAwO1xyXG4gIEBJbnB1dCgpIGludGVydmFsID0gMDtcclxuICBASW5wdXQoKSBldmVudFR5cGU6IHN0cmluZztcclxuICBASW5wdXQoKSBxdWVyeVJlbGF0aXZlVXJsOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgcXVlcnlJZDogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIGNvbnRyb2xUeXBlOiBhbnk7XHJcbiAgQElucHV0KCkgcW9JZDogYW55O1xyXG4gIEBJbnB1dCgpIHZvSWQ6IGFueTtcclxuICBmdW5jSWRzID0gW107XHJcbiAgcHJpdmF0ZSBteVZhcjogYW55O1xyXG4gIHRhYklkOiBhbnk7XHJcblxyXG4gIHBhZ2VJbmZvQ2hhbmdlID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBJbmplY3QoU2VydmVyX0hvc3QpIEBPcHRpb25hbCgpIHByaXZhdGUgc2VydmVySG9zdDogc3RyaW5nLFxyXG4gICAgcHJpdmF0ZSByZXN0ZnVsU2VydmljZTogUmVzdGZ1bFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHNlc3Npb25TZXJ2aWNlOiBTZXNzaW9uU2VydmljZSxcclxuICAgIHByaXZhdGUgY2FjaGU6IENhY2hlU2VydmljZSxcclxuICAgIHByaXZhdGUgc2NoZW1hTWFuYWdlcjogU2NoZW1hTWFuYWdlclNlcnZpY2UsXHJcbiAgICBAT3B0aW9uYWwoKSBwdWJsaWMgY2hhcnRzOiBOZ3hFY2hhcnRzRGlyZWN0aXZlLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBkYXRhUmVuZGVyRXh0ZW5kU2VydmljZTogRGF0YVJlbmRlckV4dGVuZFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGZpbHRlclNlcnZpY2U6IEZpbHRlck1hbmFnZXJTZXJ2aWNlLFxyXG4gICAgQEluamVjdChMb2FkX0RhdGFfVXJpKSBAT3B0aW9uYWwoKSBwcml2YXRlIGxvYWREYXRhVXJpOiBzdHJpbmcsXHJcbiAgICBASW5qZWN0KExvYWRfRGF0YV9Db2wpIEBPcHRpb25hbCgpIHByaXZhdGUgbG9hZERhdGFDb2w6IHN0cmluZyxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yXHJcbiAgKSB7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJpbmRDbG9zZVRhYkV2ZW50KCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdGFiID0gZ3NwZnJhbWV3b3JrU2VydmljZS5ydGYuc2Vzc2lvbi5nZXRDb21tb25WYXJpYWJsZSgpO1xyXG4gICAgICBnc3BmcmFtZXdvcmtTZXJ2aWNlLnJ0Zi5mcm1FdmVudC5ldmVudExpc3RlbmVyKCdiZWZvcmVGdW5jQ2xvc2VFdmVudCcsIHRoaXMuY2xlYXJQYXJhbWV0ZXJzQ2FjaGUuYmluZCh0aGlzKSwgdGFiKTtcclxuICAgICAgdGhpcy5mdW5jSWRzLnB1c2godGFiLnRhYklkKTtcclxuICAgICAgcmV0dXJuIHRhYi50YWJJZCArIFJ0ZlNlcnZpY2VzLmdldEluU3VpdGVGcm1VVUlEKCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNsZWFyUGFyYW1ldGVyc0NhY2hlKCkge1xyXG4gICAgY29uc3QgdGFiSWQgPSBhcmd1bWVudHNbMF0udGFiSWQ7XHJcbiAgICB0aGlzLmNhY2hlLnNldCh0aGlzLnF1ZXJ5SWQsICcnKTtcclxuICAgIHRoaXMuY2FjaGUuc2V0KGFyZ3VtZW50c1swXS50YWJJZCwgJycpO1xyXG4gICAgdGhpcy5jYWNoZS5zZXQoYXJndW1lbnRzWzBdLnRhYklkICsgJ3JlbmRlck1vZGUnLCAnJyk7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuZnVuY0lkcy5maW5kSW5kZXgoZWwgPT4gZWwgPT09IHRhYklkKTtcclxuICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgIHRoaXMuZnVuY0lkcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICBnc3BmcmFtZXdvcmtTZXJ2aWNlLnJ0Zi5mdW5jLmNsb3NlKGFyZ3VtZW50c1swXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMudGFiSWQgPSBSdGZTZXJ2aWNlcy5nZXRUYWJJZCh0aGlzLnF1ZXJ5SWQpO1xyXG4gICAgUURQQ2FjaGVVdGlsLnNldENhY2hlKHRoaXMudGFiSWQgKyB0aGlzLnF1ZXJ5SWQgKyAnbGNwLWNoYXJ0cycsIHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgZm9yIChjb25zdCBjaGFuZ2VOYW1lIGluIGNoYW5nZXMpIHtcclxuICAgICAgY29uc3QgbmV3VmFsdWUgPSBjaGFuZ2VzW2NoYW5nZU5hbWVdLmN1cnJlbnRWYWx1ZTtcclxuICAgICAgaWYgKG5ld1ZhbHVlICE9PSBudWxsICYmIG5ld1ZhbHVlICE9PSB2b2lkIDApIHtcclxuICAgICAgICBjb25zdCBldmVudElkID0gUnRmU2VydmljZXMuZ2V0VGFiSWQodGhpcy5xdWVyeUlkKTtcclxuICAgICAgICBzd2l0Y2ggKGNoYW5nZU5hbWUpIHtcclxuICAgICAgICAgIGNhc2UgJ3F1ZXJ5SWQnOlxyXG4gICAgICAgICAgICB0aGlzLnF1ZXJ5SWQgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgUURQQ2FjaGVVdGlsLnNldENhY2hlKGV2ZW50SWQgKyB0aGlzLnF1ZXJ5SWQgKyAnbGNwLWNoYXJ0cycsIHRoaXMpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ2V2ZW50VHlwZSc6XHJcbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAgIEV2ZW50QnVzLnJlZ2lzdGVyKG5ld1ZhbHVlLCB0aGlzLmhhbmRsZUxpbmthZ2UsIGV2ZW50SWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCkge1xyXG4gICAgLy8gaWYgKHRoaXMucW9JZCkgeyAvLyDmn6Xor6Lnu5Pmnpzpm4bov4fmu6TmnaHku7ZcclxuICAgIHRoaXMuZmlsdGVyU2VydmljZS5nZXRGaWx0ZXIodGhpcy5xb01hbmFnZXJDb2RlLCB0aGlzLnF1ZXJ5SWQsIHRoaXMucXVlcnlSZWxhdGl2ZVVybCwgMSkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbkV4cHJlc3Npb24gPSBKU09OLnN0cmluZ2lmeShkYXRhLmZpbHRlcik7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIoJycsICcnLCAnJywgY29uZGl0aW9uRXhwcmVzc2lvbik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIoJycpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIH0gZWxzZSB7XHJcbiAgICAvLyAgIHRoaXMucmVuZGVyKCcnKTtcclxuICAgIC8vIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZUxpbmthZ2UoJGV2ZW50KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBwYXJhbXMgPSBKU09OLnN0cmluZ2lmeSgkZXZlbnQpO1xyXG4gICAgICB0aGlzLmRlbGF5TG9hZCgnJywge30sIHBhcmFtcywgdGhpcy5xdWVyeVJlbGF0aXZlVXJsKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGRlbGF5TG9hZChzY2hlbWFJZDogYW55LCBvcHRpb24/OiBhbnksIGxpbmthZ2VQYXJhbXM/OiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw/OiBhbnksIGNvbmRpdGlvbkV4cHJlc3Npb24/OiBhbnkpIHtcclxuICAgIGlmICghdGhpcy5kZWxheSkge1xyXG4gICAgICB0aGlzLmRlbGF5ID0gMDtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRlbGF5ID09PSAwKSB7XHJcbiAgICAgIHRoaXMuYmluZERhdGEoc2NoZW1hSWQsIG9wdGlvbiwgbGlua2FnZVBhcmFtcywgcXVlcnlSZWxhdGl2ZVVybCwgY29uZGl0aW9uRXhwcmVzc2lvbik7XHJcbiAgICAgIHRoaXMuaW50ZXJ2YWxMb2FkKHNjaGVtYUlkLCBvcHRpb24sIGxpbmthZ2VQYXJhbXMsIHF1ZXJ5UmVsYXRpdmVVcmwsIGNvbmRpdGlvbkV4cHJlc3Npb24pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5iaW5kRGF0YShzY2hlbWFJZCwgb3B0aW9uLCBsaW5rYWdlUGFyYW1zLCBxdWVyeVJlbGF0aXZlVXJsLCBjb25kaXRpb25FeHByZXNzaW9uKTtcclxuICAgICAgICB0aGlzLmludGVydmFsTG9hZChzY2hlbWFJZCwgb3B0aW9uLCBsaW5rYWdlUGFyYW1zLCBxdWVyeVJlbGF0aXZlVXJsLCBjb25kaXRpb25FeHByZXNzaW9uKTtcclxuICAgICAgfSwgdGhpcy5kZWxheSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpbnRlcnZhbExvYWQoc2NoZW1hSWQ6IGFueSwgb3B0aW9uPzogYW55LCBsaW5rYWdlUGFyYW1zPzogYW55LCBxdWVyeVJlbGF0aXZlVXJsPzogYW55LCBjb25kaXRpb25FeHByZXNzaW9uPzogYW55KSB7XHJcbiAgICBpZiAodGhpcy5pbnRlcnZhbCkge1xyXG4gICAgICB0aGlzLm15VmFyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuYmluZERhdGEoc2NoZW1hSWQsIG9wdGlvbiwgbGlua2FnZVBhcmFtcywgcXVlcnlSZWxhdGl2ZVVybCwgY29uZGl0aW9uRXhwcmVzc2lvbik7XHJcbiAgICAgIH0sIHRoaXMuaW50ZXJ2YWwpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xlYXJJbnRlcnZhbExvYWQoKSB7XHJcbiAgICBpZiAodGhpcy5teVZhcikge1xyXG4gICAgICBjbGVhckludGVydmFsKHRoaXMubXlWYXIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVuZGVyKHNjaGVtYUlkOiBhbnksIG9wdGlvbj86IGFueSwgbGlua2FnZVBhcmFtcz86IGFueSwgY29uZGl0aW9uRXhwcmVzc2lvbj86IGFueSkge1xyXG4gICAgdGhpcy5kZWxheUxvYWQoc2NoZW1hSWQsIG9wdGlvbiwgbGlua2FnZVBhcmFtcywgdGhpcy5xdWVyeVJlbGF0aXZlVXJsLCBjb25kaXRpb25FeHByZXNzaW9uKTtcclxuICB9XHJcblxyXG4gIGdldERhdGEocGFyYW1zOiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGxldCB1cmkgPSB0aGlzLnNlcnZlckhvc3Q7XHJcbiAgICBpZiAodGhpcy5sb2FkRGF0YVVyaSkge1xyXG4gICAgICB1cmkgKz0gdGhpcy5sb2FkRGF0YVVyaTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHVyaSArPSAoIXF1ZXJ5UmVsYXRpdmVVcmwgfHwgcXVlcnlSZWxhdGl2ZVVybCA9PT0gJycpID8gJy9hcGkvcnVudGltZS9iY2MvdjEuMC9xZHBzZWFyY2gvcXVlcnknIDogKHF1ZXJ5UmVsYXRpdmVVcmwgKyAncXVlcnlkYXRhJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzdWx0JCA9ICFxdWVyeVJlbGF0aXZlVXJsID8gdGhpcy5yZXN0ZnVsU2VydmljZS5wb3N0KHVyaSwgcXVlcnlSZWxhdGl2ZVVybCA/IHsgJ1BhcmFtJzogcGFyYW1zIH0gOiBwYXJhbXMsIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKVxyXG4gICAgICA6IHRoaXMucmVzdGZ1bFNlcnZpY2UucHV0KHVyaSwgcXVlcnlSZWxhdGl2ZVVybCA/IHsgJ1BhcmFtJzogcGFyYW1zIH0gOiBwYXJhbXMsIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgIGRhdGEgPSAoIXF1ZXJ5UmVsYXRpdmVVcmwgfHwgcXVlcnlSZWxhdGl2ZVVybCA9PT0gJycpID8gZGF0YSA6IGRhdGEucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnBhZ2VJbmZvKSB7XHJcbiAgICAgICAgICAgIHNlbGYucGFnZUluZm9DaGFuZ2UubmV4dChkYXRhLnBhZ2VJbmZvKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q29sKHBhcmFtczogYW55LCBxdWVyeVJlbGF0aXZlVXJsOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgbGV0IHVyaSA9IHRoaXMuc2VydmVySG9zdDtcclxuICAgIGlmICh0aGlzLmxvYWREYXRhQ29sKSB7XHJcbiAgICAgIHVyaSArPSB0aGlzLmxvYWREYXRhQ29sO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdXJpICs9ICgoIXF1ZXJ5UmVsYXRpdmVVcmwgfHwgcXVlcnlSZWxhdGl2ZVVybCA9PT0gJycpID8gJy9hcGkvcnVudGltZS9iY2MvdjEuMC9xZHBzZWFyY2gvJyA6IHF1ZXJ5UmVsYXRpdmVVcmwpICsgJ3F1ZXJ5Y29sJztcclxuICAgIH1cclxuICAgIHBhcmFtcyA9ICghcXVlcnlSZWxhdGl2ZVVybCB8fCBxdWVyeVJlbGF0aXZlVXJsID09PSAnJykgPyBwYXJhbXMgOiB7ICdQYXJhbSc6IHBhcmFtcyB9O1xyXG4gICAgY29uc3QgcmVzdWx0JCA9ICFxdWVyeVJlbGF0aXZlVXJsID8gdGhpcy5yZXN0ZnVsU2VydmljZS5wb3N0KHVyaSwgcGFyYW1zLCB7fSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSlcclxuICAgICAgOiB0aGlzLnJlc3RmdWxTZXJ2aWNlLnB1dCh1cmksIHBhcmFtcywge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgZGF0YSA9ICghcXVlcnlSZWxhdGl2ZVVybCB8fCBxdWVyeVJlbGF0aXZlVXJsID09PSAnJykgPyBkYXRhIDogZGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVQYXJhbWV0ZXJzKHF1ZXJ5SWQ6IGFueSwgY29udHJvbFR5cGU6IGFueSwgc2NoZW1hSWQ6IGFueSwgcW9NYW5hZ2VyQ29kZTogYW55LCBleHRlbmRDb25kOiBhbnksIHBhZ2VJbmRleDogYW55LCBwYWdlU2l6ZTogYW55LCBwcmludEludGVncmF0aW9uPzogYW55LCBleGNlbEV4cG9ydE5hbWU/OiBhbnksIHZvSWQ/OiBhbnkpIHtcclxuICAgIGxldCBlbnRpdHlEYXRhOiBhbnk7XHJcbiAgICBjb25zdCB0YWJJZCA9IHRoaXMuYmluZENsb3NlVGFiRXZlbnQoKTtcclxuICAgIGlmICh0aGlzLmNhY2hlLmdldCh0YWJJZCkpIHtcclxuICAgICAgZW50aXR5RGF0YSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuY2FjaGUuZ2V0KHRhYklkKSk7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuY2FjaGUuZ2V0KHF1ZXJ5SWQpKSB7XHJcbiAgICAgIGVudGl0eURhdGEgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmNhY2hlLmdldChxdWVyeUlkKSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBlbnRpdHlEYXRhID0gSlNPTi5zdHJpbmdpZnkoeyAnaWQnOiAndW5kZWZpbmVkX251bGwnIH0pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyYW1zID0ge1xyXG4gICAgICBlbnRpdHlEYXRhOiBlbnRpdHlEYXRhLFxyXG4gICAgICBleHRlbmRDb25kOiBleHRlbmRDb25kLFxyXG4gICAgICBwYWdlSW5kZXg6IHBhZ2VJbmRleCxcclxuICAgICAgcGFnZVNpemU6IHBhZ2VTaXplLFxyXG4gICAgICBzY2hlbWFJZDogc2NoZW1hSWQgJiYgc2NoZW1hSWQgIT09ICdwcmVmYWInID8gc2NoZW1hSWQgOiAnMScsXHJcbiAgICAgIGZpbHRlckNvbmQ6IHRoaXMuY2FjaGUuZ2V0KHRhYklkICsgJ2ZpbHRlcmNvbmRpdGlvbicpID8gdGhpcy5jYWNoZS5nZXQodGFiSWQgKyAnZmlsdGVyY29uZGl0aW9uJykgOiAnJyxcclxuICAgICAgcW9NYW5hZ2VyQ29kZTogcW9NYW5hZ2VyQ29kZSA/IHFvTWFuYWdlckNvZGUgOiAnJyxcclxuICAgICAgdm9Db2RlOiB2b0lkID8gdm9JZCA6ICcnXHJcbiAgICB9O1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcGFyYW1ldGVyRW50aXR5RGF0YSA9IEpTT04ucGFyc2UoZW50aXR5RGF0YSk7XHJcbiAgICAgIGlmIChwYXJhbWV0ZXJFbnRpdHlEYXRhLmhhc093blByb3BlcnR5KCdAZmlsdGVyRXhwcmVzc2lvblN0cmluZ0AnKSkge1xyXG5cclxuICAgICAgICBjb25zdCBmaWx0ZXJFeHByZXNzaW9uID0gcGFyYW1zICYmIHBhcmFtcy5maWx0ZXJDb25kID8gSlNPTi5wYXJzZShwYXJhbXMuZmlsdGVyQ29uZCkgOiBudWxsO1xyXG4gICAgICAgIGlmICghZmlsdGVyRXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgcGFyYW1zLmZpbHRlckNvbmQgPSBwYXJhbWV0ZXJFbnRpdHlEYXRhWydAZmlsdGVyRXhwcmVzc2lvblN0cmluZ0AnXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY29uc3QgYWR2YW5jZUZpbHRlckV4cHJlc3Npb24gPSBKU09OLnBhcnNlKHBhcmFtZXRlckVudGl0eURhdGFbJ0BmaWx0ZXJFeHByZXNzaW9uU3RyaW5nQCddKTtcclxuICAgICAgICAgIGFkdmFuY2VGaWx0ZXJFeHByZXNzaW9uLmV4cHJlc3NJdGVtcyA9IGFkdmFuY2VGaWx0ZXJFeHByZXNzaW9uLmV4cHJlc3NJdGVtcy5jb25jYXQoZmlsdGVyRXhwcmVzc2lvbi5leHByZXNzSXRlbXMpO1xyXG4gICAgICAgICAgcGFyYW1zLmZpbHRlckNvbmQgPSBKU09OLnN0cmluZ2lmeShhZHZhbmNlRmlsdGVyRXhwcmVzc2lvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICB9XHJcbiAgICBpZiAoY29udHJvbFR5cGUpIHtcclxuICAgICAgcGFyYW1zWydjb250cm9sVHlwZSddID0gY29udHJvbFR5cGU7XHJcbiAgICB9XHJcbiAgICBpZiAoZXhjZWxFeHBvcnROYW1lKSB7XHJcbiAgICAgIHBhcmFtc1snZXhjZWxFeHBvcnROYW1lJ10gPSBleGNlbEV4cG9ydE5hbWU7XHJcbiAgICB9XHJcbiAgICBpZiAocHJpbnRJbnRlZ3JhdGlvbikge1xyXG4gICAgICBwYXJhbXNbJ3ByaW50SW50ZWdyYXRpb24nXSA9IHByaW50SW50ZWdyYXRpb24gPyBKU09OLnN0cmluZ2lmeShwcmludEludGVncmF0aW9uKSA6ICcnO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwYXJhbXM7XHJcbiAgfVxyXG5cclxuICBnZXRTY2hlbWFJbmZvKG9iajogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgb2JqLnNjaGVtYUlkID0gb2JqLnNjaGVtYUlkID09PSAncHJlZmFiJyA/ICcxJyA6IG9iai5zY2hlbWFJZDtcclxuICAgIGlmICghb2JqLnNjaGVtYUlkKSB7XHJcbiAgICAgIHJldHVybiBzZWxmLmdldERlZmF1bHRTY2hlbWFJbmZvKG9iaik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9IHRoaXMuY2FjaGUuZ2V0KFJ0ZlNlcnZpY2VzLmdldFRhYklkKG9iai5xdWVyeUlkKSArICdvcmdhbml6YXRpb25JZCcpIHx8ICcnO1xyXG4gICAgICBjb25zdCByZXN1bHQkID0gdGhpcy5zY2hlbWFNYW5hZ2VyLmdldFNjaGVtYShvYmouc2NoZW1hSWQsIG9iai5xdWVyeUlkLCBvYmoucXVlcnlSZWxhdGl2ZVVybCwgb2JqLmdyb3VwVHlwZSwgb3JnYW5pemF0aW9uSWQpO1xyXG4gICAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICAgIHN3aXRjaE1hcCgoc2NoZW1hVmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgaWYgKHNjaGVtYVZhbHVlICYmIHNjaGVtYVZhbHVlWydpZCddKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBvZihzY2hlbWFWYWx1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyAgZWxzZSB7XHJcbiAgICAgICAgICAvLyAgIHJldHVybiBzZWxmLmdldERlZmF1bHRTY2hlbWFJbmZvKG9iaik7XHJcbiAgICAgICAgICAvLyB9XHJcbiAgICAgICAgfSlcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldERlZmF1bHRTY2hlbWFJbmZvKG9iajogYW55KSB7XHJcbiAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9IHRoaXMuY2FjaGUuZ2V0KFJ0ZlNlcnZpY2VzLmdldFRhYklkKG9iai5xdWVyeUlkKSArICdvcmdhbml6YXRpb25JZCcpIHx8ICcnO1xyXG4gICAgcmV0dXJuIHRoaXMuc2NoZW1hTWFuYWdlci5nZXREZWZhdWx0U2NoZW1hKG9iai5xdWVyeUlkLCBvYmoucXVlcnlSZWxhdGl2ZVVybCwgb2JqLmdyb3VwVHlwZSwgb3JnYW5pemF0aW9uSWQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBiaW5kRGF0YShzY2hlbWFJZDogYW55LCBvcHRpb24/OiBhbnksIGxpbmthZ2VQYXJhbXM/OiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw/OiBhbnksIGNvbmRpdGlvbkV4cHJlc3Npb24/OiBhbnkpIHtcclxuICAgIGxldCBvcCA9IG9wdGlvbjtcclxuICAgIHRoaXMuZ2V0U2NoZW1hSW5mbyh7IHNjaGVtYUlkOiBzY2hlbWFJZCwgcXVlcnlJZDogdGhpcy5jaGFydHMucXVlcnlJZCwgcXVlcnlSZWxhdGl2ZVVybCB9KS5zdWJzY3JpYmUodmFsdWUgPT4ge1xyXG4gICAgICBsZXQgX3NjaGVtYUlkID0gJyc7XHJcbiAgICAgIGlmIChzY2hlbWFJZCkge1xyXG4gICAgICAgIF9zY2hlbWFJZCA9IHNjaGVtYUlkO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh2YWx1ZSAmJiAhX3NjaGVtYUlkKSB7XHJcbiAgICAgICAgX3NjaGVtYUlkID0gdmFsdWUuaWQ7XHJcbiAgICAgICAgaWYgKHZhbHVlLnNjaGVtYVZhbHVlLmNoYXJ0c1R5cGUuc2VyaWVzLnR5cGUgJiYgdmFsdWUuc2NoZW1hVmFsdWUuY2hhcnRzVHlwZS5zZXJpZXMudHlwZSAhPT0gLTEpIHtcclxuICAgICAgICAgIG9wID0gT2JqZWN0LmFzc2lnbih7fSwgdmFsdWUuc2NoZW1hVmFsdWUuY2hhcnRzRGF0YSwgdmFsdWUuc2NoZW1hVmFsdWUuY2hhcnRzU3R5bGUpO1xyXG4gICAgICAgICAgdmFsdWUuc2NoZW1hVmFsdWUuY2hhcnRzVHlwZS5zZXJpZXMudHlwZSA9IHZhbHVlLnNjaGVtYVZhbHVlLmNoYXJ0c1R5cGUuc2VyaWVzLnR5cGUucmVwbGFjZSgnMScsICcnKTtcclxuICAgICAgICAgIG9wLnNlcmllcy50eXBlID0gdmFsdWUuc2NoZW1hVmFsdWUuY2hhcnRzVHlwZS5zZXJpZXMudHlwZTtcclxuICAgICAgICAgIGlmIChvcC5zZXJpZXMudHlwZSAhPT0gJ2xpbmUxJykge1xyXG4gICAgICAgICAgICBkZWxldGUgb3Auc2VyaWVzLmFyZWFTdHlsZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG9wLnNlcmllcy5hcmVhU3R5bGUgPSB7fTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnNjaGVtYVZhbHVlICYmIHZhbHVlLnNjaGVtYVZhbHVlLmN1c3RvbU9wdGlvbikge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBvcCA9IE9iamVjdC5hc3NpZ24oe30sIG9wLCBKU09OLnBhcnNlKHZhbHVlLnNjaGVtYVZhbHVlLmN1c3RvbU9wdGlvbikpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIG9wID0gT2JqZWN0LmFzc2lnbih7fSwgb3AsIHZhbHVlLnNjaGVtYVZhbHVlLmN1c3RvbU9wdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGxldCBlbnRpdHlEYXRhOiBhbnkgPSAnJztcclxuICAgICAgaWYgKHRoaXMuY2FjaGUuZ2V0KHRoaXMuY2hhcnRzLnF1ZXJ5SWQpKSB7XHJcbiAgICAgICAgZW50aXR5RGF0YSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuY2FjaGUuZ2V0KHRoaXMuY2hhcnRzLnF1ZXJ5SWQpKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAobGlua2FnZVBhcmFtcykge1xyXG4gICAgICAgIGVudGl0eURhdGEgPSBsaW5rYWdlUGFyYW1zO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIFRPRE86IG1vcmtcclxuICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5jcmVhdGVQYXJhbWV0ZXJzKHRoaXMucXVlcnlJZCwgJ2NoYXJ0cycsIF9zY2hlbWFJZCwgdGhpcy5xb01hbmFnZXJDb2RlLCAnJywgMCwgMCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRoaXMudm9JZCk7XHJcbiAgICAgIHBhcmFtc1sncXVlcnlJZCddID0gdGhpcy5xdWVyeUlkID8gdGhpcy5xdWVyeUlkIDogJyc7XHJcbiAgICAgIGlmICh0aGlzLnFvTWFuYWdlckNvZGUpIHtcclxuICAgICAgICBwYXJhbXNbJ3FvTWFuYWdlckNvZGUnXSA9IHRoaXMucW9NYW5hZ2VyQ29kZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoX3NjaGVtYUlkICYmIF9zY2hlbWFJZCAhPT0gJ3ByZWZhYicpIHtcclxuICAgICAgICBwYXJhbXNbJ3NjaGVtYUlkJ10gPSBfc2NoZW1hSWQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcGFyYW1zWydzY2hlbWFJZCddID0gJzEnO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIOafpeivouaVsOaNruWJjeS6i+S7tlxyXG4gICAgICBpZiAodGhpcy5kYXRhUmVuZGVyRXh0ZW5kU2VydmljZSAmJiB0aGlzLmRhdGFSZW5kZXJFeHRlbmRTZXJ2aWNlLmJlZm9yZVF1ZXJ5RGF0YSkge1xyXG4gICAgICAgIHRoaXMuZGF0YVJlbmRlckV4dGVuZFNlcnZpY2UuYmVmb3JlUXVlcnlEYXRhKHRoaXMuY3JlYXRlRXZlbnRQYXJhbXMoJ2JlZm9yZVF1ZXJ5RGF0YScsICfmn6Xor6LmlbDmja7liY0nLCBwYXJhbXMsIHRoaXMuY2hhcnRzKSk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIHRoaXMuY2FjaGUuc2V0KHRoaXMudGFiSWQsIEpTT04ucGFyc2UocGFyYW1zWydlbnRpdHlEYXRhJ10pKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7IH1cclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g5re75Yqg5YiXXHJcbiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgICBzZWxmLmdldERhdGEocGFyYW1zLCBxdWVyeVJlbGF0aXZlVXJsKS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIHNlbGYuZ2V0Q29sKHBhcmFtcywgcXVlcnlSZWxhdGl2ZVVybCkuc3Vic2NyaWJlKHJlc3VsdERhdGEgPT4ge1xyXG4gICAgICAgICAgaWYgKCFkYXRhLmR5bmFtaWNDb2xzIHx8IGRhdGEuZHluYW1pY0NvbHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIGRhdGEuZHluYW1pY0NvbHMgPSByZXN1bHREYXRhLmR5bmFtaWNDb2xzIHx8IFtdO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0RGF0YS5keW5hbWljQ29scy5mb3JFYWNoKGNvbCA9PiB7XHJcbiAgICAgICAgICAgICAgZGF0YS5keW5hbWljQ29scy5wdXNoKGNvbCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5keW5hbWljQ29scyAmJiBkYXRhLmR5bmFtaWNDb2xzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBqb2luUGFyYW0gPSB7fTtcclxuICAgICAgICAgICAgam9pblBhcmFtWydjb250cm9sVHlwZSddID0gJ2NoYXJ0cyc7XHJcbiAgICAgICAgICAgIGpvaW5QYXJhbVsnY29sTGlzdCddID0gZGF0YS5keW5hbWljQ29scztcclxuICAgICAgICAgICAgc2VsZi5jYWNoZS5zZXQoc2VsZi50YWJJZCArICdqb2luU2VhcmNoJywgam9pblBhcmFtKTtcclxuICAgICAgICAgICAgc2VsZi5zY2hlbWFNYW5hZ2VyLmNvbExpc3QubmV4dChkYXRhLmR5bmFtaWNDb2xzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIOaVsOaNruWKoOi9veWJjeS6i+S7tlxyXG4gICAgICAgICAgaWYgKG9wICYmIG9wLnNlcmllcyAmJiBvcC5zZXJpZXMudHlwZSkge1xyXG4gICAgICAgICAgICBvcC5zZXJpZXMudHlwZSA9IG9wLnNlcmllcy50eXBlLnJlcGxhY2UoJzEnLCAnJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmRhdGEgJiYgZGF0YS5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBzZWxmLmNoYXJ0cy5zZXREYXRhKGRhdGEuZGF0YSwgb3ApO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VsZi5jaGFydHMuc2V0RGF0YShbXSwgb3ApO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIOmhtemdoua4suafk+WQjuS6i+S7tlxyXG4gICAgICAgICAgaWYgKHNlbGYuZGF0YVJlbmRlckV4dGVuZFNlcnZpY2UgJiYgc2VsZi5kYXRhUmVuZGVyRXh0ZW5kU2VydmljZS5hZnRlckxvYWREYXRhKSB7XHJcbiAgICAgICAgICAgIHNlbGYuZGF0YVJlbmRlckV4dGVuZFNlcnZpY2UuYmVmb3JlTG9hZERhdGEoc2VsZi5jcmVhdGVFdmVudFBhcmFtcygnYWZ0ZXJMb2FkRGF0YScsICfmuLLmn5PlkI7kuovku7YnLCBkYXRhLCBzZWxmLmNoYXJ0cykpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgc2VsZi5jYWNoZS5zZXQoc2VsZi5jaGFydHMucXVlcnlJZCArICdlY2hhcnRzY29uZmlnJywgb3ApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSB7XHJcbiAgICByZXR1cm4gUnRmU2VydmljZXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKHRoaXMuc2Vzc2lvblNlcnZpY2UpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVFdmVudFBhcmFtcyhldmVudENvZGU6IGFueSwgZXZlbnROYW1lOiBhbnksIGRhdGE6IGFueSwgY29udHJvbDogYW55KSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBldmVudENvZGUsXHJcbiAgICAgIGV2ZW50TmFtZSxcclxuICAgICAgZGF0YSxcclxuICAgICAgY29udHJvbFxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIl19
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@farris/devkit"),require("@qdp/common"),require("@ecp-caf/caf-common"),require("rxjs"),require("rxjs/operators"),require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@qdp/echarts",["exports","@farris/devkit","@qdp/common","@ecp-caf/caf-common","rxjs","rxjs/operators","@angular/core","@angular/common"],t):t((e.qdp=e.qdp||{},e.qdp.echarts={}),e["@farris/devkit"],e["@qdp/common"],e["@ecp-caf/caf-common"],e.rxjs,e.rxjs.operators,e.ng.core,e.ng.common)}(this,function(e,t,s,r,p,n,a,i){"use strict";var c=function(){function t(e){this._changes=e}return t.of=function(e){return new t(e)},t.prototype.notEmpty=function(e){if(this._changes[e]){var t=this._changes[e].currentValue;if(t!==undefined&&null!==t)return p.of(t)}return p.EMPTY},t.prototype.has=function(e){if(this._changes[e]){var t=this._changes[e].currentValue;return p.of(t)}return p.EMPTY},t.prototype.notFirst=function(e){if(!this._changes[e]||this._changes[e].isFirstChange())return p.EMPTY;var t=this._changes[e].currentValue;return p.of(t)},t.prototype.notFirstAndEmpty=function(e){if(this._changes[e]&&!this._changes[e].isFirstChange()){var t=this._changes[e].currentValue;if(t!==undefined&&null!==t)return p.of(t)}return p.EMPTY},t}(),h=function(){function e(e,t){this.el=e,this.ngZone=t,this.autoResize=!0,this.loadingType="default",this.detectEventChanges=!0,this.chartInit=new a.EventEmitter,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartPieSelectChanged=this.createLazyEvent("pieselectchanged"),this.chartPieSelected=this.createLazyEvent("pieselected"),this.chartPieUnselected=this.createLazyEvent("pieunselected"),this.chartMapSelectChanged=this.createLazyEvent("mapselectchanged"),this.chartMapSelected=this.createLazyEvent("mapselected"),this.chartMapUnselected=this.createLazyEvent("mapunselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartFocusNodeAdjacency=this.createLazyEvent("focusnodeadjacency"),this.chartUnfocusNodeAdjacency=this.createLazyEvent("unfocusnodeadjacency"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.currentOffsetWidth=0,this.currentOffsetHeight=0}return e.prototype.ngOnChanges=function(e){var t=this,a=c.of(e);a.notFirstAndEmpty("options").subscribe(function(e){return t.onOptionsChange(e)}),a.notFirstAndEmpty("merge").subscribe(function(e){return t.setOption(e)}),a.has("loading").subscribe(function(e){return t.toggleLoading(!!e)}),a.notFirst("theme").subscribe(function(){return t.refreshChart()})},e.prototype.ngOnInit=function(){var e=this;this.resizeSub=p.fromEvent(window,"resize").pipe(n.debounceTime(50)).subscribe(function(){e.autoResize&&window.innerWidth!==e.currentWindowWidth&&(e.currentWindowWidth=window.innerWidth,e.currentOffsetWidth=e.el.nativeElement.offsetWidth,e.currentOffsetHeight=e.el.nativeElement.offsetHeight,e.resize())})},e.prototype.ngOnDestroy=function(){this.resizeSub&&this.resizeSub.unsubscribe(),this.dispose()},e.prototype.ngDoCheck=function(){if(this.chart&&this.autoResize){var e=this.el.nativeElement.offsetWidth,t=this.el.nativeElement.offsetHeight;this.currentOffsetWidth===e&&this.currentOffsetHeight===t||(this.currentOffsetWidth=e,this.currentOffsetHeight=t,this.resize())}},e.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){return e.initChart()})},e.prototype.dispose=function(){this.chart&&(this.chart.dispose(),this.chart=null)},e.prototype.resize=function(){this.chart&&this.chart.resize()},e.prototype.toggleLoading=function(e){this.chart&&(e?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading())},e.prototype.setOption=function(e,t){this.chart.setOption(e,t)},e.prototype.clearOption=function(){this.chart&&this.chart.clear()},e.prototype.getOption=function(){return this.chart.getOption()},e.prototype.refreshChart=function(){this.dispose(),this.initChart()},e.prototype.createChart=function(){var e=this;this.currentWindowWidth=window.innerWidth,this.currentOffsetWidth=this.el.nativeElement.offsetWidth,this.currentOffsetHeight=this.el.nativeElement.offsetHeight;var t=this.el.nativeElement;if(window&&window.getComputedStyle){var a=window.getComputedStyle(t,null).getPropertyValue("height");a&&"0px"!==a||t.style.height&&"0px"!==t.style.height||(t.style.height="400px")}return this.ngZone.runOutsideAngular(function(){return echarts.init(t,e.theme,e.initOpts)})},e.prototype.initChart=function(){this.onOptionsChange(this.options),this.merge&&this.chart&&this.setOption(this.merge)},e.prototype.onOptionsChange=function(e){e?(this.chart||(this.chart=this.createChart(),this.chartInit.emit(this.chart)),this.chart.setOption(this.options,!0)):this.chart||(this.chart=this.createChart(),this.chartInit.emit(this.chart))},e.prototype.createLazyEvent=function(a){var i=this;return this.chartInit.pipe(n.switchMap(function(e){return new p.Observable(function(t){return e.on(a,function(e){return i.ngZone.run(function(){return t.next(e)})}),null})}))},e.prototype.setNumber=function(e,t){for(var a=[],i=e.length,s=0;s<i;s++)a[s]=e[s][t];return a},e.prototype.setData=function(e,t){var i=this;if(this.chart&&this.chart.clear(),e.forEach(function(e){if(e.dynamicPropSet){var t=e.dynamicPropSet;delete e.dynamicPropSet,Object.assign(e,t)}}),e&&e.length&&(this.chartsData={dataset:{dimensions:[],source:[]}},Object.keys(e[0]).forEach(function(e){i.chartsData.dataset.dimensions.push(e)}),e.forEach(function(t){var a=[];Object.keys(t).forEach(function(e){a.push(t[e])}),i.chartsData.dataset.source.push(a)}),t))if(t.series&&t.series.type&&"pie"===t.series.type){var a={title:t.title,dataset:this.chartsData.dataset,tooltip:{formatter:"{d}%"},series:[{type:t.series.type,encode:{value:t.series.encode.y[0],itemName:t.series.encode.x[0]}}]};a.dataset.source.splice(0,0,a.dataset.dimensions),this.chart.setOption(a)}else if(!t.series||"line"!==t.series.type&&"scatter"!==t.series.type){if(t.series&&t.series.type&&"effectScatter"===t.series.type){if(t.dataset=this.chartsData.dataset,0===t.series.encode.value2.length){D=this.chartsData.dataset.dimensions.indexOf(t.series.encode.value1[0]);t.visualMap[0].dimension=D,t.visualMap[0].min=Math.min.apply(null,this.setNumber(this.chartsData.dataset.source,D)),t.visualMap[0].max=Math.max.apply(null,this.setNumber(this.chartsData.dataset.source,D));var s=this.chartsData.dataset.dimensions.indexOf(t.series.encode.value1[0]);t.visualMap[1].dimension=s,t.visualMap[1].min=Math.min.apply(null,this.setNumber(this.chartsData.dataset.source,s)),t.visualMap[1].max=Math.max.apply(null,this.setNumber(this.chartsData.dataset.source,s))}else{var r=this.chartsData.dataset.dimensions.indexOf(t.series.encode.value1[0]);t.visualMap[0].dimension=r,t.visualMap[0].min=Math.min.apply(null,this.setNumber(this.chartsData.dataset.source,r)),t.visualMap[0].max=Math.max.apply(null,this.setNumber(this.chartsData.dataset.source,r));s=this.chartsData.dataset.dimensions.indexOf(t.series.encode.value2[0]);t.visualMap[1].dimension=s,t.visualMap[1].min=Math.min.apply(null,this.setNumber(this.chartsData.dataset.source,s)),t.visualMap[1].max=Math.max.apply(null,this.setNumber(this.chartsData.dataset.source,s))}t.dataset.source.splice(0,0,t.dataset.dimensions),this.chart.setOption(t)}else if(t.series&&"bar"===t.series.type)if(t.series.encode.y&&t.series.encode.y.length<2){for(var n=[],c=[],h=0;h<this.chartsData.dataset.source.length;h++)n.push(this.chartsData.dataset.source[h][this.chartsData.dataset.dimensions.indexOf(t.series.encode.x[0])]),c.push(this.chartsData.dataset.source[h][this.chartsData.dataset.dimensions.indexOf(t.series.encode.y[0])]);var o=Array.from(new Set(n)).length-n.length;if(0==o){t.dataset=this.chartsData.dataset,this.setZoom(t);D=this.chartsData.dataset.dimensions.indexOf(t.series.encode.y[0]);t.legend={},t.visualMap[0].dimension=D,t.visualMap[0].min=Math.min.apply(null,this.setNumber(this.chartsData.dataset.source,D)),t.visualMap[0].max=Math.max.apply(null,this.setNumber(this.chartsData.dataset.source,D)),t.dataset.source.splice(0,0,t.dataset.dimensions),this.chart.setOption(t)}if(o<0){t.visualMap=[],t.dataset=this.chartsData.dataset,this.setZoom(t);for(var u=[],p=0;p<n.length;p++)u.push({name:n[p],value:c[p]});var d={},l=0,y=[];u.forEach(function(e){var t=e.name;d[t]?y[d[t]-1].value.push(e.value):d[t]=++l&&y.push({name:t,value:[e.value]})});var f=[],g=0;y.forEach(function(e){f.push(e.name),e.value.length+1>g&&(g=e.value.length+1)});for(var v=[],m=[],I=1;I<g;I++)m.push(I+"次"),v.push({name:I+"次",type:"bar",stack:"总量",data:[]});return y.forEach(function(e){for(var t=0;t<g-1;t++)e.value[t]?v[t].data.push(e.value[t]):v[t].data.push(0)}),t.xAxis=[{data:f}],t.series=v,t.legend={data:m},void this.chart.setOption(t)}}else if(t.series.encode.y&&1<t.series.encode.y.length){t.dataset=this.chartsData.dataset,this.setZoom(t),t.visualMap=[];var b=[],O=t.series.encode.y;for(h=0;h<O.length;h++){var S={type:t.series.type,name:t.legend.data[h],encode:{x:t.series.encode.x,y:[O[h]]},label:{normal:{show:!0,position:"insideTop"}}};t.title.id&&"pile"===t.title.id&&(S.stack="总量",delete S.label),b.push(S)}t.series=b,t.dataset.source.splice(0,0,t.dataset.dimensions),this.chart.setOption(t)}}else{t.dataset=this.chartsData.dataset,this.setZoom(t);var D=this.chartsData.dataset.dimensions.indexOf(t.series.encode.y[0]);t.visualMap[0].dimension=D,t.visualMap[0].min=Math.min.apply(null,this.setNumber(this.chartsData.dataset.source,D)),t.visualMap[0].max=Math.max.apply(null,this.setNumber(this.chartsData.dataset.source,D)),t.dataset.source.splice(0,0,t.dataset.dimensions),this.chart.setOption(t)}},e.prototype.setZoom=function(e){var t=[];9<e.dataset.source.length&&(t=[{id:"dataZoomX",type:"slider",xAxisIndex:[0],filterMode:"filter"}],e.dataZoom=t)},e.decorators=[{type:a.Directive,args:[{selector:"qdp-charts, [qdp-charts]"}]}],e.ctorParameters=function(){return[{type:a.ElementRef},{type:a.NgZone}]},e.propDecorators={queryId:[{type:a.Input}],options:[{type:a.Input}],theme:[{type:a.Input}],loading:[{type:a.Input}],queryRelativeUrl:[{type:a.Input}],initOpts:[{type:a.Input}],merge:[{type:a.Input}],autoResize:[{type:a.Input}],loadingType:[{type:a.Input}],loadingOpts:[{type:a.Input}],detectEventChanges:[{type:a.Input}],chartInit:[{type:a.Output}],chartClick:[{type:a.Output}],chartDblClick:[{type:a.Output}],chartMouseDown:[{type:a.Output}],chartMouseMove:[{type:a.Output}],chartMouseUp:[{type:a.Output}],chartMouseOver:[{type:a.Output}],chartMouseOut:[{type:a.Output}],chartGlobalOut:[{type:a.Output}],chartContextMenu:[{type:a.Output}],chartLegendSelectChanged:[{type:a.Output}],chartLegendSelected:[{type:a.Output}],chartLegendUnselected:[{type:a.Output}],chartLegendScroll:[{type:a.Output}],chartDataZoom:[{type:a.Output}],chartDataRangeSelected:[{type:a.Output}],chartTimelineChanged:[{type:a.Output}],chartTimelinePlayChanged:[{type:a.Output}],chartRestore:[{type:a.Output}],chartDataViewChanged:[{type:a.Output}],chartMagicTypeChanged:[{type:a.Output}],chartPieSelectChanged:[{type:a.Output}],chartPieSelected:[{type:a.Output}],chartPieUnselected:[{type:a.Output}],chartMapSelectChanged:[{type:a.Output}],chartMapSelected:[{type:a.Output}],chartMapUnselected:[{type:a.Output}],chartAxisAreaSelected:[{type:a.Output}],chartFocusNodeAdjacency:[{type:a.Output}],chartUnfocusNodeAdjacency:[{type:a.Output}],chartBrush:[{type:a.Output}],chartBrushSelected:[{type:a.Output}],chartRendered:[{type:a.Output}],chartFinished:[{type:a.Output}]},e}(),o=function(){function e(e,t,a,i,s){this.charts=e,this.bindingData=t,this.viewModel=a,this.schemaManager=i,this.injector=s,this.delay=0,this.interval=0,this.injector&&(this.cache=this.injector.get(r.CacheService))}return e.prototype.ngOnInit=function(){s.QDPCacheUtil.setCache(s.RtfServices.getTabId(this.queryId)+this.queryId+"form-charts",this)},e.prototype.ngAfterViewInit=function(){this.delayLoad()},e.prototype.delayLoad=function(){var e=this;this.delay||(this.delay=0),setTimeout(function(){e.bindingListChange(),e.intervalLoad()},this.delay)},e.prototype.intervalLoad=function(){var e=this;this.interval&&(this.myVar=setInterval(function(){e.bindingListChange()},this.interval))},e.prototype.clearIntervalLoad=function(){this.myVar&&clearInterval(this.myVar)},e.prototype.bindingListChange=function(){var t=this;this.bindingData&&(this.bindData(),this.bindingData.changes.subscribe(function(e){t.bindData()}))},e.prototype.bindData=function(){var t=this;if(this.bindingList){var i,e=this.cache.get(s.RtfServices.getTabId(this.queryId)+"organizationId")||"";this.schemaManager.getDefaultSchema(this.charts.queryId,this.charts.queryRelativeUrl,"",e).subscribe(function(e){e&&e.schemaValue.chartsType.series.type&&-1!==e.schemaValue.chartsType.series.type&&(i=Object.assign({},e.schemaValue.chartsData,e.schemaValue.chartsStyle),e.schemaValue.chartsType.series.type=e.schemaValue.chartsType.series.type.replace("1",""),i.series.type=e.schemaValue.chartsType.series.type,"line1"!==i.series.type?delete i.series.areaStyle:i.series.areaStyle={});var a=[];t.bindingList.properties.forEach(function(e){var t={};t.name=e.name,t.bindField=e.name,t.colWidth=150,t.align=0,t.visible=!0,t.isFixed=!1,t.formatType=0,t.formattor="",t.sort=0,t.pageAggreText=null,t.pageAggre=0,t.isGroup=!1,t.groupAggreText="",t.groupAggre=0,t.totalAggreText="",t.totalAggre=0,t.level=1,t.childList=[],t.dimension=0,t.rowColor=null,a.push(t)}),t.schemaManager.setColInfo(a),i&&i.series&&i.series.type&&(i.series.type=i.series.type.replace("1","")),t.charts.setData(t.bindingList.toJSON(),i)})}},Object.defineProperty(e.prototype,"bindingList",{get:function(){if(!this.bindingData||!this.viewModel)return undefined;if("/"===this.viewModel.bindingPath||!this.viewModel.bindingPath)return this.bindingData.list;var e=this.viewModel.bindingPath.substr(1),t=(e=e[0].toLowerCase()+e.substring(1,e.length)).split("/").filter(function(e){return""!==e});return this.bindingData.getValue(t)},enumerable:!0,configurable:!0}),e.decorators=[{type:a.Directive,args:[{selector:"formBindingData, [formBindingData]"}]}],e.ctorParameters=function(){return[{type:h,decorators:[{type:a.Optional}]},{type:t.BindingData,decorators:[{type:a.Optional}]},{type:t.ViewModel,decorators:[{type:a.Optional}]},{type:s.SchemaManagerService},{type:a.Injector,decorators:[{type:a.Optional}]}]},e.propDecorators={delay:[{type:a.Input}],interval:[{type:a.Input}],queryId:[{type:a.Input}],controlType:[{type:a.Input}]},e}(),u=function(){function e(e,t,a,i,s,r,n,c,h,o,u){this.serverHost=e,this.restfulService=t,this.sessionService=a,this.cache=i,this.schemaManager=s,this.charts=r,this.dataRenderExtendService=n,this.filterService=c,this.loadDataUri=h,this.loadDataCol=o,this.injector=u,this.delay=0,this.interval=0,this.funcIds=[],this.pageInfoChange=new p.Subject}return e.prototype.bindCloseTabEvent=function(){try{var e=gspframeworkService.rtf.session.getCommonVariable();return gspframeworkService.rtf.frmEvent.eventListener("beforeFuncCloseEvent",this.clearParametersCache.bind(this),e),this.funcIds.push(e.tabId),e.tabId+s.RtfServices.getInSuiteFrmUUID()}catch(t){}},e.prototype.clearParametersCache=function(){var t=arguments[0].tabId;this.cache.set(this.queryId,""),this.cache.set(arguments[0].tabId,""),this.cache.set(arguments[0].tabId+"renderMode","");var e=this.funcIds.findIndex(function(e){return e===t});0<=e&&(this.funcIds.splice(e,1),gspframeworkService.rtf.func.close(arguments[0]))},e.prototype.ngOnInit=function(){this.tabId=s.RtfServices.getTabId(this.queryId),s.QDPCacheUtil.setCache(this.tabId+this.queryId+"lcp-charts",this)},e.prototype.ngOnChanges=function(e){for(var t in e){var a=e[t].currentValue;if(null!=a){var i=s.RtfServices.getTabId(this.queryId);switch(t){case"queryId":this.queryId=a,s.QDPCacheUtil.setCache(i+this.queryId+"lcp-charts",this);break;case"eventType":a&&s.EventBus.register(a,this.handleLinkage,i)}}}},e.prototype.ngAfterViewInit=function(){var a=this;this.filterService.getFilter(this.qoManagerCode,this.queryId,this.queryRelativeUrl,1).subscribe(function(e){if(e){var t=JSON.stringify(e.filter);a.render("","","",t)}else a.render("")})},e.prototype.handleLinkage=function(e){try{var t=JSON.stringify(e);this.delayLoad("",{},t,this.queryRelativeUrl)}catch(a){}},e.prototype.delayLoad=function(e,t,a,i,s){var r=this;this.delay||(this.delay=0),0===this.delay?(this.bindData(e,t,a,i,s),this.intervalLoad(e,t,a,i,s)):setTimeout(function(){r.bindData(e,t,a,i,s),r.intervalLoad(e,t,a,i,s)},this.delay)},e.prototype.intervalLoad=function(e,t,a,i,s){var r=this;this.interval&&(this.myVar=setInterval(function(){r.bindData(e,t,a,i,s)},this.interval))},e.prototype.clearIntervalLoad=function(){this.myVar&&clearInterval(this.myVar)},e.prototype.render=function(e,t,a,i){this.delayLoad(e,t,a,this.queryRelativeUrl,i)},e.prototype.getData=function(e,t){var a=this,i=this.serverHost;return this.loadDataUri?i+=this.loadDataUri:i+=t&&""!==t?t+"querydata":"/api/runtime/bcc/v1.0/qdpsearch/query",(t?this.restfulService.put(i,t?{Param:e}:e,{},this.createHeaderSessionId()):this.restfulService.post(i,t?{Param:e}:e,{},this.createHeaderSessionId())).pipe(n.map(function(e){return e&&(e=t&&""!==t?e.returnValue:e)&&e.pageInfo&&a.pageInfoChange.next(e.pageInfo),e}))},e.prototype.getCol=function(e,t){var a=this.serverHost;return this.loadDataCol?a+=this.loadDataCol:a+=(t&&""!==t?t:"/api/runtime/bcc/v1.0/qdpsearch/")+"querycol",e=t&&""!==t?{Param:e}:e,(t?this.restfulService.put(a,e,{},this.createHeaderSessionId()):this.restfulService.post(a,e,{},this.createHeaderSessionId())).pipe(n.map(function(e){return e&&(e=t&&""!==t?e.returnValue:e),e}))},e.prototype.createParameters=function(e,t,a,i,s,r,n,c,h,o){var u,p=this.bindCloseTabEvent(),d={entityData:u=this.cache.get(p)?JSON.stringify(this.cache.get(p)):this.cache.get(e)?JSON.stringify(this.cache.get(e)):JSON.stringify({id:"undefined_null"}),extendCond:s,pageIndex:r,pageSize:n,schemaId:a&&"prefab"!==a?a:"1",filterCond:this.cache.get(p+"filtercondition")?this.cache.get(p+"filtercondition"):"",qoManagerCode:i||"",voCode:o||""};try{var l=JSON.parse(u);if(l.hasOwnProperty("@filterExpressionString@")){var y=d&&d.filterCond?JSON.parse(d.filterCond):null;if(y){var f=JSON.parse(l["@filterExpressionString@"]);f.expressItems=f.expressItems.concat(y.expressItems),d.filterCond=JSON.stringify(f)}else d.filterCond=l["@filterExpressionString@"]}}catch(g){}return t&&(d.controlType=t),h&&(d.excelExportName=h),c&&(d.printIntegration=c?JSON.stringify(c):""),d},e.prototype.getSchemaInfo=function(e){if(e.schemaId="prefab"===e.schemaId?"1":e.schemaId,e.schemaId){var t=this.cache.get(s.RtfServices.getTabId(e.queryId)+"organizationId")||"";return this.schemaManager.getSchema(e.schemaId,e.queryId,e.queryRelativeUrl,e.groupType,t).pipe(n.switchMap(function(e){if(e&&e.id)return p.of(e)}))}return this.getDefaultSchemaInfo(e)},e.prototype.getDefaultSchemaInfo=function(e){var t=this.cache.get(s.RtfServices.getTabId(e.queryId)+"organizationId")||"";return this.schemaManager.getDefaultSchema(e.queryId,e.queryRelativeUrl,e.groupType,t)},e.prototype.bindData=function(r,e,t,n,a){var c=this,h=e;this.getSchemaInfo({schemaId:r,queryId:this.charts.queryId,queryRelativeUrl:n}).subscribe(function(e){var t="";if(r&&(t=r),e&&!t&&(t=e.id,e.schemaValue.chartsType.series.type&&-1!==e.schemaValue.chartsType.series.type&&(h=Object.assign({},e.schemaValue.chartsData,e.schemaValue.chartsStyle),e.schemaValue.chartsType.series.type=e.schemaValue.chartsType.series.type.replace("1",""),h.series.type=e.schemaValue.chartsType.series.type,"line1"!==h.series.type?delete h.series.areaStyle:h.series.areaStyle={})),e&&e.schemaValue&&e.schemaValue.customOption)try{h=Object.assign({},h,JSON.parse(e.schemaValue.customOption))}catch(a){h=Object.assign({},h,e.schemaValue.customOption)}c.cache.get(c.charts.queryId)&&JSON.stringify(c.cache.get(c.charts.queryId));var i=c.createParameters(c.queryId,"charts",t,c.qoManagerCode,"",0,0,undefined,undefined,c.voId);if(i.queryId=c.queryId?c.queryId:"",c.qoManagerCode&&(i.qoManagerCode=c.qoManagerCode),i.schemaId=t&&"prefab"!==t?t:"1",c.dataRenderExtendService&&c.dataRenderExtendService.beforeQueryData){c.dataRenderExtendService.beforeQueryData(c.createEventParams("beforeQueryData","查询数据前",i,c.charts));try{c.cache.set(c.tabId,JSON.parse(i.entityData))}catch(a){}}var s=c;s.getData(i,n).subscribe(function(a){s.getCol(i,n).subscribe(function(e){if(a.dynamicCols&&0!==a.dynamicCols.length?e.dynamicCols.forEach(function(e){a.dynamicCols.push(e)}):a.dynamicCols=e.dynamicCols||[],a&&a.dynamicCols&&a.dynamicCols.length){var t={controlType:"charts"};t.colList=a.dynamicCols,s.cache.set(s.tabId+"joinSearch",t),s.schemaManager.colList.next(a.dynamicCols)}h&&h.series&&h.series.type&&(h.series.type=h.series.type.replace("1","")),a&&a.data&&a.data.length?s.charts.setData(a.data,h):s.charts.setData([],h),s.dataRenderExtendService&&s.dataRenderExtendService.afterLoadData&&s.dataRenderExtendService.beforeLoadData(s.createEventParams("afterLoadData","渲染后事件",a,s.charts)),s.cache.set(s.charts.queryId+"echartsconfig",h)})})})},e.prototype.createHeaderSessionId=function(){return s.RtfServices.createHeaderSessionId(this.sessionService)},e.prototype.createEventParams=function(e,t,a,i){return{eventCode:e,eventName:t,data:a,control:i}},e.decorators=[{type:a.Directive,args:[{selector:"lcpBindingData, [lcpBindingData]"}]}],e.ctorParameters=function(){return[{type:String,decorators:[{type:a.Inject,args:[s.Server_Host]},{type:a.Optional}]},{type:s.RestfulService},{type:r.SessionService},{type:r.CacheService},{type:s.SchemaManagerService},{type:h,decorators:[{type:a.Optional}]},{type:s.DataRenderExtendService,decorators:[{type:a.Optional}]},{type:s.FilterManagerService},{type:String,decorators:[{type:a.Inject,args:[s.Load_Data_Uri]},{type:a.Optional}]},{type:String,decorators:[{type:a.Inject,args:[s.Load_Data_Col]},{type:a.Optional}]},{type:a.Injector,decorators:[{type:a.Optional}]}]},e.propDecorators={qoManagerCode:[{type:a.Input}],delay:[{type:a.Input}],interval:[{type:a.Input}],eventType:[{type:a.Input}],queryRelativeUrl:[{type:a.Input}],queryId:[{type:a.Input}],controlType:[{type:a.Input}],qoId:[{type:a.Input}],voId:[{type:a.Input}]},e}(),d=function(){function e(){}return e.decorators=[{type:a.NgModule,args:[{imports:[i.CommonModule],declarations:[h,o,u],exports:[h,o,u]}]}],e}();e.NgxEchartsDirective=h,e.FormBindingDataDirective=o,e.LcpBindingDataDirective=u,e.EchartsModule=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=qdp-echarts.umd.min.js.map
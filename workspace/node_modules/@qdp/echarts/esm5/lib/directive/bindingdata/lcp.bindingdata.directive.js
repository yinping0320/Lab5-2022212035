/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Directive, Input, Optional, Injector } from '@angular/core';
import { NgxEchartsDirective } from '../qdp-charts/qdp.charts.directive';
import { RestfulService, SchemaManagerService, DataRenderExtendService, Server_Host, EventBus, QDPCacheUtil } from '@qdp/common';
import { CacheService } from '@ecp-caf/caf-common';
import { of, Subject } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { SessionService } from '@ecp-caf/caf-common';
import { FilterManagerService, Load_Data_Uri, Load_Data_Col } from '@qdp/common';
import { RtfServices } from '@qdp/common';
import { map } from 'rxjs/operators';
var LcpBindingDataDirective = /** @class */ (function () {
    function LcpBindingDataDirective(serverHost, restfulService, sessionService, cache, schemaManager, charts, dataRenderExtendService, filterService, loadDataUri, loadDataCol, injector) {
        this.serverHost = serverHost;
        this.restfulService = restfulService;
        this.sessionService = sessionService;
        this.cache = cache;
        this.schemaManager = schemaManager;
        this.charts = charts;
        this.dataRenderExtendService = dataRenderExtendService;
        this.filterService = filterService;
        this.loadDataUri = loadDataUri;
        this.loadDataCol = loadDataCol;
        this.injector = injector;
        this.delay = 0;
        this.interval = 0;
        this.funcIds = [];
        this.pageInfoChange = new Subject();
    }
    /**
     * @private
     * @return {?}
     */
    LcpBindingDataDirective.prototype.bindCloseTabEvent = /**
     * @private
     * @return {?}
     */
    function () {
        try {
            /** @type {?} */
            var tab = gspframeworkService.rtf.session.getCommonVariable();
            gspframeworkService.rtf.frmEvent.eventListener('beforeFuncCloseEvent', this.clearParametersCache.bind(this), tab);
            this.funcIds.push(tab.tabId);
            return tab.tabId + RtfServices.getInSuiteFrmUUID();
        }
        catch (e) {
        }
    };
    /**
     * @private
     * @return {?}
     */
    LcpBindingDataDirective.prototype.clearParametersCache = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var tabId = arguments[0].tabId;
        this.cache.set(this.queryId, '');
        this.cache.set(arguments[0].tabId, '');
        this.cache.set(arguments[0].tabId + 'renderMode', '');
        /** @type {?} */
        var index = this.funcIds.findIndex((/**
         * @param {?} el
         * @return {?}
         */
        function (el) { return el === tabId; }));
        if (index >= 0) {
            this.funcIds.splice(index, 1);
            gspframeworkService.rtf.func.close(arguments[0]);
        }
    };
    /**
     * @return {?}
     */
    LcpBindingDataDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.tabId = RtfServices.getTabId(this.queryId);
        QDPCacheUtil.setCache(this.tabId + this.queryId + 'lcp-charts', this);
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    LcpBindingDataDirective.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        for (var changeName in changes) {
            /** @type {?} */
            var newValue = changes[changeName].currentValue;
            if (newValue !== null && newValue !== void 0) {
                /** @type {?} */
                var eventId = RtfServices.getTabId(this.queryId);
                switch (changeName) {
                    case 'queryId':
                        this.queryId = newValue;
                        QDPCacheUtil.setCache(eventId + this.queryId + 'lcp-charts', this);
                        break;
                    case 'eventType':
                        if (newValue) {
                            EventBus.register(newValue, this.handleLinkage, eventId);
                        }
                        break;
                }
            }
        }
    };
    /**
     * @return {?}
     */
    LcpBindingDataDirective.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // if (this.qoId) { // 查询结果集过滤条件
        this.filterService.getFilter(this.qoManagerCode, this.queryId, this.queryRelativeUrl, 1).subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                /** @type {?} */
                var conditionExpression = JSON.stringify(data.filter);
                _this.render('', '', '', conditionExpression);
            }
            else {
                _this.render('');
            }
        }));
        // } else {
        //   this.render('');
        // }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    LcpBindingDataDirective.prototype.handleLinkage = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        try {
            /** @type {?} */
            var params = JSON.stringify($event);
            this.delayLoad('', {}, params, this.queryRelativeUrl);
        }
        catch (e) {
        }
    };
    /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    LcpBindingDataDirective.prototype.delayLoad = /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    function (schemaId, option, linkageParams, queryRelativeUrl, conditionExpression) {
        var _this = this;
        if (!this.delay) {
            this.delay = 0;
        }
        if (this.delay === 0) {
            this.bindData(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
            this.intervalLoad(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
        }
        else {
            setTimeout((/**
             * @return {?}
             */
            function () {
                _this.bindData(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
                _this.intervalLoad(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
            }), this.delay);
        }
    };
    /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    LcpBindingDataDirective.prototype.intervalLoad = /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    function (schemaId, option, linkageParams, queryRelativeUrl, conditionExpression) {
        var _this = this;
        if (this.interval) {
            this.myVar = setInterval((/**
             * @return {?}
             */
            function () {
                _this.bindData(schemaId, option, linkageParams, queryRelativeUrl, conditionExpression);
            }), this.interval);
        }
    };
    /**
     * @return {?}
     */
    LcpBindingDataDirective.prototype.clearIntervalLoad = /**
     * @return {?}
     */
    function () {
        if (this.myVar) {
            clearInterval(this.myVar);
        }
    };
    /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} conditionExpression
     * @return {?}
     */
    LcpBindingDataDirective.prototype.render = /**
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} conditionExpression
     * @return {?}
     */
    function (schemaId, option, linkageParams, conditionExpression) {
        this.delayLoad(schemaId, option, linkageParams, this.queryRelativeUrl, conditionExpression);
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpBindingDataDirective.prototype.getData = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += (!queryRelativeUrl || queryRelativeUrl === '') ? '/api/runtime/bcc/v1.0/qdpsearch/query' : (queryRelativeUrl + 'querydata');
        }
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, queryRelativeUrl ? { 'Param': params } : params, {}, this.createHeaderSessionId())
            : this.restfulService.put(uri, queryRelativeUrl ? { 'Param': params } : params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                data = (!queryRelativeUrl || queryRelativeUrl === '') ? data : data.returnValue;
                if (data && data.pageInfo) {
                    self.pageInfoChange.next(data.pageInfo);
                }
            }
            return data;
        })));
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpBindingDataDirective.prototype.getCol = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataCol) {
            uri += this.loadDataCol;
        }
        else {
            uri += ((!queryRelativeUrl || queryRelativeUrl === '') ? '/api/runtime/bcc/v1.0/qdpsearch/' : queryRelativeUrl) + 'querycol';
        }
        params = (!queryRelativeUrl || queryRelativeUrl === '') ? params : { 'Param': params };
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, this.createHeaderSessionId())
            : this.restfulService.put(uri, params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                data = (!queryRelativeUrl || queryRelativeUrl === '') ? data : data.returnValue;
            }
            return data;
        })));
    };
    /**
     * @private
     * @param {?} queryId
     * @param {?} controlType
     * @param {?} schemaId
     * @param {?} qoManagerCode
     * @param {?} extendCond
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?=} printIntegration
     * @param {?=} excelExportName
     * @param {?=} voId
     * @return {?}
     */
    LcpBindingDataDirective.prototype.createParameters = /**
     * @private
     * @param {?} queryId
     * @param {?} controlType
     * @param {?} schemaId
     * @param {?} qoManagerCode
     * @param {?} extendCond
     * @param {?} pageIndex
     * @param {?} pageSize
     * @param {?=} printIntegration
     * @param {?=} excelExportName
     * @param {?=} voId
     * @return {?}
     */
    function (queryId, controlType, schemaId, qoManagerCode, extendCond, pageIndex, pageSize, printIntegration, excelExportName, voId) {
        /** @type {?} */
        var entityData;
        /** @type {?} */
        var tabId = this.bindCloseTabEvent();
        if (this.cache.get(tabId)) {
            entityData = JSON.stringify(this.cache.get(tabId));
        }
        else if (this.cache.get(queryId)) {
            entityData = JSON.stringify(this.cache.get(queryId));
        }
        else {
            entityData = JSON.stringify({ 'id': 'undefined_null' });
        }
        /** @type {?} */
        var params = {
            entityData: entityData,
            extendCond: extendCond,
            pageIndex: pageIndex,
            pageSize: pageSize,
            schemaId: schemaId && schemaId !== 'prefab' ? schemaId : '1',
            filterCond: this.cache.get(tabId + 'filtercondition') ? this.cache.get(tabId + 'filtercondition') : '',
            qoManagerCode: qoManagerCode ? qoManagerCode : '',
            voCode: voId ? voId : ''
        };
        try {
            /** @type {?} */
            var parameterEntityData = JSON.parse(entityData);
            if (parameterEntityData.hasOwnProperty('@filterExpressionString@')) {
                /** @type {?} */
                var filterExpression = params && params.filterCond ? JSON.parse(params.filterCond) : null;
                if (!filterExpression) {
                    params.filterCond = parameterEntityData['@filterExpressionString@'];
                }
                else {
                    /** @type {?} */
                    var advanceFilterExpression = JSON.parse(parameterEntityData['@filterExpressionString@']);
                    advanceFilterExpression.expressItems = advanceFilterExpression.expressItems.concat(filterExpression.expressItems);
                    params.filterCond = JSON.stringify(advanceFilterExpression);
                }
            }
        }
        catch (e) {
        }
        if (controlType) {
            params['controlType'] = controlType;
        }
        if (excelExportName) {
            params['excelExportName'] = excelExportName;
        }
        if (printIntegration) {
            params['printIntegration'] = printIntegration ? JSON.stringify(printIntegration) : '';
        }
        return params;
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    LcpBindingDataDirective.prototype.getSchemaInfo = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var self = this;
        obj.schemaId = obj.schemaId === 'prefab' ? '1' : obj.schemaId;
        if (!obj.schemaId) {
            return self.getDefaultSchemaInfo(obj);
        }
        else {
            /** @type {?} */
            var organizationId = this.cache.get(RtfServices.getTabId(obj.queryId) + 'organizationId') || '';
            /** @type {?} */
            var result$ = this.schemaManager.getSchema(obj.schemaId, obj.queryId, obj.queryRelativeUrl, obj.groupType, organizationId);
            return result$.pipe(switchMap((/**
             * @param {?} schemaValue
             * @return {?}
             */
            function (schemaValue) {
                if (schemaValue && schemaValue['id']) {
                    return of(schemaValue);
                }
                //  else {
                //   return self.getDefaultSchemaInfo(obj);
                // }
            })));
        }
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    LcpBindingDataDirective.prototype.getDefaultSchemaInfo = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        /** @type {?} */
        var organizationId = this.cache.get(RtfServices.getTabId(obj.queryId) + 'organizationId') || '';
        return this.schemaManager.getDefaultSchema(obj.queryId, obj.queryRelativeUrl, obj.groupType, organizationId);
    };
    /**
     * @private
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    LcpBindingDataDirective.prototype.bindData = /**
     * @private
     * @param {?} schemaId
     * @param {?=} option
     * @param {?=} linkageParams
     * @param {?=} queryRelativeUrl
     * @param {?=} conditionExpression
     * @return {?}
     */
    function (schemaId, option, linkageParams, queryRelativeUrl, conditionExpression) {
        var _this = this;
        /** @type {?} */
        var op = option;
        this.getSchemaInfo({ schemaId: schemaId, queryId: this.charts.queryId, queryRelativeUrl: queryRelativeUrl }).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            /** @type {?} */
            var _schemaId = '';
            if (schemaId) {
                _schemaId = schemaId;
            }
            if (value && !_schemaId) {
                _schemaId = value.id;
                if (value.schemaValue.chartsType.series.type && value.schemaValue.chartsType.series.type !== -1) {
                    op = Object.assign({}, value.schemaValue.chartsData, value.schemaValue.chartsStyle);
                    value.schemaValue.chartsType.series.type = value.schemaValue.chartsType.series.type.replace('1', '');
                    op.series.type = value.schemaValue.chartsType.series.type;
                    if (op.series.type !== 'line1') {
                        delete op.series.areaStyle;
                    }
                    else {
                        op.series.areaStyle = {};
                    }
                }
            }
            if (value && value.schemaValue && value.schemaValue.customOption) {
                try {
                    op = Object.assign({}, op, JSON.parse(value.schemaValue.customOption));
                }
                catch (e) {
                    op = Object.assign({}, op, value.schemaValue.customOption);
                }
            }
            /** @type {?} */
            var entityData = '';
            if (_this.cache.get(_this.charts.queryId)) {
                entityData = JSON.stringify(_this.cache.get(_this.charts.queryId));
            }
            if (linkageParams) {
                entityData = linkageParams;
            }
            // TODO: mork
            /** @type {?} */
            var params = _this.createParameters(_this.queryId, 'charts', _schemaId, _this.qoManagerCode, '', 0, 0, undefined, undefined, _this.voId);
            params['queryId'] = _this.queryId ? _this.queryId : '';
            if (_this.qoManagerCode) {
                params['qoManagerCode'] = _this.qoManagerCode;
            }
            if (_schemaId && _schemaId !== 'prefab') {
                params['schemaId'] = _schemaId;
            }
            else {
                params['schemaId'] = '1';
            }
            // 查询数据前事件
            if (_this.dataRenderExtendService && _this.dataRenderExtendService.beforeQueryData) {
                _this.dataRenderExtendService.beforeQueryData(_this.createEventParams('beforeQueryData', '查询数据前', params, _this.charts));
                try {
                    _this.cache.set(_this.tabId, JSON.parse(params['entityData']));
                }
                catch (e) { }
            }
            // 添加列
            /** @type {?} */
            var self = _this;
            self.getData(params, queryRelativeUrl).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                self.getCol(params, queryRelativeUrl).subscribe((/**
                 * @param {?} resultData
                 * @return {?}
                 */
                function (resultData) {
                    if (!data.dynamicCols || data.dynamicCols.length === 0) {
                        data.dynamicCols = resultData.dynamicCols || [];
                    }
                    else {
                        resultData.dynamicCols.forEach((/**
                         * @param {?} col
                         * @return {?}
                         */
                        function (col) {
                            data.dynamicCols.push(col);
                        }));
                    }
                    if (data && data.dynamicCols && data.dynamicCols.length) {
                        /** @type {?} */
                        var joinParam = {};
                        joinParam['controlType'] = 'charts';
                        joinParam['colList'] = data.dynamicCols;
                        self.cache.set(self.tabId + 'joinSearch', joinParam);
                        self.schemaManager.colList.next(data.dynamicCols);
                    }
                    // 数据加载前事件
                    if (op && op.series && op.series.type) {
                        op.series.type = op.series.type.replace('1', '');
                    }
                    if (data && data.data && data.data.length) {
                        self.charts.setData(data.data, op);
                    }
                    else {
                        self.charts.setData([], op);
                    }
                    // 页面渲染后事件
                    if (self.dataRenderExtendService && self.dataRenderExtendService.afterLoadData) {
                        self.dataRenderExtendService.beforeLoadData(self.createEventParams('afterLoadData', '渲染后事件', data, self.charts));
                    }
                    self.cache.set(self.charts.queryId + 'echartsconfig', op);
                }));
            }));
        }));
    };
    /**
     * @private
     * @return {?}
     */
    LcpBindingDataDirective.prototype.createHeaderSessionId = /**
     * @private
     * @return {?}
     */
    function () {
        return RtfServices.createHeaderSessionId(this.sessionService);
    };
    /**
     * @private
     * @param {?} eventCode
     * @param {?} eventName
     * @param {?} data
     * @param {?} control
     * @return {?}
     */
    LcpBindingDataDirective.prototype.createEventParams = /**
     * @private
     * @param {?} eventCode
     * @param {?} eventName
     * @param {?} data
     * @param {?} control
     * @return {?}
     */
    function (eventCode, eventName, data, control) {
        return {
            eventCode: eventCode,
            eventName: eventName,
            data: data,
            control: control
        };
    };
    LcpBindingDataDirective.decorators = [
        { type: Directive, args: [{
                    // tslint:disable-next-line:directive-selector
                    selector: 'lcpBindingData, [lcpBindingData]',
                },] }
    ];
    /** @nocollapse */
    LcpBindingDataDirective.ctorParameters = function () { return [
        { type: String, decorators: [{ type: Inject, args: [Server_Host,] }, { type: Optional }] },
        { type: RestfulService },
        { type: SessionService },
        { type: CacheService },
        { type: SchemaManagerService },
        { type: NgxEchartsDirective, decorators: [{ type: Optional }] },
        { type: DataRenderExtendService, decorators: [{ type: Optional }] },
        { type: FilterManagerService },
        { type: String, decorators: [{ type: Inject, args: [Load_Data_Uri,] }, { type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [Load_Data_Col,] }, { type: Optional }] },
        { type: Injector, decorators: [{ type: Optional }] }
    ]; };
    LcpBindingDataDirective.propDecorators = {
        qoManagerCode: [{ type: Input }],
        delay: [{ type: Input }],
        interval: [{ type: Input }],
        eventType: [{ type: Input }],
        queryRelativeUrl: [{ type: Input }],
        queryId: [{ type: Input }],
        controlType: [{ type: Input }],
        qoId: [{ type: Input }],
        voId: [{ type: Input }]
    };
    return LcpBindingDataDirective;
}());
export { LcpBindingDataDirective };
if (false) {
    /** @type {?} */
    LcpBindingDataDirective.prototype.qoManagerCode;
    /** @type {?} */
    LcpBindingDataDirective.prototype.delay;
    /** @type {?} */
    LcpBindingDataDirective.prototype.interval;
    /** @type {?} */
    LcpBindingDataDirective.prototype.eventType;
    /** @type {?} */
    LcpBindingDataDirective.prototype.queryRelativeUrl;
    /** @type {?} */
    LcpBindingDataDirective.prototype.queryId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.controlType;
    /** @type {?} */
    LcpBindingDataDirective.prototype.qoId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.voId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.funcIds;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.myVar;
    /** @type {?} */
    LcpBindingDataDirective.prototype.tabId;
    /** @type {?} */
    LcpBindingDataDirective.prototype.pageInfoChange;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.serverHost;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.restfulService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.cache;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.schemaManager;
    /** @type {?} */
    LcpBindingDataDirective.prototype.charts;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.dataRenderExtendService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.filterService;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.loadDataUri;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.loadDataCol;
    /**
     * @type {?}
     * @private
     */
    LcpBindingDataDirective.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGNwLmJpbmRpbmdkYXRhLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvZWNoYXJ0cy8iLCJzb3VyY2VzIjpbImxpYi9kaXJlY3RpdmUvYmluZGluZ2RhdGEvbGNwLmJpbmRpbmdkYXRhLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFFBQVEsRUFBMkMsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlILE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxjQUFjLEVBQUUsb0JBQW9CLEVBQUUsdUJBQXVCLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDakksT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25ELE9BQU8sRUFBYyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLGFBQWEsRUFBRSxhQUFhLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDakYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUMxQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFJckM7SUFvQkUsaUNBQzJDLFVBQWtCLEVBQ25ELGNBQThCLEVBQzlCLGNBQThCLEVBQzlCLEtBQW1CLEVBQ25CLGFBQW1DLEVBQ3hCLE1BQTJCLEVBQzFCLHVCQUFnRCxFQUM1RCxhQUFtQyxFQUNBLFdBQW1CLEVBQ25CLFdBQW1CLEVBQzFDLFFBQWtCO1FBVkcsZUFBVSxHQUFWLFVBQVUsQ0FBUTtR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QVE7NkNBQy9CLE1BQU0sU0FBQyxhQUFhLGNBQUcsUUFBUTtnQkEzQzBELFFBQVEsdUJBNENqRyxRQUFROzs7Z0NBMUJWLEtBQUs7d0JBQ0wsS0FBSzsyQkFDTCxLQUFLOzRCQUNMLEtBQUs7bUNBQ0wsS0FBSzswQkFDTCxLQUFLOzhCQUNMLEtBQUs7dUJBQ0wsS0FBSzt1QkFDTCxLQUFLOztJQTBWUiw4QkFBQztDQUFBLEFBdldELElBdVdDO1NBbldZLHVCQUF1Qjs7O0lBQ2xDLGdEQUE0Qjs7SUFDNUIsd0NBQW1COztJQUNuQiwyQ0FBc0I7O0lBQ3RCLDRDQUEyQjs7SUFDM0IsbURBQWtDOztJQUNsQywwQ0FBeUI7O0lBQ3pCLDhDQUEwQjs7SUFDMUIsdUNBQW1COztJQUNuQix1Q0FBbUI7O0lBQ25CLDBDQUFhOzs7OztJQUNiLHdDQUFtQjs7SUFDbkIsd0NBQVc7O0lBRVgsaURBQW9DOzs7OztJQUdsQyw2Q0FBMkQ7Ozs7O0lBQzNELGlEQUFzQzs7Ozs7SUFDdEMsaURBQXNDOzs7OztJQUN0Qyx3Q0FBMkI7Ozs7O0lBQzNCLGdEQUEyQzs7SUFDM0MseUNBQThDOzs7OztJQUM5QywwREFBb0U7Ozs7O0lBQ3BFLGdEQUEyQzs7Ozs7SUFDM0MsOENBQThEOzs7OztJQUM5RCw4Q0FBOEQ7Ozs7O0lBQzlELDJDQUFzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgRGlyZWN0aXZlLCBPbkluaXQsIElucHV0LCBPcHRpb25hbCwgQWZ0ZXJWaWV3SW5pdCwgU2ltcGxlQ2hhbmdlcywgT25DaGFuZ2VzLCBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOZ3hFY2hhcnRzRGlyZWN0aXZlIH0gZnJvbSAnLi4vcWRwLWNoYXJ0cy9xZHAuY2hhcnRzLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IFJlc3RmdWxTZXJ2aWNlLCBTY2hlbWFNYW5hZ2VyU2VydmljZSwgRGF0YVJlbmRlckV4dGVuZFNlcnZpY2UsIFNlcnZlcl9Ib3N0LCBFdmVudEJ1cywgUURQQ2FjaGVVdGlsIH0gZnJvbSAnQHFkcC9jb21tb24nO1xyXG5pbXBvcnQgeyBDYWNoZVNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBTZXNzaW9uU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBGaWx0ZXJNYW5hZ2VyU2VydmljZSwgTG9hZF9EYXRhX1VyaSwgTG9hZF9EYXRhX0NvbCB9IGZyb20gJ0BxZHAvY29tbW9uJztcclxuaW1wb3J0IHsgUnRmU2VydmljZXMgfSBmcm9tICdAcWRwL2NvbW1vbic7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmRlY2xhcmUgdmFyIGdzcGZyYW1ld29ya1NlcnZpY2U6IGFueTtcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpkaXJlY3RpdmUtc2VsZWN0b3JcclxuICBzZWxlY3RvcjogJ2xjcEJpbmRpbmdEYXRhLCBbbGNwQmluZGluZ0RhdGFdJyxcclxufSlcclxuZXhwb3J0IGNsYXNzIExjcEJpbmRpbmdEYXRhRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgpIHFvTWFuYWdlckNvZGU6IGFueTtcclxuICBASW5wdXQoKSBkZWxheSA9IDA7XHJcbiAgQElucHV0KCkgaW50ZXJ2YWwgPSAwO1xyXG4gIEBJbnB1dCgpIGV2ZW50VHlwZTogc3RyaW5nO1xyXG4gIEBJbnB1dCgpIHF1ZXJ5UmVsYXRpdmVVcmw6IHN0cmluZztcclxuICBASW5wdXQoKSBxdWVyeUlkOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgY29udHJvbFR5cGU6IGFueTtcclxuICBASW5wdXQoKSBxb0lkOiBhbnk7XHJcbiAgQElucHV0KCkgdm9JZDogYW55O1xyXG4gIGZ1bmNJZHMgPSBbXTtcclxuICBwcml2YXRlIG15VmFyOiBhbnk7XHJcbiAgdGFiSWQ6IGFueTtcclxuXHJcbiAgcGFnZUluZm9DaGFuZ2UgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQEluamVjdChTZXJ2ZXJfSG9zdCkgQE9wdGlvbmFsKCkgcHJpdmF0ZSBzZXJ2ZXJIb3N0OiBzdHJpbmcsXHJcbiAgICBwcml2YXRlIHJlc3RmdWxTZXJ2aWNlOiBSZXN0ZnVsU2VydmljZSxcclxuICAgIHByaXZhdGUgc2Vzc2lvblNlcnZpY2U6IFNlc3Npb25TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBjYWNoZTogQ2FjaGVTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBzY2hlbWFNYW5hZ2VyOiBTY2hlbWFNYW5hZ2VyU2VydmljZSxcclxuICAgIEBPcHRpb25hbCgpIHB1YmxpYyBjaGFydHM6IE5neEVjaGFydHNEaXJlY3RpdmUsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGRhdGFSZW5kZXJFeHRlbmRTZXJ2aWNlOiBEYXRhUmVuZGVyRXh0ZW5kU2VydmljZSxcclxuICAgIHByaXZhdGUgZmlsdGVyU2VydmljZTogRmlsdGVyTWFuYWdlclNlcnZpY2UsXHJcbiAgICBASW5qZWN0KExvYWRfRGF0YV9VcmkpIEBPcHRpb25hbCgpIHByaXZhdGUgbG9hZERhdGFVcmk6IHN0cmluZyxcclxuICAgIEBJbmplY3QoTG9hZF9EYXRhX0NvbCkgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsb2FkRGF0YUNvbDogc3RyaW5nLFxyXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3JcclxuICApIHtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYmluZENsb3NlVGFiRXZlbnQoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB0YWIgPSBnc3BmcmFtZXdvcmtTZXJ2aWNlLnJ0Zi5zZXNzaW9uLmdldENvbW1vblZhcmlhYmxlKCk7XHJcbiAgICAgIGdzcGZyYW1ld29ya1NlcnZpY2UucnRmLmZybUV2ZW50LmV2ZW50TGlzdGVuZXIoJ2JlZm9yZUZ1bmNDbG9zZUV2ZW50JywgdGhpcy5jbGVhclBhcmFtZXRlcnNDYWNoZS5iaW5kKHRoaXMpLCB0YWIpO1xyXG4gICAgICB0aGlzLmZ1bmNJZHMucHVzaCh0YWIudGFiSWQpO1xyXG4gICAgICByZXR1cm4gdGFiLnRhYklkICsgUnRmU2VydmljZXMuZ2V0SW5TdWl0ZUZybVVVSUQoKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xlYXJQYXJhbWV0ZXJzQ2FjaGUoKSB7XHJcbiAgICBjb25zdCB0YWJJZCA9IGFyZ3VtZW50c1swXS50YWJJZDtcclxuICAgIHRoaXMuY2FjaGUuc2V0KHRoaXMucXVlcnlJZCwgJycpO1xyXG4gICAgdGhpcy5jYWNoZS5zZXQoYXJndW1lbnRzWzBdLnRhYklkLCAnJyk7XHJcbiAgICB0aGlzLmNhY2hlLnNldChhcmd1bWVudHNbMF0udGFiSWQgKyAncmVuZGVyTW9kZScsICcnKTtcclxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5mdW5jSWRzLmZpbmRJbmRleChlbCA9PiBlbCA9PT0gdGFiSWQpO1xyXG4gICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgdGhpcy5mdW5jSWRzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgIGdzcGZyYW1ld29ya1NlcnZpY2UucnRmLmZ1bmMuY2xvc2UoYXJndW1lbnRzWzBdKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy50YWJJZCA9IFJ0ZlNlcnZpY2VzLmdldFRhYklkKHRoaXMucXVlcnlJZCk7XHJcbiAgICBRRFBDYWNoZVV0aWwuc2V0Q2FjaGUodGhpcy50YWJJZCArIHRoaXMucXVlcnlJZCArICdsY3AtY2hhcnRzJywgdGhpcyk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBmb3IgKGNvbnN0IGNoYW5nZU5hbWUgaW4gY2hhbmdlcykge1xyXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IGNoYW5nZXNbY2hhbmdlTmFtZV0uY3VycmVudFZhbHVlO1xyXG4gICAgICBpZiAobmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IHZvaWQgMCkge1xyXG4gICAgICAgIGNvbnN0IGV2ZW50SWQgPSBSdGZTZXJ2aWNlcy5nZXRUYWJJZCh0aGlzLnF1ZXJ5SWQpO1xyXG4gICAgICAgIHN3aXRjaCAoY2hhbmdlTmFtZSkge1xyXG4gICAgICAgICAgY2FzZSAncXVlcnlJZCc6XHJcbiAgICAgICAgICAgIHRoaXMucXVlcnlJZCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICBRRFBDYWNoZVV0aWwuc2V0Q2FjaGUoZXZlbnRJZCArIHRoaXMucXVlcnlJZCArICdsY3AtY2hhcnRzJywgdGhpcyk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnZXZlbnRUeXBlJzpcclxuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgRXZlbnRCdXMucmVnaXN0ZXIobmV3VmFsdWUsIHRoaXMuaGFuZGxlTGlua2FnZSwgZXZlbnRJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAvLyBpZiAodGhpcy5xb0lkKSB7IC8vIOafpeivoue7k+aenOmbhui/h+a7pOadoeS7tlxyXG4gICAgdGhpcy5maWx0ZXJTZXJ2aWNlLmdldEZpbHRlcih0aGlzLnFvTWFuYWdlckNvZGUsIHRoaXMucXVlcnlJZCwgdGhpcy5xdWVyeVJlbGF0aXZlVXJsLCAxKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgY29uc3QgY29uZGl0aW9uRXhwcmVzc2lvbiA9IEpTT04uc3RyaW5naWZ5KGRhdGEuZmlsdGVyKTtcclxuICAgICAgICB0aGlzLnJlbmRlcignJywgJycsICcnLCBjb25kaXRpb25FeHByZXNzaW9uKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnJlbmRlcignJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8gfSBlbHNlIHtcclxuICAgIC8vICAgdGhpcy5yZW5kZXIoJycpO1xyXG4gICAgLy8gfVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlTGlua2FnZSgkZXZlbnQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHBhcmFtcyA9IEpTT04uc3RyaW5naWZ5KCRldmVudCk7XHJcbiAgICAgIHRoaXMuZGVsYXlMb2FkKCcnLCB7fSwgcGFyYW1zLCB0aGlzLnF1ZXJ5UmVsYXRpdmVVcmwpO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGVsYXlMb2FkKHNjaGVtYUlkOiBhbnksIG9wdGlvbj86IGFueSwgbGlua2FnZVBhcmFtcz86IGFueSwgcXVlcnlSZWxhdGl2ZVVybD86IGFueSwgY29uZGl0aW9uRXhwcmVzc2lvbj86IGFueSkge1xyXG4gICAgaWYgKCF0aGlzLmRlbGF5KSB7XHJcbiAgICAgIHRoaXMuZGVsYXkgPSAwO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZGVsYXkgPT09IDApIHtcclxuICAgICAgdGhpcy5iaW5kRGF0YShzY2hlbWFJZCwgb3B0aW9uLCBsaW5rYWdlUGFyYW1zLCBxdWVyeVJlbGF0aXZlVXJsLCBjb25kaXRpb25FeHByZXNzaW9uKTtcclxuICAgICAgdGhpcy5pbnRlcnZhbExvYWQoc2NoZW1hSWQsIG9wdGlvbiwgbGlua2FnZVBhcmFtcywgcXVlcnlSZWxhdGl2ZVVybCwgY29uZGl0aW9uRXhwcmVzc2lvbik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmJpbmREYXRhKHNjaGVtYUlkLCBvcHRpb24sIGxpbmthZ2VQYXJhbXMsIHF1ZXJ5UmVsYXRpdmVVcmwsIGNvbmRpdGlvbkV4cHJlc3Npb24pO1xyXG4gICAgICAgIHRoaXMuaW50ZXJ2YWxMb2FkKHNjaGVtYUlkLCBvcHRpb24sIGxpbmthZ2VQYXJhbXMsIHF1ZXJ5UmVsYXRpdmVVcmwsIGNvbmRpdGlvbkV4cHJlc3Npb24pO1xyXG4gICAgICB9LCB0aGlzLmRlbGF5KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGludGVydmFsTG9hZChzY2hlbWFJZDogYW55LCBvcHRpb24/OiBhbnksIGxpbmthZ2VQYXJhbXM/OiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw/OiBhbnksIGNvbmRpdGlvbkV4cHJlc3Npb24/OiBhbnkpIHtcclxuICAgIGlmICh0aGlzLmludGVydmFsKSB7XHJcbiAgICAgIHRoaXMubXlWYXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5iaW5kRGF0YShzY2hlbWFJZCwgb3B0aW9uLCBsaW5rYWdlUGFyYW1zLCBxdWVyeVJlbGF0aXZlVXJsLCBjb25kaXRpb25FeHByZXNzaW9uKTtcclxuICAgICAgfSwgdGhpcy5pbnRlcnZhbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGVhckludGVydmFsTG9hZCgpIHtcclxuICAgIGlmICh0aGlzLm15VmFyKSB7XHJcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5teVZhcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZW5kZXIoc2NoZW1hSWQ6IGFueSwgb3B0aW9uPzogYW55LCBsaW5rYWdlUGFyYW1zPzogYW55LCBjb25kaXRpb25FeHByZXNzaW9uPzogYW55KSB7XHJcbiAgICB0aGlzLmRlbGF5TG9hZChzY2hlbWFJZCwgb3B0aW9uLCBsaW5rYWdlUGFyYW1zLCB0aGlzLnF1ZXJ5UmVsYXRpdmVVcmwsIGNvbmRpdGlvbkV4cHJlc3Npb24pO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGF0YShwYXJhbXM6IGFueSwgcXVlcnlSZWxhdGl2ZVVybDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgbGV0IHVyaSA9IHRoaXMuc2VydmVySG9zdDtcclxuICAgIGlmICh0aGlzLmxvYWREYXRhVXJpKSB7XHJcbiAgICAgIHVyaSArPSB0aGlzLmxvYWREYXRhVXJpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdXJpICs9ICghcXVlcnlSZWxhdGl2ZVVybCB8fCBxdWVyeVJlbGF0aXZlVXJsID09PSAnJykgPyAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3FkcHNlYXJjaC9xdWVyeScgOiAocXVlcnlSZWxhdGl2ZVVybCArICdxdWVyeWRhdGEnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCByZXN1bHQkID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyB0aGlzLnJlc3RmdWxTZXJ2aWNlLnBvc3QodXJpLCBxdWVyeVJlbGF0aXZlVXJsID8geyAnUGFyYW0nOiBwYXJhbXMgfSA6IHBhcmFtcywge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpXHJcbiAgICAgIDogdGhpcy5yZXN0ZnVsU2VydmljZS5wdXQodXJpLCBxdWVyeVJlbGF0aXZlVXJsID8geyAnUGFyYW0nOiBwYXJhbXMgfSA6IHBhcmFtcywge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgZGF0YSA9ICghcXVlcnlSZWxhdGl2ZVVybCB8fCBxdWVyeVJlbGF0aXZlVXJsID09PSAnJykgPyBkYXRhIDogZGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEucGFnZUluZm8pIHtcclxuICAgICAgICAgICAgc2VsZi5wYWdlSW5mb0NoYW5nZS5uZXh0KGRhdGEucGFnZUluZm8pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRDb2wocGFyYW1zOiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgdXJpID0gdGhpcy5zZXJ2ZXJIb3N0O1xyXG4gICAgaWYgKHRoaXMubG9hZERhdGFDb2wpIHtcclxuICAgICAgdXJpICs9IHRoaXMubG9hZERhdGFDb2w7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB1cmkgKz0gKCghcXVlcnlSZWxhdGl2ZVVybCB8fCBxdWVyeVJlbGF0aXZlVXJsID09PSAnJykgPyAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3FkcHNlYXJjaC8nIDogcXVlcnlSZWxhdGl2ZVVybCkgKyAncXVlcnljb2wnO1xyXG4gICAgfVxyXG4gICAgcGFyYW1zID0gKCFxdWVyeVJlbGF0aXZlVXJsIHx8IHF1ZXJ5UmVsYXRpdmVVcmwgPT09ICcnKSA/IHBhcmFtcyA6IHsgJ1BhcmFtJzogcGFyYW1zIH07XHJcbiAgICBjb25zdCByZXN1bHQkID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyB0aGlzLnJlc3RmdWxTZXJ2aWNlLnBvc3QodXJpLCBwYXJhbXMsIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKVxyXG4gICAgICA6IHRoaXMucmVzdGZ1bFNlcnZpY2UucHV0KHVyaSwgcGFyYW1zLCB7fSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICBkYXRhID0gKCFxdWVyeVJlbGF0aXZlVXJsIHx8IHF1ZXJ5UmVsYXRpdmVVcmwgPT09ICcnKSA/IGRhdGEgOiBkYXRhLnJldHVyblZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZVBhcmFtZXRlcnMocXVlcnlJZDogYW55LCBjb250cm9sVHlwZTogYW55LCBzY2hlbWFJZDogYW55LCBxb01hbmFnZXJDb2RlOiBhbnksIGV4dGVuZENvbmQ6IGFueSwgcGFnZUluZGV4OiBhbnksIHBhZ2VTaXplOiBhbnksIHByaW50SW50ZWdyYXRpb24/OiBhbnksIGV4Y2VsRXhwb3J0TmFtZT86IGFueSwgdm9JZD86IGFueSkge1xyXG4gICAgbGV0IGVudGl0eURhdGE6IGFueTtcclxuICAgIGNvbnN0IHRhYklkID0gdGhpcy5iaW5kQ2xvc2VUYWJFdmVudCgpO1xyXG4gICAgaWYgKHRoaXMuY2FjaGUuZ2V0KHRhYklkKSkge1xyXG4gICAgICBlbnRpdHlEYXRhID0gSlNPTi5zdHJpbmdpZnkodGhpcy5jYWNoZS5nZXQodGFiSWQpKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5jYWNoZS5nZXQocXVlcnlJZCkpIHtcclxuICAgICAgZW50aXR5RGF0YSA9IEpTT04uc3RyaW5naWZ5KHRoaXMuY2FjaGUuZ2V0KHF1ZXJ5SWQpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGVudGl0eURhdGEgPSBKU09OLnN0cmluZ2lmeSh7ICdpZCc6ICd1bmRlZmluZWRfbnVsbCcgfSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgIGVudGl0eURhdGE6IGVudGl0eURhdGEsXHJcbiAgICAgIGV4dGVuZENvbmQ6IGV4dGVuZENvbmQsXHJcbiAgICAgIHBhZ2VJbmRleDogcGFnZUluZGV4LFxyXG4gICAgICBwYWdlU2l6ZTogcGFnZVNpemUsXHJcbiAgICAgIHNjaGVtYUlkOiBzY2hlbWFJZCAmJiBzY2hlbWFJZCAhPT0gJ3ByZWZhYicgPyBzY2hlbWFJZCA6ICcxJyxcclxuICAgICAgZmlsdGVyQ29uZDogdGhpcy5jYWNoZS5nZXQodGFiSWQgKyAnZmlsdGVyY29uZGl0aW9uJykgPyB0aGlzLmNhY2hlLmdldCh0YWJJZCArICdmaWx0ZXJjb25kaXRpb24nKSA6ICcnLFxyXG4gICAgICBxb01hbmFnZXJDb2RlOiBxb01hbmFnZXJDb2RlID8gcW9NYW5hZ2VyQ29kZSA6ICcnLFxyXG4gICAgICB2b0NvZGU6IHZvSWQgPyB2b0lkIDogJydcclxuICAgIH07XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBwYXJhbWV0ZXJFbnRpdHlEYXRhID0gSlNPTi5wYXJzZShlbnRpdHlEYXRhKTtcclxuICAgICAgaWYgKHBhcmFtZXRlckVudGl0eURhdGEuaGFzT3duUHJvcGVydHkoJ0BmaWx0ZXJFeHByZXNzaW9uU3RyaW5nQCcpKSB7XHJcblxyXG4gICAgICAgIGNvbnN0IGZpbHRlckV4cHJlc3Npb24gPSBwYXJhbXMgJiYgcGFyYW1zLmZpbHRlckNvbmQgPyBKU09OLnBhcnNlKHBhcmFtcy5maWx0ZXJDb25kKSA6IG51bGw7XHJcbiAgICAgICAgaWYgKCFmaWx0ZXJFeHByZXNzaW9uKSB7XHJcbiAgICAgICAgICBwYXJhbXMuZmlsdGVyQ29uZCA9IHBhcmFtZXRlckVudGl0eURhdGFbJ0BmaWx0ZXJFeHByZXNzaW9uU3RyaW5nQCddO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCBhZHZhbmNlRmlsdGVyRXhwcmVzc2lvbiA9IEpTT04ucGFyc2UocGFyYW1ldGVyRW50aXR5RGF0YVsnQGZpbHRlckV4cHJlc3Npb25TdHJpbmdAJ10pO1xyXG4gICAgICAgICAgYWR2YW5jZUZpbHRlckV4cHJlc3Npb24uZXhwcmVzc0l0ZW1zID0gYWR2YW5jZUZpbHRlckV4cHJlc3Npb24uZXhwcmVzc0l0ZW1zLmNvbmNhdChmaWx0ZXJFeHByZXNzaW9uLmV4cHJlc3NJdGVtcyk7XHJcbiAgICAgICAgICBwYXJhbXMuZmlsdGVyQ29uZCA9IEpTT04uc3RyaW5naWZ5KGFkdmFuY2VGaWx0ZXJFeHByZXNzaW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgIH1cclxuICAgIGlmIChjb250cm9sVHlwZSkge1xyXG4gICAgICBwYXJhbXNbJ2NvbnRyb2xUeXBlJ10gPSBjb250cm9sVHlwZTtcclxuICAgIH1cclxuICAgIGlmIChleGNlbEV4cG9ydE5hbWUpIHtcclxuICAgICAgcGFyYW1zWydleGNlbEV4cG9ydE5hbWUnXSA9IGV4Y2VsRXhwb3J0TmFtZTtcclxuICAgIH1cclxuICAgIGlmIChwcmludEludGVncmF0aW9uKSB7XHJcbiAgICAgIHBhcmFtc1sncHJpbnRJbnRlZ3JhdGlvbiddID0gcHJpbnRJbnRlZ3JhdGlvbiA/IEpTT04uc3RyaW5naWZ5KHByaW50SW50ZWdyYXRpb24pIDogJyc7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBhcmFtcztcclxuICB9XHJcblxyXG4gIGdldFNjaGVtYUluZm8ob2JqOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBvYmouc2NoZW1hSWQgPSBvYmouc2NoZW1hSWQgPT09ICdwcmVmYWInID8gJzEnIDogb2JqLnNjaGVtYUlkO1xyXG4gICAgaWYgKCFvYmouc2NoZW1hSWQpIHtcclxuICAgICAgcmV0dXJuIHNlbGYuZ2V0RGVmYXVsdFNjaGVtYUluZm8ob2JqKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gdGhpcy5jYWNoZS5nZXQoUnRmU2VydmljZXMuZ2V0VGFiSWQob2JqLnF1ZXJ5SWQpICsgJ29yZ2FuaXphdGlvbklkJykgfHwgJyc7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnNjaGVtYU1hbmFnZXIuZ2V0U2NoZW1hKG9iai5zY2hlbWFJZCwgb2JqLnF1ZXJ5SWQsIG9iai5xdWVyeVJlbGF0aXZlVXJsLCBvYmouZ3JvdXBUeXBlLCBvcmdhbml6YXRpb25JZCk7XHJcbiAgICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgICAgc3dpdGNoTWFwKChzY2hlbWFWYWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgICBpZiAoc2NoZW1hVmFsdWUgJiYgc2NoZW1hVmFsdWVbJ2lkJ10pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9mKHNjaGVtYVZhbHVlKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vICBlbHNlIHtcclxuICAgICAgICAgIC8vICAgcmV0dXJuIHNlbGYuZ2V0RGVmYXVsdFNjaGVtYUluZm8ob2JqKTtcclxuICAgICAgICAgIC8vIH1cclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0RGVmYXVsdFNjaGVtYUluZm8ob2JqOiBhbnkpIHtcclxuICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gdGhpcy5jYWNoZS5nZXQoUnRmU2VydmljZXMuZ2V0VGFiSWQob2JqLnF1ZXJ5SWQpICsgJ29yZ2FuaXphdGlvbklkJykgfHwgJyc7XHJcbiAgICByZXR1cm4gdGhpcy5zY2hlbWFNYW5hZ2VyLmdldERlZmF1bHRTY2hlbWEob2JqLnF1ZXJ5SWQsIG9iai5xdWVyeVJlbGF0aXZlVXJsLCBvYmouZ3JvdXBUeXBlLCBvcmdhbml6YXRpb25JZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJpbmREYXRhKHNjaGVtYUlkOiBhbnksIG9wdGlvbj86IGFueSwgbGlua2FnZVBhcmFtcz86IGFueSwgcXVlcnlSZWxhdGl2ZVVybD86IGFueSwgY29uZGl0aW9uRXhwcmVzc2lvbj86IGFueSkge1xyXG4gICAgbGV0IG9wID0gb3B0aW9uO1xyXG4gICAgdGhpcy5nZXRTY2hlbWFJbmZvKHsgc2NoZW1hSWQ6IHNjaGVtYUlkLCBxdWVyeUlkOiB0aGlzLmNoYXJ0cy5xdWVyeUlkLCBxdWVyeVJlbGF0aXZlVXJsIH0pLnN1YnNjcmliZSh2YWx1ZSA9PiB7XHJcbiAgICAgIGxldCBfc2NoZW1hSWQgPSAnJztcclxuICAgICAgaWYgKHNjaGVtYUlkKSB7XHJcbiAgICAgICAgX3NjaGVtYUlkID0gc2NoZW1hSWQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHZhbHVlICYmICFfc2NoZW1hSWQpIHtcclxuICAgICAgICBfc2NoZW1hSWQgPSB2YWx1ZS5pZDtcclxuICAgICAgICBpZiAodmFsdWUuc2NoZW1hVmFsdWUuY2hhcnRzVHlwZS5zZXJpZXMudHlwZSAmJiB2YWx1ZS5zY2hlbWFWYWx1ZS5jaGFydHNUeXBlLnNlcmllcy50eXBlICE9PSAtMSkge1xyXG4gICAgICAgICAgb3AgPSBPYmplY3QuYXNzaWduKHt9LCB2YWx1ZS5zY2hlbWFWYWx1ZS5jaGFydHNEYXRhLCB2YWx1ZS5zY2hlbWFWYWx1ZS5jaGFydHNTdHlsZSk7XHJcbiAgICAgICAgICB2YWx1ZS5zY2hlbWFWYWx1ZS5jaGFydHNUeXBlLnNlcmllcy50eXBlID0gdmFsdWUuc2NoZW1hVmFsdWUuY2hhcnRzVHlwZS5zZXJpZXMudHlwZS5yZXBsYWNlKCcxJywgJycpO1xyXG4gICAgICAgICAgb3Auc2VyaWVzLnR5cGUgPSB2YWx1ZS5zY2hlbWFWYWx1ZS5jaGFydHNUeXBlLnNlcmllcy50eXBlO1xyXG4gICAgICAgICAgaWYgKG9wLnNlcmllcy50eXBlICE9PSAnbGluZTEnKSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBvcC5zZXJpZXMuYXJlYVN0eWxlO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3Auc2VyaWVzLmFyZWFTdHlsZSA9IHt9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpZiAodmFsdWUgJiYgdmFsdWUuc2NoZW1hVmFsdWUgJiYgdmFsdWUuc2NoZW1hVmFsdWUuY3VzdG9tT3B0aW9uKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIG9wID0gT2JqZWN0LmFzc2lnbih7fSwgb3AsIEpTT04ucGFyc2UodmFsdWUuc2NoZW1hVmFsdWUuY3VzdG9tT3B0aW9uKSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgb3AgPSBPYmplY3QuYXNzaWduKHt9LCBvcCwgdmFsdWUuc2NoZW1hVmFsdWUuY3VzdG9tT3B0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGVudGl0eURhdGE6IGFueSA9ICcnO1xyXG4gICAgICBpZiAodGhpcy5jYWNoZS5nZXQodGhpcy5jaGFydHMucXVlcnlJZCkpIHtcclxuICAgICAgICBlbnRpdHlEYXRhID0gSlNPTi5zdHJpbmdpZnkodGhpcy5jYWNoZS5nZXQodGhpcy5jaGFydHMucXVlcnlJZCkpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChsaW5rYWdlUGFyYW1zKSB7XHJcbiAgICAgICAgZW50aXR5RGF0YSA9IGxpbmthZ2VQYXJhbXM7XHJcbiAgICAgIH1cclxuICAgICAgLy8gVE9ETzogbW9ya1xyXG4gICAgICBjb25zdCBwYXJhbXMgPSB0aGlzLmNyZWF0ZVBhcmFtZXRlcnModGhpcy5xdWVyeUlkLCAnY2hhcnRzJywgX3NjaGVtYUlkLCB0aGlzLnFvTWFuYWdlckNvZGUsICcnLCAwLCAwLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdGhpcy52b0lkKTtcclxuICAgICAgcGFyYW1zWydxdWVyeUlkJ10gPSB0aGlzLnF1ZXJ5SWQgPyB0aGlzLnF1ZXJ5SWQgOiAnJztcclxuICAgICAgaWYgKHRoaXMucW9NYW5hZ2VyQ29kZSkge1xyXG4gICAgICAgIHBhcmFtc1sncW9NYW5hZ2VyQ29kZSddID0gdGhpcy5xb01hbmFnZXJDb2RlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChfc2NoZW1hSWQgJiYgX3NjaGVtYUlkICE9PSAncHJlZmFiJykge1xyXG4gICAgICAgIHBhcmFtc1snc2NoZW1hSWQnXSA9IF9zY2hlbWFJZDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwYXJhbXNbJ3NjaGVtYUlkJ10gPSAnMSc7XHJcbiAgICAgIH1cclxuICAgICAgLy8g5p+l6K+i5pWw5o2u5YmN5LqL5Lu2XHJcbiAgICAgIGlmICh0aGlzLmRhdGFSZW5kZXJFeHRlbmRTZXJ2aWNlICYmIHRoaXMuZGF0YVJlbmRlckV4dGVuZFNlcnZpY2UuYmVmb3JlUXVlcnlEYXRhKSB7XHJcbiAgICAgICAgdGhpcy5kYXRhUmVuZGVyRXh0ZW5kU2VydmljZS5iZWZvcmVRdWVyeURhdGEodGhpcy5jcmVhdGVFdmVudFBhcmFtcygnYmVmb3JlUXVlcnlEYXRhJywgJ+afpeivouaVsOaNruWJjScsIHBhcmFtcywgdGhpcy5jaGFydHMpKTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgdGhpcy5jYWNoZS5zZXQodGhpcy50YWJJZCwgSlNPTi5wYXJzZShwYXJhbXNbJ2VudGl0eURhdGEnXSkpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDmt7vliqDliJdcclxuICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICAgIHNlbGYuZ2V0RGF0YShwYXJhbXMsIHF1ZXJ5UmVsYXRpdmVVcmwpLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgc2VsZi5nZXRDb2wocGFyYW1zLCBxdWVyeVJlbGF0aXZlVXJsKS5zdWJzY3JpYmUocmVzdWx0RGF0YSA9PiB7XHJcbiAgICAgICAgICBpZiAoIWRhdGEuZHluYW1pY0NvbHMgfHwgZGF0YS5keW5hbWljQ29scy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgZGF0YS5keW5hbWljQ29scyA9IHJlc3VsdERhdGEuZHluYW1pY0NvbHMgfHwgW107XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXN1bHREYXRhLmR5bmFtaWNDb2xzLmZvckVhY2goY29sID0+IHtcclxuICAgICAgICAgICAgICBkYXRhLmR5bmFtaWNDb2xzLnB1c2goY29sKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmR5bmFtaWNDb2xzICYmIGRhdGEuZHluYW1pY0NvbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGpvaW5QYXJhbSA9IHt9O1xyXG4gICAgICAgICAgICBqb2luUGFyYW1bJ2NvbnRyb2xUeXBlJ10gPSAnY2hhcnRzJztcclxuICAgICAgICAgICAgam9pblBhcmFtWydjb2xMaXN0J10gPSBkYXRhLmR5bmFtaWNDb2xzO1xyXG4gICAgICAgICAgICBzZWxmLmNhY2hlLnNldChzZWxmLnRhYklkICsgJ2pvaW5TZWFyY2gnLCBqb2luUGFyYW0pO1xyXG4gICAgICAgICAgICBzZWxmLnNjaGVtYU1hbmFnZXIuY29sTGlzdC5uZXh0KGRhdGEuZHluYW1pY0NvbHMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgLy8g5pWw5o2u5Yqg6L295YmN5LqL5Lu2XHJcbiAgICAgICAgICBpZiAob3AgJiYgb3Auc2VyaWVzICYmIG9wLnNlcmllcy50eXBlKSB7XHJcbiAgICAgICAgICAgIG9wLnNlcmllcy50eXBlID0gb3Auc2VyaWVzLnR5cGUucmVwbGFjZSgnMScsICcnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuZGF0YSAmJiBkYXRhLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHNlbGYuY2hhcnRzLnNldERhdGEoZGF0YS5kYXRhLCBvcCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWxmLmNoYXJ0cy5zZXREYXRhKFtdLCBvcCk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8g6aG16Z2i5riy5p+T5ZCO5LqL5Lu2XHJcbiAgICAgICAgICBpZiAoc2VsZi5kYXRhUmVuZGVyRXh0ZW5kU2VydmljZSAmJiBzZWxmLmRhdGFSZW5kZXJFeHRlbmRTZXJ2aWNlLmFmdGVyTG9hZERhdGEpIHtcclxuICAgICAgICAgICAgc2VsZi5kYXRhUmVuZGVyRXh0ZW5kU2VydmljZS5iZWZvcmVMb2FkRGF0YShzZWxmLmNyZWF0ZUV2ZW50UGFyYW1zKCdhZnRlckxvYWREYXRhJywgJ+a4suafk+WQjuS6i+S7ticsIGRhdGEsIHNlbGYuY2hhcnRzKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzZWxmLmNhY2hlLnNldChzZWxmLmNoYXJ0cy5xdWVyeUlkICsgJ2VjaGFydHNjb25maWcnLCBvcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZUhlYWRlclNlc3Npb25JZCgpIHtcclxuICAgIHJldHVybiBSdGZTZXJ2aWNlcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQodGhpcy5zZXNzaW9uU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZUV2ZW50UGFyYW1zKGV2ZW50Q29kZTogYW55LCBldmVudE5hbWU6IGFueSwgZGF0YTogYW55LCBjb250cm9sOiBhbnkpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGV2ZW50Q29kZSxcclxuICAgICAgZXZlbnROYW1lLFxyXG4gICAgICBkYXRhLFxyXG4gICAgICBjb250cm9sXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG4iXX0=
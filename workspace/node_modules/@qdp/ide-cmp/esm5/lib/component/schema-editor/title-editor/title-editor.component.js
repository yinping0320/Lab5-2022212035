/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Injector } from '@angular/core';
import { LocalizeService } from '@qdp/localize';
import { LcpService } from '@qdp/common';
var TitleEditorComponent = /** @class */ (function () {
    function TitleEditorComponent(injector) {
        this.injector = injector;
        this.columnSizeData = [
            60, 90, 160, 80, 80
        ];
        this.subTitleType = [
            { label: '副标题', value: 0 },
            { label: '表尾', value: 1 }
        ];
        this.subTitleAlign = [
            { label: '居左', value: 0 },
            { label: '居中', value: 1 },
            { label: '居右', value: 2 }
        ];
        this.newSubTitle = {
            type: 0,
            text: '',
            level: 1,
            align: 0
        };
        this.alignData = [];
        this.currentSubTitle = null;
        this.localizeService = this.injector.get(LocalizeService);
        this.lcpService = this.injector.get(LcpService);
        this.subTitleType = this.localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleData');
        this.subTitleAlign = this.localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleAlign');
    }
    /**
     * @return {?}
     */
    TitleEditorComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var self = this;
        if (!this.subscriptions) {
            this.subscriptions = [];
        }
        this.subscriptions.push(self.lcpService.variablesChange.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                var _loop_1 = function (key) {
                    // if (key === 'securityLevel') { continue; }
                    if (self.alignData.findIndex((/**
                     * @param {?} x
                     * @return {?}
                     */
                    function (x) { return x.name.replace(x.name.substring(x.name.indexOf('[')), "").replace(/ /g, "") === key; })) < 0) {
                        self.alignData.push({ name: key + '   [' + data[key] + ']', value: key });
                    }
                };
                for (var key in data) {
                    _loop_1(key);
                }
            }
        })));
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    TitleEditorComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        for (var changeName in changes) {
            /** @type {?} */
            var newValue = changes[changeName].currentValue;
            if (newValue !== null && newValue !== void 0) {
                switch (changeName) {
                    case 'currSchema':
                        if (newValue.schemaValue && newValue.schemaValue.titleOption) {
                            /** @type {?} */
                            var str = JSON.stringify(newValue.schemaValue.titleOption);
                            this.titleOption = JSON.parse(str);
                            this.title = this.titleOption.title;
                            this.subTitles = this.titleOption.subTitles || [];
                        }
                        break;
                }
            }
        }
    };
    /**
     * @return {?}
     */
    TitleEditorComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (this.subscriptions && this.subscriptions.length) {
            try {
                for (var _b = tslib_1.__values(this.subscriptions), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var subscription = _c.value;
                    subscription.unsubscribe();
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    TitleEditorComponent.prototype.insertSubTitle = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        /** @type {?} */
        var _newSubTitle = Object.assign({}, this.newSubTitle);
        // if (index === 0) {
        //   this.subTitles.unshift(_newSubTitle);
        // } else {
        this.subTitles.splice(index + 1, 0, _newSubTitle);
        // }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    TitleEditorComponent.prototype.removeSubTitle = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        this.subTitles.splice(index, 1);
        if (this.currentSubTitle) {
            if (index === this.currentSubTitle.index) {
                this.currentSubTitle = null;
            }
        }
    };
    /**
     * @return {?}
     */
    TitleEditorComponent.prototype.onAddSubTitle = /**
     * @return {?}
     */
    function () {
        this.subTitles = tslib_1.__spread(this.subTitles);
        this.subTitles.push(Object.assign({}, this.newSubTitle));
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    TitleEditorComponent.prototype.selected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.currentSubTitle = $event;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    TitleEditorComponent.prototype.isSelected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.currentSubTitle) {
            return this.currentSubTitle.index === $event;
        }
        return false;
    };
    /**
     * @return {?}
     */
    TitleEditorComponent.prototype.getTitleOption = /**
     * @return {?}
     */
    function () {
        if (this.titleOption) {
            this.titleOption.title = this.title;
            this.titleOption.subTitles = this.subTitles;
        }
        return this.titleOption;
    };
    TitleEditorComponent.decorators = [
        { type: Component, args: [{
                    selector: 'title-editor',
                    template: "<div class=\"d-flex flex-column flex-fill position-relative h-100 m-0\">\r\n  <div class=\"farris-group-wrap form-inline farris-form-inline m-2\">\r\n    <div class=\"form-group farris-group-wrap mb-0\">\r\n      <label class=\"mr-2\" for=\"titleID\">\r\n        <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.schemaManager.titleOption.title')}}:</span>\r\n      </label>\r\n      <div class=\"farris-input-wrap\">\r\n        <input-group  id=\"titleID\" [(ngModel)]=\"title\" ></input-group>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"table-header\">\r\n    <table class=\"table table-bordered mb-0\">\r\n      <colgroup>\r\n        <col *ngFor=\"let s of columnSizeData\" [style.width]=\" s + 'px'\">\r\n      </colgroup>\r\n      <thead>\r\n        <tr>\r\n          <th>\r\n            <button type=\"button\" (click)=\"onAddSubTitle()\" class=\"btn btn-link\" style=\"color: black;\"><span\r\n                class=\"f-icon f-icon-plus\"></span></button>\r\n          </th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[0]}}</b></th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[1]}}</b></th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[2]}}</b></th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[3]}}</b></th>\r\n        </tr>\r\n      </thead>\r\n    </table>\r\n  </div>\r\n  <perfect-scrollbar [config]=\"{}\" [style.height.px]=\"205\">\r\n    <div class=\"table-body flex-fill\" style=\"overflow: hidden\" #tablebodybox>\r\n      <table class=\"table table-bordered\">\r\n        <colgroup>\r\n          <col *ngFor=\"let s of columnSizeData\" [style.width.px]=\"s\">\r\n        </colgroup>\r\n        <tbody>\r\n          <tr *ngFor=\"let sub of subTitles; let index=index;\" (click)=\"selected({'index':index, 'sub': sub})\"\r\n            [class.selected]=\"isSelected(index)\">\r\n            <td>\r\n              <button type=\"button\" (click)=\"insertSubTitle(index)\" class=\"btn btn-link\" style=\"color: black;\"><span\r\n                  class=\"f-icon f-icon-plus\"></span></button>\r\n              <button type=\"button\" (click)=\"removeSubTitle(index)\" class=\"btn btn-link\" style=\"color: black;\"><span\r\n                  class=\"f-icon f-icon-minus\"></span></button>\r\n            </td>\r\n            <td>\r\n              <select class=\"form-control filter-select\" [(ngModel)]=\"sub.type\" name=\"subType\">\r\n                <option *ngFor=\"let item of subTitleType\" [value]=\"item.value\">{{ item.label }}</option>\r\n              </select>\r\n            </td>\r\n            <td>\r\n              <farris-combo-list [(ngModel)]=\"sub.text\" [data]=\"alignData\" [textField]=\"'name'\" [idField]=\"'value'\" [nosearch]=\"true\" [editable]=\"true\"></farris-combo-list>\r\n              <!-- <input-group type=\"text\" style=\"width:100%\" placeholder=\"\" name=\"value\"\r\n                [(ngModel)]=\"sub.text\"></input-group> -->\r\n            </td>\r\n            <td>\r\n              <farris-number-spinner [(ngModel)]=\"sub.level\" [min]=\"1\" [step]=\"1\"></farris-number-spinner>\r\n            </td>\r\n            <td>\r\n              <select class=\"form-control filter-select\" [(ngModel)]=\"sub.align\" name=\"subAlign\">\r\n                <option *ngFor=\"let item of subTitleAlign\" [value]=\"item.value\">{{ item.label }}</option>\r\n              </select>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </perfect-scrollbar>\r\n</div>\r\n",
                    styles: [".filter-select{width:100%;padding-left:0;padding-right:0}.selected{background:#c2e4ff}:host{position:absolute;top:0;left:0;right:0;bottom:0}"]
                }] }
    ];
    /** @nocollapse */
    TitleEditorComponent.ctorParameters = function () { return [
        { type: Injector }
    ]; };
    TitleEditorComponent.propDecorators = {
        currSchema: [{ type: Input }]
    };
    return TitleEditorComponent;
}());
export { TitleEditorComponent };
if (false) {
    /** @type {?} */
    TitleEditorComponent.prototype.currSchema;
    /** @type {?} */
    TitleEditorComponent.prototype.titleOption;
    /** @type {?} */
    TitleEditorComponent.prototype.title;
    /** @type {?} */
    TitleEditorComponent.prototype.subTitles;
    /** @type {?} */
    TitleEditorComponent.prototype.columnSizeData;
    /** @type {?} */
    TitleEditorComponent.prototype.subTitleType;
    /** @type {?} */
    TitleEditorComponent.prototype.subTitleAlign;
    /**
     * @type {?}
     * @private
     */
    TitleEditorComponent.prototype.newSubTitle;
    /** @type {?} */
    TitleEditorComponent.prototype.localizeService;
    /** @type {?} */
    TitleEditorComponent.prototype.alignData;
    /** @type {?} */
    TitleEditorComponent.prototype.currentSubTitle;
    /** @type {?} */
    TitleEditorComponent.prototype.lcpService;
    /**
     * @type {?}
     * @private
     */
    TitleEditorComponent.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    TitleEditorComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGl0bGUtZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvaWRlLWNtcC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnQvc2NoZW1hLWVkaXRvci90aXRsZS1lZGl0b3IvdGl0bGUtZWRpdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQW9DLEtBQUssRUFBRSxRQUFRLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDeEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBR3pDO0lBcUNFLDhCQUFvQixRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBM0J0QyxtQkFBYyxHQUFRO1lBQ3BCLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFO1NBQ3BCLENBQUM7UUFDRixpQkFBWSxHQUFRO1lBQ2xCLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQzFCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1NBQzFCLENBQUM7UUFDRixrQkFBYSxHQUFRO1lBQ25CLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQ3pCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQ3pCLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1NBQzFCLENBQUM7UUFDTSxnQkFBVyxHQUFHO1lBQ3BCLElBQUksRUFBRSxDQUFDO1lBQ1AsSUFBSSxFQUFFLEVBQUU7WUFDUixLQUFLLEVBQUUsQ0FBQztZQUNSLEtBQUssRUFBRSxDQUFDO1NBQ1QsQ0FBQztRQUdGLGNBQVMsR0FBRyxFQUFF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LENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQztTQUM5QztRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQzs7OztJQUVELDZDQUFjOzs7SUFBZDtRQUNFLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ3BDLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7U0FDN0M7UUFDRCxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDMUIsQ0FBQzs7Z0JBaElGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsY0FBYztvQkFDeEIsd3BIQUE0Qzs7aUJBRTdDOzs7O2dCQVQ0RCxRQUFROzs7NkJBV2xFLEtBQUs7O0lBMkhSLDJCQUFDO0NBQUEsQUFqSUQsSUFpSUM7U0E1SFksb0JBQW9COzs7SUFDL0IsMENBQXlCOztJQUN6QiwyQ0FBaUI7O0lBQ2pCLHFDQUFXOztJQUNYLHlDQUFpQjs7SUFDakIsOENBRUU7O0lBQ0YsNENBR0U7O0lBQ0YsNkNBSUU7Ozs7O0lBQ0YsMkNBS0U7O0lBQ0YsK0NBQWlDOztJQUVqQyx5Q0FBZTs7SUFFZiwrQ0FBeUQ7O0lBRXpELDBDQUF1Qjs7Ozs7SUFDdkIsNkNBQXNDOzs7OztJQUUxQix3Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgSW5qZWN0b3IsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBMb2NhbGl6ZVNlcnZpY2UgfSBmcm9tICdAcWRwL2xvY2FsaXplJztcclxuaW1wb3J0IHsgTGNwU2VydmljZSB9IGZyb20gJ0BxZHAvY29tbW9uJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3RpdGxlLWVkaXRvcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3RpdGxlLWVkaXRvci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vdGl0bGUtZWRpdG9yLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGl0bGVFZGl0b3JDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcclxuICBASW5wdXQoKSBjdXJyU2NoZW1hOiBhbnk7XHJcbiAgdGl0bGVPcHRpb246IGFueTtcclxuICB0aXRsZTogYW55O1xyXG4gIHN1YlRpdGxlczogYW55W107XHJcbiAgY29sdW1uU2l6ZURhdGE6IGFueSA9IFtcclxuICAgIDYwLCA5MCwgMTYwLCA4MCwgODBcclxuICBdO1xyXG4gIHN1YlRpdGxlVHlwZTogYW55ID0gW1xyXG4gICAgeyBsYWJlbDogJ+WJr+agh+mimCcsIHZhbHVlOiAwIH0sXHJcbiAgICB7IGxhYmVsOiAn6KGo5bC+JywgdmFsdWU6IDEgfVxyXG4gIF07XHJcbiAgc3ViVGl0bGVBbGlnbjogYW55ID0gW1xyXG4gICAgeyBsYWJlbDogJ+WxheW3picsIHZhbHVlOiAwIH0sXHJcbiAgICB7IGxhYmVsOiAn5bGF5LitJywgdmFsdWU6IDEgfSxcclxuICAgIHsgbGFiZWw6ICflsYXlj7MnLCB2YWx1ZTogMiB9XHJcbiAgXTtcclxuICBwcml2YXRlIG5ld1N1YlRpdGxlID0ge1xyXG4gICAgdHlwZTogMCxcclxuICAgIHRleHQ6ICcnLFxyXG4gICAgbGV2ZWw6IDEsXHJcbiAgICBhbGlnbjogMFxyXG4gIH07XHJcbiAgbG9jYWxpemVTZXJ2aWNlOiBMb2NhbGl6ZVNlcnZpY2U7XHJcblxyXG4gIGFsaWduRGF0YSA9IFtdO1xyXG5cclxuICBjdXJyZW50U3ViVGl0bGU6IHsgaW5kZXg6IG51bWJlciwgc3ViVGl0bGU6IGFueSB9ID0gbnVsbDtcclxuXHJcbiAgbGNwU2VydmljZTogTGNwU2VydmljZTtcclxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGluamVjdG9yOiBJbmplY3Rvcikge1xyXG4gICAgdGhpcy5sb2NhbGl6ZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGl6ZVNlcnZpY2UpO1xyXG4gICAgdGhpcy5sY3BTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTGNwU2VydmljZSk7XHJcbiAgICB0aGlzLnN1YlRpdGxlVHlwZSA9IHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuc2NoZW1hTWFuYWdlci50aXRsZU9wdGlvbi5zdWJUaXRsZURhdGEnKTtcclxuICAgIHRoaXMuc3ViVGl0bGVBbGlnbiA9IHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAuc2NoZW1hTWFuYWdlci50aXRsZU9wdGlvbi5zdWJUaXRsZUFsaWduJyk7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKCF0aGlzLnN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XHJcbiAgICB9XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzZWxmLmxjcFNlcnZpY2UudmFyaWFibGVzQ2hhbmdlLnN1YnNjcmliZSgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xyXG4gICAgICAgICAgLy8gaWYgKGtleSA9PT0gJ3NlY3VyaXR5TGV2ZWwnKSB7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICBpZiAoc2VsZi5hbGlnbkRhdGEuZmluZEluZGV4KHggPT4geC5uYW1lLnJlcGxhY2UoeC5uYW1lLnN1YnN0cmluZyh4Lm5hbWUuaW5kZXhPZignWycpKSwgXCJcIikucmVwbGFjZSgvIC9nLCBcIlwiKSA9PT0ga2V5KSA8IDApIHtcclxuICAgICAgICAgICAgc2VsZi5hbGlnbkRhdGEucHVzaCh7IG5hbWU6IGtleSArICcgICBbJyArIGRhdGFba2V5XSArICddJywgdmFsdWU6IGtleSB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGZvciAoY29uc3QgY2hhbmdlTmFtZSBpbiBjaGFuZ2VzKSB7XHJcbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gY2hhbmdlc1tjaGFuZ2VOYW1lXS5jdXJyZW50VmFsdWU7XHJcbiAgICAgIGlmIChuZXdWYWx1ZSAhPT0gbnVsbCAmJiBuZXdWYWx1ZSAhPT0gdm9pZCAwKSB7XHJcbiAgICAgICAgc3dpdGNoIChjaGFuZ2VOYW1lKSB7XHJcbiAgICAgICAgICBjYXNlICdjdXJyU2NoZW1hJzpcclxuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlLnNjaGVtYVZhbHVlICYmIG5ld1ZhbHVlLnNjaGVtYVZhbHVlLnRpdGxlT3B0aW9uKSB7XHJcbiAgICAgICAgICAgICAgY29uc3Qgc3RyID0gSlNPTi5zdHJpbmdpZnkobmV3VmFsdWUuc2NoZW1hVmFsdWUudGl0bGVPcHRpb24pO1xyXG4gICAgICAgICAgICAgIHRoaXMudGl0bGVPcHRpb24gPSBKU09OLnBhcnNlKHN0cik7XHJcbiAgICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMudGl0bGVPcHRpb24udGl0bGU7XHJcbiAgICAgICAgICAgICAgdGhpcy5zdWJUaXRsZXMgPSB0aGlzLnRpdGxlT3B0aW9uLnN1YlRpdGxlcyB8fCBbXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9ucyAmJiB0aGlzLnN1YnNjcmlwdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgIGZvciAoY29uc3Qgc3Vic2NyaXB0aW9uIG9mIHRoaXMuc3Vic2NyaXB0aW9ucykge1xyXG4gICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpbnNlcnRTdWJUaXRsZShpbmRleDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBfbmV3U3ViVGl0bGUgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm5ld1N1YlRpdGxlKTtcclxuICAgIC8vIGlmIChpbmRleCA9PT0gMCkge1xyXG4gICAgLy8gICB0aGlzLnN1YlRpdGxlcy51bnNoaWZ0KF9uZXdTdWJUaXRsZSk7XHJcbiAgICAvLyB9IGVsc2Uge1xyXG4gICAgdGhpcy5zdWJUaXRsZXMuc3BsaWNlKGluZGV4ICsgMSwgMCwgX25ld1N1YlRpdGxlKTtcclxuICAgIC8vIH1cclxuICB9XHJcblxyXG4gIHJlbW92ZVN1YlRpdGxlKGluZGV4OiBudW1iZXIpIHtcclxuICAgIHRoaXMuc3ViVGl0bGVzLnNwbGljZShpbmRleCwgMSk7XHJcblxyXG4gICAgaWYgKHRoaXMuY3VycmVudFN1YlRpdGxlKSB7XHJcbiAgICAgIGlmIChpbmRleCA9PT0gdGhpcy5jdXJyZW50U3ViVGl0bGUuaW5kZXgpIHtcclxuICAgICAgICB0aGlzLmN1cnJlbnRTdWJUaXRsZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uQWRkU3ViVGl0bGUoKSB7XHJcbiAgICB0aGlzLnN1YlRpdGxlcyA9IFsuLi50aGlzLnN1YlRpdGxlc107XHJcbiAgICB0aGlzLnN1YlRpdGxlcy5wdXNoKE9iamVjdC5hc3NpZ24oe30sIHRoaXMubmV3U3ViVGl0bGUpKTtcclxuICB9XHJcblxyXG4gIHNlbGVjdGVkKCRldmVudCkge1xyXG4gICAgdGhpcy5jdXJyZW50U3ViVGl0bGUgPSAkZXZlbnQ7XHJcbiAgfVxyXG5cclxuICBpc1NlbGVjdGVkKCRldmVudDogbnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50U3ViVGl0bGUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFN1YlRpdGxlLmluZGV4ID09PSAkZXZlbnQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBnZXRUaXRsZU9wdGlvbigpIHtcclxuICAgIGlmICh0aGlzLnRpdGxlT3B0aW9uKSB7XHJcbiAgICAgIHRoaXMudGl0bGVPcHRpb24udGl0bGUgPSB0aGlzLnRpdGxlO1xyXG4gICAgICB0aGlzLnRpdGxlT3B0aW9uLnN1YlRpdGxlcyA9IHRoaXMuc3ViVGl0bGVzO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMudGl0bGVPcHRpb247XHJcbiAgfVxyXG59XHJcbiJdfQ==
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Injector } from '@angular/core';
import { LocalizeService } from '@qdp/localize';
import { LcpService } from '@qdp/common';
export class TitleEditorComponent {
    /**
     * @param {?} injector
     */
    constructor(injector) {
        this.injector = injector;
        this.columnSizeData = [
            60, 90, 160, 80, 80
        ];
        this.subTitleType = [
            { label: '副标题', value: 0 },
            { label: '表尾', value: 1 }
        ];
        this.subTitleAlign = [
            { label: '居左', value: 0 },
            { label: '居中', value: 1 },
            { label: '居右', value: 2 }
        ];
        this.newSubTitle = {
            type: 0,
            text: '',
            level: 1,
            align: 0
        };
        this.alignData = [];
        this.currentSubTitle = null;
        this.localizeService = this.injector.get(LocalizeService);
        this.lcpService = this.injector.get(LcpService);
        this.subTitleType = this.localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleData');
        this.subTitleAlign = this.localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleAlign');
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const self = this;
        if (!this.subscriptions) {
            this.subscriptions = [];
        }
        this.subscriptions.push(self.lcpService.variablesChange.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data) {
                for (const key in data) {
                    // if (key === 'securityLevel') { continue; }
                    if (self.alignData.findIndex((/**
                     * @param {?} x
                     * @return {?}
                     */
                    x => x.name.replace(x.name.substring(x.name.indexOf('[')), "").replace(/ /g, "") === key)) < 0) {
                        self.alignData.push({ name: key + '   [' + data[key] + ']', value: key });
                    }
                }
            }
        })));
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        for (const changeName in changes) {
            /** @type {?} */
            const newValue = changes[changeName].currentValue;
            if (newValue !== null && newValue !== void 0) {
                switch (changeName) {
                    case 'currSchema':
                        if (newValue.schemaValue && newValue.schemaValue.titleOption) {
                            /** @type {?} */
                            const str = JSON.stringify(newValue.schemaValue.titleOption);
                            this.titleOption = JSON.parse(str);
                            this.title = this.titleOption.title;
                            this.subTitles = this.titleOption.subTitles || [];
                        }
                        break;
                }
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.subscriptions && this.subscriptions.length) {
            for (const subscription of this.subscriptions) {
                subscription.unsubscribe();
            }
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    insertSubTitle(index) {
        /** @type {?} */
        const _newSubTitle = Object.assign({}, this.newSubTitle);
        // if (index === 0) {
        //   this.subTitles.unshift(_newSubTitle);
        // } else {
        this.subTitles.splice(index + 1, 0, _newSubTitle);
        // }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    removeSubTitle(index) {
        this.subTitles.splice(index, 1);
        if (this.currentSubTitle) {
            if (index === this.currentSubTitle.index) {
                this.currentSubTitle = null;
            }
        }
    }
    /**
     * @return {?}
     */
    onAddSubTitle() {
        this.subTitles = [...this.subTitles];
        this.subTitles.push(Object.assign({}, this.newSubTitle));
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    selected($event) {
        this.currentSubTitle = $event;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    isSelected($event) {
        if (this.currentSubTitle) {
            return this.currentSubTitle.index === $event;
        }
        return false;
    }
    /**
     * @return {?}
     */
    getTitleOption() {
        if (this.titleOption) {
            this.titleOption.title = this.title;
            this.titleOption.subTitles = this.subTitles;
        }
        return this.titleOption;
    }
}
TitleEditorComponent.decorators = [
    { type: Component, args: [{
                selector: 'title-editor',
                template: "<div class=\"d-flex flex-column flex-fill position-relative h-100 m-0\">\r\n  <div class=\"farris-group-wrap form-inline farris-form-inline m-2\">\r\n    <div class=\"form-group farris-group-wrap mb-0\">\r\n      <label class=\"mr-2\" for=\"titleID\">\r\n        <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.schemaManager.titleOption.title')}}:</span>\r\n      </label>\r\n      <div class=\"farris-input-wrap\">\r\n        <input-group  id=\"titleID\" [(ngModel)]=\"title\" ></input-group>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"table-header\">\r\n    <table class=\"table table-bordered mb-0\">\r\n      <colgroup>\r\n        <col *ngFor=\"let s of columnSizeData\" [style.width]=\" s + 'px'\">\r\n      </colgroup>\r\n      <thead>\r\n        <tr>\r\n          <th>\r\n            <button type=\"button\" (click)=\"onAddSubTitle()\" class=\"btn btn-link\" style=\"color: black;\"><span\r\n                class=\"f-icon f-icon-plus\"></span></button>\r\n          </th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[0]}}</b></th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[1]}}</b></th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[2]}}</b></th>\r\n          <th><b>{{localizeService.getValue('ideCmp.schemaManager.titleOption.subTitleColumnName')[3]}}</b></th>\r\n        </tr>\r\n      </thead>\r\n    </table>\r\n  </div>\r\n  <perfect-scrollbar [config]=\"{}\" [style.height.px]=\"205\">\r\n    <div class=\"table-body flex-fill\" style=\"overflow: hidden\" #tablebodybox>\r\n      <table class=\"table table-bordered\">\r\n        <colgroup>\r\n          <col *ngFor=\"let s of columnSizeData\" [style.width.px]=\"s\">\r\n        </colgroup>\r\n        <tbody>\r\n          <tr *ngFor=\"let sub of subTitles; let index=index;\" (click)=\"selected({'index':index, 'sub': sub})\"\r\n            [class.selected]=\"isSelected(index)\">\r\n            <td>\r\n              <button type=\"button\" (click)=\"insertSubTitle(index)\" class=\"btn btn-link\" style=\"color: black;\"><span\r\n                  class=\"f-icon f-icon-plus\"></span></button>\r\n              <button type=\"button\" (click)=\"removeSubTitle(index)\" class=\"btn btn-link\" style=\"color: black;\"><span\r\n                  class=\"f-icon f-icon-minus\"></span></button>\r\n            </td>\r\n            <td>\r\n              <select class=\"form-control filter-select\" [(ngModel)]=\"sub.type\" name=\"subType\">\r\n                <option *ngFor=\"let item of subTitleType\" [value]=\"item.value\">{{ item.label }}</option>\r\n              </select>\r\n            </td>\r\n            <td>\r\n              <farris-combo-list [(ngModel)]=\"sub.text\" [data]=\"alignData\" [textField]=\"'name'\" [idField]=\"'value'\" [nosearch]=\"true\" [editable]=\"true\"></farris-combo-list>\r\n              <!-- <input-group type=\"text\" style=\"width:100%\" placeholder=\"\" name=\"value\"\r\n                [(ngModel)]=\"sub.text\"></input-group> -->\r\n            </td>\r\n            <td>\r\n              <farris-number-spinner [(ngModel)]=\"sub.level\" [min]=\"1\" [step]=\"1\"></farris-number-spinner>\r\n            </td>\r\n            <td>\r\n              <select class=\"form-control filter-select\" [(ngModel)]=\"sub.align\" name=\"subAlign\">\r\n                <option *ngFor=\"let item of subTitleAlign\" [value]=\"item.value\">{{ item.label }}</option>\r\n              </select>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </perfect-scrollbar>\r\n</div>\r\n",
                styles: [".filter-select{width:100%;padding-left:0;padding-right:0}.selected{background:#c2e4ff}:host{position:absolute;top:0;left:0;right:0;bottom:0}"]
            }] }
];
/** @nocollapse */
TitleEditorComponent.ctorParameters = () => [
    { type: Injector }
];
TitleEditorComponent.propDecorators = {
    currSchema: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    TitleEditorComponent.prototype.currSchema;
    /** @type {?} */
    TitleEditorComponent.prototype.titleOption;
    /** @type {?} */
    TitleEditorComponent.prototype.title;
    /** @type {?} */
    TitleEditorComponent.prototype.subTitles;
    /** @type {?} */
    TitleEditorComponent.prototype.columnSizeData;
    /** @type {?} */
    TitleEditorComponent.prototype.subTitleType;
    /** @type {?} */
    TitleEditorComponent.prototype.subTitleAlign;
    /**
     * @type {?}
     * @private
     */
    TitleEditorComponent.prototype.newSubTitle;
    /** @type {?} */
    TitleEditorComponent.prototype.localizeService;
    /** @type {?} */
    TitleEditorComponent.prototype.alignData;
    /** @type {?} */
    TitleEditorComponent.prototype.currentSubTitle;
    /** @type {?} */
    TitleEditorComponent.prototype.lcpService;
    /**
     * @type {?}
     * @private
     */
    TitleEditorComponent.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    TitleEditorComponent.prototype.injector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGl0bGUtZWRpdG9yLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvaWRlLWNtcC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnQvc2NoZW1hLWVkaXRvci90aXRsZS1lZGl0b3IvdGl0bGUtZWRpdG9yLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBb0MsS0FBSyxFQUFFLFFBQVEsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN4RyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFRekMsTUFBTSxPQUFPLG9CQUFvQjs7OztJQWdDL0IsWUFBb0IsUUFBa0I7UUFBbEIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQTNCdEMsbUJBQWMsR0FBUTtZQUNwQixFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRTtTQUNwQixDQUFDO1FBQ0YsaUJBQVksR0FBUTtZQUNsQixFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtZQUMxQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtTQUMxQixDQUFDO1FBQ0Ysa0JBQWEsR0FBUTtZQUNuQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtZQUN6QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtZQUN6QixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtTQUMxQixDQUFDO1FBQ00sZ0JBQVcsR0FBRztZQUNwQixJQUFJLEVBQUUsQ0FBQztZQUNQLElBQUksRUFBRSxFQUFFO1lBQ1IsS0FBSyxFQUFFLENBQUM7WUFDUixLQUFLLEVBQUUsQ0FBQztTQUNULENBQUM7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cEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUNwQyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1NBQzdDO1FBQ0QsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzFCLENBQUM7OztZQWhJRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLHdwSEFBNEM7O2FBRTdDOzs7O1lBVDRELFFBQVE7Ozt5QkFXbEUsS0FBSzs7OztJQUFOLDBDQUF5Qjs7SUFDekIsMkNBQWlCOztJQUNqQixxQ0FBVzs7SUFDWCx5Q0FBaUI7O0lBQ2pCLDhDQUVFOztJQUNGLDRDQUdFOztJQUNGLDZDQUlFOzs7OztJQUNGLDJDQUtFOztJQUNGLCtDQUFpQzs7SUFFakMseUNBQWU7O0lBRWYsK0NBQXlEOztJQUV6RCwwQ0FBdUI7Ozs7O0lBQ3ZCLDZDQUFzQzs7Ozs7SUFFMUIsd0NBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgSW5wdXQsIEluamVjdG9yLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTG9jYWxpemVTZXJ2aWNlIH0gZnJvbSAnQHFkcC9sb2NhbGl6ZSc7XHJcbmltcG9ydCB7IExjcFNlcnZpY2UgfSBmcm9tICdAcWRwL2NvbW1vbic7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICd0aXRsZS1lZGl0b3InLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi90aXRsZS1lZGl0b3IuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3RpdGxlLWVkaXRvci5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFRpdGxlRWRpdG9yQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XHJcbiAgQElucHV0KCkgY3VyclNjaGVtYTogYW55O1xyXG4gIHRpdGxlT3B0aW9uOiBhbnk7XHJcbiAgdGl0bGU6IGFueTtcclxuICBzdWJUaXRsZXM6IGFueVtdO1xyXG4gIGNvbHVtblNpemVEYXRhOiBhbnkgPSBbXHJcbiAgICA2MCwgOTAsIDE2MCwgODAsIDgwXHJcbiAgXTtcclxuICBzdWJUaXRsZVR5cGU6IGFueSA9IFtcclxuICAgIHsgbGFiZWw6ICflia/moIfpopgnLCB2YWx1ZTogMCB9LFxyXG4gICAgeyBsYWJlbDogJ+ihqOWwvicsIHZhbHVlOiAxIH1cclxuICBdO1xyXG4gIHN1YlRpdGxlQWxpZ246IGFueSA9IFtcclxuICAgIHsgbGFiZWw6ICflsYXlt6YnLCB2YWx1ZTogMCB9LFxyXG4gICAgeyBsYWJlbDogJ+WxheS4rScsIHZhbHVlOiAxIH0sXHJcbiAgICB7IGxhYmVsOiAn5bGF5Y+zJywgdmFsdWU6IDIgfVxyXG4gIF07XHJcbiAgcHJpdmF0ZSBuZXdTdWJUaXRsZSA9IHtcclxuICAgIHR5cGU6IDAsXHJcbiAgICB0ZXh0OiAnJyxcclxuICAgIGxldmVsOiAxLFxyXG4gICAgYWxpZ246IDBcclxuICB9O1xyXG4gIGxvY2FsaXplU2VydmljZTogTG9jYWxpemVTZXJ2aWNlO1xyXG5cclxuICBhbGlnbkRhdGEgPSBbXTtcclxuXHJcbiAgY3VycmVudFN1YlRpdGxlOiB7IGluZGV4OiBudW1iZXIsIHN1YlRpdGxlOiBhbnkgfSA9IG51bGw7XHJcblxyXG4gIGxjcFNlcnZpY2U6IExjcFNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgIHRoaXMubG9jYWxpemVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxpemVTZXJ2aWNlKTtcclxuICAgIHRoaXMubGNwU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExjcFNlcnZpY2UpO1xyXG4gICAgdGhpcy5zdWJUaXRsZVR5cGUgPSB0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnNjaGVtYU1hbmFnZXIudGl0bGVPcHRpb24uc3ViVGl0bGVEYXRhJyk7XHJcbiAgICB0aGlzLnN1YlRpdGxlQWxpZ24gPSB0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnNjaGVtYU1hbmFnZXIudGl0bGVPcHRpb24uc3ViVGl0bGVBbGlnbicpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGlmICghdGhpcy5zdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goc2VsZi5sY3BTZXJ2aWNlLnZhcmlhYmxlc0NoYW5nZS5zdWJzY3JpYmUoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcclxuICAgICAgICAgIC8vIGlmIChrZXkgPT09ICdzZWN1cml0eUxldmVsJykgeyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgaWYgKHNlbGYuYWxpZ25EYXRhLmZpbmRJbmRleCh4ID0+IHgubmFtZS5yZXBsYWNlKHgubmFtZS5zdWJzdHJpbmcoeC5uYW1lLmluZGV4T2YoJ1snKSksIFwiXCIpLnJlcGxhY2UoLyAvZywgXCJcIikgPT09IGtleSkgPCAwKSB7XHJcbiAgICAgICAgICAgIHNlbGYuYWxpZ25EYXRhLnB1c2goeyBuYW1lOiBrZXkgKyAnICAgWycgKyBkYXRhW2tleV0gKyAnXScsIHZhbHVlOiBrZXkgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgICBmb3IgKGNvbnN0IGNoYW5nZU5hbWUgaW4gY2hhbmdlcykge1xyXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IGNoYW5nZXNbY2hhbmdlTmFtZV0uY3VycmVudFZhbHVlO1xyXG4gICAgICBpZiAobmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IHZvaWQgMCkge1xyXG4gICAgICAgIHN3aXRjaCAoY2hhbmdlTmFtZSkge1xyXG4gICAgICAgICAgY2FzZSAnY3VyclNjaGVtYSc6XHJcbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZS5zY2hlbWFWYWx1ZSAmJiBuZXdWYWx1ZS5zY2hlbWFWYWx1ZS50aXRsZU9wdGlvbikge1xyXG4gICAgICAgICAgICAgIGNvbnN0IHN0ciA9IEpTT04uc3RyaW5naWZ5KG5ld1ZhbHVlLnNjaGVtYVZhbHVlLnRpdGxlT3B0aW9uKTtcclxuICAgICAgICAgICAgICB0aGlzLnRpdGxlT3B0aW9uID0gSlNPTi5wYXJzZShzdHIpO1xyXG4gICAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLnRpdGxlT3B0aW9uLnRpdGxlO1xyXG4gICAgICAgICAgICAgIHRoaXMuc3ViVGl0bGVzID0gdGhpcy50aXRsZU9wdGlvbi5zdWJUaXRsZXMgfHwgW107XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbnMgJiYgdGhpcy5zdWJzY3JpcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICBmb3IgKGNvbnN0IHN1YnNjcmlwdGlvbiBvZiB0aGlzLnN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaW5zZXJ0U3ViVGl0bGUoaW5kZXg6IG51bWJlcikge1xyXG4gICAgY29uc3QgX25ld1N1YlRpdGxlID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5uZXdTdWJUaXRsZSk7XHJcbiAgICAvLyBpZiAoaW5kZXggPT09IDApIHtcclxuICAgIC8vICAgdGhpcy5zdWJUaXRsZXMudW5zaGlmdChfbmV3U3ViVGl0bGUpO1xyXG4gICAgLy8gfSBlbHNlIHtcclxuICAgIHRoaXMuc3ViVGl0bGVzLnNwbGljZShpbmRleCArIDEsIDAsIF9uZXdTdWJUaXRsZSk7XHJcbiAgICAvLyB9XHJcbiAgfVxyXG5cclxuICByZW1vdmVTdWJUaXRsZShpbmRleDogbnVtYmVyKSB7XHJcbiAgICB0aGlzLnN1YlRpdGxlcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cclxuICAgIGlmICh0aGlzLmN1cnJlbnRTdWJUaXRsZSkge1xyXG4gICAgICBpZiAoaW5kZXggPT09IHRoaXMuY3VycmVudFN1YlRpdGxlLmluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50U3ViVGl0bGUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvbkFkZFN1YlRpdGxlKCkge1xyXG4gICAgdGhpcy5zdWJUaXRsZXMgPSBbLi4udGhpcy5zdWJUaXRsZXNdO1xyXG4gICAgdGhpcy5zdWJUaXRsZXMucHVzaChPYmplY3QuYXNzaWduKHt9LCB0aGlzLm5ld1N1YlRpdGxlKSk7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RlZCgkZXZlbnQpIHtcclxuICAgIHRoaXMuY3VycmVudFN1YlRpdGxlID0gJGV2ZW50O1xyXG4gIH1cclxuXHJcbiAgaXNTZWxlY3RlZCgkZXZlbnQ6IG51bWJlcikge1xyXG4gICAgaWYgKHRoaXMuY3VycmVudFN1YlRpdGxlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRTdWJUaXRsZS5pbmRleCA9PT0gJGV2ZW50O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgZ2V0VGl0bGVPcHRpb24oKSB7XHJcbiAgICBpZiAodGhpcy50aXRsZU9wdGlvbikge1xyXG4gICAgICB0aGlzLnRpdGxlT3B0aW9uLnRpdGxlID0gdGhpcy50aXRsZTtcclxuICAgICAgdGhpcy50aXRsZU9wdGlvbi5zdWJUaXRsZXMgPSB0aGlzLnN1YlRpdGxlcztcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnRpdGxlT3B0aW9uO1xyXG4gIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, Renderer2, ViewEncapsulation, Output, EventEmitter, TemplateRef, Optional, Injector } from '@angular/core';
import { FormGroup, FormControl, Validators } from '@angular/forms';
import { findIndex } from 'lodash-es';
import { DialogComponent } from '@farris/ui-dialog';
import { DatagridComponent } from '@farris/ui-datagrid';
import { EditorTypes } from '@farris/ui-datagrid-editors';
import { MessagerService } from '@farris/ui-messager';
import { ParasMappingService } from '../../service/paras-mapping/paras-mapping.service';
import { of } from 'rxjs';
import { EventBus } from '@qdp/common';
import { LocalizeService } from '@qdp/localize';
/** @type {?} */
const createFormGroup = (/**
 * @param {?} dataItem
 * @return {?}
 */
dataItem => new FormGroup({
    'id': new FormControl(dataItem.id),
    'parameter': new FormControl(dataItem.parameter, Validators.required),
    'sourceParameter': new FormControl(dataItem.sourceParameter),
    'mappingType': new FormControl(dataItem.mappingType),
    'constant': new FormControl(dataItem.constant),
    'expression': new FormControl(dataItem.expression),
    'paraisused': new FormControl(dataItem.paraisused)
}));
const ɵ0 = createFormGroup;
/** @type {?} */
const matches = (/**
 * @param {?} el
 * @param {?} selector
 * @return {?}
 */
(el, selector) => (el.matches || el.msMatchesSelector).call(el, selector));
const ɵ1 = matches;
export class ParasMappingComponent {
    /**
     * @param {?} renderer
     * @param {?} parasMappingService
     * @param {?} msgService
     * @param {?} injector
     */
    constructor(renderer, parasMappingService, msgService, injector) {
        this.renderer = renderer;
        this.parasMappingService = parasMappingService;
        this.msgService = msgService;
        this.injector = injector;
        this.closeModal = new EventEmitter();
        // 模态框确定后关闭，并传递参数
        this.submitModal = new EventEmitter();
        this.editorParams = {};
        this.modalConfig = {
            title: '参数设置',
            width: 900,
            height: 500,
            showButtons: true
        };
        this.colName = '';
        this.size = {};
        this.mappingTypeData = [
            { name: '字段', value: 0 },
            { name: '常量', value: 1 },
            { name: '表达式', value: 2 }
        ];
        this.QueryInfoDatas = [];
        this.saveDatas = {};
        this.currentmode = true;
        this.columns = [];
        this.total = 0;
        this.editMode = 'row';
        this.pageSize = 200;
        this.pageIndex = 1;
        this.handlebeforeClose = (/**
         * @return {?}
         */
        () => {
            if (this.dg1) {
                this.dg1.endRowEdit();
            }
            this.updateParasMapping();
            return of(true);
        });
        if (this.injector) {
            this.localizeService = this.injector.get(LocalizeService);
            this.mappingTypeData = this.localizeService.getValue('ideCmp.paramsMapping.mappingTypeData');
            this.modalConfig.title = this.localizeService.getValue('ideCmp.paramsMapping.paramOption');
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.editorParams && this.editorParams.queryId) {
            this.currentmode = true;
            this.queryId = this.editorParams.queryId;
            this.queryparaData = this.editorParams.queryparaData;
            this.sourceparaData = this.editorParams.sourceparaData;
            this.qoManagerCode = this.editorParams.datasourceid;
            this.queryRelativeUrl = this.editorParams.queryRelativeUrl;
            /*
            this.parasMappingService.getParasMapping(this.qoManagerCode , this.queryId, this.queryRelativeUrl).subscribe(
              data => { if (data != null) { this.QueryInfoDatas =  JSON.parse(data.parasmapping.value); } });
              */
            this.parasMappingService.getParasMapping(this.qoManagerCode, this.queryId, this.queryRelativeUrl).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                if (data != null) {
                    this.QueryInfoDatas = JSON.parse(data.parasmapping.value);
                }
                else if (this.editorParams.QueryInfoDatas) {
                    this.QueryInfoDatas = this.editorParams.QueryInfoDatas;
                }
            }));
        }
        else {
            this.currentmode = false;
            this.parasMappingService.getParasMapping(this.qoManagerCode, this.queryId, this.queryRelativeUrl).subscribe((/**
             * @param {?} data
             * @return {?}
             */
            data => {
                if (data != null) {
                    this.queryparaData = JSON.parse(data.parasmapping.queryparaData);
                    this.sourceparaData = JSON.parse(data.parasmapping.sourceparaData);
                    this.QueryInfoDatas = JSON.parse(data.parasmapping.value);
                }
            }));
        }
        this.gridInit();
    }
    /**
     * @private
     * @return {?}
     */
    gridInit() {
        /** @type {?} */
        const self = this;
        /** @type {?} */
        const enumOpts = { valueField: 'value', textField: 'name', data: this.queryparaData };
        /** @type {?} */
        const enumOpts1 = { valueField: 'value', textField: 'name', data: this.mappingTypeData };
        /** @type {?} */
        const enumOpts2 = { valueField: 'value', textField: 'name', data: this.sourceparaData };
        this.columns = [
            {
                field: 'parameter', width: 100, title: self.localizeService.getValue('ideCmp.paramsMapping.columnHeader')[0], formatter: { type: 'enum', options: enumOpts },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: Object.assign({}, enumOpts, { idField: 'value' }),
                    validators: [
                        { type: 'required', messager: '该字段不能为空！' }
                    ]
                }
            },
            {
                field: 'mappingType', width: 100, title: self.localizeService.getValue('ideCmp.paramsMapping.columnHeader')[1], formatter: { type: 'enum', options: enumOpts1 },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: Object.assign({}, enumOpts1, { idField: 'value' })
                }
            },
            {
                field: 'sourceParameter', width: 100, title: self.localizeService.getValue('ideCmp.paramsMapping.columnHeader')[2], formatter: { type: 'enum', options: enumOpts2 },
                editor: {
                    type: EditorTypes.COMBOLIST,
                    options: Object.assign({}, enumOpts2, { idField: 'value' })
                }
            },
            {
                field: 'constant', width: 100, title: self.localizeService.getValue('ideCmp.paramsMapping.columnHeader')[3],
                editor: {
                    type: EditorTypes.TEXTBOX
                }
            },
            {
                field: 'expression', width: 100, title: self.localizeService.getValue('ideCmp.paramsMapping.columnHeader')[4],
                editor: {
                    type: EditorTypes.TEXTBOX
                }
            },
            {
                field: 'paraisused', width: 100, title: self.localizeService.getValue('ideCmp.paramsMapping.columnHeader')[5],
                editor: {
                    type: EditorTypes.CHECKBOX
                }
            }
        ];
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onResized(event) {
        this.size.height = event.newHeight;
        this.size.width = event.newWidth;
    }
    /**
     * @return {?}
     */
    clickCancel() {
        if (this.dg2) {
            this.dg2.endRowEdit();
        }
        this.closeModal.emit();
    }
    /**
     * @return {?}
     */
    clickConfirm() {
        /** @type {?} */
        const self = this;
        this.updateParasMapping();
        self.submitModal.emit({ value: self.QueryInfoDatas });
    }
    /**
     * @return {?}
     */
    updateParasMapping() {
        /** @type {?} */
        const self = this;
        if (self.QueryInfoDatas && self.QueryInfoDatas.length) {
            // tslint:disable-next-line:max-line-length
            self.saveDatas = { Id: EventBus.guid(), parasmapping: JSON.stringify({ value: JSON.stringify(self.QueryInfoDatas), queryparaData: JSON.stringify(self.queryparaData), sourceparaData: JSON.stringify(self.sourceparaData) }), queryid: self.queryId, datasourceid: self.qoManagerCode };
            self.parasMappingService.saveParasMapping(self.saveDatas, self.queryRelativeUrl)
                .subscribe();
        }
        else {
            self.parasMappingService.deleteParasMapping(self.qoManagerCode, self.queryId, self.queryRelativeUrl).subscribe();
            self.QueryInfoDatas = [];
        }
    }
    /**
     * @return {?}
     */
    handleDialogShow() {
        this.farrisDialog.show();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    addFilterRow($event) {
        this.QueryInfoDatas.push({
            'id': EventBus.guid(),
            'parameter': '',
            'sourceParameter': '',
            'mappingType': 0,
            'constant': '',
            'expression': '',
            'paraisused': true
        });
        if (this.dg1) {
            this.dg1.refresh();
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    addFilterRowForIde($event) {
        this.QueryInfoDatas.push({
            'id': EventBus.guid(),
            'parameter': '',
            'sourceParameter': '',
            'mappingType': 0,
            'constant': '',
            'expression': '',
            'paraisused': true
        });
        if (this.dg2) {
            this.dg2.refresh();
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    deleteFilterRow($event) {
        /** @type {?} */
        const self = this;
        if (this.dg1.selectedRow) {
            /** @type {?} */
            const index = findIndex(this.QueryInfoDatas, (/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.id === self.dg1.selectedRow.id; }));
            this.QueryInfoDatas.splice(index, 1);
            this.dg1.refresh();
        }
        else {
            this.msgService.info(self.localizeService.getValue('ideCmp.paramsMapping.message.validate.select'));
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    deleteFilterRowForIde($event) {
        /** @type {?} */
        const self = this;
        if (this.dg2.selectedRow) {
            /** @type {?} */
            const index = findIndex(this.QueryInfoDatas, (/**
             * @param {?} n
             * @return {?}
             */
            function (n) { return n.id === self.dg2.selectedRow.id; }));
            this.QueryInfoDatas.splice(index, 1);
            this.dg2.refresh();
        }
        else {
            this.msgService.info(self.localizeService.getValue('ideCmp.paramsMapping.message.validate.select'));
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    cancelEdit($event) {
        if (this.dg1) {
            this.dg1.endRowEdit();
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    cancelEditForIde($event) {
        if (this.dg2) {
            this.dg2.endRowEdit();
        }
    }
}
ParasMappingComponent.decorators = [
    { type: Component, args: [{
                selector: 'paras-mapping',
                template: "<div class=\"btn-group mr-3\" fDropdown *ngIf=\"!currentmode\">\r\n  <button class=\"btn f-rt-btn f-btn-ml btn-secondary dropdown-toggle\" type=\"button\" id=\"menuButton\" (click)=\"handleDialogShow()\" >\r\n    <span class=\"f-icon f-icon-grid-layout\" role=\"presentation\"></span>\r\n    <span *ngIf=\"!isMultiForm\">&nbsp;{{localizeService.getValue('ideCmp.paramsMapping.paramOption')}}</span>\r\n  </button>\r\n</div>\r\n\r\n<farris-dialog #farrisDialog [title]=\"localizeService.getValue('ideCmp.paramsMapping.paramOption')\" [showButtons]=\"false\" [width]=\"700\" [height]=\"500\" *ngIf=\"!currentmode\" [beforeClose]=\"handlebeforeClose\">\r\n  <div class=\"d-flex flex-column flex-fill position-relative h-100 m-0\">\r\n    <div class=\"flex-fill farris-split-section m-1 farris-overflow-hidden\" (resized)=\"onResized($event)\">\r\n      <div class=\"farris-form farris-card-content-bg\">\r\n          <fieldSet farrisFold [style.height.px]=\"size.height\">\r\n            <button id=\"addFilterRow\" class=\"btn btn-primary mr-1 mb-1\" (click)=\"addFilterRow($event)\">{{localizeService.getValue('ideCmp.paramsMapping.btnAdd')}}</button>\r\n            <button id=\"addFilterRow\" class=\"btn btn-secondary mr-1 mb-1\" (click)=\"deleteFilterRow($event)\">{{localizeService.getValue('ideCmp.paramsMapping.btnDelete')}}</button>\r\n            <button id=\"addFilterRow\" class=\"btn btn-secondary mr-1 mb-1\" (click)=\"cancelEdit($event)\">{{localizeService.getValue('ideCmp.paramsMapping.btnCancel')}}</button>\r\n            <farris-datagrid [data]=\"QueryInfoDatas\" [columns]=\"columns\" #dg1=\"datagrid\" [fit]=\"true\"\r\n              [editable]=\"true\" [editMode]=\"editMode\" [showCheckbox]=\"false\" [fitColumns]=\"true\"\r\n              [showLineNumber] =\"true\" [striped]=\"true\"  [total]=\"total\" [pageSize]=\"100\"\r\n              [virtualized]=\"true\" [pagination]=\"false\">\r\n            </farris-datagrid>\r\n          </fieldSet>\r\n        </div>\r\n      </div>\r\n  </div>\r\n</farris-dialog>\r\n<div class=\"d-flex flex-column flex-fill position-relative h-100 m-0\" *ngIf=\"currentmode\">\r\n  <div class=\"flex-fill farris-split-section m-1 farris-overflow-hidden\" (resized)=\"onResized($event)\">\r\n    <div class=\"farris-form farris-card-content-bg\">\r\n        <fieldSet farrisFold [style.height.px]=\"size.height\">\r\n          <button id=\"addFilterRow\" class=\"btn btn-primary mr-1 mb-1\" (click)=\"addFilterRowForIde($event)\">{{localizeService.getValue('ideCmp.paramsMapping.btnAdd')}}</button>\r\n            <button id=\"addFilterRow\" class=\"btn btn-secondary mr-1 mb-1\" (click)=\"deleteFilterRowForIde($event)\">{{localizeService.getValue('ideCmp.paramsMapping.btnDelete')}}</button>\r\n            <button id=\"addFilterRow\" class=\"btn btn-secondary mr-1 mb-1\" (click)=\"cancelEditForIde($event)\">{{localizeService.getValue('ideCmp.paramsMapping.btnCancel')}}</button>\r\n            <farris-datagrid [data]=\"QueryInfoDatas\" [columns]=\"columns\" #dg2=\"datagrid\" [fit]=\"true\"\r\n              [editable]=\"true\" [editMode]=\"editMode\" [showCheckbox]=\"false\" [fitColumns]=\"true\"\r\n              [showLineNumber] =\"true\" [striped]=\"true\"  [total]=\"total\" [pageSize]=\"100\"\r\n              [virtualized]=\"true\" [pagination]=\"false\">\r\n            </farris-datagrid>\r\n        </fieldSet>\r\n      </div>\r\n    </div>\r\n</div>\r\n<ng-template #enumFooter>\r\n  <button type=\"button\" class=\"btn btn-secondary\" (click)=\"clickCancel()\">{{localizeService.getValue('ideCmp.paramsMapping.btnCancel')}}</button>\r\n  <button type=\"button\" class=\"btn btn-primary\" (click)=\"clickConfirm()\">{{localizeService.getValue('ideCmp.paramsMapping.btnOK')}}</button>\r\n</ng-template>\r\n",
                encapsulation: ViewEncapsulation.None,
                styles: ["tr .center{text-align:center}"]
            }] }
];
/** @nocollapse */
ParasMappingComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: ParasMappingService },
    { type: MessagerService, decorators: [{ type: Optional }] },
    { type: Injector, decorators: [{ type: Optional }] }
];
ParasMappingComponent.propDecorators = {
    closeModal: [{ type: Output }],
    submitModal: [{ type: Output }],
    editorParams: [{ type: Input }],
    queryId: [{ type: Input }],
    qoManagerCode: [{ type: Input }],
    queryRelativeUrl: [{ type: Input }],
    isMultiForm: [{ type: Input }],
    modalFooter: [{ type: ViewChild, args: ['enumFooter',] }],
    farrisDialog: [{ type: ViewChild, args: ['farrisDialog',] }],
    dg1: [{ type: ViewChild, args: ['dg1',] }],
    dg2: [{ type: ViewChild, args: ['dg2',] }]
};
if (false) {
    /** @type {?} */
    ParasMappingComponent.prototype.closeModal;
    /** @type {?} */
    ParasMappingComponent.prototype.submitModal;
    /** @type {?} */
    ParasMappingComponent.prototype.editorParams;
    /** @type {?} */
    ParasMappingComponent.prototype.queryId;
    /** @type {?} */
    ParasMappingComponent.prototype.qoManagerCode;
    /** @type {?} */
    ParasMappingComponent.prototype.queryRelativeUrl;
    /** @type {?} */
    ParasMappingComponent.prototype.isMultiForm;
    /** @type {?} */
    ParasMappingComponent.prototype.queryparaData;
    /** @type {?} */
    ParasMappingComponent.prototype.sourceparaData;
    /** @type {?} */
    ParasMappingComponent.prototype.modalFooter;
    /** @type {?} */
    ParasMappingComponent.prototype.modalConfig;
    /** @type {?} */
    ParasMappingComponent.prototype.farrisDialog;
    /** @type {?} */
    ParasMappingComponent.prototype.currTreeNodeId;
    /** @type {?} */
    ParasMappingComponent.prototype.currQueryInfoData;
    /** @type {?} */
    ParasMappingComponent.prototype.colSelectValue;
    /** @type {?} */
    ParasMappingComponent.prototype.colName;
    /** @type {?} */
    ParasMappingComponent.prototype.size;
    /** @type {?} */
    ParasMappingComponent.prototype.datasourceid;
    /** @type {?} */
    ParasMappingComponent.prototype.gridData;
    /** @type {?} */
    ParasMappingComponent.prototype.formGroup;
    /**
     * @type {?}
     * @private
     */
    ParasMappingComponent.prototype.editedRowIndex;
    /** @type {?} */
    ParasMappingComponent.prototype.isNew;
    /** @type {?} */
    ParasMappingComponent.prototype.mappingTypeData;
    /** @type {?} */
    ParasMappingComponent.prototype.QueryInfoDatas;
    /** @type {?} */
    ParasMappingComponent.prototype.saveDatas;
    /** @type {?} */
    ParasMappingComponent.prototype.currentmode;
    /** @type {?} */
    ParasMappingComponent.prototype.localizeService;
    /** @type {?} */
    ParasMappingComponent.prototype.columns;
    /** @type {?} */
    ParasMappingComponent.prototype.total;
    /** @type {?} */
    ParasMappingComponent.prototype.editMode;
    /** @type {?} */
    ParasMappingComponent.prototype.pageSize;
    /** @type {?} */
    ParasMappingComponent.prototype.pageIndex;
    /** @type {?} */
    ParasMappingComponent.prototype.dg1;
    /** @type {?} */
    ParasMappingComponent.prototype.dg2;
    /** @type {?} */
    ParasMappingComponent.prototype.handlebeforeClose;
    /**
     * @type {?}
     * @private
     */
    ParasMappingComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    ParasMappingComponent.prototype.parasMappingService;
    /**
     * @type {?}
     * @private
     */
    ParasMappingComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    ParasMappingComponent.prototype.injector;
}
export { ɵ0, ɵ1 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYXMtbWFwcGluZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcWRwL2lkZS1jbXAvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50L3BhcmFzLW1hcHBpbmcvcGFyYXMtbWFwcGluZy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFpQixTQUFTLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEssT0FBTyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUN0QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEQsT0FBTyxFQUFFLGlCQUFpQixFQUFtQixNQUFNLHFCQUFxQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbURBQW1ELENBQUM7QUFDeEYsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7O01BRTFDLGVBQWU7Ozs7QUFBRyxRQUFRLENBQUMsRUFBRSxDQUFDLElBQUksU0FBUyxDQUFDO0lBQ2hELElBQUksRUFBRSxJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO0lBQ2xDLFdBQVcsRUFBRSxJQUFJLFdBQVcsQ0FBQyxRQUFR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SixNQUFNOzBCQUVOLE1BQU07MkJBQ04sS0FBSztzQkFDTCxLQUFLOzRCQUNMLEtBQUs7K0JBQ0wsS0FBSzswQkFDTCxLQUFLOzBCQUdMLFNBQVMsU0FBQyxZQUFZOzJCQU90QixTQUFTLFNBQUMsY0FBYztrQkE0QnhCLFNBQVMsU0FBQyxLQUFLO2tCQUNmLFNBQVMsU0FBQyxLQUFLOzs7O0lBOUNoQiwyQ0FBK0M7O0lBRS9DLDRDQUFnRDs7SUFDaEQsNkNBQWdDOztJQUNoQyx3Q0FBc0I7O0lBQ3RCLDhDQUE0Qjs7SUFDNUIsaURBQStCOztJQUMvQiw0Q0FBMEI7O0lBQzFCLDhDQUFtQjs7SUFDbkIsK0NBQW9COztJQUNwQiw0Q0FBdUQ7O0lBQ3ZELDRDQUtFOztJQUNGLDZDQUF5RDs7SUFDekQsK0NBQW9COztJQUNwQixrREFBdUI7O0lBR3ZCLCtDQUFvQjs7SUFDcEIsd0NBQWE7O0lBQ2IscUNBQWU7O0lBQ2YsNkNBQWtCOztJQUNsQix5Q0FBdUI7O0lBQ3ZCLDBDQUE0Qjs7Ozs7SUFDNUIsK0NBQStCOztJQUMvQixzQ0FBZTs7SUFDZixnREFJRTs7SUFDRiwrQ0FBeUI7O0lBQ3pCLDBDQUFvQjs7SUFDcEIsNENBQW1COztJQUNuQixnREFBaUM7O0lBRWpDLHdDQUFhOztJQUNiLHNDQUFVOztJQUNWLHlDQUFpQjs7SUFDakIseUNBQWU7O0lBQ2YsMENBQWM7O0lBQ2Qsb0NBQXlDOztJQUN6QyxvQ0FBeUM7O0lBZ0h6QyxrREFNQzs7Ozs7SUFwSFcseUNBQTJCOzs7OztJQUFFLG9EQUFnRDs7Ozs7SUFBRSwyQ0FBK0M7Ozs7O0lBQUUseUNBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBTaW1wbGVDaGFuZ2VzLCBWaWV3Q2hpbGQsIFJlbmRlcmVyMiwgVmlld0VuY2Fwc3VsYXRpb24sIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBUZW1wbGF0ZVJlZiwgT3B0aW9uYWwsIEluamVjdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZvcm1Hcm91cCwgRm9ybUNvbnRyb2wsIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IGZpbmRJbmRleCB9IGZyb20gJ2xvZGFzaC1lcyc7XHJcbmltcG9ydCB7IERpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ0BmYXJyaXMvdWktZGlhbG9nJztcclxuaW1wb3J0IHsgRGF0YWdyaWRDb21wb25lbnQsIEdSSURfVkFMSURBVE9SUyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQnO1xyXG5pbXBvcnQgeyBFZGl0b3JUeXBlcyB9IGZyb20gJ0BmYXJyaXMvdWktZGF0YWdyaWQtZWRpdG9ycyc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBQYXJhc01hcHBpbmdTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZS9wYXJhcy1tYXBwaW5nL3BhcmFzLW1hcHBpbmcuc2VydmljZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEV2ZW50QnVzIH0gZnJvbSAnQHFkcC9jb21tb24nO1xyXG5pbXBvcnQgeyBMb2NhbGl6ZVNlcnZpY2UgfSBmcm9tICdAcWRwL2xvY2FsaXplJztcclxuXHJcbmNvbnN0IGNyZWF0ZUZvcm1Hcm91cCA9IGRhdGFJdGVtID0+IG5ldyBGb3JtR3JvdXAoe1xyXG4gICdpZCc6IG5ldyBGb3JtQ29udHJvbChkYXRhSXRlbS5pZCksXHJcbiAgJ3BhcmFtZXRlcic6IG5ldyBGb3JtQ29udHJvbChkYXRhSXRlbS5wYXJhbWV0ZXIsIFZhbGlkYXRvcnMucmVxdWlyZWQpLFxyXG4gICdzb3VyY2VQYXJhbWV0ZXInOiBuZXcgRm9ybUNvbnRyb2woZGF0YUl0ZW0uc291cmNlUGFyYW1ldGVyKSxcclxuICAnbWFwcGluZ1R5cGUnOiBuZXcgRm9ybUNvbnRyb2woZGF0YUl0ZW0ubWFwcGluZ1R5cGUpLFxyXG4gICdjb25zdGFudCc6IG5ldyBGb3JtQ29udHJvbChkYXRhSXRlbS5jb25zdGFudCksXHJcbiAgJ2V4cHJlc3Npb24nOiBuZXcgRm9ybUNvbnRyb2woZGF0YUl0ZW0uZXhwcmVzc2lvbiksXHJcbiAgJ3BhcmFpc3VzZWQnOiBuZXcgRm9ybUNvbnRyb2woZGF0YUl0ZW0ucGFyYWlzdXNlZClcclxufSk7XHJcbmNvbnN0IG1hdGNoZXMgPSAoZWwsIHNlbGVjdG9yKSA9PiAoZWwubWF0Y2hlcyB8fCBlbC5tc01hdGNoZXNTZWxlY3RvcikuY2FsbChlbCwgc2VsZWN0b3IpO1xyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3BhcmFzLW1hcHBpbmcnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wYXJhcy1tYXBwaW5nLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9wYXJhcy1tYXBwaW5nLmNvbXBvbmVudC5jc3MnXSxcclxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgUGFyYXNNYXBwaW5nQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICBAT3V0cHV0KCkgY2xvc2VNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIC8vIOaooeaAgeahhuehruWumuWQjuWFs+mXre+8jOW5tuS8oOmAkuWPguaVsFxyXG4gIEBPdXRwdXQoKSBzdWJtaXRNb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBJbnB1dCgpIGVkaXRvclBhcmFtczogYW55ID0ge307XHJcbiAgQElucHV0KCkgcXVlcnlJZDogYW55O1xyXG4gIEBJbnB1dCgpIHFvTWFuYWdlckNvZGU6IGFueTtcclxuICBASW5wdXQoKSBxdWVyeVJlbGF0aXZlVXJsOiBhbnk7XHJcbiAgQElucHV0KCkgaXNNdWx0aUZvcm06IGFueTtcclxuICBxdWVyeXBhcmFEYXRhOiBhbnk7IC8vIOa6kOWPguaVsOS/oeaBr1xyXG4gIHNvdXJjZXBhcmFEYXRhOiBhbnk7IC8vIOWPguaVsOWQjeS/oeaBr1xyXG4gIEBWaWV3Q2hpbGQoJ2VudW1Gb290ZXInKSBtb2RhbEZvb3RlcjogVGVtcGxhdGVSZWY8YW55PjtcclxuICBtb2RhbENvbmZpZyA9IHtcclxuICAgIHRpdGxlOiAn5Y+C5pWw6K6+572uJyxcclxuICAgIHdpZHRoOiA5MDAsXHJcbiAgICBoZWlnaHQ6IDUwMCxcclxuICAgIHNob3dCdXR0b25zOiB0cnVlXHJcbiAgfTtcclxuICBAVmlld0NoaWxkKCdmYXJyaXNEaWFsb2cnKSBmYXJyaXNEaWFsb2c6IERpYWxvZ0NvbXBvbmVudDtcclxuICBjdXJyVHJlZU5vZGVJZDogYW55O1xyXG4gIGN1cnJRdWVyeUluZm9EYXRhOiBhbnk7XHJcbiAgLy8gcXVlcnlwYXJhRGF0YTogYW55ID0gW107XHJcbiAgLy8gc291cmNlcGFyYURhdGE6IGFueSA9IFtdO1xyXG4gIGNvbFNlbGVjdFZhbHVlOiBhbnk7XHJcbiAgY29sTmFtZSA9ICcnO1xyXG4gIHNpemU6IGFueSA9IHt9O1xyXG4gIGRhdGFzb3VyY2VpZDogYW55O1xyXG4gIHB1YmxpYyBncmlkRGF0YTogYW55W107XHJcbiAgcHVibGljIGZvcm1Hcm91cDogRm9ybUdyb3VwO1xyXG4gIHByaXZhdGUgZWRpdGVkUm93SW5kZXg6IG51bWJlcjtcclxuICBpc05ldzogYm9vbGVhbjtcclxuICBtYXBwaW5nVHlwZURhdGE6IGFueSA9IFtcclxuICAgIHsgbmFtZTogJ+Wtl+autScsIHZhbHVlOiAwIH0sXHJcbiAgICB7IG5hbWU6ICfluLjph48nLCB2YWx1ZTogMSB9LFxyXG4gICAgeyBuYW1lOiAn6KGo6L6+5byPJywgdmFsdWU6IDIgfVxyXG4gIF07XHJcbiAgUXVlcnlJbmZvRGF0YXM6IGFueSA9IFtdO1xyXG4gIHNhdmVEYXRhczogYW55ID0ge307XHJcbiAgY3VycmVudG1vZGUgPSB0cnVlO1xyXG4gIGxvY2FsaXplU2VydmljZTogTG9jYWxpemVTZXJ2aWNlO1xyXG5cclxuICBjb2x1bW5zID0gW107XHJcbiAgdG90YWwgPSAwO1xyXG4gIGVkaXRNb2RlID0gJ3Jvdyc7XHJcbiAgcGFnZVNpemUgPSAyMDA7XHJcbiAgcGFnZUluZGV4ID0gMTtcclxuICBAVmlld0NoaWxkKCdkZzEnKSBkZzE6IERhdGFncmlkQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ2RnMicpIGRnMjogRGF0YWdyaWRDb21wb25lbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBwYXJhc01hcHBpbmdTZXJ2aWNlOiBQYXJhc01hcHBpbmdTZXJ2aWNlLCBAT3B0aW9uYWwoKSBwcml2YXRlIG1zZ1NlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSwgQE9wdGlvbmFsKCkgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IpIHtcclxuICAgIGlmICh0aGlzLmluamVjdG9yKSB7XHJcbiAgICAgIHRoaXMubG9jYWxpemVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxpemVTZXJ2aWNlKTtcclxuICAgICAgdGhpcy5tYXBwaW5nVHlwZURhdGEgPSB0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnBhcmFtc01hcHBpbmcubWFwcGluZ1R5cGVEYXRhJyk7XHJcbiAgICAgIHRoaXMubW9kYWxDb25maWcudGl0bGUgPSB0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnBhcmFtc01hcHBpbmcucGFyYW1PcHRpb24nKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMuZWRpdG9yUGFyYW1zICYmIHRoaXMuZWRpdG9yUGFyYW1zLnF1ZXJ5SWQpIHtcclxuICAgICAgdGhpcy5jdXJyZW50bW9kZSA9IHRydWU7XHJcbiAgICAgIHRoaXMucXVlcnlJZCA9IHRoaXMuZWRpdG9yUGFyYW1zLnF1ZXJ5SWQ7XHJcbiAgICAgIHRoaXMucXVlcnlwYXJhRGF0YSA9IHRoaXMuZWRpdG9yUGFyYW1zLnF1ZXJ5cGFyYURhdGE7XHJcbiAgICAgIHRoaXMuc291cmNlcGFyYURhdGEgPSB0aGlzLmVkaXRvclBhcmFtcy5zb3VyY2VwYXJhRGF0YTtcclxuICAgICAgdGhpcy5xb01hbmFnZXJDb2RlID0gdGhpcy5lZGl0b3JQYXJhbXMuZGF0YXNvdXJjZWlkO1xyXG4gICAgICB0aGlzLnF1ZXJ5UmVsYXRpdmVVcmwgPSB0aGlzLmVkaXRvclBhcmFtcy5xdWVyeVJlbGF0aXZlVXJsO1xyXG4gICAgICAvKlxyXG4gICAgICB0aGlzLnBhcmFzTWFwcGluZ1NlcnZpY2UuZ2V0UGFyYXNNYXBwaW5nKHRoaXMucW9NYW5hZ2VyQ29kZSAsIHRoaXMucXVlcnlJZCwgdGhpcy5xdWVyeVJlbGF0aXZlVXJsKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgZGF0YSA9PiB7IGlmIChkYXRhICE9IG51bGwpIHsgdGhpcy5RdWVyeUluZm9EYXRhcyA9ICBKU09OLnBhcnNlKGRhdGEucGFyYXNtYXBwaW5nLnZhbHVlKTsgfSB9KTtcclxuICAgICAgICAqL1xyXG4gICAgICB0aGlzLnBhcmFzTWFwcGluZ1NlcnZpY2UuZ2V0UGFyYXNNYXBwaW5nKHRoaXMucW9NYW5hZ2VyQ29kZSwgdGhpcy5xdWVyeUlkLCB0aGlzLnF1ZXJ5UmVsYXRpdmVVcmwpLnN1YnNjcmliZShcclxuICAgICAgICBkYXRhID0+IHtcclxuICAgICAgICAgIGlmIChkYXRhICE9IG51bGwpIHsgdGhpcy5RdWVyeUluZm9EYXRhcyA9IEpTT04ucGFyc2UoZGF0YS5wYXJhc21hcHBpbmcudmFsdWUpOyB9IGVsc2UgaWYgKHRoaXMuZWRpdG9yUGFyYW1zLlF1ZXJ5SW5mb0RhdGFzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuUXVlcnlJbmZvRGF0YXMgPSB0aGlzLmVkaXRvclBhcmFtcy5RdWVyeUluZm9EYXRhcztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY3VycmVudG1vZGUgPSBmYWxzZTtcclxuICAgICAgdGhpcy5wYXJhc01hcHBpbmdTZXJ2aWNlLmdldFBhcmFzTWFwcGluZyh0aGlzLnFvTWFuYWdlckNvZGUsIHRoaXMucXVlcnlJZCwgdGhpcy5xdWVyeVJlbGF0aXZlVXJsKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgZGF0YSA9PiB7XHJcbiAgICAgICAgICBpZiAoZGF0YSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMucXVlcnlwYXJhRGF0YSA9IEpTT04ucGFyc2UoZGF0YS5wYXJhc21hcHBpbmcucXVlcnlwYXJhRGF0YSk7XHJcbiAgICAgICAgICAgIHRoaXMuc291cmNlcGFyYURhdGEgPSBKU09OLnBhcnNlKGRhdGEucGFyYXNtYXBwaW5nLnNvdXJjZXBhcmFEYXRhKTtcclxuICAgICAgICAgICAgdGhpcy5RdWVyeUluZm9EYXRhcyA9IEpTT04ucGFyc2UoZGF0YS5wYXJhc21hcHBpbmcudmFsdWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIHRoaXMuZ3JpZEluaXQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ3JpZEluaXQoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGNvbnN0IGVudW1PcHRzID0geyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICduYW1lJywgZGF0YTogdGhpcy5xdWVyeXBhcmFEYXRhIH07XHJcbiAgICBjb25zdCBlbnVtT3B0czEgPSB7IHZhbHVlRmllbGQ6ICd2YWx1ZScsIHRleHRGaWVsZDogJ25hbWUnLCBkYXRhOiB0aGlzLm1hcHBpbmdUeXBlRGF0YSB9O1xyXG4gICAgY29uc3QgZW51bU9wdHMyID0geyB2YWx1ZUZpZWxkOiAndmFsdWUnLCB0ZXh0RmllbGQ6ICduYW1lJywgZGF0YTogdGhpcy5zb3VyY2VwYXJhRGF0YSB9O1xyXG4gICAgdGhpcy5jb2x1bW5zID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdwYXJhbWV0ZXInLCB3aWR0aDogMTAwLCB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5wYXJhbXNNYXBwaW5nLmNvbHVtbkhlYWRlcicpWzBdLCBmb3JtYXR0ZXI6IHsgdHlwZTogJ2VudW0nLCBvcHRpb25zOiBlbnVtT3B0cyB9LFxyXG4gICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgICAgb3B0aW9uczogeyAuLi5lbnVtT3B0cywgaWRGaWVsZDogJ3ZhbHVlJyB9LFxyXG4gICAgICAgICAgdmFsaWRhdG9yczogW1xyXG4gICAgICAgICAgICB7IHR5cGU6ICdyZXF1aXJlZCcsIG1lc3NhZ2VyOiAn6K+l5a2X5q615LiN6IO95Li656m677yBJyB9XHJcbiAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdtYXBwaW5nVHlwZScsIHdpZHRoOiAxMDAsIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnBhcmFtc01hcHBpbmcuY29sdW1uSGVhZGVyJylbMV0sIGZvcm1hdHRlcjogeyB0eXBlOiAnZW51bScsIG9wdGlvbnM6IGVudW1PcHRzMSB9LFxyXG4gICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ09NQk9MSVNULFxyXG4gICAgICAgICAgb3B0aW9uczogeyAuLi5lbnVtT3B0czEsIGlkRmllbGQ6ICd2YWx1ZScgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAge1xyXG4gICAgICAgIGZpZWxkOiAnc291cmNlUGFyYW1ldGVyJywgd2lkdGg6IDEwMCwgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAucGFyYW1zTWFwcGluZy5jb2x1bW5IZWFkZXInKVsyXSwgZm9ybWF0dGVyOiB7IHR5cGU6ICdlbnVtJywgb3B0aW9uczogZW51bU9wdHMyIH0sXHJcbiAgICAgICAgZWRpdG9yOiB7XHJcbiAgICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5DT01CT0xJU1QsXHJcbiAgICAgICAgICBvcHRpb25zOiB7IC4uLmVudW1PcHRzMiwgaWRGaWVsZDogJ3ZhbHVlJyB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdjb25zdGFudCcsIHdpZHRoOiAxMDAsIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnBhcmFtc01hcHBpbmcuY29sdW1uSGVhZGVyJylbM10sXHJcbiAgICAgICAgZWRpdG9yOiB7XHJcbiAgICAgICAgICB0eXBlOiBFZGl0b3JUeXBlcy5URVhUQk9YXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZmllbGQ6ICdleHByZXNzaW9uJywgd2lkdGg6IDEwMCwgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdpZGVDbXAucGFyYW1zTWFwcGluZy5jb2x1bW5IZWFkZXInKVs0XSxcclxuICAgICAgICBlZGl0b3I6IHtcclxuICAgICAgICAgIHR5cGU6IEVkaXRvclR5cGVzLlRFWFRCT1hcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBmaWVsZDogJ3BhcmFpc3VzZWQnLCB3aWR0aDogMTAwLCB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ2lkZUNtcC5wYXJhbXNNYXBwaW5nLmNvbHVtbkhlYWRlcicpWzVdLFxyXG4gICAgICAgIGVkaXRvcjoge1xyXG4gICAgICAgICAgdHlwZTogRWRpdG9yVHlwZXMuQ0hFQ0tCT1hcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBvblJlc2l6ZWQoZXZlbnQ6IGFueSk6IHZvaWQge1xyXG4gICAgdGhpcy5zaXplLmhlaWdodCA9IGV2ZW50Lm5ld0hlaWdodDtcclxuICAgIHRoaXMuc2l6ZS53aWR0aCA9IGV2ZW50Lm5ld1dpZHRoO1xyXG4gIH1cclxuXHJcbiAgY2xpY2tDYW5jZWwoKSB7XHJcbiAgICBpZiAodGhpcy5kZzIpIHtcclxuICAgICAgdGhpcy5kZzIuZW5kUm93RWRpdCgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jbG9zZU1vZGFsLmVtaXQoKTtcclxuICB9XHJcblxyXG4gIGNsaWNrQ29uZmlybSgpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgdGhpcy51cGRhdGVQYXJhc01hcHBpbmcoKTtcclxuICAgIHNlbGYuc3VibWl0TW9kYWwuZW1pdCh7IHZhbHVlOiBzZWxmLlF1ZXJ5SW5mb0RhdGFzIH0pO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlYmVmb3JlQ2xvc2UgPSAoKTogT2JzZXJ2YWJsZTxhbnk+ID0+IHtcclxuICAgIGlmICh0aGlzLmRnMSkge1xyXG4gICAgICB0aGlzLmRnMS5lbmRSb3dFZGl0KCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZVBhcmFzTWFwcGluZygpO1xyXG4gICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlUGFyYXNNYXBwaW5nKCkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBpZiAoc2VsZi5RdWVyeUluZm9EYXRhcyAmJiBzZWxmLlF1ZXJ5SW5mb0RhdGFzLmxlbmd0aCkge1xyXG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXHJcbiAgICAgIHNlbGYuc2F2ZURhdGFzID0geyBJZDogRXZlbnRCdXMuZ3VpZCgpLCBwYXJhc21hcHBpbmc6IEpTT04uc3RyaW5naWZ5KHsgdmFsdWU6IEpTT04uc3RyaW5naWZ5KHNlbGYuUXVlcnlJbmZvRGF0YXMpLCBxdWVyeXBhcmFEYXRhOiBKU09OLnN0cmluZ2lmeShzZWxmLnF1ZXJ5cGFyYURhdGEpLCBzb3VyY2VwYXJhRGF0YTogSlNPTi5zdHJpbmdpZnkoc2VsZi5zb3VyY2VwYXJhRGF0YSkgfSksIHF1ZXJ5aWQ6IHNlbGYucXVlcnlJZCwgZGF0YXNvdXJjZWlkOiBzZWxmLnFvTWFuYWdlckNvZGUgfTtcclxuICAgICAgc2VsZi5wYXJhc01hcHBpbmdTZXJ2aWNlLnNhdmVQYXJhc01hcHBpbmcoc2VsZi5zYXZlRGF0YXMsIHNlbGYucXVlcnlSZWxhdGl2ZVVybClcclxuICAgICAgICAuc3Vic2NyaWJlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLnBhcmFzTWFwcGluZ1NlcnZpY2UuZGVsZXRlUGFyYXNNYXBwaW5nKHNlbGYucW9NYW5hZ2VyQ29kZSwgc2VsZi5xdWVyeUlkLCBzZWxmLnF1ZXJ5UmVsYXRpdmVVcmwpLnN1YnNjcmliZSgpO1xyXG4gICAgICBzZWxmLlF1ZXJ5SW5mb0RhdGFzID0gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVEaWFsb2dTaG93KCkge1xyXG4gICAgdGhpcy5mYXJyaXNEaWFsb2cuc2hvdygpO1xyXG4gIH1cclxuXHJcbiAgYWRkRmlsdGVyUm93KCRldmVudDogYW55KSB7XHJcbiAgICB0aGlzLlF1ZXJ5SW5mb0RhdGFzLnB1c2goe1xyXG4gICAgICAnaWQnOiBFdmVudEJ1cy5ndWlkKCksXHJcbiAgICAgICdwYXJhbWV0ZXInOiAnJyxcclxuICAgICAgJ3NvdXJjZVBhcmFtZXRlcic6ICcnLFxyXG4gICAgICAnbWFwcGluZ1R5cGUnOiAwLFxyXG4gICAgICAnY29uc3RhbnQnOiAnJyxcclxuICAgICAgJ2V4cHJlc3Npb24nOiAnJyxcclxuICAgICAgJ3BhcmFpc3VzZWQnOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIGlmICh0aGlzLmRnMSkge1xyXG4gICAgICB0aGlzLmRnMS5yZWZyZXNoKCk7XHJcbiAgfVxyXG4gIH1cclxuXHJcbiAgYWRkRmlsdGVyUm93Rm9ySWRlKCRldmVudDogYW55KSB7XHJcbiAgICB0aGlzLlF1ZXJ5SW5mb0RhdGFzLnB1c2goe1xyXG4gICAgICAnaWQnOiBFdmVudEJ1cy5ndWlkKCksXHJcbiAgICAgICdwYXJhbWV0ZXInOiAnJyxcclxuICAgICAgJ3NvdXJjZVBhcmFtZXRlcic6ICcnLFxyXG4gICAgICAnbWFwcGluZ1R5cGUnOiAwLFxyXG4gICAgICAnY29uc3RhbnQnOiAnJyxcclxuICAgICAgJ2V4cHJlc3Npb24nOiAnJyxcclxuICAgICAgJ3BhcmFpc3VzZWQnOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIGlmICh0aGlzLmRnMikge1xyXG4gICAgICB0aGlzLmRnMi5yZWZyZXNoKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkZWxldGVGaWx0ZXJSb3coJGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKHRoaXMuZGcxLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gZmluZEluZGV4KHRoaXMuUXVlcnlJbmZvRGF0YXMsIGZ1bmN0aW9uIChuOiBhbnkpIHsgcmV0dXJuIG4uaWQgPT09IHNlbGYuZGcxLnNlbGVjdGVkUm93LmlkOyB9KTtcclxuICAgICAgdGhpcy5RdWVyeUluZm9EYXRhcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICB0aGlzLmRnMS5yZWZyZXNoKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1zZ1NlcnZpY2UuaW5mbyhzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnBhcmFtc01hcHBpbmcubWVzc2FnZS52YWxpZGF0ZS5zZWxlY3QnKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBkZWxldGVGaWx0ZXJSb3dGb3JJZGUoJGV2ZW50OiBhbnkpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKHRoaXMuZGcyLnNlbGVjdGVkUm93KSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gZmluZEluZGV4KHRoaXMuUXVlcnlJbmZvRGF0YXMsIGZ1bmN0aW9uIChuOiBhbnkpIHsgcmV0dXJuIG4uaWQgPT09IHNlbGYuZGcyLnNlbGVjdGVkUm93LmlkOyB9KTtcclxuICAgICAgdGhpcy5RdWVyeUluZm9EYXRhcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICB0aGlzLmRnMi5yZWZyZXNoKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1zZ1NlcnZpY2UuaW5mbyhzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnBhcmFtc01hcHBpbmcubWVzc2FnZS52YWxpZGF0ZS5zZWxlY3QnKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjYW5jZWxFZGl0KCRldmVudDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5kZzEpIHtcclxuICAgICAgdGhpcy5kZzEuZW5kUm93RWRpdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2FuY2VsRWRpdEZvcklkZSgkZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKHRoaXMuZGcyKSB7XHJcbiAgICAgIHRoaXMuZGcyLmVuZFJvd0VkaXQoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
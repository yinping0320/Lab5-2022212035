/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import 'rxjs/add/operator/map';
import { Injectable, Inject } from '@angular/core';
import { map } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { SessionService } from '@ecp-caf/caf-common';
import { RestfulService } from '../restful-service/restful.service';
import { Server_Host } from '../../entitties/server.host';
import { RtfServices } from '../rtfservices/rtfservices';
export class JointSearchManagerService {
    /**
     * @param {?} restService
     * @param {?} sessionService
     * @param {?} host
     */
    constructor(restService, sessionService, host) {
        this.restService = restService;
        this.sessionService = sessionService;
        this.host = host;
        this.uri = '/api/runtime/bcc/v1.0/joinsearch/';
        this.localUri = '/api/runtime/sys/v1.0/loginInfo';
        this.lcpUri = '/api/runtime/bcc/v1.0/qdpsearch/';
        this.jointsearchInfoChange = new Subject();
        this.jointsearchInfoList = {};
        // this.uri = this.host + this.uri;
    }
    /**
     * 获取查询参数映射信息
     * @param {?} formId
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    getjointsearch(formId, queryId, queryRelativeUrl) {
        /** @type {?} */
        const result$ = this.getjointsearchList(formId, queryId, '', '', queryRelativeUrl);
        return result$.pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (value && value[formId + queryId]) {
                return value[formId + queryId];
            }
            else {
                return null;
            }
        })));
    }
    /**
     * @param {?} visibleJointParam
     * @param {?} queryRelativeUrl
     * @param {?} searchList
     * @return {?}
     */
    getVisibleJoint(visibleJointParam, queryRelativeUrl, searchList) {
        /** @type {?} */
        const jointUri = this.host + (!queryRelativeUrl ? this.lcpUri : queryRelativeUrl) + 'visiblejoint';
        /** @type {?} */
        const result$ = this.restService.put(jointUri, { 'Param': visibleJointParam }, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            const jointSearchList = [];
            if (data) {
                data = !queryRelativeUrl ? data : data.returnValue;
                if (!queryRelativeUrl) {
                    for (const search of searchList) {
                        if (data[search.id] !== null && data[search.id] === true) {
                            jointSearchList.push(search);
                        }
                    }
                }
                else {
                    for (const search of searchList) {
                        /** @type {?} */
                        const item = data.find((/**
                         * @param {?} d
                         * @return {?}
                         */
                        d => d.id === search.id));
                        if (item && item.visible === true) {
                            jointSearchList.push(search);
                        }
                    }
                }
            }
            return jointSearchList;
        })));
    }
    /**
     * 获取参数映射列表
     * @param {?} formId
     * @param {?} queryId 查询编号
     * @param {?} userId 用户ID
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    getjointsearchList(formId, queryId, userId, languageType, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'getjoinsearch';
        /** @type {?} */
        const result$ = this.restService.get(restUri, { formId, queryId, userId, languageType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            // this.jointsearchInfoList = {};
            if (data && data.length) {
                data.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                (element) => {
                    this.jointsearchInfoList[element.formId + element.queryId] = element;
                }));
                this.jointsearchInfoChange.next({ jointsearchInfoList: this.jointsearchInfoList });
                return this.jointsearchInfoList;
            }
            else {
                this.jointsearchInfoChange.next({ jointsearchInfoList: null });
                return null;
            }
        })));
    }
    /**
     * 保存参数映射
     * @param {?} jointsearch 参数映射实体
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    savejointsearch(jointsearch, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'addjointsearch';
        /** @type {?} */
        const result$ = this.restService.post(restUri, jointsearch, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data === true) {
                this.jointsearchInfoList[jointsearch.FormId + jointsearch.queryId] = jointsearch;
                return true;
            }
            else {
                return false;
            }
        })));
    }
    /**
     * 删除联查
     * @param {?} formId
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    deletejointsearch(formId, queryId, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'deletejointsearch';
        /** @type {?} */
        const result$ = this.restService.delete(restUri, { formId, queryId }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data === true) {
                this.jointsearchInfoList[formId + queryId] = null;
                return true;
            }
            else {
                return false;
            }
        })));
    }
    /**
     * @return {?}
     */
    getLanguageList() {
        /** @type {?} */
        const result$ = this.restService.get(this.localUri, { infoType: 'supportedLanguage' });
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            return data;
        })));
    }
    /**
     * @private
     * @return {?}
     */
    createHeaderSessionId() {
        return RtfServices.createHeaderSessionId(this.sessionService);
    }
}
JointSearchManagerService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
JointSearchManagerService.ctorParameters = () => [
    { type: RestfulService },
    { type: SessionService },
    { type: String, decorators: [{ type: Inject, args: [Server_Host,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    JointSearchManagerService.prototype.uri;
    /**
     * @type {?}
     * @private
     */
    JointSearchManagerService.prototype.localUri;
    /**
     * @type {?}
     * @private
     */
    JointSearchManagerService.prototype.lcpUri;
    /** @type {?} */
    JointSearchManagerService.prototype.jointsearchInfoChange;
    /** @type {?} */
    JointSearchManagerService.prototype.jointsearchInfoList;
    /**
     * @type {?}
     * @private
     */
    JointSearchManagerService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    JointSearchManagerService.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    JointSearchManagerService.prototype.host;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiam9pbnQtc2VhcmNobWFuYWdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHFkcC9jb21tb24vIiwic291cmNlcyI6WyJsaWIvc2VydmljZS9qb2ludC1zZWFyY2gvam9pbnQtc2VhcmNobWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBYyxPQUFPLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFFMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBR3pELE1BQU0sT0FBTyx5QkFBeUI7Ozs7OztJQVFwQyxZQUFvQixXQUEyQixFQUFVLGNBQThCLEVBQStCLElBQVk7UUFBOUcsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQStCLFNBQUksR0FBSixJQUFJLENBQVE7UUFQMUgsUUFBRyxHQUFHLG1DQUFtQyxDQUFDO1FBQzFDLGFBQVEsR0FBRyxpQ0FBaUMsQ0FBQztRQUM3QyxXQUFNLEdBQUcsa0NBQWtDLENBQUM7UUFDcEQsMEJBQXFCLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUUzQyx3QkFBbUIsR0FBUSxFQUFFLENBQUM7UUFHNUIsbUNBQW1DO0lBQ3JDLENBQUM7Ozs7Ozs7O0lBT0QsY0FBYyxDQUFDLE1BQWMsRUFBRSxPQUFlLEVBQUUsZ0JBQXFCOztjQUM3RCxPQUFPLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFD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LHlDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvbWFwJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgUmVzdGZ1bFNlcnZpY2UgfSBmcm9tICcuLi9yZXN0ZnVsLXNlcnZpY2UvcmVzdGZ1bC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU2VydmVyX0hvc3QgfSBmcm9tICcuLi8uLi9lbnRpdHRpZXMvc2VydmVyLmhvc3QnO1xyXG5pbXBvcnQgeyBlbGVtZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9zcmMvcmVuZGVyMyc7XHJcbmltcG9ydCB7IFJ0ZlNlcnZpY2VzIH0gZnJvbSAnLi4vcnRmc2VydmljZXMvcnRmc2VydmljZXMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgSm9pbnRTZWFyY2hNYW5hZ2VyU2VydmljZSB7XHJcbiAgcHJpdmF0ZSB1cmkgPSAnL2FwaS9ydW50aW1lL2JjYy92MS4wL2pvaW5zZWFyY2gvJztcclxuICBwcml2YXRlIGxvY2FsVXJpID0gJy9hcGkvcnVudGltZS9zeXMvdjEuMC9sb2dpbkluZm8nO1xyXG4gIHByaXZhdGUgbGNwVXJpID0gJy9hcGkvcnVudGltZS9iY2MvdjEuMC9xZHBzZWFyY2gvJztcclxuICBqb2ludHNlYXJjaEluZm9DaGFuZ2UgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcblxyXG4gIGpvaW50c2VhcmNoSW5mb0xpc3Q6IGFueSA9IHt9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlc3RTZXJ2aWNlOiBSZXN0ZnVsU2VydmljZSwgcHJpdmF0ZSBzZXNzaW9uU2VydmljZTogU2Vzc2lvblNlcnZpY2UsIEBJbmplY3QoU2VydmVyX0hvc3QpIHByaXZhdGUgaG9zdDogc3RyaW5nKSB7XHJcbiAgICAvLyB0aGlzLnVyaSA9IHRoaXMuaG9zdCArIHRoaXMudXJpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5p+l6K+i5Y+C5pWw5pig5bCE5L+h5oGvXHJcbiAgICogQHBhcmFtIGZvcm1pZCDooajljZVJRFxyXG4gICAqIEBwYXJhbSBxdWVyeUlkIOafpeivoue8luWPt1xyXG4gICAqL1xyXG4gIGdldGpvaW50c2VhcmNoKGZvcm1JZDogc3RyaW5nLCBxdWVyeUlkOiBzdHJpbmcsIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5nZXRqb2ludHNlYXJjaExpc3QoZm9ybUlkLCBxdWVyeUlkLCAnJywgJycsIHF1ZXJ5UmVsYXRpdmVVcmwpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKHZhbHVlID0+IHtcclxuICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbZm9ybUlkICsgcXVlcnlJZF0pIHtcclxuICAgICAgICAgIHJldHVybiB2YWx1ZVtmb3JtSWQgKyBxdWVyeUlkXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldFZpc2libGVKb2ludCh2aXNpYmxlSm9pbnRQYXJhbTogYW55LCBxdWVyeVJlbGF0aXZlVXJsOiBhbnksIHNlYXJjaExpc3Q6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBqb2ludFVyaSA9IHRoaXMuaG9zdCArICghcXVlcnlSZWxhdGl2ZVVybCA/IHRoaXMubGNwVXJpIDogcXVlcnlSZWxhdGl2ZVVybCkgKyAndmlzaWJsZWpvaW50JztcclxuXHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5wdXQoam9pbnRVcmksIHsgJ1BhcmFtJzogdmlzaWJsZUpvaW50UGFyYW19LCB7fSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGpvaW50U2VhcmNoTGlzdCA9IFtdO1xyXG4gICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICBkYXRhID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyBkYXRhIDogZGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgICAgICAgIGlmICghcXVlcnlSZWxhdGl2ZVVybCkge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNlYXJjaCBvZiBzZWFyY2hMaXN0KSB7XHJcbiAgICAgICAgICAgICAgaWYgKGRhdGFbc2VhcmNoLmlkXSAhPT0gbnVsbCAmJiBkYXRhW3NlYXJjaC5pZF0gPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGpvaW50U2VhcmNoTGlzdC5wdXNoKHNlYXJjaCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBzZWFyY2ggb2Ygc2VhcmNoTGlzdCkge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhLmZpbmQoZCA9PiBkLmlkID09PSBzZWFyY2guaWQpO1xyXG4gICAgICAgICAgICAgIGlmIChpdGVtICYmIGl0ZW0udmlzaWJsZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgam9pbnRTZWFyY2hMaXN0LnB1c2goc2VhcmNoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBqb2ludFNlYXJjaExpc3Q7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Y+C5pWw5pig5bCE5YiX6KGoXHJcbiAgICogQHBhcmFtIHF1ZXJ5SWQg5p+l6K+i57yW5Y+3XHJcbiAgICogQHBhcmFtIHVzZXJJZCDnlKjmiLdJRFxyXG4gICAqIEBwYXJhbSBsYW5ndWFnZVR5cGUg6K+t6KiA57G75Z6LXHJcbiAgICovXHJcbiAgZ2V0am9pbnRzZWFyY2hMaXN0KGZvcm1JZDogYW55LCBxdWVyeUlkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nLCBsYW5ndWFnZVR5cGU6IHN0cmluZywgcXVlcnlSZWxhdGl2ZVVybDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3RVcmkgPSB0aGlzLmhvc3QgKyB0aGlzLnVyaSArICdnZXRqb2luc2VhcmNoJztcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnJlc3RTZXJ2aWNlLmdldChyZXN0VXJpLCB7IGZvcm1JZCwgcXVlcnlJZCwgdXNlcklkLCBsYW5ndWFnZVR5cGUgfSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIC8vIHRoaXMuam9pbnRzZWFyY2hJbmZvTGlzdCA9IHt9O1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICBkYXRhLmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmpvaW50c2VhcmNoSW5mb0xpc3RbZWxlbWVudC5mb3JtSWQgKyBlbGVtZW50LnF1ZXJ5SWRdID0gZWxlbWVudDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy5qb2ludHNlYXJjaEluZm9DaGFuZ2UubmV4dCh7IGpvaW50c2VhcmNoSW5mb0xpc3Q6IHRoaXMuam9pbnRzZWFyY2hJbmZvTGlzdCB9KTtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmpvaW50c2VhcmNoSW5mb0xpc3Q7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuam9pbnRzZWFyY2hJbmZvQ2hhbmdlLm5leHQoeyBqb2ludHNlYXJjaEluZm9MaXN0OiBudWxsIH0pO1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5L+d5a2Y5Y+C5pWw5pig5bCEXHJcbiAgICogQHBhcmFtIGpvaW50c2VhcmNoIOWPguaVsOaYoOWwhOWunuS9k1xyXG4gICAqL1xyXG4gIHNhdmVqb2ludHNlYXJjaChqb2ludHNlYXJjaDogYW55LCBxdWVyeVJlbGF0aXZlVXJsOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVzdFVyaSA9IHRoaXMuaG9zdCArIHRoaXMudXJpICsgJ2FkZGpvaW50c2VhcmNoJztcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnJlc3RTZXJ2aWNlLnBvc3QocmVzdFVyaSwgam9pbnRzZWFyY2gsIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHtcclxuICAgICAgICAgIHRoaXMuam9pbnRzZWFyY2hJbmZvTGlzdFtqb2ludHNlYXJjaC5Gb3JtSWQgKyBqb2ludHNlYXJjaC5xdWVyeUlkXSA9IGpvaW50c2VhcmNoO1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOiBlOafpVxyXG4gICAqIEBwYXJhbSBxdWVyeUlkIOafpeivoue8luWPt1xyXG4gICAqL1xyXG4gIGRlbGV0ZWpvaW50c2VhcmNoKGZvcm1JZDogYW55LCBxdWVyeUlkOiBzdHJpbmcsIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnZGVsZXRlam9pbnRzZWFyY2gnO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UuZGVsZXRlKHJlc3RVcmksIHsgZm9ybUlkLCBxdWVyeUlkIH0sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoZGF0YSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgdGhpcy5qb2ludHNlYXJjaEluZm9MaXN0W2Zvcm1JZCArIHF1ZXJ5SWRdID0gbnVsbDtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldExhbmd1YWdlTGlzdCgpIHtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnJlc3RTZXJ2aWNlLmdldCh0aGlzLmxvY2FsVXJpLCB7IGluZm9UeXBlOiAnc3VwcG9ydGVkTGFuZ3VhZ2UnIH0pO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZUhlYWRlclNlc3Npb25JZCgpIHtcclxuICAgIHJldHVybiBSdGZTZXJ2aWNlcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQodGhpcy5zZXNzaW9uU2VydmljZSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
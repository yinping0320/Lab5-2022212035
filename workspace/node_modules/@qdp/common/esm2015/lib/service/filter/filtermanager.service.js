/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import 'rxjs/add/operator/map';
import { Injectable, Inject } from '@angular/core';
import { map } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { SessionService } from '@ecp-caf/caf-common';
import { RestfulService } from '../restful-service/restful.service';
import { Server_Host } from '../../entitties/server.host';
import { RtfServices } from '../rtfservices/rtfservices';
export class FilterManagerService {
    /**
     * @param {?} restService
     * @param {?} sessionService
     * @param {?} host
     */
    constructor(restService, sessionService, host) {
        this.restService = restService;
        this.sessionService = sessionService;
        this.host = host;
        this.uri = '/api/runtime/bcc/v1.0/qdpfilter/';
        this.filterInfoChange = new Subject();
        this.isFilterQDP = new Subject(); // 是否刷新
        // 是否刷新
        this.filterInfoList = {};
        // this.uri = this.host + this.uri;
    }
    /**
     * 获取查询参数映射信息
     * @param {?} id 数据源ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @param {?} queryType
     * @param {?=} groupType
     * @return {?}
     */
    getFilter(id, queryId, queryRelativeUrl, queryType, groupType) {
        /** @type {?} */
        const result$ = this.getFilterList(queryId, id, groupType, '', queryRelativeUrl, queryType);
        return result$.pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (value && value[queryId]) {
                return value[queryId];
            }
            else {
                return null;
            }
        })));
    }
    /**
     * 获取参数映射列表
     * @param {?} queryId 查询编号
     * @param {?} datasourceId
     * @param {?} groupType
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @param {?=} queryType
     * @return {?}
     */
    getFilterList(queryId, datasourceId, groupType, languageType, queryRelativeUrl, queryType = 0) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'getfilterlist';
        /** @type {?} */
        const result$ = this.restService.get(restUri, { queryId, datasourceId, groupType, languageType, queryType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data && data.length) {
                data.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                (element) => {
                    element.filter = JSON.parse(element.filter);
                    this.filterInfoList[element.queryid] = element;
                }));
                this.filterInfoChange.next({ parasInfoList: this.filterInfoList });
                return this.filterInfoList;
            }
            else {
                this.filterInfoChange.next({ parasInfoList: null });
                return null;
            }
        })));
    }
    /**
     * 保存参数映射
     * @param {?} filter 参数映射实体
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    saveFilter(filter, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'savefilter';
        /** @type {?} */
        const result$ = this.restService.post(restUri, filter, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @return {?}
         */
        () => {
            filter.filter = JSON.parse(filter.filter);
            if (Object.keys(this.filterInfoList).indexOf(filter.queryid)) {
                this.filterInfoList[filter.queryid] = filter;
            }
        })));
    }
    /**
     * 删除方案
     * @param {?} datasourceid
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @param {?} queryType
     * @return {?}
     */
    deleteFilter(datasourceid, queryId, queryRelativeUrl, queryType) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'deletefilter';
        /** @type {?} */
        const result$ = this.restService.delete(restUri, { datasourceId: datasourceid, queryId, queryType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data === true) {
                this.filterInfoList[queryId] = null;
            }
            else {
                return false;
            }
        })));
    }
    /**
     * @private
     * @return {?}
     */
    createHeaderSessionId() {
        return RtfServices.createHeaderSessionId(this.sessionService);
    }
}
FilterManagerService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
FilterManagerService.ctorParameters = () => [
    { type: RestfulService },
    { type: SessionService },
    { type: String, decorators: [{ type: Inject, args: [Server_Host,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.uri;
    /** @type {?} */
    FilterManagerService.prototype.filterInfoChange;
    /** @type {?} */
    FilterManagerService.prototype.isFilterQDP;
    /** @type {?} */
    FilterManagerService.prototype.filterInfoList;
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.host;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVybWFuYWdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHFkcC9jb21tb24vIiwic291cmNlcyI6WyJsaWIvc2VydmljZS9maWx0ZXIvZmlsdGVybWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBYyxPQUFPLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBR3pELE1BQU0sT0FBTyxvQkFBb0I7Ozs7OztJQU8vQixZQUFvQixXQUEyQixFQUFVLGNBQThCLEVBQStCLElBQVk7UUFBOUcsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQStCLFNBQUksR0FBSixJQUFJLENBQVE7UUFOMUgsUUFBRyxHQUFHLGtDQUFrQyxDQUFDO1FBQ2pELHFCQUFnQixHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFDdEMsZ0JBQVcsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTzs7UUFFcEMsbUJBQWMsR0FBUSxFQUFFLENBQUM7UUFHdkIsbUNBQW1DO0lBQ3JDLENBQUM7Ozs7Ozs7Ozs7SUFPRCxTQUFTLENBQUMsRUFBVSxFQUFFLE9BQWUsRUFBRSxnQkFBcUIsRUFBRSxTQUFpQixFQUFFLFNBQWU7O2NBQ3hGLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLENBQUM7UUFDM0YsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNqQixHQUFHOzs7O1FBQUMsS0FBSyxDQUFDLEVBQUU7WUFDVixJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzNCLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3ZCO2lCQUFNO2dCQUNMLE9BQU8sSUFBSSxDQUFDO2FBQ2I7UUFDSCxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7Ozs7Ozs7SUFRRCxhQUFhLENBQUMsT0FBZSxFQUFFLFlBQWlCLEVBQUUsU0FBaUIsRUFBRSxZQUFvQixFQUFFLGdCQUFxQixFQUFFLFlBQW9CLENBQUM7O2NBQy9ILE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsZUFBZTs7Y0FDaEQsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUMxSSxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQ2pCLEdBQUc7Ozs7UUFBQyxDQUFDLElBQVMsRUFBRSxFQUFFO1lBQ2hCLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxPQUFPOzs7O2dCQUFDLENBQUMsT0FBWSxFQUFFLEVBQUU7b0JBQzVCLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQzVDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLE9BQU8sQ0FBQztnQkFDakQsQ0FBQyxFQUFDLENBQUM7Z0JBQ0gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQztnQkFDbkUsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO2FBQzVCO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDcEQsT0FBTyxJQUFJLENBQUM7YUFDYjtRQUNILENBQUMsRUFBQyxDQUNILENBQUM7SUFDSixDQUFDOzs7Ozs7O0lBS0QsVUFBVSxDQUFDLE1BQVcsRUFBRSxnQkFBcUI7O2NBQ3JDLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsWUFBWTs7Y0FDN0MsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3hGLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FDakIsR0FBRzs7O1FBQUMsR0FBRyxFQUFFO1lBQ1AsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMxQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzVELElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLE1BQU0sQ0FBQzthQUM5QztRQUNILENBQUMsRUFBQyxDQUNILENBQUM7SUFDSixDQUFDOzs7Ozs7Ozs7SUFNRCxZQUFZLENBQUMsWUFBb0IsRUFBRSxPQUFlLEVBQUUsZ0JBQXFCLEVBQUUsU0FBaUI7O2NBQ3BGLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsY0FBYzs7Y0FDL0MsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ2xJLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FDakIsR0FBRzs7OztRQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDaEIsSUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFO2dCQUNqQixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQzthQUNyQztpQkFBTTtnQkFDTCxPQUFPLEtBQUssQ0FBQzthQUNkO1FBQ0gsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7Ozs7O0lBRU8scUJBQXFCO1FBQzNCLE9BQU8sV0FBVyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNoRSxDQUFDOzs7WUE1RkYsVUFBVTs7OztZQUpGLGNBQWM7WUFEZCxjQUFjO3lDQWFxRSxNQUFNLFNBQUMsV0FBVzs7Ozs7OztJQU41RyxtQ0FBaUQ7O0lBQ2pELGdEQUFzQzs7SUFDdEMsMkNBQTRCOztJQUU1Qiw4Q0FBeUI7Ozs7O0lBRWIsMkNBQW1DOzs7OztJQUFFLDhDQUFzQzs7Ozs7SUFBRSxvQ0FBeUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL21hcCc7XHJcbmltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QsIG9mIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFNlc3Npb25TZXJ2aWNlIH0gZnJvbSAnQGVjcC1jYWYvY2FmLWNvbW1vbic7XHJcbmltcG9ydCB7IFJlc3RmdWxTZXJ2aWNlIH0gZnJvbSAnLi4vcmVzdGZ1bC1zZXJ2aWNlL3Jlc3RmdWwuc2VydmljZSc7XHJcbmltcG9ydCB7IFNlcnZlcl9Ib3N0IH0gZnJvbSAnLi4vLi4vZW50aXR0aWVzL3NlcnZlci5ob3N0JztcclxuaW1wb3J0IHsgUnRmU2VydmljZXMgfSBmcm9tICcuLi9ydGZzZXJ2aWNlcy9ydGZzZXJ2aWNlcyc7XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBGaWx0ZXJNYW5hZ2VyU2VydmljZSB7XHJcbiAgcHJpdmF0ZSB1cmkgPSAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3FkcGZpbHRlci8nO1xyXG4gIGZpbHRlckluZm9DaGFuZ2UgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgaXNGaWx0ZXJRRFAgPSBuZXcgU3ViamVjdCgpOyAvLyDmmK/lkKbliLfmlrBcclxuXHJcbiAgZmlsdGVySW5mb0xpc3Q6IGFueSA9IHt9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlc3RTZXJ2aWNlOiBSZXN0ZnVsU2VydmljZSwgcHJpdmF0ZSBzZXNzaW9uU2VydmljZTogU2Vzc2lvblNlcnZpY2UsIEBJbmplY3QoU2VydmVyX0hvc3QpIHByaXZhdGUgaG9zdDogc3RyaW5nKSB7XHJcbiAgICAvLyB0aGlzLnVyaSA9IHRoaXMuaG9zdCArIHRoaXMudXJpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5p+l6K+i5Y+C5pWw5pig5bCE5L+h5oGvXHJcbiAgICogQHBhcmFtIGlkIOaVsOaNrua6kElEXHJcbiAgICogQHBhcmFtIHF1ZXJ5SWQg5p+l6K+i57yW5Y+3XHJcbiAgICovXHJcbiAgZ2V0RmlsdGVyKGlkOiBzdHJpbmcsIHF1ZXJ5SWQ6IHN0cmluZywgcXVlcnlSZWxhdGl2ZVVybDogYW55LCBxdWVyeVR5cGU6IG51bWJlciwgZ3JvdXBUeXBlPzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLmdldEZpbHRlckxpc3QocXVlcnlJZCwgaWQsIGdyb3VwVHlwZSwgJycsIHF1ZXJ5UmVsYXRpdmVVcmwsIHF1ZXJ5VHlwZSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAodmFsdWUgPT4ge1xyXG4gICAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZVtxdWVyeUlkXSkge1xyXG4gICAgICAgICAgcmV0dXJuIHZhbHVlW3F1ZXJ5SWRdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5Y+C5pWw5pig5bCE5YiX6KGoXHJcbiAgICogQHBhcmFtIHF1ZXJ5SWQg5p+l6K+i57yW5Y+3XHJcbiAgICogQHBhcmFtIHVzZXJJZCDnlKjmiLdJRFxyXG4gICAqIEBwYXJhbSBsYW5ndWFnZVR5cGUg6K+t6KiA57G75Z6LXHJcbiAgICovXHJcbiAgZ2V0RmlsdGVyTGlzdChxdWVyeUlkOiBzdHJpbmcsIGRhdGFzb3VyY2VJZDogYW55LCBncm91cFR5cGU6IHN0cmluZywgbGFuZ3VhZ2VUeXBlOiBzdHJpbmcsIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSwgcXVlcnlUeXBlOiBudW1iZXIgPSAwKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3RVcmkgPSB0aGlzLmhvc3QgKyB0aGlzLnVyaSArICdnZXRmaWx0ZXJsaXN0JztcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnJlc3RTZXJ2aWNlLmdldChyZXN0VXJpLCB7IHF1ZXJ5SWQsIGRhdGFzb3VyY2VJZCwgZ3JvdXBUeXBlLCBsYW5ndWFnZVR5cGUsIHF1ZXJ5VHlwZSB9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgIGRhdGEuZm9yRWFjaCgoZWxlbWVudDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuZmlsdGVyID0gSlNPTi5wYXJzZShlbGVtZW50LmZpbHRlcik7XHJcbiAgICAgICAgICAgIHRoaXMuZmlsdGVySW5mb0xpc3RbZWxlbWVudC5xdWVyeWlkXSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHRoaXMuZmlsdGVySW5mb0NoYW5nZS5uZXh0KHsgcGFyYXNJbmZvTGlzdDogdGhpcy5maWx0ZXJJbmZvTGlzdCB9KTtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmZpbHRlckluZm9MaXN0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmZpbHRlckluZm9DaGFuZ2UubmV4dCh7IHBhcmFzSW5mb0xpc3Q6IG51bGwgfSk7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkv53lrZjlj4LmlbDmmKDlsIRcclxuICAgKiBAcGFyYW0gZmlsdGVyIOWPguaVsOaYoOWwhOWunuS9k1xyXG4gICAqL1xyXG4gIHNhdmVGaWx0ZXIoZmlsdGVyOiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnc2F2ZWZpbHRlcic7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5wb3N0KHJlc3RVcmksIGZpbHRlciwge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICBmaWx0ZXIuZmlsdGVyID0gSlNPTi5wYXJzZShmaWx0ZXIuZmlsdGVyKTtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5maWx0ZXJJbmZvTGlzdCkuaW5kZXhPZihmaWx0ZXIucXVlcnlpZCkpIHtcclxuICAgICAgICAgIHRoaXMuZmlsdGVySW5mb0xpc3RbZmlsdGVyLnF1ZXJ5aWRdID0gZmlsdGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOaWueahiFxyXG4gICAqIEBwYXJhbSBpZCDmlrnmoYhJRFxyXG4gICAqIEBwYXJhbSBxdWVyeUlkIOafpeivoue8luWPt1xyXG4gICAqL1xyXG4gIGRlbGV0ZUZpbHRlcihkYXRhc291cmNlaWQ6IHN0cmluZywgcXVlcnlJZDogc3RyaW5nLCBxdWVyeVJlbGF0aXZlVXJsOiBhbnksIHF1ZXJ5VHlwZTogbnVtYmVyKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3RVcmkgPSB0aGlzLmhvc3QgKyB0aGlzLnVyaSArICdkZWxldGVmaWx0ZXInO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UuZGVsZXRlKHJlc3RVcmksIHsgZGF0YXNvdXJjZUlkOiBkYXRhc291cmNlaWQsIHF1ZXJ5SWQsIHF1ZXJ5VHlwZSB9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHtcclxuICAgICAgICAgIHRoaXMuZmlsdGVySW5mb0xpc3RbcXVlcnlJZF0gPSBudWxsO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkge1xyXG4gICAgcmV0dXJuIFJ0ZlNlcnZpY2VzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCh0aGlzLnNlc3Npb25TZXJ2aWNlKTtcclxuICB9XHJcbn1cclxuIl19
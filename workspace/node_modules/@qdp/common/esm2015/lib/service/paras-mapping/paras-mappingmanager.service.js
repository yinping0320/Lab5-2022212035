/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import 'rxjs/add/operator/map';
import { Injectable, Inject } from '@angular/core';
import { map } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { SessionService } from '@ecp-caf/caf-common';
import { RestfulService } from '../restful-service/restful.service';
import { Server_Host } from '../../entitties/server.host';
import { RtfServices } from '../rtfservices/rtfservices';
export class ParasMappingManagerService {
    /**
     * @param {?} restService
     * @param {?} sessionService
     * @param {?} host
     */
    constructor(restService, sessionService, host) {
        this.restService = restService;
        this.sessionService = sessionService;
        this.host = host;
        this.uri = '/api/runtime/bcc/v1.0/qdpparasmapping/';
        this.parasmappingInfoChange = new Subject();
        this.parasmappingInfoList = {};
    }
    /**
     * 获取查询参数映射信息
     * @param {?} id 数据源ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @param {?=} type
     * @return {?}
     */
    getParasMapping(id, queryId, queryRelativeUrl, type = 0) {
        /** @type {?} */
        const result$ = this.getParasMappingList(queryId, id, '', '', queryRelativeUrl, type);
        return result$.pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (value && value[id]) {
                return value[id];
            }
            else {
                return null;
            }
        })));
    }
    /**
     * 获取参数映射列表
     * @param {?} queryId 查询编号
     * @param {?} datasourceId
     * @param {?} userId 用户ID
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @param {?=} queryType
     * @return {?}
     */
    getParasMappingList(queryId, datasourceId, userId, languageType, queryRelativeUrl, queryType = 0) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'getparasmappinglist';
        /** @type {?} */
        const result$ = this.restService.get(restUri, { queryId, datasourceId, userId, languageType, queryType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data && data.length) {
                data.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                (element) => {
                    element.parasmapping = JSON.parse(element.parasmapping);
                    this.parasmappingInfoList[element.datasourceid] = element;
                }));
                this.parasmappingInfoChange.next({ parasInfoList: this.parasmappingInfoList });
                return this.parasmappingInfoList;
            }
            else {
                this.parasmappingInfoChange.next({ parasInfoList: null });
                return null;
            }
        })));
    }
    /**
     * 保存参数映射
     * @param {?} parasmapping 参数映射实体
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    saveParasMapping(parasmapping, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'saveparasmapping';
        /** @type {?} */
        const result$ = this.restService.post(restUri, parasmapping, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @return {?}
         */
        () => {
            parasmapping.parasmapping = JSON.parse(parasmapping.parasmapping);
            if (Object.keys(this.parasmappingInfoList).indexOf(parasmapping.datasourceid)) {
                this.parasmappingInfoList[parasmapping.datasourceid] = parasmapping;
            }
        })));
    }
    /**
     * 删除方案
     * @param {?} datasourceid
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    deleteParasMapping(datasourceid, queryId, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'deleteparasmapping';
        /** @type {?} */
        const result$ = this.restService.delete(restUri, { datasourceId: datasourceid, queryId }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data === true) {
                this.parasmappingInfoList[datasourceid] = null;
            }
            else {
                return false;
            }
        })));
    }
    /**
     * 获取元数据信息
     * @param {?} Id metadataid
     * @return {?}
     */
    getMetaDataInfoById(Id) {
        /** @type {?} */
        const restUri = this.host + '/api/runtime/lcm/v1.0/rt-metadatas/' + Id;
        /** @type {?} */
        const result$ = this.restService.get(restUri, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data) {
                return data;
            }
            else {
                return null;
            }
        })));
    }
    /**
     * @private
     * @return {?}
     */
    createHeaderSessionId() {
        return RtfServices.createHeaderSessionId(this.sessionService);
    }
}
ParasMappingManagerService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
ParasMappingManagerService.ctorParameters = () => [
    { type: RestfulService },
    { type: SessionService },
    { type: String, decorators: [{ type: Inject, args: [Server_Host,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    ParasMappingManagerService.prototype.uri;
    /** @type {?} */
    ParasMappingManagerService.prototype.parasmappingInfoChange;
    /** @type {?} */
    ParasMappingManagerService.prototype.parasmappingInfoList;
    /**
     * @type {?}
     * @private
     */
    ParasMappingManagerService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    ParasMappingManagerService.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    ParasMappingManagerService.prototype.host;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYXMtbWFwcGluZ21hbmFnZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvY29tbW9uLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2UvcGFyYXMtbWFwcGluZy9wYXJhcy1tYXBwaW5nbWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBYyxPQUFPLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBR3pELE1BQU0sT0FBTywwQkFBMEI7Ozs7OztJQU1yQyxZQUFvQixXQUEyQixFQUFVLGNBQThCLEVBQStCLElBQVk7UUFBOUcsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQStCLFNBQUksR0FBSixJQUFJLENBQVE7UUFMMUgsUUFBRyxHQUFHLHdDQUF3QyxDQUFDO1FBQ3ZELDJCQUFzQixHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFFNUMseUJBQW9CLEdBQVEsRUFBRSxDQUFDO0lBRy9CLENBQUM7Ozs7Ozs7OztJQU9ELGVBQWUsQ0FBQyxFQUFVLEVBQUUsT0FBZSxFQUFFLGdCQUFxQixFQUFFLE9BQWUsQ0FBQzs7Y0FDNUUsT0FBTyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsZ0JBQWdCLEVB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dXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvbWFwJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgUmVzdGZ1bFNlcnZpY2UgfSBmcm9tICcuLi9yZXN0ZnVsLXNlcnZpY2UvcmVzdGZ1bC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU2VydmVyX0hvc3QgfSBmcm9tICcuLi8uLi9lbnRpdHRpZXMvc2VydmVyLmhvc3QnO1xyXG5pbXBvcnQgeyBSdGZTZXJ2aWNlcyB9IGZyb20gJy4uL3J0ZnNlcnZpY2VzL3J0ZnNlcnZpY2VzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFBhcmFzTWFwcGluZ01hbmFnZXJTZXJ2aWNlIHtcclxuICBwcml2YXRlIHVyaSA9ICcvYXBpL3J1bnRpbWUvYmNjL3YxLjAvcWRwcGFyYXNtYXBwaW5nLyc7XHJcbiAgcGFyYXNtYXBwaW5nSW5mb0NoYW5nZSA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuXHJcbiAgcGFyYXNtYXBwaW5nSW5mb0xpc3Q6IGFueSA9IHt9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlc3RTZXJ2aWNlOiBSZXN0ZnVsU2VydmljZSwgcHJpdmF0ZSBzZXNzaW9uU2VydmljZTogU2Vzc2lvblNlcnZpY2UsIEBJbmplY3QoU2VydmVyX0hvc3QpIHByaXZhdGUgaG9zdDogc3RyaW5nKSB7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmn6Xor6Llj4LmlbDmmKDlsITkv6Hmga9cclxuICAgKiBAcGFyYW0gaWQg5pWw5o2u5rqQSURcclxuICAgKiBAcGFyYW0gcXVlcnlJZCDmn6Xor6LnvJblj7dcclxuICAgKi9cclxuICBnZXRQYXJhc01hcHBpbmcoaWQ6IHN0cmluZywgcXVlcnlJZDogc3RyaW5nLCBxdWVyeVJlbGF0aXZlVXJsOiBhbnksIHR5cGU6IG51bWJlciA9IDApOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMuZ2V0UGFyYXNNYXBwaW5nTGlzdChxdWVyeUlkLCBpZCwgJycsICcnLCBxdWVyeVJlbGF0aXZlVXJsLCB0eXBlKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCh2YWx1ZSA9PiB7XHJcbiAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlW2lkXSkge1xyXG4gICAgICAgICAgcmV0dXJuIHZhbHVlW2lkXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWPguaVsOaYoOWwhOWIl+ihqFxyXG4gICAqIEBwYXJhbSBxdWVyeUlkIOafpeivoue8luWPt1xyXG4gICAqIEBwYXJhbSB1c2VySWQg55So5oi3SURcclxuICAgKiBAcGFyYW0gbGFuZ3VhZ2VUeXBlIOivreiogOexu+Wei1xyXG4gICAqL1xyXG4gIGdldFBhcmFzTWFwcGluZ0xpc3QocXVlcnlJZDogc3RyaW5nLCBkYXRhc291cmNlSWQ6IGFueSwgdXNlcklkOiBzdHJpbmcsIGxhbmd1YWdlVHlwZTogc3RyaW5nLCBxdWVyeVJlbGF0aXZlVXJsOiBhbnksIHF1ZXJ5VHlwZTogbnVtYmVyID0gMCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnZ2V0cGFyYXNtYXBwaW5nbGlzdCc7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5nZXQocmVzdFVyaSwgeyBxdWVyeUlkLCBkYXRhc291cmNlSWQsIHVzZXJJZCwgbGFuZ3VhZ2VUeXBlLCBxdWVyeVR5cGUgfSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICBkYXRhLmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBlbGVtZW50LnBhcmFzbWFwcGluZyA9IEpTT04ucGFyc2UoZWxlbWVudC5wYXJhc21hcHBpbmcpO1xyXG4gICAgICAgICAgICB0aGlzLnBhcmFzbWFwcGluZ0luZm9MaXN0W2VsZW1lbnQuZGF0YXNvdXJjZWlkXSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHRoaXMucGFyYXNtYXBwaW5nSW5mb0NoYW5nZS5uZXh0KHsgcGFyYXNJbmZvTGlzdDogdGhpcy5wYXJhc21hcHBpbmdJbmZvTGlzdCB9KTtcclxuICAgICAgICAgIHJldHVybiB0aGlzLnBhcmFzbWFwcGluZ0luZm9MaXN0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnBhcmFzbWFwcGluZ0luZm9DaGFuZ2UubmV4dCh7IHBhcmFzSW5mb0xpc3Q6IG51bGwgfSk7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkv53lrZjlj4LmlbDmmKDlsIRcclxuICAgKiBAcGFyYW0gcGFyYXNtYXBwaW5nIOWPguaVsOaYoOWwhOWunuS9k1xyXG4gICAqL1xyXG4gIHNhdmVQYXJhc01hcHBpbmcocGFyYXNtYXBwaW5nOiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnc2F2ZXBhcmFzbWFwcGluZyc7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5wb3N0KHJlc3RVcmksIHBhcmFzbWFwcGluZywge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICBwYXJhc21hcHBpbmcucGFyYXNtYXBwaW5nID0gSlNPTi5wYXJzZShwYXJhc21hcHBpbmcucGFyYXNtYXBwaW5nKTtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5wYXJhc21hcHBpbmdJbmZvTGlzdCkuaW5kZXhPZihwYXJhc21hcHBpbmcuZGF0YXNvdXJjZWlkKSkge1xyXG4gICAgICAgICAgdGhpcy5wYXJhc21hcHBpbmdJbmZvTGlzdFtwYXJhc21hcHBpbmcuZGF0YXNvdXJjZWlkXSA9IHBhcmFzbWFwcGluZztcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliKDpmaTmlrnmoYhcclxuICAgKiBAcGFyYW0gaWQg5pa55qGISURcclxuICAgKiBAcGFyYW0gcXVlcnlJZCDmn6Xor6LnvJblj7dcclxuICAgKi9cclxuICBkZWxldGVQYXJhc01hcHBpbmcoZGF0YXNvdXJjZWlkOiBzdHJpbmcsIHF1ZXJ5SWQ6IHN0cmluZywgcXVlcnlSZWxhdGl2ZVVybDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3RVcmkgPSB0aGlzLmhvc3QgKyB0aGlzLnVyaSArICdkZWxldGVwYXJhc21hcHBpbmcnO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UuZGVsZXRlKHJlc3RVcmksIHsgZGF0YXNvdXJjZUlkOiBkYXRhc291cmNlaWQsIHF1ZXJ5SWQgfSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7XHJcbiAgICAgICAgICB0aGlzLnBhcmFzbWFwcGluZ0luZm9MaXN0W2RhdGFzb3VyY2VpZF0gPSBudWxsO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWFg+aVsOaNruS/oeaBr1xyXG4gICAqIEBwYXJhbSBJZCBtZXRhZGF0YWlkXHJcbiAgICovXHJcbiAgZ2V0TWV0YURhdGFJbmZvQnlJZChJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3RVcmkgPSB0aGlzLmhvc3QgKyAnL2FwaS9ydW50aW1lL2xjbS92MS4wL3J0LW1ldGFkYXRhcy8nICsgSWQ7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5nZXQocmVzdFVyaSwge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG5cclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSB7XHJcbiAgICByZXR1cm4gUnRmU2VydmljZXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKHRoaXMuc2Vzc2lvblNlcnZpY2UpO1xyXG4gIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import 'rxjs/add/operator/map';
import { Injectable, Inject } from '@angular/core';
import { map } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { SessionService } from '@ecp-caf/caf-common';
import { RestfulService } from '../restful-service/restful.service';
import { Server_Host } from '../../entitties/server.host';
import { RtfServices } from '../rtfservices/rtfservices';
export class PrintIntegrationManagerService {
    /**
     * @param {?} restService
     * @param {?} sessionService
     * @param {?} host
     */
    constructor(restService, sessionService, host) {
        this.restService = restService;
        this.sessionService = sessionService;
        this.host = host;
        this.uri = '/api/runtime/bcc/v1.0/printintegration/';
        this.printIntegrationInfoChange = new Subject();
        this.printIntegrationInfoList = {};
    }
    /**
     * 获取查询参数映射信息
     * @param {?} schemaId 方案ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    getPrintIntegration(schemaId, queryId, queryRelativeUrl) {
        /** @type {?} */
        const result$ = this.getPrintIntegrationList(queryId, schemaId, '', '', queryRelativeUrl);
        return result$.pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        value => {
            if (value && value[schemaId + queryId]) {
                return value[schemaId + queryId];
            }
            else {
                return null;
            }
        })));
    }
    /**
     * 获取打印设置信息列表
     * @param {?} queryId 查询编号
     * @param {?} schemaId 方案ID
     * @param {?} userId 用户ID
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    getPrintIntegrationList(queryId, schemaId, userId, languageType, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'getprintintegrationlist';
        /** @type {?} */
        const result$ = this.restService.get(restUri, { queryId, schemaId, userId, languageType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data && data.length) {
                data.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                (element) => {
                    element.printintegration = JSON.parse(element.printintegration);
                    this.printIntegrationInfoList[schemaId + queryId] = element;
                }));
                this.printIntegrationInfoChange.next({ printIntegrationInfoList: this.printIntegrationInfoList });
                return this.printIntegrationInfoList;
            }
            else {
                this.printIntegrationInfoChange.next({ printIntegrationInfoList: null });
                return null;
            }
        })));
    }
    /**
     * 保存打印设置信息
     * @param {?} element 打印设置
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    savePrintIntegration(element, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'saveprintintegration';
        /** @type {?} */
        const integration = element;
        /** @type {?} */
        const result$ = this.restService.post(restUri, integration, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @return {?}
         */
        () => {
            element.printintegration = JSON.parse(element.printintegration);
            if (Object.keys(this.printIntegrationInfoList).indexOf(element.schemaId + element.queryId)) {
                this.printIntegrationInfoList[element.schemaId + element.queryId] = element;
            }
        })));
    }
    /**
     * 删除打印设置信息
     * @param {?} schemaId 方案ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    deletePrintIntegration(schemaId, queryId, queryRelativeUrl) {
        /** @type {?} */
        const restUri = this.host + this.uri + 'deleteprintintegration';
        /** @type {?} */
        const result$ = this.restService.delete(restUri, { schemaId, queryId }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            if (data === true) {
                this.printIntegrationInfoList[schemaId + queryId] = null;
            }
            else {
                return false;
            }
        })));
    }
    /**
     * @private
     * @return {?}
     */
    createHeaderSessionId() {
        return RtfServices.createHeaderSessionId(this.sessionService);
    }
}
PrintIntegrationManagerService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
PrintIntegrationManagerService.ctorParameters = () => [
    { type: RestfulService },
    { type: SessionService },
    { type: String, decorators: [{ type: Inject, args: [Server_Host,] }] }
];
if (false) {
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.uri;
    /** @type {?} */
    PrintIntegrationManagerService.prototype.printIntegrationInfoChange;
    /** @type {?} */
    PrintIntegrationManagerService.prototype.printIntegrationInfoList;
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.host;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpbnQtaW50ZWdyYXRpb25tYW5hZ2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcWRwL2NvbW1vbi8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL3ByaW50LWludGVncmF0aW9uL3ByaW50LWludGVncmF0aW9ubWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBYyxPQUFPLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBR3pELE1BQU0sT0FBTyw4QkFBOEI7Ozs7OztJQU16QyxZQUFvQixXQUEyQixFQUFVLGNBQThCLEVBQStCLElBQVk7UUFBOUcsZ0JBQVcsR0FBWCxXQUFXLENBQWdCO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQStCLFNBQUksR0FBSixJQUFJLENBQVE7UUFMMUgsUUFBRyxHQUFHLHlDQUF5QyxDQUFDO1FBQ3hELCtCQUEwQixHQUFHLElBQUksT0FBTyxFQUFPLENBQUM7UUFFaEQsNkJBQXdCLEdBQVEsRUFBRSxDQUFDO0lBR25DLENBQUM7Ozs7Ozs7O0lBT0QsbUJBQW1CLENBQUMsUUFBZ0IsRUFBRSxPQUFlLEVBQUUsZ0JBQXFCOztjQUNwRSxPQUFPLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxnQkFBZ0IsQ0FB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QUcsd0JBQXdCOztjQUN6RCxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3JHLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FDakIsR0FBRzs7OztRQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDaEIsSUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFO2dCQUNqQixJQUFJLENBQUMsd0JBQXdCLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQzthQUMxRDtpQkFBTTtnQkFDTCxPQUFPLEtBQUssQ0FBQzthQUNkO1FBQ0gsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7Ozs7O0lBRU8scUJBQXFCO1FBQzNCLE9BQU8sV0FBVyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNoRSxDQUFDOzs7WUE1RkYsVUFBVTs7OztZQUpGLGNBQWM7WUFEZCxjQUFjO3lDQVlxRSxNQUFNLFNBQUMsV0FBVzs7Ozs7OztJQUw1Ryw2Q0FBd0Q7O0lBQ3hELG9FQUFnRDs7SUFFaEQsa0VBQW1DOzs7OztJQUV2QixxREFBbUM7Ozs7O0lBQUUsd0RBQXNDOzs7OztJQUFFLDhDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvbWFwJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3ViamVjdCwgb2YgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgU2Vzc2lvblNlcnZpY2UgfSBmcm9tICdAZWNwLWNhZi9jYWYtY29tbW9uJztcclxuaW1wb3J0IHsgUmVzdGZ1bFNlcnZpY2UgfSBmcm9tICcuLi9yZXN0ZnVsLXNlcnZpY2UvcmVzdGZ1bC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgU2VydmVyX0hvc3QgfSBmcm9tICcuLi8uLi9lbnRpdHRpZXMvc2VydmVyLmhvc3QnO1xyXG5pbXBvcnQgeyBSdGZTZXJ2aWNlcyB9IGZyb20gJy4uL3J0ZnNlcnZpY2VzL3J0ZnNlcnZpY2VzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFByaW50SW50ZWdyYXRpb25NYW5hZ2VyU2VydmljZSB7XHJcbiAgcHJpdmF0ZSB1cmkgPSAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3ByaW50aW50ZWdyYXRpb24vJztcclxuICBwcmludEludGVncmF0aW9uSW5mb0NoYW5nZSA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuXHJcbiAgcHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0OiBhbnkgPSB7fTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZXN0U2VydmljZTogUmVzdGZ1bFNlcnZpY2UsIHByaXZhdGUgc2Vzc2lvblNlcnZpY2U6IFNlc3Npb25TZXJ2aWNlLCBASW5qZWN0KFNlcnZlcl9Ib3N0KSBwcml2YXRlIGhvc3Q6IHN0cmluZykge1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5p+l6K+i5Y+C5pWw5pig5bCE5L+h5oGvXHJcbiAgICogQHBhcmFtIHNjaGVtYUlkIOaWueahiElEXHJcbiAgICogQHBhcmFtIHF1ZXJ5SWQg5p+l6K+i57yW5Y+3XHJcbiAgICovXHJcbiAgZ2V0UHJpbnRJbnRlZ3JhdGlvbihzY2hlbWFJZDogc3RyaW5nLCBxdWVyeUlkOiBzdHJpbmcsIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5nZXRQcmludEludGVncmF0aW9uTGlzdChxdWVyeUlkLCBzY2hlbWFJZCwgJycsICcnLCBxdWVyeVJlbGF0aXZlVXJsKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCh2YWx1ZSA9PiB7XHJcbiAgICAgICAgaWYgKHZhbHVlICYmIHZhbHVlW3NjaGVtYUlkICsgcXVlcnlJZF0pIHtcclxuICAgICAgICAgIHJldHVybiB2YWx1ZVtzY2hlbWFJZCArIHF1ZXJ5SWRdO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5omT5Y2w6K6+572u5L+h5oGv5YiX6KGoXHJcbiAgICogQHBhcmFtIHF1ZXJ5SWQg5p+l6K+i57yW5Y+3XHJcbiAgICogQHBhcmFtIHNjaGVtYUlkIOaWueahiElEXHJcbiAgICogQHBhcmFtIHVzZXJJZCDnlKjmiLdJRFxyXG4gICAqIEBwYXJhbSBsYW5ndWFnZVR5cGUg6K+t6KiA57G75Z6LXHJcbiAgICovXHJcbiAgZ2V0UHJpbnRJbnRlZ3JhdGlvbkxpc3QocXVlcnlJZDogc3RyaW5nLCBzY2hlbWFJZDogYW55LCB1c2VySWQ6IHN0cmluZywgbGFuZ3VhZ2VUeXBlOiBzdHJpbmcsIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnZ2V0cHJpbnRpbnRlZ3JhdGlvbmxpc3QnO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UuZ2V0KHJlc3RVcmksIHsgcXVlcnlJZCwgc2NoZW1hSWQsIHVzZXJJZCwgbGFuZ3VhZ2VUeXBlIH0sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgZGF0YS5mb3JFYWNoKChlbGVtZW50OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgZWxlbWVudC5wcmludGludGVncmF0aW9uID0gSlNPTi5wYXJzZShlbGVtZW50LnByaW50aW50ZWdyYXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvTGlzdFtzY2hlbWFJZCArIHF1ZXJ5SWRdID0gZWxlbWVudDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy5wcmludEludGVncmF0aW9uSW5mb0NoYW5nZS5uZXh0KHsgcHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0OiB0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvTGlzdCB9KTtcclxuICAgICAgICAgIHJldHVybiB0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvTGlzdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5wcmludEludGVncmF0aW9uSW5mb0NoYW5nZS5uZXh0KHsgcHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0OiBudWxsIH0pO1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5L+d5a2Y5omT5Y2w6K6+572u5L+h5oGvXHJcbiAgICogQHBhcmFtIGVsZW1lbnQg5omT5Y2w6K6+572uXHJcbiAgICovXHJcbiAgc2F2ZVByaW50SW50ZWdyYXRpb24oZWxlbWVudDogYW55LCBxdWVyeVJlbGF0aXZlVXJsOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVzdFVyaSA9IHRoaXMuaG9zdCArIHRoaXMudXJpICsgJ3NhdmVwcmludGludGVncmF0aW9uJztcclxuICAgIGNvbnN0IGludGVncmF0aW9uID0gZWxlbWVudDtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnJlc3RTZXJ2aWNlLnBvc3QocmVzdFVyaSwgaW50ZWdyYXRpb24sIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgZWxlbWVudC5wcmludGludGVncmF0aW9uID0gSlNPTi5wYXJzZShlbGVtZW50LnByaW50aW50ZWdyYXRpb24pO1xyXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvTGlzdCkuaW5kZXhPZihlbGVtZW50LnNjaGVtYUlkICsgZWxlbWVudC5xdWVyeUlkKSkge1xyXG4gICAgICAgICAgdGhpcy5wcmludEludGVncmF0aW9uSW5mb0xpc3RbZWxlbWVudC5zY2hlbWFJZCArIGVsZW1lbnQucXVlcnlJZF0gPSBlbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWIoOmZpOaJk+WNsOiuvue9ruS/oeaBr1xyXG4gICAqIEBwYXJhbSBzY2hlbWFJZCDmlrnmoYhJRFxyXG4gICAqIEBwYXJhbSBxdWVyeUlkIOafpeivoue8luWPt1xyXG4gICAqL1xyXG4gIGRlbGV0ZVByaW50SW50ZWdyYXRpb24oc2NoZW1hSWQ6IHN0cmluZywgcXVlcnlJZDogc3RyaW5nLCBxdWVyeVJlbGF0aXZlVXJsOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVzdFVyaSA9IHRoaXMuaG9zdCArIHRoaXMudXJpICsgJ2RlbGV0ZXByaW50aW50ZWdyYXRpb24nO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UuZGVsZXRlKHJlc3RVcmksIHsgc2NoZW1hSWQsIHF1ZXJ5SWQgfSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7XHJcbiAgICAgICAgICB0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvTGlzdFtzY2hlbWFJZCArIHF1ZXJ5SWRdID0gbnVsbDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZUhlYWRlclNlc3Npb25JZCgpIHtcclxuICAgIHJldHVybiBSdGZTZXJ2aWNlcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQodGhpcy5zZXNzaW9uU2VydmljZSk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=
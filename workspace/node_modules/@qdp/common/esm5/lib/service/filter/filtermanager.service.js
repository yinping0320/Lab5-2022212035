/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import 'rxjs/add/operator/map';
import { Injectable, Inject } from '@angular/core';
import { map } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { SessionService } from '@ecp-caf/caf-common';
import { RestfulService } from '../restful-service/restful.service';
import { Server_Host } from '../../entitties/server.host';
import { RtfServices } from '../rtfservices/rtfservices';
var FilterManagerService = /** @class */ (function () {
    function FilterManagerService(restService, sessionService, host) {
        this.restService = restService;
        this.sessionService = sessionService;
        this.host = host;
        this.uri = '/api/runtime/bcc/v1.0/qdpfilter/';
        this.filterInfoChange = new Subject();
        this.isFilterQDP = new Subject(); // 是否刷新
        // 是否刷新
        this.filterInfoList = {};
        // this.uri = this.host + this.uri;
    }
    /**
     * 获取查询参数映射信息
     * @param id 数据源ID
     * @param queryId 查询编号
     */
    /**
     * 获取查询参数映射信息
     * @param {?} id 数据源ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @param {?} queryType
     * @param {?=} groupType
     * @return {?}
     */
    FilterManagerService.prototype.getFilter = /**
     * 获取查询参数映射信息
     * @param {?} id 数据源ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @param {?} queryType
     * @param {?=} groupType
     * @return {?}
     */
    function (id, queryId, queryRelativeUrl, queryType, groupType) {
        /** @type {?} */
        var result$ = this.getFilterList(queryId, id, groupType, '', queryRelativeUrl, queryType);
        return result$.pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value && value[queryId]) {
                return value[queryId];
            }
            else {
                return null;
            }
        })));
    };
    /**
     * 获取参数映射列表
     * @param queryId 查询编号
     * @param userId 用户ID
     * @param languageType 语言类型
     */
    /**
     * 获取参数映射列表
     * @param {?} queryId 查询编号
     * @param {?} datasourceId
     * @param {?} groupType
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @param {?=} queryType
     * @return {?}
     */
    FilterManagerService.prototype.getFilterList = /**
     * 获取参数映射列表
     * @param {?} queryId 查询编号
     * @param {?} datasourceId
     * @param {?} groupType
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @param {?=} queryType
     * @return {?}
     */
    function (queryId, datasourceId, groupType, languageType, queryRelativeUrl, queryType) {
        var _this = this;
        if (queryType === void 0) { queryType = 0; }
        /** @type {?} */
        var restUri = this.host + this.uri + 'getfilterlist';
        /** @type {?} */
        var result$ = this.restService.get(restUri, { queryId: queryId, datasourceId: datasourceId, groupType: groupType, languageType: languageType, queryType: queryType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data && data.length) {
                data.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                function (element) {
                    element.filter = JSON.parse(element.filter);
                    _this.filterInfoList[element.queryid] = element;
                }));
                _this.filterInfoChange.next({ parasInfoList: _this.filterInfoList });
                return _this.filterInfoList;
            }
            else {
                _this.filterInfoChange.next({ parasInfoList: null });
                return null;
            }
        })));
    };
    /**
     * 保存参数映射
     * @param filter 参数映射实体
     */
    /**
     * 保存参数映射
     * @param {?} filter 参数映射实体
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    FilterManagerService.prototype.saveFilter = /**
     * 保存参数映射
     * @param {?} filter 参数映射实体
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (filter, queryRelativeUrl) {
        var _this = this;
        /** @type {?} */
        var restUri = this.host + this.uri + 'savefilter';
        /** @type {?} */
        var result$ = this.restService.post(restUri, filter, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @return {?}
         */
        function () {
            filter.filter = JSON.parse(filter.filter);
            if (Object.keys(_this.filterInfoList).indexOf(filter.queryid)) {
                _this.filterInfoList[filter.queryid] = filter;
            }
        })));
    };
    /**
     * 删除方案
     * @param id 方案ID
     * @param queryId 查询编号
     */
    /**
     * 删除方案
     * @param {?} datasourceid
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @param {?} queryType
     * @return {?}
     */
    FilterManagerService.prototype.deleteFilter = /**
     * 删除方案
     * @param {?} datasourceid
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @param {?} queryType
     * @return {?}
     */
    function (datasourceid, queryId, queryRelativeUrl, queryType) {
        var _this = this;
        /** @type {?} */
        var restUri = this.host + this.uri + 'deletefilter';
        /** @type {?} */
        var result$ = this.restService.delete(restUri, { datasourceId: datasourceid, queryId: queryId, queryType: queryType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data === true) {
                _this.filterInfoList[queryId] = null;
            }
            else {
                return false;
            }
        })));
    };
    /**
     * @private
     * @return {?}
     */
    FilterManagerService.prototype.createHeaderSessionId = /**
     * @private
     * @return {?}
     */
    function () {
        return RtfServices.createHeaderSessionId(this.sessionService);
    };
    FilterManagerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    FilterManagerService.ctorParameters = function () { return [
        { type: RestfulService },
        { type: SessionService },
        { type: String, decorators: [{ type: Inject, args: [Server_Host,] }] }
    ]; };
    return FilterManagerService;
}());
export { FilterManagerService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.uri;
    /** @type {?} */
    FilterManagerService.prototype.filterInfoChange;
    /** @type {?} */
    FilterManagerService.prototype.isFilterQDP;
    /** @type {?} */
    FilterManagerService.prototype.filterInfoList;
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    FilterManagerService.prototype.host;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVybWFuYWdlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHFkcC9jb21tb24vIiwic291cmNlcyI6WyJsaWIvc2VydmljZS9maWx0ZXIvZmlsdGVybWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBYyxPQUFPLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRXpEO0lBUUUsOEJBQW9CLFdBQTJCLEVBQVUsY0FBOEIsRUFBK0IsSUFBWTtRQUE5RyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFBVSxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFBK0IsU0FBSSxHQUFKLElBQUksQ0FBUTtRQU4xSCxRQUFHLEdBQUcsa0NBQWtDLENBQUM7UUFDakQscUJBQWdCLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUN0QyxnQkFBVyxHQUFHLElBQUksT0FBTyxFQUFFLENBQUMsQ0FBQyxPQUFPOztRQUVwQyxtQkFBYyxHQUFRLEVBQUUsQ0FBQztRQUd2QixtQ0FBbUM7SUFDckMsQ0FBQztJQUVEOzs7O09BSUc7Ozs7Ozs7Ozs7SUFDSCx3Q0FBUzs7Ozs7Ozs7O0lBQVQsVUFBVSxFQUFVLEVBQUUsT0FBZSxFQUFFLGdCQUFxQixFQUFFLFNBQWlCLEVBQUUsU0FBZTs7WUFDeEYsT0FBTyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMs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QUFhLFlBQW9CLEVBQUUsT0FBZSxFQUFFLGdCQUFxQixFQUFFLFNBQWlCO1FBQTVGLGlCQVlDOztZQVhPLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsY0FBYzs7WUFDL0MsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsT0FBTyxTQUFBLEVBQUUsU0FBUyxXQUFBLEVBQUUsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUNsSSxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQ2pCLEdBQUc7Ozs7UUFBQyxVQUFDLElBQVM7WUFDWixJQUFJLElBQUksS0FBSyxJQUFJLEVBQUU7Z0JBQ2pCLEtBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO2FBQ3JDO2lCQUFNO2dCQUNMLE9BQU8sS0FBSyxDQUFDO2FBQ2Q7UUFDSCxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFTyxvREFBcUI7Ozs7SUFBN0I7UUFDRSxPQUFPLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDaEUsQ0FBQzs7Z0JBNUZGLFVBQVU7Ozs7Z0JBSkYsY0FBYztnQkFEZCxjQUFjOzZDQWFxRSxNQUFNLFNBQUMsV0FBVzs7SUFxRjlHLDJCQUFDO0NBQUEsQUE3RkQsSUE2RkM7U0E1Rlksb0JBQW9COzs7Ozs7SUFDL0IsbUNBQWlEOztJQUNqRCxnREFBc0M7O0lBQ3RDLDJDQUE0Qjs7SUFFNUIsOENBQXlCOzs7OztJQUViLDJDQUFtQzs7Ozs7SUFBRSw4Q0FBc0M7Ozs7O0lBQUUsb0NBQXlDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9tYXAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBTZXNzaW9uU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBSZXN0ZnVsU2VydmljZSB9IGZyb20gJy4uL3Jlc3RmdWwtc2VydmljZS9yZXN0ZnVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTZXJ2ZXJfSG9zdCB9IGZyb20gJy4uLy4uL2VudGl0dGllcy9zZXJ2ZXIuaG9zdCc7XHJcbmltcG9ydCB7IFJ0ZlNlcnZpY2VzIH0gZnJvbSAnLi4vcnRmc2VydmljZXMvcnRmc2VydmljZXMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgRmlsdGVyTWFuYWdlclNlcnZpY2Uge1xyXG4gIHByaXZhdGUgdXJpID0gJy9hcGkvcnVudGltZS9iY2MvdjEuMC9xZHBmaWx0ZXIvJztcclxuICBmaWx0ZXJJbmZvQ2hhbmdlID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIGlzRmlsdGVyUURQID0gbmV3IFN1YmplY3QoKTsgLy8g5piv5ZCm5Yi35pawXHJcblxyXG4gIGZpbHRlckluZm9MaXN0OiBhbnkgPSB7fTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZXN0U2VydmljZTogUmVzdGZ1bFNlcnZpY2UsIHByaXZhdGUgc2Vzc2lvblNlcnZpY2U6IFNlc3Npb25TZXJ2aWNlLCBASW5qZWN0KFNlcnZlcl9Ib3N0KSBwcml2YXRlIGhvc3Q6IHN0cmluZykge1xyXG4gICAgLy8gdGhpcy51cmkgPSB0aGlzLmhvc3QgKyB0aGlzLnVyaTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluafpeivouWPguaVsOaYoOWwhOS/oeaBr1xyXG4gICAqIEBwYXJhbSBpZCDmlbDmja7mupBJRFxyXG4gICAqIEBwYXJhbSBxdWVyeUlkIOafpeivoue8luWPt1xyXG4gICAqL1xyXG4gIGdldEZpbHRlcihpZDogc3RyaW5nLCBxdWVyeUlkOiBzdHJpbmcsIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSwgcXVlcnlUeXBlOiBudW1iZXIsIGdyb3VwVHlwZT86IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5nZXRGaWx0ZXJMaXN0KHF1ZXJ5SWQsIGlkLCBncm91cFR5cGUsICcnLCBxdWVyeVJlbGF0aXZlVXJsLCBxdWVyeVR5cGUpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKHZhbHVlID0+IHtcclxuICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbcXVlcnlJZF0pIHtcclxuICAgICAgICAgIHJldHVybiB2YWx1ZVtxdWVyeUlkXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWPguaVsOaYoOWwhOWIl+ihqFxyXG4gICAqIEBwYXJhbSBxdWVyeUlkIOafpeivoue8luWPt1xyXG4gICAqIEBwYXJhbSB1c2VySWQg55So5oi3SURcclxuICAgKiBAcGFyYW0gbGFuZ3VhZ2VUeXBlIOivreiogOexu+Wei1xyXG4gICAqL1xyXG4gIGdldEZpbHRlckxpc3QocXVlcnlJZDogc3RyaW5nLCBkYXRhc291cmNlSWQ6IGFueSwgZ3JvdXBUeXBlOiBzdHJpbmcsIGxhbmd1YWdlVHlwZTogc3RyaW5nLCBxdWVyeVJlbGF0aXZlVXJsOiBhbnksIHF1ZXJ5VHlwZTogbnVtYmVyID0gMCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnZ2V0ZmlsdGVybGlzdCc7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5nZXQocmVzdFVyaSwgeyBxdWVyeUlkLCBkYXRhc291cmNlSWQsIGdyb3VwVHlwZSwgbGFuZ3VhZ2VUeXBlLCBxdWVyeVR5cGUgfSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICBkYXRhLmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBlbGVtZW50LmZpbHRlciA9IEpTT04ucGFyc2UoZWxlbWVudC5maWx0ZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmZpbHRlckluZm9MaXN0W2VsZW1lbnQucXVlcnlpZF0gPSBlbGVtZW50O1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICB0aGlzLmZpbHRlckluZm9DaGFuZ2UubmV4dCh7IHBhcmFzSW5mb0xpc3Q6IHRoaXMuZmlsdGVySW5mb0xpc3QgfSk7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJJbmZvTGlzdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5maWx0ZXJJbmZvQ2hhbmdlLm5leHQoeyBwYXJhc0luZm9MaXN0OiBudWxsIH0pO1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5L+d5a2Y5Y+C5pWw5pig5bCEXHJcbiAgICogQHBhcmFtIGZpbHRlciDlj4LmlbDmmKDlsITlrp7kvZNcclxuICAgKi9cclxuICBzYXZlRmlsdGVyKGZpbHRlcjogYW55LCBxdWVyeVJlbGF0aXZlVXJsOiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgY29uc3QgcmVzdFVyaSA9IHRoaXMuaG9zdCArIHRoaXMudXJpICsgJ3NhdmVmaWx0ZXInO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UucG9zdChyZXN0VXJpLCBmaWx0ZXIsIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoKSA9PiB7XHJcbiAgICAgICAgZmlsdGVyLmZpbHRlciA9IEpTT04ucGFyc2UoZmlsdGVyLmZpbHRlcik7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuZmlsdGVySW5mb0xpc3QpLmluZGV4T2YoZmlsdGVyLnF1ZXJ5aWQpKSB7XHJcbiAgICAgICAgICB0aGlzLmZpbHRlckluZm9MaXN0W2ZpbHRlci5xdWVyeWlkXSA9IGZpbHRlcjtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDliKDpmaTmlrnmoYhcclxuICAgKiBAcGFyYW0gaWQg5pa55qGISURcclxuICAgKiBAcGFyYW0gcXVlcnlJZCDmn6Xor6LnvJblj7dcclxuICAgKi9cclxuICBkZWxldGVGaWx0ZXIoZGF0YXNvdXJjZWlkOiBzdHJpbmcsIHF1ZXJ5SWQ6IHN0cmluZywgcXVlcnlSZWxhdGl2ZVVybDogYW55LCBxdWVyeVR5cGU6IG51bWJlcik6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnZGVsZXRlZmlsdGVyJztcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLnJlc3RTZXJ2aWNlLmRlbGV0ZShyZXN0VXJpLCB7IGRhdGFzb3VyY2VJZDogZGF0YXNvdXJjZWlkLCBxdWVyeUlkLCBxdWVyeVR5cGUgfSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7XHJcbiAgICAgICAgICB0aGlzLmZpbHRlckluZm9MaXN0W3F1ZXJ5SWRdID0gbnVsbDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZUhlYWRlclNlc3Npb25JZCgpIHtcclxuICAgIHJldHVybiBSdGZTZXJ2aWNlcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQodGhpcy5zZXNzaW9uU2VydmljZSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
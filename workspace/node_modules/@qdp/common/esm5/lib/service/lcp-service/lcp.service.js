/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Inject, Optional } from '@angular/core';
import { Server_Host, Load_Data_Uri, Load_Data_Col } from '../../entitties/server.host';
import { Subject } from 'rxjs';
import { map } from 'rxjs/operators';
import { SessionService } from '@ecp-caf/caf-common';
import { RestfulService } from '../restful-service/restful.service';
import { RtfServices } from '../rtfservices/rtfservices';
import { FileType, OutputType, PrintType } from '@gsp-svc/cloudprint';
var LcpService = /** @class */ (function () {
    function LcpService(restfulService, sessionService, serverHost, loadDataUri, loadDataCol) {
        this.restfulService = restfulService;
        this.sessionService = sessionService;
        this.serverHost = serverHost;
        this.loadDataUri = loadDataUri;
        this.loadDataCol = loadDataCol;
        this.pageInfoChange = new Subject();
        this.variablesChange = new Subject();
        this.inSuiteDropDownInfoChange = new Subject();
    }
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpService.prototype.exportData = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += (!queryRelativeUrl ? '/api/runtime/bcc/v1.0/qdpsearch/' : queryRelativeUrl) + 'export';
        }
        /** @type {?} */
        var config = {
            responseType: 'application/json' // 表明返回服务器返回的数据类型
        };
        Object.assign(config, this.createHeaderSessionId());
        /** @type {?} */
        var fileName = params.excelExportName + '.xlsx';
        params = !queryRelativeUrl ? params : { 'Param': params };
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, config)
            : this.restfulService.put(uri, params, {}, config);
        result$.toPromise().then((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            data = !queryRelativeUrl ? data : JSON.parse(data).returnValue;
            /** @type {?} */
            var byteString = atob(data);
            // base64 解码
            /** @type {?} */
            var arrayBuffer = new ArrayBuffer(byteString.length);
            // 创建缓冲数组
            /** @type {?} */
            var intArray = new Uint8Array(arrayBuffer);
            for (var i = 0; i < byteString.length; i++) {
                intArray[i] = byteString.charCodeAt(i);
            }
            /** @type {?} */
            var blob = new Blob([intArray], { type: 'application/vnd.ms-excel' });
            if ('download' in document.createElement('a')) { // 非IE下载
                // 非IE下载
                /** @type {?} */
                var elink = document.createElement('a');
                elink.download = fileName;
                elink.style.display = 'none';
                elink.href = URL.createObjectURL(blob);
                document.body.appendChild(elink);
                elink.click();
                URL.revokeObjectURL(elink.href); // 释放URL 对象
                document.body.removeChild(elink);
            }
            else { // IE10+下载
                navigator.msSaveBlob(blob, fileName);
            }
            self.loading.close();
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            self.formErrorService.exception(error.Message, error);
        }));
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpService.prototype.aysnExportData = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += (!queryRelativeUrl ? '/api/runtime/bcc/v1.0/qdpsearch/' : queryRelativeUrl) + 'export';
        }
        /** @type {?} */
        var config = {
            responseType: 'application/json' // 表明返回服务器返回的数据类型
        };
        Object.assign(config, this.createHeaderSessionId());
        params.async = 1;
        params = !queryRelativeUrl ? params : { 'Param': params };
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, config)
            : this.restfulService.put(uri, params, {}, config);
        result$.toPromise().then((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            data = !queryRelativeUrl ? data : JSON.parse(data).returnValue;
            if (data) {
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            self.formErrorService.exception(error.Message, error);
        }));
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpService.prototype.pdfExportEvent = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += (!queryRelativeUrl ? '/api/runtime/bcc/v1.0/qdpsearch/' : queryRelativeUrl) + 'print';
        }
        /** @type {?} */
        var config = {
            responseType: 'application/json' // 表明返回服务器返回的数据类型
        };
        Object.assign(config, this.createHeaderSessionId());
        params = !queryRelativeUrl ? params : { 'Param': params };
        /** @type {?} */
        var fileName = params.Param && params.Param.excelExportName ? params.Param.excelExportName + '' : params.excelExportName + '';
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, config)
            : this.restfulService.put(uri, params, {}, config);
        result$.toPromise().then((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            data = !queryRelativeUrl ? data : JSON.parse(data).returnValue;
            /** @type {?} */
            var byteString = atob(data);
            // base64 解码
            /** @type {?} */
            var arrayBuffer = new ArrayBuffer(byteString.length);
            // 创建缓冲数组
            /** @type {?} */
            var intArray = new Uint8Array(arrayBuffer);
            for (var i = 0; i < byteString.length; i++) {
                intArray[i] = byteString.charCodeAt(i);
            }
            /** @type {?} */
            var blob = new Blob([intArray], { type: 'application/pdf' });
            if ('download' in document.createElement('a')) { // 非IE下载
                // 非IE下载
                /** @type {?} */
                var elink = document.createElement('a');
                elink.download = fileName;
                elink.style.display = 'none';
                elink.href = URL.createObjectURL(blob);
                document.body.appendChild(elink);
                elink.click();
                URL.revokeObjectURL(elink.href); // 释放URL 对象
                document.body.removeChild(elink);
            }
            else { // IE10+下载
                navigator.msSaveBlob(blob, fileName);
            }
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            self.formErrorService.exception(error.Message, error);
        }));
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpService.prototype.printPreView = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += (!queryRelativeUrl ? '/api/runtime/bcc/v1.0/qdpsearch/' : queryRelativeUrl) + 'print';
        }
        /** @type {?} */
        var config = {
            responseType: 'application/json' // 表明返回服务器返回的数据类型
        };
        Object.assign(config, this.createHeaderSessionId());
        params = !queryRelativeUrl ? params : { 'Param': params };
        /** @type {?} */
        var fileName = params.Param && params.Param.excelExportName ? params.Param.excelExportName + '' : params.excelExportName + '';
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, config)
            : this.restfulService.put(uri, params, {}, config);
        result$.toPromise().then((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            data = !queryRelativeUrl ? data : JSON.parse(data).returnValue;
            /** @type {?} */
            var options = {
                OutputType: OutputType.PRINT,
                FileType: FileType.Pdf,
                Path: '',
                DeviceId: '',
                printType: PrintType.Query,
                printJob: false,
                printerName: '',
                printSetting: null
            };
            /** @type {?} */
            var byteString = atob(data);
            // base64 解码
            /** @type {?} */
            var arrayBuffer = new ArrayBuffer(byteString.length);
            // 创建缓冲数组
            /** @type {?} */
            var intArray = new Uint8Array(arrayBuffer);
            for (var i = 0; i < byteString.length; i++) {
                intArray[i] = byteString.charCodeAt(i);
            }
            /** @type {?} */
            var blob = new Blob([intArray]);
            self.cloudprintService.openRendedViewer('tab', blob, options);
        }), (/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            self.formErrorService.exception(error.Message, error);
        }));
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpService.prototype.getData = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += !queryRelativeUrl ? '/api/runtime/bcc/v1.0/qdpsearch/query' : (queryRelativeUrl + 'querydata');
        }
        params = !queryRelativeUrl ? params : { 'Param': params };
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, this.createHeaderSessionId())
            : this.restfulService.put(uri, params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                data = !queryRelativeUrl ? data : data.returnValue;
                if (data && data.pageInfo) {
                    self.pageInfoChange.next(data.pageInfo);
                }
                if (data && data.variables) {
                    self.variablesChange.next(data.variables);
                }
                if (data && data.dropDownOption) {
                    self.inSuiteDropDownInfo = data.dropDownOption;
                    self.inSuiteDropDownInfoChange.next(data.dropDownOption);
                }
            }
            return data;
        })));
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpService.prototype.getCol = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataCol) {
            uri += this.loadDataCol;
        }
        else {
            uri += (!queryRelativeUrl ? '/api/runtime/bcc/v1.0/qdpsearch/' : queryRelativeUrl) + 'querycol';
        }
        params = !queryRelativeUrl ? params : { 'Param': params };
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, this.createHeaderSessionId())
            : this.restfulService.put(uri, params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data) {
                data = !queryRelativeUrl ? data : data.returnValue;
            }
            return data;
        })));
    };
    /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    LcpService.prototype.getCrosstabTemplate = /**
     * @param {?} params
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (params, queryRelativeUrl) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost;
        if (this.loadDataUri) {
            uri += this.loadDataUri;
        }
        else {
            uri += !queryRelativeUrl ? '/api/runtime/bcc/v1.0/qdpsearch/getcrosstabtemplate' : (queryRelativeUrl + 'getcrosstabtemplate');
        }
        params = !queryRelativeUrl ? params : { 'Param': params };
        /** @type {?} */
        var result$ = !queryRelativeUrl ? this.restfulService.post(uri, params, {}, this.createHeaderSessionId())
            : this.restfulService.put(uri, params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            if (result) {
                result = !queryRelativeUrl ? result : (result && result.returnValue) ? JSON.parse(result.returnValue) : undefined;
            }
            return result;
        })));
    };
    /**
     * @return {?}
     */
    LcpService.prototype.getSpreadLicense = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var uri = '/api/runtime/bcc/v1.0/qdpschemamanager/getSpreadLicense';
        /** @type {?} */
        var result$ = this.restfulService.get(uri, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            return data.spreadjs;
        })));
    };
    /**
     * @param {?} params
     * @return {?}
     */
    LcpService.prototype.clearCache = /**
     * @param {?} params
     * @return {?}
     */
    function (params) {
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var uri = this.serverHost + '/api/runtime/bcc/v1.0/qdpsearch/clearcache';
        /** @type {?} */
        var result$ = this.restfulService.post(uri, params, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            return result;
        })));
    };
    /**
     * @private
     * @return {?}
     */
    LcpService.prototype.createHeaderSessionId = /**
     * @private
     * @return {?}
     */
    function () {
        return RtfServices.createHeaderSessionId(this.sessionService);
    };
    LcpService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    LcpService.ctorParameters = function () { return [
        { type: RestfulService },
        { type: SessionService },
        { type: String, decorators: [{ type: Inject, args: [Server_Host,] }, { type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [Load_Data_Uri,] }, { type: Optional }] },
        { type: String, decorators: [{ type: Inject, args: [Load_Data_Col,] }, { type: Optional }] }
    ]; };
    return LcpService;
}());
export { LcpService };
if (false) {
    /** @type {?} */
    LcpService.prototype.pageInfoChange;
    /** @type {?} */
    LcpService.prototype.variablesChange;
    /** @type {?} */
    LcpService.prototype.inSuiteDropDownInfoChange;
    /** @type {?} */
    LcpService.prototype.inSuiteDropDownInfo;
    /** @type {?} */
    LcpService.prototype.cloudprintService;
    /** @type {?} */
    LcpService.prototype.formErrorService;
    /** @type {?} */
    LcpService.prototype.loading;
    /**
     * @type {?}
     * @private
     */
    LcpService.prototype.restfulService;
    /**
     * @type {?}
     * @private
     */
    LcpService.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    LcpService.prototype.serverHost;
    /**
     * @type {?}
     * @private
     */
    LcpService.prototype.loadDataUri;
    /**
     * @type {?}
     * @private
     */
    LcpService.prototype.loadDataCol;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGNwLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcWRwL2NvbW1vbi8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL2xjcC1zZXJ2aWNlL2xjcC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDN0QsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsYUFBYSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDeEYsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDekQsT0FBTyxFQUFxQixRQUFRLEVBQWlCLFVBQVUsRUFBRSxTQUFTLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV4RztJQVVFLG9CQUNVLGNBQThCLEVBQzlCLGNBQThCLEVBQ0csVUFBa0IsRUFDaEIsV0FBbUIsRUFDbkIsV0FBbUI7UUFKdEQsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUNHLGVBQVUsR0FBVixVQUFVLENBQVE7UUFDaEIsZ0JBQVcsR0FBWCxXQUFXLENBQVE7UUFDbkIsZ0JBQVcsR0FBWCxXQUFXLENBQVE7UUFiaEUsbUJBQWMsR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO1FBQ3BDLG9CQUFlLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUNyQyw4QkFBeUIsR0FBRyxJQUFJLE9BQU8sRUFBTyxDQUFDO0lBWTNDLENBQUM7Ozs7OztJQUVMLCtCQUFVOzs7OztJQUFWLFVBQVcsTUFBVyxFQUFFLGdCQUFxQjs7WUFDckMsSUFBSSxHQUFHLElBQUk7O1lBQ2IsR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVO1FBQ3pCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUN6QjthQUFNO1lBQ0wsR0FBRyxJQUFJLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsa0NBQWtDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsUUFBUSxDQUFDO1NBQy9GOztZQUNLLE1BQU0sR0FBRztZQUNiLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxpQkFBaUI7U0FDbkQ7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDOztZQUM5QyxRQUFRLEdBQUcsTUFBTSxDQUFDLGVBQWUsR0FBRyxPQUFPO1FBQ2pELE1BQU0sR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDOztZQUNwRCxPQUFPLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDO1lBQ25GLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxNQUFNLENBQUM7UUFDcEQsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLElBQUk7Ozs7UUFBQyxVQUFBLElBQUk7WUFDM0IsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUM7O2dCQUN6RCxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQzs7O2dCQUN2QixXQUFXLEdBQUcsSUFBSSxXQUFXLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQzs7O2dCQUNoRCxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDO1lBRTVDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUMxQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN4Qzs7Z0JBQ0ssSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsMEJBQTBCLEVBQUUsQ0FBQztZQUN2RSxJQUFJLFVBQVUsSUFBSSxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsUUFBUTs7O29CQUNqRCxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUM7Z0JBQ3pDLEtBQUssQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO2dCQUMxQixLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7Z0JBQzdCLEtBQUssQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdkMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2pDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDZCxHQUFHLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVc7Z0JBQzVDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2xDO2lCQUFNLEVBQUUsVUFBVTtnQkFDakIsU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7YUFDdEM7WUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3ZCLENBQUM7Ozs7UUFBRSxVQUFBLEtBQUs7WUFDTixJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7Ozs7SUFFRCxtQ0FBYzs7Ozs7SUFBZCxVQUFlLE1BQVcsRUFBRSxnQkFBcUI7O1lBQ3pDLElBQUksR0FBRyxJQUFJOztZQUNiLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVTtRQUN6QixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDcEIsR0FBRyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDekI7YUFBTTtZQUNMLEdBQUcsSUFBSSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGtDQUFrQyxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLFFBQVEsQ0FBQztTQUMvRjs7WUFDSyxNQUFNLEdBQUc7WUFDYixZQUFZLEVBQUUsa0JBQWtCLENBQUMsaUJBQWlCO1NBQ25EO1FBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUMsQ0FBQztRQUNwRCxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNqQixNQUFNLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQzs7WUFDcEQsT0FBTyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLE1BQU0sQ0FBQztZQUNuRixDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDO1FBQ3BELE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJOzs7O1FBQUMsVUFBQSxJQUFJO1lBQzNCLElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFDO1lBQy9ELElBQUksSUFBSSxFQUFFO2FBQ1Q7UUFDSCxDQUFDOzs7O1FBQUUsVUFBQSxLQUFLO1lBQ04sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3hELENBQUMsRUFBQyxDQUFBO0lBQ0osQ0FBQzs7Ozs7O0lBRUQsbUNBQWM7Ozs7O0lBQWQsVUFBZSxNQUFXLEVBQUUsZ0JBQXFCOztZQUN6QyxJQUFJLEdBQUcsSUFBSTs7WUFDYixHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVU7UUFDekIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3BCLEdBQUcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDO1NBQ3pCO2FBQU07WUFDTCxHQUFHLElBQUksQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxPQUFPLENBQUM7U0FDOUY7O1lBRUssTUFBTSxHQUFHO1lBQ2IsWUFBWSxFQUFFLGtCQUFrQixDQUFDLGlCQUFpQjtTQUNuRDtRQUNELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUM7UUFDcEQsTUFBTSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7O1lBQ3BELFFBQVEsR0FBRyxNQUFNLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxlQUFlLEdBQUcsRUFBRTs7WUFDekgsT0FBTyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLE1BQU0sQ0FBQztZQUNuRixDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDO1FBQ3BELE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJOzs7O1FBQUMsVUFBQSxJQUFJO1lBQzNCLElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFDOztnQkFDekQsVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7OztnQkFDdkIsV0FBVyxHQUFHLElBQUksV0FBVyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7OztnQkFDaEQsUUFBUSxHQUFHLElBQUksVUFBVSxDQUFDLFdBQVcsQ0FBQztZQUU1QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDMUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDeEM7O2dCQUNLLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLENBQUM7WUFDOUQsSUFBSSxVQUFVLElBQUksUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLFFBQVE7OztvQkFDakQsS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDO2dCQUN6QyxLQUFLLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztnQkFDMUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO2dCQUM3QixLQUFLLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNqQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ2QsR0FBRyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXO2dCQUM1QyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNsQztpQkFBTSxFQUFFLFVBQVU7Z0JBQ2pCLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO2FBQ3RDO1FBQ0gsQ0FBQzs7OztRQUFFLFVBQUEsS0FBSztZQUNOLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN4RCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7OztJQUVELGlDQUFZOzs7OztJQUFaLFVBQWEsTUFBVyxFQUFFLGdCQUFxQjs7WUFDdkMsSUFBSSxHQUFHLElBQUk7O1lBQ2IsR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVO1FBQ3pCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUN6QjthQUFNO1lBQ0wsR0FBRyxJQUFJLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsa0NBQWtDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsT0FBTyxDQUFDO1NBQzlGOztZQUVLLE1BQU0sR0FBRztZQUNiLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxpQkFBaUI7U0FDbkQ7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDOztZQUNwRCxRQUFRLEdBQUcsTUFBTSxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsZUFBZSxHQUFHLEVBQUU7O1lBQ3pILE9BQU8sR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxNQUFNLENBQUM7WUFDbkYsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLE1BQU0sQ0FBQztRQUNwRCxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUMsSUFBSTs7OztRQUFDLFVBQUEsSUFBSTtZQUMzQixJQUFJLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsQ0FBQzs7Z0JBQ3pELE9BQU8sR0FBa0I7Z0JBQzdCLFVBQVUsRUFBRSxVQUFVLENBQUMsS0FBSztnQkFDNUIsUUFBUSxFQUFFLFFBQVEsQ0FBQyxHQUFHO2dCQUN0QixJQUFJLEVBQUUsRUFBRTtnQkFDUixRQUFRLEVBQUUsRUFBRTtnQkFDWixTQUFTLEVBQUUsU0FBUyxDQUFDLEtBQUs7Z0JBQzFCLFFBQVEsRUFBRSxLQUFLO2dCQUNmLFdBQVcsRUFBRSxFQUFFO2dCQUNmLFlBQVksRUFBRSxJQUFJO2FBQ25COztnQkFDSyxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQzs7O2dCQUN2QixXQUFXLEdBQUcsSUFBSSxXQUFXLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQzs7O2dCQUNoRCxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsV0FBVyxDQUFDO1lBRTVDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUMxQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN4Qzs7Z0JBQ0ssSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDaEUsQ0FBQzs7OztRQUFFLFVBQUEsS0FBSztZQUNOLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN4RCxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7OztJQUVELDRCQUFPOzs7OztJQUFQLFVBQVEsTUFBVyxFQUFFLGdCQUFxQjs7WUFDbEMsSUFBSSxHQUFHLElBQUk7O1lBQ2IsR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVO1FBQ3pCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUN6QjthQUFNO1lBQ0wsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLHVDQUF1QyxDQUFDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixHQUFHLFdBQVcsQ0FBQyxDQUFDO1NBQ3ZHO1FBQ0QsTUFBTSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7O1lBQ3BELE9BQU8sR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUN6RyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDMUUsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNqQixHQUFHOzs7O1FBQUMsVUFBQyxJQUFTO1lBQ1osSUFBSSxJQUFJLEVBQUU7Z0JBQ1IsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFDbkQsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtvQkFDekIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUN6QztnQkFDRCxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFO29CQUMxQixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7aUJBQzNDO2dCQUNELElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUU7b0JBQy9CLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO29CQUMvQyxJQUFJLENBQUMseUJBQXlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztpQkFDMUQ7YUFDRjtZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7Ozs7OztJQUVELDJCQUFNOzs7OztJQUFOLFVBQU8sTUFBVyxFQUFFLGdCQUFxQjs7WUFDakMsSUFBSSxHQUFHLElBQUk7O1lBQ2IsR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVO1FBQ3pCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUN6QjthQUFNO1lBQ0wsR0FBRyxJQUFJLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsa0NBQWtDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLEdBQUcsVUFBVSxDQUFDO1NBQ2pHO1FBQ0QsTUFBTSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7O1lBQ3BELE9BQU8sR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUN6RyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDMUUsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNqQixHQUFHOzs7O1FBQUMsVUFBQyxJQUFTO1lBQ1osSUFBSSxJQUFJLEVBQUU7Z0JBQ1IsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQzthQUNwRDtZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7Ozs7OztJQUVELHdDQUFtQjs7Ozs7SUFBbkIsVUFBb0IsTUFBVyxFQUFFLGdCQUFxQjs7WUFDOUMsSUFBSSxHQUFHLElBQUk7O1lBQ2IsR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVO1FBQ3pCLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixHQUFHLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUN6QjthQUFNO1lBQ0wsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLHFEQUFxRCxDQUFDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixHQUFHLHFCQUFxQixDQUFDLENBQUM7U0FDL0g7UUFDRCxNQUFNLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQzs7WUFDcEQsT0FBTyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBQ3pHLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUMxRSxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQ2pCLEdBQUc7Ozs7UUFBQyxVQUFDLE1BQVc7WUFDZCxJQUFJLE1BQU0sRUFBRTtnQkFDVixNQUFNLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7YUFDbkg7WUFDRCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7OztJQUVELHFDQUFnQjs7O0lBQWhCOztZQUNRLEdBQUcsR0FBRyx5REFBeUQ7O1lBQy9ELE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQzlFLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FDakIsR0FBRzs7OztRQUFDLFVBQUMsSUFBUztZQUNaLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN2QixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFRCwrQkFBVTs7OztJQUFWLFVBQVcsTUFBVzs7WUFDZCxJQUFJLEdBQUcsSUFBSTs7WUFDWCxHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsR0FBRyw0Q0FBNEM7O1lBQ3BFLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUN2RixPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQ2pCLEdBQUc7Ozs7UUFBQyxVQUFDLE1BQVc7WUFDZCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQzs7Ozs7SUFFTywwQ0FBcUI7Ozs7SUFBN0I7UUFDRSxPQUFPLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDaEUsQ0FBQzs7Z0JBOVFGLFVBQVU7Ozs7Z0JBSkYsY0FBYztnQkFEZCxjQUFjOzZDQWtCbEIsTUFBTSxTQUFDLFdBQVcsY0FBRyxRQUFROzZDQUM3QixNQUFNLFNBQUMsYUFBYSxjQUFHLFFBQVE7NkNBQy9CLE1BQU0sU0FBQyxhQUFhLGNBQUcsUUFBUTs7SUFnUXBDLGlCQUFDO0NBQUEsQUEvUUQsSUErUUM7U0E5UVksVUFBVTs7O0lBQ3JCLG9DQUFvQzs7SUFDcEMscUNBQXFDOztJQUNyQywrQ0FBK0M7O0lBQy9DLHlDQUF5Qjs7SUFDekIsdUNBQXFDOztJQUNyQyxzQ0FBc0I7O0lBQ3RCLDZCQUFhOzs7OztJQUdYLG9DQUFzQzs7Ozs7SUFDdEMsb0NBQXNDOzs7OztJQUN0QyxnQ0FBMkQ7Ozs7O0lBQzNELGlDQUE4RDs7Ozs7SUFDOUQsaUNBQThEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgSW5qZWN0LCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTZXJ2ZXJfSG9zdCwgTG9hZF9EYXRhX1VyaSwgTG9hZF9EYXRhX0NvbCB9IGZyb20gJy4uLy4uL2VudGl0dGllcy9zZXJ2ZXIuaG9zdCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBTZXNzaW9uU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBSZXN0ZnVsU2VydmljZSB9IGZyb20gJy4uL3Jlc3RmdWwtc2VydmljZS9yZXN0ZnVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSdGZTZXJ2aWNlcyB9IGZyb20gJy4uL3J0ZnNlcnZpY2VzL3J0ZnNlcnZpY2VzJztcclxuaW1wb3J0IHsgQ2xvdWRwcmludFNlcnZpY2UsIEZpbGVUeXBlLCBPdXRwdXRPcHRpb25zLCBPdXRwdXRUeXBlLCBQcmludFR5cGUgfSBmcm9tICdAZ3NwLXN2Yy9jbG91ZHByaW50JztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIExjcFNlcnZpY2Uge1xyXG4gIHBhZ2VJbmZvQ2hhbmdlID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIHZhcmlhYmxlc0NoYW5nZSA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBpblN1aXRlRHJvcERvd25JbmZvQ2hhbmdlID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIGluU3VpdGVEcm9wRG93bkluZm86IGFueTtcclxuICBjbG91ZHByaW50U2VydmljZTogQ2xvdWRwcmludFNlcnZpY2U7XHJcbiAgZm9ybUVycm9yU2VydmljZTogYW55O1xyXG4gIGxvYWRpbmc6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIHJlc3RmdWxTZXJ2aWNlOiBSZXN0ZnVsU2VydmljZSxcclxuICAgIHByaXZhdGUgc2Vzc2lvblNlcnZpY2U6IFNlc3Npb25TZXJ2aWNlLFxyXG4gICAgQEluamVjdChTZXJ2ZXJfSG9zdCkgQE9wdGlvbmFsKCkgcHJpdmF0ZSBzZXJ2ZXJIb3N0OiBzdHJpbmcsXHJcbiAgICBASW5qZWN0KExvYWRfRGF0YV9VcmkpIEBPcHRpb25hbCgpIHByaXZhdGUgbG9hZERhdGFVcmk6IHN0cmluZyxcclxuICAgIEBJbmplY3QoTG9hZF9EYXRhX0NvbCkgQE9wdGlvbmFsKCkgcHJpdmF0ZSBsb2FkRGF0YUNvbDogc3RyaW5nXHJcbiAgKSB7IH1cclxuXHJcbiAgZXhwb3J0RGF0YShwYXJhbXM6IGFueSwgcXVlcnlSZWxhdGl2ZVVybDogYW55KSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGxldCB1cmkgPSB0aGlzLnNlcnZlckhvc3Q7XHJcbiAgICBpZiAodGhpcy5sb2FkRGF0YVVyaSkge1xyXG4gICAgICB1cmkgKz0gdGhpcy5sb2FkRGF0YVVyaTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHVyaSArPSAoIXF1ZXJ5UmVsYXRpdmVVcmwgPyAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3FkcHNlYXJjaC8nIDogcXVlcnlSZWxhdGl2ZVVybCkgKyAnZXhwb3J0JztcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbmZpZyA9IHtcclxuICAgICAgcmVzcG9uc2VUeXBlOiAnYXBwbGljYXRpb24vanNvbicgLy8g6KGo5piO6L+U5Zue5pyN5Yqh5Zmo6L+U5Zue55qE5pWw5o2u57G75Z6LXHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmFzc2lnbihjb25maWcsIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgY29uc3QgZmlsZU5hbWUgPSBwYXJhbXMuZXhjZWxFeHBvcnROYW1lICsgJy54bHN4JztcclxuICAgIHBhcmFtcyA9ICFxdWVyeVJlbGF0aXZlVXJsID8gcGFyYW1zIDogeyAnUGFyYW0nOiBwYXJhbXMgfTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSAhcXVlcnlSZWxhdGl2ZVVybCA/IHRoaXMucmVzdGZ1bFNlcnZpY2UucG9zdCh1cmksIHBhcmFtcywge30sIGNvbmZpZylcclxuICAgICAgOiB0aGlzLnJlc3RmdWxTZXJ2aWNlLnB1dCh1cmksIHBhcmFtcywge30sIGNvbmZpZyk7XHJcbiAgICByZXN1bHQkLnRvUHJvbWlzZSgpLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgIGRhdGEgPSAhcXVlcnlSZWxhdGl2ZVVybCA/IGRhdGEgOiBKU09OLnBhcnNlKGRhdGEpLnJldHVyblZhbHVlO1xyXG4gICAgICBjb25zdCBieXRlU3RyaW5nID0gYXRvYihkYXRhKTsgLy8gYmFzZTY0IOino+eggVxyXG4gICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihieXRlU3RyaW5nLmxlbmd0aCk7IC8vIOWIm+W7uue8k+WGsuaVsOe7hFxyXG4gICAgICBjb25zdCBpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmZmVyKTsgLy8g5Yib5bu66KeG5Zu+XHJcblxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVTdHJpbmcubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpbnRBcnJheVtpXSA9IGJ5dGVTdHJpbmcuY2hhckNvZGVBdChpKTtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2ludEFycmF5XSwgeyB0eXBlOiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsJyB9KTtcclxuICAgICAgaWYgKCdkb3dubG9hZCcgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpKSB7IC8vIOmdnklF5LiL6L29XHJcbiAgICAgICAgY29uc3QgZWxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgZWxpbmsuZG93bmxvYWQgPSBmaWxlTmFtZTtcclxuICAgICAgICBlbGluay5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIGVsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxpbmspO1xyXG4gICAgICAgIGVsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChlbGluay5ocmVmKTsgLy8g6YeK5pS+VVJMIOWvueixoVxyXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxpbmspO1xyXG4gICAgICB9IGVsc2UgeyAvLyBJRTEwK+S4i+i9vVxyXG4gICAgICAgIG5hdmlnYXRvci5tc1NhdmVCbG9iKGJsb2IsIGZpbGVOYW1lKTtcclxuICAgICAgfVxyXG4gICAgICBzZWxmLmxvYWRpbmcuY2xvc2UoKTtcclxuICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGF5c25FeHBvcnREYXRhKHBhcmFtczogYW55LCBxdWVyeVJlbGF0aXZlVXJsOiBhbnkpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgbGV0IHVyaSA9IHRoaXMuc2VydmVySG9zdDtcclxuICAgIGlmICh0aGlzLmxvYWREYXRhVXJpKSB7XHJcbiAgICAgIHVyaSArPSB0aGlzLmxvYWREYXRhVXJpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdXJpICs9ICghcXVlcnlSZWxhdGl2ZVVybCA/ICcvYXBpL3J1bnRpbWUvYmNjL3YxLjAvcWRwc2VhcmNoLycgOiBxdWVyeVJlbGF0aXZlVXJsKSArICdleHBvcnQnO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY29uZmlnID0ge1xyXG4gICAgICByZXNwb25zZVR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyAvLyDooajmmI7ov5Tlm57mnI3liqHlmajov5Tlm57nmoTmlbDmja7nsbvlnotcclxuICAgIH07XHJcbiAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICBwYXJhbXMuYXN5bmMgPSAxO1xyXG4gICAgcGFyYW1zID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyBwYXJhbXMgOiB7ICdQYXJhbSc6IHBhcmFtcyB9O1xyXG4gICAgY29uc3QgcmVzdWx0JCA9ICFxdWVyeVJlbGF0aXZlVXJsID8gdGhpcy5yZXN0ZnVsU2VydmljZS5wb3N0KHVyaSwgcGFyYW1zLCB7fSwgY29uZmlnKVxyXG4gICAgICA6IHRoaXMucmVzdGZ1bFNlcnZpY2UucHV0KHVyaSwgcGFyYW1zLCB7fSwgY29uZmlnKTtcclxuICAgIHJlc3VsdCQudG9Qcm9taXNlKCkudGhlbihkYXRhID0+IHtcclxuICAgICAgZGF0YSA9ICFxdWVyeVJlbGF0aXZlVXJsID8gZGF0YSA6IEpTT04ucGFyc2UoZGF0YSkucmV0dXJuVmFsdWU7XHJcbiAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgIH1cclxuICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcGRmRXhwb3J0RXZlbnQocGFyYW1zOiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBsZXQgdXJpID0gdGhpcy5zZXJ2ZXJIb3N0O1xyXG4gICAgaWYgKHRoaXMubG9hZERhdGFVcmkpIHtcclxuICAgICAgdXJpICs9IHRoaXMubG9hZERhdGFVcmk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB1cmkgKz0gKCFxdWVyeVJlbGF0aXZlVXJsID8gJy9hcGkvcnVudGltZS9iY2MvdjEuMC9xZHBzZWFyY2gvJyA6IHF1ZXJ5UmVsYXRpdmVVcmwpICsgJ3ByaW50JztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb25maWcgPSB7XHJcbiAgICAgIHJlc3BvbnNlVHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nIC8vIOihqOaYjui/lOWbnuacjeWKoeWZqOi/lOWbnueahOaVsOaNruexu+Wei1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5hc3NpZ24oY29uZmlnLCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHBhcmFtcyA9ICFxdWVyeVJlbGF0aXZlVXJsID8gcGFyYW1zIDogeyAnUGFyYW0nOiBwYXJhbXMgfTtcclxuICAgIGNvbnN0IGZpbGVOYW1lID0gcGFyYW1zLlBhcmFtICYmIHBhcmFtcy5QYXJhbS5leGNlbEV4cG9ydE5hbWUgPyBwYXJhbXMuUGFyYW0uZXhjZWxFeHBvcnROYW1lICsgJycgOiBwYXJhbXMuZXhjZWxFeHBvcnROYW1lICsgJyc7XHJcbiAgICBjb25zdCByZXN1bHQkID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyB0aGlzLnJlc3RmdWxTZXJ2aWNlLnBvc3QodXJpLCBwYXJhbXMsIHt9LCBjb25maWcpXHJcbiAgICAgIDogdGhpcy5yZXN0ZnVsU2VydmljZS5wdXQodXJpLCBwYXJhbXMsIHt9LCBjb25maWcpO1xyXG4gICAgcmVzdWx0JC50b1Byb21pc2UoKS50aGVuKGRhdGEgPT4ge1xyXG4gICAgICBkYXRhID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyBkYXRhIDogSlNPTi5wYXJzZShkYXRhKS5yZXR1cm5WYWx1ZTtcclxuICAgICAgY29uc3QgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YSk7IC8vIGJhc2U2NCDop6PnoIFcclxuICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZVN0cmluZy5sZW5ndGgpOyAvLyDliJvlu7rnvJPlhrLmlbDnu4RcclxuICAgICAgY29uc3QgaW50QXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7IC8vIOWIm+W7uuinhuWbvlxyXG5cclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlU3RyaW5nLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaW50QXJyYXlbaV0gPSBieXRlU3RyaW5nLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtpbnRBcnJheV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicgfSk7XHJcbiAgICAgIGlmICgnZG93bmxvYWQnIGluIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKSkgeyAvLyDpnZ5JReS4i+i9vVxyXG4gICAgICAgIGNvbnN0IGVsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gICAgICAgIGVsaW5rLmRvd25sb2FkID0gZmlsZU5hbWU7XHJcbiAgICAgICAgZWxpbmsuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICBlbGluay5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsaW5rKTtcclxuICAgICAgICBlbGluay5jbGljaygpO1xyXG4gICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwoZWxpbmsuaHJlZik7IC8vIOmHiuaUvlVSTCDlr7nosaFcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsaW5rKTtcclxuICAgICAgfSBlbHNlIHsgLy8gSUUxMCvkuIvovb1cclxuICAgICAgICBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBmaWxlTmFtZSk7XHJcbiAgICAgIH1cclxuICAgIH0sIGVycm9yID0+IHtcclxuICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaW50UHJlVmlldyhwYXJhbXM6IGFueSwgcXVlcnlSZWxhdGl2ZVVybDogYW55KSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGxldCB1cmkgPSB0aGlzLnNlcnZlckhvc3Q7XHJcbiAgICBpZiAodGhpcy5sb2FkRGF0YVVyaSkge1xyXG4gICAgICB1cmkgKz0gdGhpcy5sb2FkRGF0YVVyaTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHVyaSArPSAoIXF1ZXJ5UmVsYXRpdmVVcmwgPyAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3FkcHNlYXJjaC8nIDogcXVlcnlSZWxhdGl2ZVVybCkgKyAncHJpbnQnO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbmZpZyA9IHtcclxuICAgICAgcmVzcG9uc2VUeXBlOiAnYXBwbGljYXRpb24vanNvbicgLy8g6KGo5piO6L+U5Zue5pyN5Yqh5Zmo6L+U5Zue55qE5pWw5o2u57G75Z6LXHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmFzc2lnbihjb25maWcsIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcGFyYW1zID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyBwYXJhbXMgOiB7ICdQYXJhbSc6IHBhcmFtcyB9O1xyXG4gICAgY29uc3QgZmlsZU5hbWUgPSBwYXJhbXMuUGFyYW0gJiYgcGFyYW1zLlBhcmFtLmV4Y2VsRXhwb3J0TmFtZSA/IHBhcmFtcy5QYXJhbS5leGNlbEV4cG9ydE5hbWUgKyAnJyA6IHBhcmFtcy5leGNlbEV4cG9ydE5hbWUgKyAnJztcclxuICAgIGNvbnN0IHJlc3VsdCQgPSAhcXVlcnlSZWxhdGl2ZVVybCA/IHRoaXMucmVzdGZ1bFNlcnZpY2UucG9zdCh1cmksIHBhcmFtcywge30sIGNvbmZpZylcclxuICAgICAgOiB0aGlzLnJlc3RmdWxTZXJ2aWNlLnB1dCh1cmksIHBhcmFtcywge30sIGNvbmZpZyk7XHJcbiAgICByZXN1bHQkLnRvUHJvbWlzZSgpLnRoZW4oZGF0YSA9PiB7XHJcbiAgICAgIGRhdGEgPSAhcXVlcnlSZWxhdGl2ZVVybCA/IGRhdGEgOiBKU09OLnBhcnNlKGRhdGEpLnJldHVyblZhbHVlO1xyXG4gICAgICBjb25zdCBvcHRpb25zOiBPdXRwdXRPcHRpb25zID0ge1xyXG4gICAgICAgIE91dHB1dFR5cGU6IE91dHB1dFR5cGUuUFJJTlQsXHJcbiAgICAgICAgRmlsZVR5cGU6IEZpbGVUeXBlLlBkZixcclxuICAgICAgICBQYXRoOiAnJyxcclxuICAgICAgICBEZXZpY2VJZDogJycsXHJcbiAgICAgICAgcHJpbnRUeXBlOiBQcmludFR5cGUuUXVlcnksXHJcbiAgICAgICAgcHJpbnRKb2I6IGZhbHNlLFxyXG4gICAgICAgIHByaW50ZXJOYW1lOiAnJyxcclxuICAgICAgICBwcmludFNldHRpbmc6IG51bGxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YSk7IC8vIGJhc2U2NCDop6PnoIFcclxuICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZVN0cmluZy5sZW5ndGgpOyAvLyDliJvlu7rnvJPlhrLmlbDnu4RcclxuICAgICAgY29uc3QgaW50QXJyYXkgPSBuZXcgVWludDhBcnJheShhcnJheUJ1ZmZlcik7IC8vIOWIm+W7uuinhuWbvlxyXG5cclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlU3RyaW5nLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaW50QXJyYXlbaV0gPSBieXRlU3RyaW5nLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtpbnRBcnJheV0pO1xyXG4gICAgICBzZWxmLmNsb3VkcHJpbnRTZXJ2aWNlLm9wZW5SZW5kZWRWaWV3ZXIoJ3RhYicsIGJsb2IsIG9wdGlvbnMpO1xyXG4gICAgfSwgZXJyb3IgPT4ge1xyXG4gICAgICBzZWxmLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKGVycm9yLk1lc3NhZ2UsIGVycm9yKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0RGF0YShwYXJhbXM6IGFueSwgcXVlcnlSZWxhdGl2ZVVybDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgbGV0IHVyaSA9IHRoaXMuc2VydmVySG9zdDtcclxuICAgIGlmICh0aGlzLmxvYWREYXRhVXJpKSB7XHJcbiAgICAgIHVyaSArPSB0aGlzLmxvYWREYXRhVXJpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdXJpICs9ICFxdWVyeVJlbGF0aXZlVXJsID8gJy9hcGkvcnVudGltZS9iY2MvdjEuMC9xZHBzZWFyY2gvcXVlcnknIDogKHF1ZXJ5UmVsYXRpdmVVcmwgKyAncXVlcnlkYXRhJyk7XHJcbiAgICB9XHJcbiAgICBwYXJhbXMgPSAhcXVlcnlSZWxhdGl2ZVVybCA/IHBhcmFtcyA6IHsgJ1BhcmFtJzogcGFyYW1zIH07XHJcbiAgICBjb25zdCByZXN1bHQkID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyB0aGlzLnJlc3RmdWxTZXJ2aWNlLnBvc3QodXJpLCBwYXJhbXMsIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKVxyXG4gICAgICA6IHRoaXMucmVzdGZ1bFNlcnZpY2UucHV0KHVyaSwgcGFyYW1zLCB7fSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICBkYXRhID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyBkYXRhIDogZGF0YS5yZXR1cm5WYWx1ZTtcclxuICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEucGFnZUluZm8pIHtcclxuICAgICAgICAgICAgc2VsZi5wYWdlSW5mb0NoYW5nZS5uZXh0KGRhdGEucGFnZUluZm8pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS52YXJpYWJsZXMpIHtcclxuICAgICAgICAgICAgc2VsZi52YXJpYWJsZXNDaGFuZ2UubmV4dChkYXRhLnZhcmlhYmxlcyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmRyb3BEb3duT3B0aW9uKSB7XHJcbiAgICAgICAgICAgIHNlbGYuaW5TdWl0ZURyb3BEb3duSW5mbyA9IGRhdGEuZHJvcERvd25PcHRpb247XHJcbiAgICAgICAgICAgIHNlbGYuaW5TdWl0ZURyb3BEb3duSW5mb0NoYW5nZS5uZXh0KGRhdGEuZHJvcERvd25PcHRpb24pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRDb2wocGFyYW1zOiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGxldCB1cmkgPSB0aGlzLnNlcnZlckhvc3Q7XHJcbiAgICBpZiAodGhpcy5sb2FkRGF0YUNvbCkge1xyXG4gICAgICB1cmkgKz0gdGhpcy5sb2FkRGF0YUNvbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHVyaSArPSAoIXF1ZXJ5UmVsYXRpdmVVcmwgPyAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3FkcHNlYXJjaC8nIDogcXVlcnlSZWxhdGl2ZVVybCkgKyAncXVlcnljb2wnO1xyXG4gICAgfVxyXG4gICAgcGFyYW1zID0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyBwYXJhbXMgOiB7ICdQYXJhbSc6IHBhcmFtcyB9O1xyXG4gICAgY29uc3QgcmVzdWx0JCA9ICFxdWVyeVJlbGF0aXZlVXJsID8gdGhpcy5yZXN0ZnVsU2VydmljZS5wb3N0KHVyaSwgcGFyYW1zLCB7fSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSlcclxuICAgICAgOiB0aGlzLnJlc3RmdWxTZXJ2aWNlLnB1dCh1cmksIHBhcmFtcywge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgZGF0YSA9ICFxdWVyeVJlbGF0aXZlVXJsID8gZGF0YSA6IGRhdGEucmV0dXJuVmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldENyb3NzdGFiVGVtcGxhdGUocGFyYW1zOiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBsZXQgdXJpID0gdGhpcy5zZXJ2ZXJIb3N0O1xyXG4gICAgaWYgKHRoaXMubG9hZERhdGFVcmkpIHtcclxuICAgICAgdXJpICs9IHRoaXMubG9hZERhdGFVcmk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB1cmkgKz0gIXF1ZXJ5UmVsYXRpdmVVcmwgPyAnL2FwaS9ydW50aW1lL2JjYy92MS4wL3FkcHNlYXJjaC9nZXRjcm9zc3RhYnRlbXBsYXRlJyA6IChxdWVyeVJlbGF0aXZlVXJsICsgJ2dldGNyb3NzdGFidGVtcGxhdGUnKTtcclxuICAgIH1cclxuICAgIHBhcmFtcyA9ICFxdWVyeVJlbGF0aXZlVXJsID8gcGFyYW1zIDogeyAnUGFyYW0nOiBwYXJhbXMgfTtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSAhcXVlcnlSZWxhdGl2ZVVybCA/IHRoaXMucmVzdGZ1bFNlcnZpY2UucG9zdCh1cmksIHBhcmFtcywge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpXHJcbiAgICAgIDogdGhpcy5yZXN0ZnVsU2VydmljZS5wdXQodXJpLCBwYXJhbXMsIHt9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgocmVzdWx0OiBhbnkpID0+IHtcclxuICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICByZXN1bHQgPSAhcXVlcnlSZWxhdGl2ZVVybCA/IHJlc3VsdCA6IChyZXN1bHQgJiYgcmVzdWx0LnJldHVyblZhbHVlKSA/IEpTT04ucGFyc2UocmVzdWx0LnJldHVyblZhbHVlKSA6IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRTcHJlYWRMaWNlbnNlKCkge1xyXG4gICAgY29uc3QgdXJpID0gJy9hcGkvcnVudGltZS9iY2MvdjEuMC9xZHBzY2hlbWFtYW5hZ2VyL2dldFNwcmVhZExpY2Vuc2UnO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdGZ1bFNlcnZpY2UuZ2V0KHVyaSwge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICByZXR1cm4gZGF0YS5zcHJlYWRqcztcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjbGVhckNhY2hlKHBhcmFtczogYW55KSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGNvbnN0IHVyaSA9IHRoaXMuc2VydmVySG9zdCArICcvYXBpL3J1bnRpbWUvYmNjL3YxLjAvcWRwc2VhcmNoL2NsZWFyY2FjaGUnO1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdGZ1bFNlcnZpY2UucG9zdCh1cmksIHBhcmFtcywge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKChyZXN1bHQ6IGFueSkgPT4ge1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSB7XHJcbiAgICByZXR1cm4gUnRmU2VydmljZXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKHRoaXMuc2Vzc2lvblNlcnZpY2UpO1xyXG4gIH1cclxufVxyXG4iXX0=
/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// import 'rxjs/add/operator/map';
import { Injectable, Inject } from '@angular/core';
import { map } from 'rxjs/operators';
import { Subject } from 'rxjs';
import { SessionService } from '@ecp-caf/caf-common';
import { RestfulService } from '../restful-service/restful.service';
import { Server_Host } from '../../entitties/server.host';
import { RtfServices } from '../rtfservices/rtfservices';
var PrintIntegrationManagerService = /** @class */ (function () {
    function PrintIntegrationManagerService(restService, sessionService, host) {
        this.restService = restService;
        this.sessionService = sessionService;
        this.host = host;
        this.uri = '/api/runtime/bcc/v1.0/printintegration/';
        this.printIntegrationInfoChange = new Subject();
        this.printIntegrationInfoList = {};
    }
    /**
     * 获取查询参数映射信息
     * @param schemaId 方案ID
     * @param queryId 查询编号
     */
    /**
     * 获取查询参数映射信息
     * @param {?} schemaId 方案ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    PrintIntegrationManagerService.prototype.getPrintIntegration = /**
     * 获取查询参数映射信息
     * @param {?} schemaId 方案ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (schemaId, queryId, queryRelativeUrl) {
        /** @type {?} */
        var result$ = this.getPrintIntegrationList(queryId, schemaId, '', '', queryRelativeUrl);
        return result$.pipe(map((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value && value[schemaId + queryId]) {
                return value[schemaId + queryId];
            }
            else {
                return null;
            }
        })));
    };
    /**
     * 获取打印设置信息列表
     * @param queryId 查询编号
     * @param schemaId 方案ID
     * @param userId 用户ID
     * @param languageType 语言类型
     */
    /**
     * 获取打印设置信息列表
     * @param {?} queryId 查询编号
     * @param {?} schemaId 方案ID
     * @param {?} userId 用户ID
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    PrintIntegrationManagerService.prototype.getPrintIntegrationList = /**
     * 获取打印设置信息列表
     * @param {?} queryId 查询编号
     * @param {?} schemaId 方案ID
     * @param {?} userId 用户ID
     * @param {?} languageType 语言类型
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (queryId, schemaId, userId, languageType, queryRelativeUrl) {
        var _this = this;
        /** @type {?} */
        var restUri = this.host + this.uri + 'getprintintegrationlist';
        /** @type {?} */
        var result$ = this.restService.get(restUri, { queryId: queryId, schemaId: schemaId, userId: userId, languageType: languageType }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data && data.length) {
                data.forEach((/**
                 * @param {?} element
                 * @return {?}
                 */
                function (element) {
                    element.printintegration = JSON.parse(element.printintegration);
                    _this.printIntegrationInfoList[schemaId + queryId] = element;
                }));
                _this.printIntegrationInfoChange.next({ printIntegrationInfoList: _this.printIntegrationInfoList });
                return _this.printIntegrationInfoList;
            }
            else {
                _this.printIntegrationInfoChange.next({ printIntegrationInfoList: null });
                return null;
            }
        })));
    };
    /**
     * 保存打印设置信息
     * @param element 打印设置
     */
    /**
     * 保存打印设置信息
     * @param {?} element 打印设置
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    PrintIntegrationManagerService.prototype.savePrintIntegration = /**
     * 保存打印设置信息
     * @param {?} element 打印设置
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (element, queryRelativeUrl) {
        var _this = this;
        /** @type {?} */
        var restUri = this.host + this.uri + 'saveprintintegration';
        /** @type {?} */
        var integration = element;
        /** @type {?} */
        var result$ = this.restService.post(restUri, integration, {}, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @return {?}
         */
        function () {
            element.printintegration = JSON.parse(element.printintegration);
            if (Object.keys(_this.printIntegrationInfoList).indexOf(element.schemaId + element.queryId)) {
                _this.printIntegrationInfoList[element.schemaId + element.queryId] = element;
            }
        })));
    };
    /**
     * 删除打印设置信息
     * @param schemaId 方案ID
     * @param queryId 查询编号
     */
    /**
     * 删除打印设置信息
     * @param {?} schemaId 方案ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    PrintIntegrationManagerService.prototype.deletePrintIntegration = /**
     * 删除打印设置信息
     * @param {?} schemaId 方案ID
     * @param {?} queryId 查询编号
     * @param {?} queryRelativeUrl
     * @return {?}
     */
    function (schemaId, queryId, queryRelativeUrl) {
        var _this = this;
        /** @type {?} */
        var restUri = this.host + this.uri + 'deleteprintintegration';
        /** @type {?} */
        var result$ = this.restService.delete(restUri, { schemaId: schemaId, queryId: queryId }, this.createHeaderSessionId());
        return result$.pipe(map((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            if (data === true) {
                _this.printIntegrationInfoList[schemaId + queryId] = null;
            }
            else {
                return false;
            }
        })));
    };
    /**
     * @private
     * @return {?}
     */
    PrintIntegrationManagerService.prototype.createHeaderSessionId = /**
     * @private
     * @return {?}
     */
    function () {
        return RtfServices.createHeaderSessionId(this.sessionService);
    };
    PrintIntegrationManagerService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    PrintIntegrationManagerService.ctorParameters = function () { return [
        { type: RestfulService },
        { type: SessionService },
        { type: String, decorators: [{ type: Inject, args: [Server_Host,] }] }
    ]; };
    return PrintIntegrationManagerService;
}());
export { PrintIntegrationManagerService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.uri;
    /** @type {?} */
    PrintIntegrationManagerService.prototype.printIntegrationInfoChange;
    /** @type {?} */
    PrintIntegrationManagerService.prototype.printIntegrationInfoList;
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.restService;
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.sessionService;
    /**
     * @type {?}
     * @private
     */
    PrintIntegrationManagerService.prototype.host;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpbnQtaW50ZWdyYXRpb25tYW5hZ2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcWRwL2NvbW1vbi8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlL3ByaW50LWludGVncmF0aW9uL3ByaW50LWludGVncmF0aW9ubWFuYWdlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBYyxPQUFPLEVBQU0sTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRXpEO0lBT0Usd0NBQW9CLFdBQTJCLEVBQVUsY0FBOEIsRUFBK0IsSUFBWTtRQUE5RyxnQkFBVyxHQUFYLFdBQVcsQ0FBZ0I7UUFBVSxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFBK0IsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUwxSCxRQUFHLEdBQUcseUNBQXlDLENBQUM7UUFDeEQsK0JBQTBCLEdBQUcsSUFBSSxPQUFPLEVBQU8sQ0FBQztRQUVoRCw2QkFBd0IsR0FBUSxFQUFFLENBQUM7SUFHbkMsQ0FBQztJQUVEOzs7O09BSUc7Ozs7Ozs7O0lBQ0gsNERBQW1COzs7Ozs7O0lBQW5CLFVBQW9CLFFBQWdCLEVBQUUsT0FBZSxFQUFFLGdCQUFxQjs7WUFDcEUsT0FBTyxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsZ0JBQWdCLENBQUM7UUFDekYsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNqQixHQUFHOzs7O1FBQUMsVUFBQSxLQUFLO1lBQ1AsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsRUFBRTtnQkFDdEMsT0FBTyxLQUFLLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxDQUFDO2FBQ2xDO2lCQUFNO2dCQUNMLE9BQU8sSUFBSSxDQUFDO2FBQ2I7UUFDSCxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7Ozs7T0FNRzs7Ozs7Ozs7OztJQUNILGdFQUF1Qjs7Ozs7Ozs7O0lBQXZCLFVBQXdCLE9BQWUsRUFBRSxRQUFhLEVBQUUsTUFBYyxFQUFFLFlBQW9CLEVBQUUsZ0JBQXFCO1FBQW5ILGlCQWtCQzs7WUFqQk8sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyx5QkFBeUI7O1lBQzFELE9BQU8sR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsRUFBRSxPQUFPLFNBQUEsRUFBRSxRQUFRLFVBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxZQUFZLGNBQUEsRUFBRSxFQUFFLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQ3hILE9BQU8sT0FBTyxDQUFDLElBQUksQ0FDakIsR0FBRzs7OztRQUFDLFVBQUMsSUFBUztZQUNaLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxPQUFPOzs7O2dCQUFDLFVBQUMsT0FBWTtvQkFDeEIsT0FBTyxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7b0JBQ2hFLEtBQUksQ0FBQyx3QkFBd0IsQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsT0FBTyxDQUFDO2dCQUM5RCxDQUFDLEVBQUMsQ0FBQztnQkFDSCxLQUFJLENBQUMsMEJBQTBCLENBQUMsSUFBSSxDQUFDLEVBQUUsd0JBQXdCLEVBQUUsS0FBSSxDQUFDLHdCQUF3QixFQUFFLENBQUMsQ0FBQztnQkFDbEcsT0FBTyxLQUFJLENBQUMsd0JBQXdCLENBQUM7YUFDdEM7aUJBQU07Z0JBQ0wsS0FBSSxDQUFDLDBCQUEwQixDQUFDLElBQUksQ0FBQyxFQUFFLHdCQUF3QixFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQ3pFLE9BQU8sSUFBSSxDQUFDO2FBQ2I7UUFDSCxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUNEOzs7T0FHRzs7Ozs7OztJQUNILDZEQUFvQjs7Ozs7O0lBQXBCLFVBQXFCLE9BQVksRUFBRSxnQkFBcUI7UUFBeEQsaUJBWUM7O1lBWE8sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxzQkFBc0I7O1lBQ3ZELFdBQVcsR0FBRyxPQUFPOztZQUNyQixPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDN0YsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNqQixHQUFHOzs7UUFBQztZQUNGLE9BQU8sQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ2hFLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzFGLEtBQUksQ0FBQyx3QkFBd0IsQ0FBQyxPQUFPLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxPQUFPLENBQUM7YUFDN0U7UUFDSCxDQUFDLEVBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUNEOzs7O09BSUc7Ozs7Ozs7O0lBQ0gsK0RBQXNCOzs7Ozs7O0lBQXRCLFVBQXVCLFFBQWdCLEVBQUUsT0FBZSxFQUFFLGdCQUFxQjtRQUEvRSxpQkFZQzs7WUFYTyxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLHdCQUF3Qjs7WUFDekQsT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLFFBQVEsVUFBQSxFQUFFLE9BQU8sU0FBQSxFQUFFLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDckcsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUNqQixHQUFHOzs7O1FBQUMsVUFBQyxJQUFTO1lBQ1osSUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFO2dCQUNqQixLQUFJLENBQUMsd0JBQXdCLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQzthQUMxRDtpQkFBTTtnQkFDTCxPQUFPLEtBQUssQ0FBQzthQUNkO1FBQ0gsQ0FBQyxFQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7Ozs7O0lBRU8sOERBQXFCOzs7O0lBQTdCO1FBQ0UsT0FBTyxXQUFXLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7O2dCQTVGRixVQUFVOzs7O2dCQUpGLGNBQWM7Z0JBRGQsY0FBYzs2Q0FZcUUsTUFBTSxTQUFDLFdBQVc7O0lBdUY5RyxxQ0FBQztDQUFBLEFBOUZELElBOEZDO1NBN0ZZLDhCQUE4Qjs7Ozs7O0lBQ3pDLDZDQUF3RDs7SUFDeEQsb0VBQWdEOztJQUVoRCxrRUFBbUM7Ozs7O0lBRXZCLHFEQUFtQzs7Ozs7SUFBRSx3REFBc0M7Ozs7O0lBQUUsOENBQXlDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9tYXAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBvZiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBTZXNzaW9uU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBSZXN0ZnVsU2VydmljZSB9IGZyb20gJy4uL3Jlc3RmdWwtc2VydmljZS9yZXN0ZnVsLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBTZXJ2ZXJfSG9zdCB9IGZyb20gJy4uLy4uL2VudGl0dGllcy9zZXJ2ZXIuaG9zdCc7XHJcbmltcG9ydCB7IFJ0ZlNlcnZpY2VzIH0gZnJvbSAnLi4vcnRmc2VydmljZXMvcnRmc2VydmljZXMnO1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgUHJpbnRJbnRlZ3JhdGlvbk1hbmFnZXJTZXJ2aWNlIHtcclxuICBwcml2YXRlIHVyaSA9ICcvYXBpL3J1bnRpbWUvYmNjL3YxLjAvcHJpbnRpbnRlZ3JhdGlvbi8nO1xyXG4gIHByaW50SW50ZWdyYXRpb25JbmZvQ2hhbmdlID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG5cclxuICBwcmludEludGVncmF0aW9uSW5mb0xpc3Q6IGFueSA9IHt9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlc3RTZXJ2aWNlOiBSZXN0ZnVsU2VydmljZSwgcHJpdmF0ZSBzZXNzaW9uU2VydmljZTogU2Vzc2lvblNlcnZpY2UsIEBJbmplY3QoU2VydmVyX0hvc3QpIHByaXZhdGUgaG9zdDogc3RyaW5nKSB7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmn6Xor6Llj4LmlbDmmKDlsITkv6Hmga9cclxuICAgKiBAcGFyYW0gc2NoZW1hSWQg5pa55qGISURcclxuICAgKiBAcGFyYW0gcXVlcnlJZCDmn6Xor6LnvJblj7dcclxuICAgKi9cclxuICBnZXRQcmludEludGVncmF0aW9uKHNjaGVtYUlkOiBzdHJpbmcsIHF1ZXJ5SWQ6IHN0cmluZywgcXVlcnlSZWxhdGl2ZVVybDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3VsdCQgPSB0aGlzLmdldFByaW50SW50ZWdyYXRpb25MaXN0KHF1ZXJ5SWQsIHNjaGVtYUlkLCAnJywgJycsIHF1ZXJ5UmVsYXRpdmVVcmwpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKHZhbHVlID0+IHtcclxuICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWVbc2NoZW1hSWQgKyBxdWVyeUlkXSkge1xyXG4gICAgICAgICAgcmV0dXJuIHZhbHVlW3NjaGVtYUlkICsgcXVlcnlJZF07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5bmiZPljbDorr7nva7kv6Hmga/liJfooahcclxuICAgKiBAcGFyYW0gcXVlcnlJZCDmn6Xor6LnvJblj7dcclxuICAgKiBAcGFyYW0gc2NoZW1hSWQg5pa55qGISURcclxuICAgKiBAcGFyYW0gdXNlcklkIOeUqOaIt0lEXHJcbiAgICogQHBhcmFtIGxhbmd1YWdlVHlwZSDor63oqIDnsbvlnotcclxuICAgKi9cclxuICBnZXRQcmludEludGVncmF0aW9uTGlzdChxdWVyeUlkOiBzdHJpbmcsIHNjaGVtYUlkOiBhbnksIHVzZXJJZDogc3RyaW5nLCBsYW5ndWFnZVR5cGU6IHN0cmluZywgcXVlcnlSZWxhdGl2ZVVybDogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnN0IHJlc3RVcmkgPSB0aGlzLmhvc3QgKyB0aGlzLnVyaSArICdnZXRwcmludGludGVncmF0aW9ubGlzdCc7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5nZXQocmVzdFVyaSwgeyBxdWVyeUlkLCBzY2hlbWFJZCwgdXNlcklkLCBsYW5ndWFnZVR5cGUgfSwgdGhpcy5jcmVhdGVIZWFkZXJTZXNzaW9uSWQoKSk7XHJcbiAgICByZXR1cm4gcmVzdWx0JC5waXBlKFxyXG4gICAgICBtYXAoKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICBkYXRhLmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBlbGVtZW50LnByaW50aW50ZWdyYXRpb24gPSBKU09OLnBhcnNlKGVsZW1lbnQucHJpbnRpbnRlZ3JhdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMucHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0W3NjaGVtYUlkICsgcXVlcnlJZF0gPSBlbGVtZW50O1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICB0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvQ2hhbmdlLm5leHQoeyBwcmludEludGVncmF0aW9uSW5mb0xpc3Q6IHRoaXMucHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0IH0pO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMucHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvQ2hhbmdlLm5leHQoeyBwcmludEludGVncmF0aW9uSW5mb0xpc3Q6IG51bGwgfSk7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDkv53lrZjmiZPljbDorr7nva7kv6Hmga9cclxuICAgKiBAcGFyYW0gZWxlbWVudCDmiZPljbDorr7nva5cclxuICAgKi9cclxuICBzYXZlUHJpbnRJbnRlZ3JhdGlvbihlbGVtZW50OiBhbnksIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnc2F2ZXByaW50aW50ZWdyYXRpb24nO1xyXG4gICAgY29uc3QgaW50ZWdyYXRpb24gPSBlbGVtZW50O1xyXG4gICAgY29uc3QgcmVzdWx0JCA9IHRoaXMucmVzdFNlcnZpY2UucG9zdChyZXN0VXJpLCBpbnRlZ3JhdGlvbiwge30sIHRoaXMuY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkpO1xyXG4gICAgcmV0dXJuIHJlc3VsdCQucGlwZShcclxuICAgICAgbWFwKCgpID0+IHtcclxuICAgICAgICBlbGVtZW50LnByaW50aW50ZWdyYXRpb24gPSBKU09OLnBhcnNlKGVsZW1lbnQucHJpbnRpbnRlZ3JhdGlvbik7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMucHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0KS5pbmRleE9mKGVsZW1lbnQuc2NoZW1hSWQgKyBlbGVtZW50LnF1ZXJ5SWQpKSB7XHJcbiAgICAgICAgICB0aGlzLnByaW50SW50ZWdyYXRpb25JbmZvTGlzdFtlbGVtZW50LnNjaGVtYUlkICsgZWxlbWVudC5xdWVyeUlkXSA9IGVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk5omT5Y2w6K6+572u5L+h5oGvXHJcbiAgICogQHBhcmFtIHNjaGVtYUlkIOaWueahiElEXHJcbiAgICogQHBhcmFtIHF1ZXJ5SWQg5p+l6K+i57yW5Y+3XHJcbiAgICovXHJcbiAgZGVsZXRlUHJpbnRJbnRlZ3JhdGlvbihzY2hlbWFJZDogc3RyaW5nLCBxdWVyeUlkOiBzdHJpbmcsIHF1ZXJ5UmVsYXRpdmVVcmw6IGFueSk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBjb25zdCByZXN0VXJpID0gdGhpcy5ob3N0ICsgdGhpcy51cmkgKyAnZGVsZXRlcHJpbnRpbnRlZ3JhdGlvbic7XHJcbiAgICBjb25zdCByZXN1bHQkID0gdGhpcy5yZXN0U2VydmljZS5kZWxldGUocmVzdFVyaSwgeyBzY2hlbWFJZCwgcXVlcnlJZCB9LCB0aGlzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCgpKTtcclxuICAgIHJldHVybiByZXN1bHQkLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHtcclxuICAgICAgICAgIHRoaXMucHJpbnRJbnRlZ3JhdGlvbkluZm9MaXN0W3NjaGVtYUlkICsgcXVlcnlJZF0gPSBudWxsO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlSGVhZGVyU2Vzc2lvbklkKCkge1xyXG4gICAgcmV0dXJuIFJ0ZlNlcnZpY2VzLmNyZWF0ZUhlYWRlclNlc3Npb25JZCh0aGlzLnNlc3Npb25TZXJ2aWNlKTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==
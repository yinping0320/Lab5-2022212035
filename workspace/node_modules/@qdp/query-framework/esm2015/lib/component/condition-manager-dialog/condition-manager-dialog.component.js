/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Injector, Input } from '@angular/core';
import { DialogComponent } from '@farris/ui-dialog';
import { LocalizeService } from '@qdp/localize';
import { ConditionSchemaService } from '@qdp/condition-schema';
import { MessagerService } from '@farris/ui-messager';
import { NotifyService } from '@farris/ui-notify';
import { Subject } from 'rxjs';
import { FormErrorService } from '@farris/command-services';
export class ConditionManagerDialogComponent {
    /**
     * @param {?} injector
     * @param {?} msgService
     * @param {?} conditionService
     * @param {?} notifyService
     */
    constructor(injector, msgService, conditionService, notifyService) {
        this.injector = injector;
        this.msgService = msgService;
        this.conditionService = conditionService;
        this.notifyService = notifyService;
        this.expandPublic = true;
        this.expandPersonal = true;
        this.publicList = [];
        this.personalList = [];
        this.removeList = [];
        this.motifyList = [];
        this.removeListEvent = new Subject();
        if (this.injector) {
            this.localizeService = this.injector.get(LocalizeService);
            this.formErrorService = this.injector.get(FormErrorService);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
    }
    /**
     * @return {?}
     */
    handleDialogShow() {
        this.farrisDialog.show();
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    handleExpandType($event) {
        this.expandPublic = $event === 0 ? !this.expandPublic : this.expandPublic;
        this.expandPersonal = $event === 1 ? !this.expandPersonal : this.expandPersonal;
    }
    /**
     * @param {?} change
     * @param {?} item
     * @return {?}
     */
    handleNgModelChange(change, item) {
        item.isDefault = change ? 1 : 0;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    handleDeleteSchame($event) {
        if (this.removeList.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        (item) => item.id === $event.id)) < 0) {
            this.removeList.push($event);
            this.motifyList.push({ type: 'delete', id: $event.id });
        }
        /** @type {?} */
        const index = $event.schemaType === 0
            ? this.publicList.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            (item) => item.id === $event.id))
            : this.personalList.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            (item) => item.id === $event.id));
        if ($event.schemaType === 0) {
            this.publicList.splice(index, 1);
        }
        else {
            this.personalList.splice(index, 1);
        }
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    handleSettingDefault($event) {
        /** @type {?} */
        const self = this;
        this.publicList.forEach((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            item.isDefault = item.id === $event.id ? 1 : 0;
            if (item.id === $event.id) {
                self.motifyList.push({ type: 'edit', id: $event.id });
            }
        }));
        this.personalList.forEach((/**
         * @param {?} item
         * @return {?}
         */
        (item) => {
            item.isDefault = item.id === $event.id ? 1 : 0;
            if (item.id === $event.id) {
                self.motifyList.push({ type: 'edit', id: $event.id });
            }
        }));
    }
    /**
     * @return {?}
     */
    handleOKClick() {
        /** @type {?} */
        const self = this;
        if (this.motifyList.length) {
            /** @type {?} */
            const deleteSchemas = [];
            /** @type {?} */
            let saveSchema;
            this.motifyList.forEach((/**
             * @param {?} item
             * @return {?}
             */
            (item) => {
                if (item.type === 'delete') {
                    deleteSchemas.push(item.id);
                }
                else {
                    saveSchema = self.publicList.find((/**
                     * @param {?} el
                     * @return {?}
                     */
                    (el) => el.id === item.id));
                    if (!saveSchema || !saveSchema.id) {
                        saveSchema = self.personalList.find((/**
                         * @param {?} el
                         * @return {?}
                         */
                        (el) => el.id === item.id));
                    }
                }
            }));
            if (saveSchema && saveSchema.schemaValue) {
                saveSchema.schemaValue = saveSchema && saveSchema.schemaValue ? JSON.stringify(saveSchema.schemaValue) : null;
            }
            if (deleteSchemas.length && saveSchema && saveSchema.id) {
                this.conditionService.deleteSchemaList(deleteSchemas.join(','), self.queryId).subscribe((/**
                 * @return {?}
                 */
                () => {
                    this.conditionService.saveSchema(saveSchema).subscribe((/**
                     * @return {?}
                     */
                    () => {
                        self.clearChanges();
                        self.notifyService['success']((/** @type {?} */ ({
                            title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.success'), timeout: 3000
                        })));
                        self.farrisDialog.close();
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    (error) => {
                        self.formErrorService.exception(error.Message, error);
                        // self.notifyService['success']({
                        //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                        // } as NotifyOptions);
                        self.farrisDialog.close();
                    }));
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                (error) => {
                    self.formErrorService.exception(error.Message, error);
                    // console.log(error);
                    // self.notifyService['success']({
                    //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                    // } as NotifyOptions);
                    self.farrisDialog.close();
                }));
            }
            else if (deleteSchemas.length) {
                this.conditionService.deleteSchemaList(deleteSchemas.join(','), self.queryId).subscribe((/**
                 * @return {?}
                 */
                () => {
                    self.clearChanges();
                    self.notifyService['success']((/** @type {?} */ ({
                        title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.success'), timeout: 3000
                    })));
                    self.farrisDialog.close();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                (error) => {
                    self.formErrorService.exception(error.Message, error);
                    // console.log(error);
                    // self.notifyService['success']({
                    //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                    // } as NotifyOptions);
                    self.farrisDialog.close();
                }));
            }
            else if (saveSchema && saveSchema.id) {
                this.conditionService.saveSchema(saveSchema).subscribe((/**
                 * @return {?}
                 */
                () => {
                    self.clearChanges();
                    self.notifyService['success']((/** @type {?} */ ({
                        title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.success'), timeout: 3000
                    })));
                    self.farrisDialog.close();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                (error) => {
                    self.formErrorService.exception(error.Message, error);
                    // console.log(error);
                    // self.notifyService['success']({
                    //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                    // } as NotifyOptions);
                    self.farrisDialog.close();
                }));
            }
        }
    }
    /**
     * @return {?}
     */
    clearChanges() {
        this.motifyList = [];
        this.removeList = [];
    }
    /**
     * @return {?}
     */
    handleCancelClick() {
        /** @type {?} */
        const self = this;
        if (this.motifyList.length) {
            this.motifyList.forEach((/**
             * @param {?} item
             * @return {?}
             */
            (item) => {
                if (item.type === 'delete') {
                    /** @type {?} */
                    const result = self.removeList.find((/**
                     * @param {?} el
                     * @return {?}
                     */
                    (el) => el.id === item.id));
                    if (result.schemaType === 0) {
                        self.publicList.push(item);
                    }
                    else {
                        self.personalList.push(item);
                    }
                }
                else {
                    this.publicList.forEach((/**
                     * @param {?} el
                     * @return {?}
                     */
                    (el) => {
                        el.isDefault = el.id === item.id ? 1 : 0;
                    }));
                    this.personalList.forEach((/**
                     * @param {?} el1
                     * @return {?}
                     */
                    (el1) => {
                        el1.isDefault = el1.id === item.id ? 1 : 0;
                    }));
                }
            }));
            this.removeList = [];
            this.motifyList = [];
        }
        this.farrisDialog.close();
    }
}
ConditionManagerDialogComponent.decorators = [
    { type: Component, args: [{
                selector: 'condition-manager-dialog',
                template: "<farris-dialog #farrisDialog [title]=\"localizeService.getValue('queryFramework.dialogTitle1')\" [showButtons]=\"false\"\r\n  [width]=\"550\" [showMaxButton]=\"false\" [showMinButton]=\"false\" [showCloseButton]=\"false\" [resizable]=\"false\" [height]=\"570\">\r\n  <div class=\"f-utils-absolute-all f-utils-flex-column bg-white\">\r\n    <div class=\"f-utils-fill-auto\">\r\n      <div class=\"f-utils-flex-row-wrap m-2 item-header-row\" style=\"height: 40px\">\r\n        <div class=\"col-4 pt-1 item-header-col-font item-header-col1\">\r\n          {{localizeService.getValue('queryFramework.conditionManagerListColumn')[0]}}\r\n        </div>\r\n        <div class=\"col-4 pt-1 item-header-col-font item-header-col2\">\r\n          {{localizeService.getValue('queryFramework.conditionManagerListColumn')[1]}}\r\n        </div>\r\n        <div class=\"col-4 pt-1 item-header-col-font item-header-col3\">\r\n          {{localizeService.getValue('queryFramework.conditionManagerListColumn')[2]}}\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-flex-row-wrap m-2\" (click)=\"handleExpandType(0)\">\r\n        <span *ngIf=\"expandPublic\" class=\"f-icon f-icon-minus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <span *ngIf=\"!expandPublic\" class=\"f-icon f-icon-plus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <div class=\"item-schema-type\">{{localizeService.getValue('queryFramework.schemaType.public')}}</div>\r\n      </div>\r\n      <div [class]=\"expandPublic ? 'f-utils-flex-column item-list-block' : 'f-utils-flex-column item-list-none'\">\r\n        <div *ngFor=\"let item of publicList\" [class]=\"currentSchema && currentSchema.id  && currentSchema.id === item.id ? 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row item-row-hover' : 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row'\">\r\n          <div [class]=\"item.isProtected === 1 ? 'col-4 item-data-font item-data-col1' : 'col-4 item-data-font-disable item-data-col1'\">\r\n            {{item.schemaName}}\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col2\">\r\n            <div class=\"custom-control custom-checkbox mb-0 ml-4\">\r\n              <input type=\"checkbox\" class=\"custom-control-input\" [ngModel]=\"item.isDefault === 1 ? true : false\" (ngModelChange)=\"handleNgModelChange($event, item)\" (click)=\"handleSettingDefault(item)\" [disabled]=\"item.isProtected === 1\" id=\"{{item.id}}\" checked=\"\">\r\n              <label class=\"custom-control-label\" for=\"{{item.id}}\"></label>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col3\">\r\n            <button class=\"btn btn-link p-1 mr-1\" id=\"button-delete\" [disabled]=\"item.isProtected === 1\" (click)=\"handleDeleteSchame(item)\">\r\n              <span class=\"f-icon f-icon-delete item-delete\"></span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-flex-row-wrap m-2\" (click)=\"handleExpandType(1)\">\r\n        <span *ngIf=\"expandPersonal\" class=\"f-icon f-icon-minus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <span *ngIf=\"!expandPersonal\" class=\"f-icon f-icon-plus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <div class=\"item-schema-type\">{{localizeService.getValue('queryFramework.schemaType.personal')}}</div>\r\n      </div>\r\n      <div [class]=\"expandPersonal ? 'f-utils-flex-column item-list-block' : 'f-utils-flex-column item-list-none'\">\r\n        <div *ngFor=\"let item1 of personalList\" [class]=\"currentSchema && currentSchema.id && currentSchema.id === item1.id ? 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row item-row-hover' : 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row'\">\r\n          <div [class]=\"item1.isProtected === 1 ? 'col-4 item-data-font item-data-col1' : 'col-4 item-data-font-disable item-data-col1'\">\r\n            {{item1.schemaName}}\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col2\">\r\n            <div class=\"custom-control custom-checkbox mb-0 ml-4\">\r\n              <input type=\"checkbox\" class=\"custom-control-input\" [ngModel]=\"item1.isDefault === 1 ? true : false\" (ngModelChange)=\"handleNgModelChange($event, item1)\" (click)=\"handleSettingDefault(item1)\" [disabled]=\"item1.isProtected === 1\"\r\n                id=\"{{item1.id}}\" checked=\"\">\r\n              <label class=\"custom-control-label\" for=\"{{item1.id}}\"></label>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col3\">\r\n            <button class=\"btn btn-link p-1 mr-1\" id=\"button-delete\" [disabled]=\"item1.isProtected === 1\" (click)=\"handleDeleteSchame(item1)\">\r\n              <span class=\"f-icon f-icon-delete item-delete\"></span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n      <div class=\"btn-toolbar btn-group-lg\" id=\"page-header-toolbar\">\r\n        <button class=\"btn btn-primary mr-1\" id=\"button-edit\" (click)=\"handleOKClick()\">\r\n          {{localizeService.getValue('queryFramework.btnOk')}}</button>\r\n        <button class=\"btn btn-secondary mr-1\" id=\"button-edit\" (click)=\"handleCancelClick()\">\r\n          {{localizeService.getValue('queryFramework.btnCancel')}}</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n",
                styles: [".item-header-row{border-bottom:1px solid #e2e8f0}.item-row{height:40px}.item-header-col-font{font-family:PingFangSC-Regular;font-size:14px;color:#000}.item-header-col1{text-align:left}.item-header-col2{text-align:center}.item-header-col3{text-align:right}.item-schema-type{font-family:PingFangSC-Regular;font-size:14px;color:#000;line-height:20px;display:block;top:-2px;position:relative}.item-row-current{background:#ddf4ff;border-left:3px solid #388fff!important}.item-data-font-disable{font-family:PingFangSC-Regular;font-size:14px;color:rgba(166,166,166,.8);line-height:20px;position:relative;top:-2px;padding-top:.75rem!important}.item-data-font{font-family:PingFangSC-Regular;font-size:14px;color:rgba(0,0,0,.8);line-height:20px;position:relative;top:-2px;padding-top:.75rem!important}.item-data-col1,.item-data-col2{text-align:center}.item-data-col3{text-align:right;padding-right:1.25rem!important}.item-row-hover,.item-row:hover{background:#ddf4ff;border-left:3px solid #388fff!important}.item-list-block{display:block!important}.item-list-none{display:none!important}.item-delete{position:relative;top:-3px}"]
            }] }
];
/** @nocollapse */
ConditionManagerDialogComponent.ctorParameters = () => [
    { type: Injector },
    { type: MessagerService },
    { type: ConditionSchemaService },
    { type: NotifyService }
];
ConditionManagerDialogComponent.propDecorators = {
    farrisDialog: [{ type: ViewChild, args: ['farrisDialog',] }],
    currentSchema: [{ type: Input }],
    queryId: [{ type: Input }],
    publicList: [{ type: Input }],
    personalList: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.farrisDialog;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.currentSchema;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.localizeService;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.expandPublic;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.expandPersonal;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.queryId;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.publicList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.personalList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.removeList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.motifyList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.removeListEvent;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.formErrorService;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.conditionService;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.notifyService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZGl0aW9uLW1hbmFnZXItZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvcXVlcnktZnJhbWV3b3JrLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudC9jb25kaXRpb24tbWFuYWdlci1kaWFsb2cvY29uZGl0aW9uLW1hbmFnZXItZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFDeEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxhQUFhLEVBQWlCLE1BQU0sbUJBQW1CLENBQUM7QUFDakUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQU81RCxNQUFNLE9BQU8sK0JBQStCOzs7Ozs7O0lBYzFDLFlBQ1UsUUFBa0IsRUFDbEIsVUFBMkIsRUFDM0IsZ0JBQXdDLEVBQ3hDLGFBQTRCO1FBSDVCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFDM0IscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF3QjtRQUN4QyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQWR0QyxpQkFBWSxHQUFHLElBQUksQ0FBQztRQUNwQixtQkFBYyxHQUFHLElBQUksQ0FBQztRQUViLGVBQVUsR0FBRyxFQUFFLENBQUM7UUFDaEIsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFDM0Is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LENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM3QyxDQUFDLEVBQUMsQ0FBQztpQkFDSjtZQUNILENBQUMsRUFBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7WUFDckIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7U0FDdEI7UUFDRCxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzVCLENBQUM7OztZQXpMRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLDBCQUEwQjtnQkFDcEMsdzVLQUF3RDs7YUFFekQ7Ozs7WUFic0MsUUFBUTtZQUl0QyxlQUFlO1lBRGYsc0JBQXNCO1lBRXRCLGFBQWE7OzsyQkFVbkIsU0FBUyxTQUFDLGNBQWM7NEJBQ3hCLEtBQUs7c0JBSUwsS0FBSzt5QkFDTCxLQUFLOzJCQUNMLEtBQUs7Ozs7SUFQTix1REFBeUQ7O0lBQ3pELHdEQUE0Qjs7SUFDNUIsMERBQXFCOztJQUNyQix1REFBb0I7O0lBQ3BCLHlEQUFzQjs7SUFDdEIsa0RBQXNCOztJQUN0QixxREFBeUI7O0lBQ3pCLHVEQUEyQjs7SUFDM0IscURBQWdCOztJQUNoQixxREFBZ0I7O0lBQ2hCLDBEQUFxQzs7SUFDckMsMkRBQXNCOzs7OztJQUdwQixtREFBMEI7Ozs7O0lBQzFCLHFEQUFtQzs7Ozs7SUFDbkMsMkRBQWdEOzs7OztJQUNoRCx3REFBb0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBJbmplY3RvciwgSW5wdXQsIFNpbXBsZUNoYW5nZXMsIE9uQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEaWFsb2dDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRpYWxvZyc7XHJcbmltcG9ydCB7IExvY2FsaXplU2VydmljZSB9IGZyb20gJ0BxZHAvbG9jYWxpemUnO1xyXG5pbXBvcnQgeyBDb25kaXRpb25TY2hlbWFTZXJ2aWNlIH0gZnJvbSAnQHFkcC9jb25kaXRpb24tc2NoZW1hJztcclxuaW1wb3J0IHsgTWVzc2FnZXJTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy91aS1tZXNzYWdlcic7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UsIE5vdGlmeU9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgRm9ybUVycm9yU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvY29tbWFuZC1zZXJ2aWNlcyc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2NvbmRpdGlvbi1tYW5hZ2VyLWRpYWxvZycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbmRpdGlvbi1tYW5hZ2VyLWRpYWxvZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vY29uZGl0aW9uLW1hbmFnZXItZGlhbG9nLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ29uZGl0aW9uTWFuYWdlckRpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzIHtcclxuICBAVmlld0NoaWxkKCdmYXJyaXNEaWFsb2cnKSBmYXJyaXNEaWFsb2c6IERpYWxvZ0NvbXBvbmVudDtcclxuICBASW5wdXQoKSBjdXJyZW50U2NoZW1hOiBhbnk7XHJcbiAgbG9jYWxpemVTZXJ2aWNlOiBhbnk7XHJcbiAgZXhwYW5kUHVibGljID0gdHJ1ZTtcclxuICBleHBhbmRQZXJzb25hbCA9IHRydWU7XHJcbiAgQElucHV0KCkgcXVlcnlJZDogYW55O1xyXG4gIEBJbnB1dCgpIHB1YmxpY0xpc3QgPSBbXTtcclxuICBASW5wdXQoKSBwZXJzb25hbExpc3QgPSBbXTtcclxuICByZW1vdmVMaXN0ID0gW107XHJcbiAgbW90aWZ5TGlzdCA9IFtdO1xyXG4gIHJlbW92ZUxpc3RFdmVudCA9IG5ldyBTdWJqZWN0PGFueT4oKTtcclxuICBmb3JtRXJyb3JTZXJ2aWNlOiBhbnk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXHJcbiAgICBwcml2YXRlIG1zZ1NlcnZpY2U6IE1lc3NhZ2VyU2VydmljZSxcclxuICAgIHByaXZhdGUgY29uZGl0aW9uU2VydmljZTogQ29uZGl0aW9uU2NoZW1hU2VydmljZSxcclxuICAgIHByaXZhdGUgbm90aWZ5U2VydmljZTogTm90aWZ5U2VydmljZVxyXG4gICkge1xyXG4gICAgaWYgKHRoaXMuaW5qZWN0b3IpIHtcclxuICAgICAgdGhpcy5sb2NhbGl6ZVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChMb2NhbGl6ZVNlcnZpY2UpO1xyXG4gICAgICB0aGlzLmZvcm1FcnJvclNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChGb3JtRXJyb3JTZXJ2aWNlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlRGlhbG9nU2hvdygpIHtcclxuICAgIHRoaXMuZmFycmlzRGlhbG9nLnNob3coKTtcclxuICB9XHJcblxyXG4gIGhhbmRsZUV4cGFuZFR5cGUoJGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMuZXhwYW5kUHVibGljID0gJGV2ZW50ID09PSAwID8gIXRoaXMuZXhwYW5kUHVibGljIDogdGhpcy5leHBhbmRQdWJsaWM7XHJcbiAgICB0aGlzLmV4cGFuZFBlcnNvbmFsID0gJGV2ZW50ID09PSAxID8gIXRoaXMuZXhwYW5kUGVyc29uYWwgOiB0aGlzLmV4cGFuZFBlcnNvbmFsO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlTmdNb2RlbENoYW5nZShjaGFuZ2U6IGFueSwgaXRlbTogYW55KSB7XHJcbiAgICBpdGVtLmlzRGVmYXVsdCA9IGNoYW5nZSA/IDEgOiAwO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlRGVsZXRlU2NoYW1lKCRldmVudDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5yZW1vdmVMaXN0LmZpbmRJbmRleCgoaXRlbTogYW55KSA9PiBpdGVtLmlkID09PSAkZXZlbnQuaWQpIDwgMCkge1xyXG4gICAgICB0aGlzLnJlbW92ZUxpc3QucHVzaCgkZXZlbnQpO1xyXG4gICAgICB0aGlzLm1vdGlmeUxpc3QucHVzaCh7IHR5cGU6ICdkZWxldGUnLCBpZDogJGV2ZW50LmlkIH0pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaW5kZXggPSAkZXZlbnQuc2NoZW1hVHlwZSA9PT0gMFxyXG4gICAgICA/IHRoaXMucHVibGljTGlzdC5maW5kSW5kZXgoKGl0ZW06IGFueSkgPT4gaXRlbS5pZCA9PT0gJGV2ZW50LmlkKVxyXG4gICAgICA6IHRoaXMucGVyc29uYWxMaXN0LmZpbmRJbmRleCgoaXRlbTogYW55KSA9PiBpdGVtLmlkID09PSAkZXZlbnQuaWQpO1xyXG4gICAgaWYgKCRldmVudC5zY2hlbWFUeXBlID09PSAwKSB7XHJcbiAgICAgIHRoaXMucHVibGljTGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5wZXJzb25hbExpc3Quc3BsaWNlKGluZGV4LCAxKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZVNldHRpbmdEZWZhdWx0KCRldmVudDogYW55KSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIHRoaXMucHVibGljTGlzdC5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgaXRlbS5pc0RlZmF1bHQgPSBpdGVtLmlkID09PSAkZXZlbnQuaWQgPyAxIDogMDtcclxuICAgICAgaWYgKGl0ZW0uaWQgPT09ICRldmVudC5pZCkge1xyXG4gICAgICAgIHNlbGYubW90aWZ5TGlzdC5wdXNoKHsgdHlwZTogJ2VkaXQnLCBpZDogJGV2ZW50LmlkIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIHRoaXMucGVyc29uYWxMaXN0LmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICBpdGVtLmlzRGVmYXVsdCA9IGl0ZW0uaWQgPT09ICRldmVudC5pZCA/IDEgOiAwO1xyXG4gICAgICBpZiAoaXRlbS5pZCA9PT0gJGV2ZW50LmlkKSB7XHJcbiAgICAgICAgc2VsZi5tb3RpZnlMaXN0LnB1c2goeyB0eXBlOiAnZWRpdCcsIGlkOiAkZXZlbnQuaWQgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlT0tDbGljaygpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKHRoaXMubW90aWZ5TGlzdC5sZW5ndGgpIHtcclxuICAgICAgY29uc3QgZGVsZXRlU2NoZW1hcyA9IFtdO1xyXG4gICAgICBsZXQgc2F2ZVNjaGVtYTogYW55O1xyXG4gICAgICB0aGlzLm1vdGlmeUxpc3QuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gJ2RlbGV0ZScpIHtcclxuICAgICAgICAgIGRlbGV0ZVNjaGVtYXMucHVzaChpdGVtLmlkKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc2F2ZVNjaGVtYSA9IHNlbGYucHVibGljTGlzdC5maW5kKChlbDogYW55KSA9PiBlbC5pZCA9PT0gaXRlbS5pZCk7XHJcbiAgICAgICAgICBpZiAoIXNhdmVTY2hlbWEgfHwgIXNhdmVTY2hlbWEuaWQpIHtcclxuICAgICAgICAgICAgc2F2ZVNjaGVtYSA9IHNlbGYucGVyc29uYWxMaXN0LmZpbmQoKGVsOiBhbnkpID0+IGVsLmlkID09PSBpdGVtLmlkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAoc2F2ZVNjaGVtYSAmJiBzYXZlU2NoZW1hLnNjaGVtYVZhbHVlKSB7XHJcbiAgICAgICAgc2F2ZVNjaGVtYS5zY2hlbWFWYWx1ZSA9IHNhdmVTY2hlbWEgJiYgc2F2ZVNjaGVtYS5zY2hlbWFWYWx1ZSA/IEpTT04uc3RyaW5naWZ5KHNhdmVTY2hlbWEuc2NoZW1hVmFsdWUpIDogbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBpZiAoZGVsZXRlU2NoZW1hcy5sZW5ndGggJiYgc2F2ZVNjaGVtYSAmJiBzYXZlU2NoZW1hLmlkKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25TZXJ2aWNlLmRlbGV0ZVNjaGVtYUxpc3QoZGVsZXRlU2NoZW1hcy5qb2luKCcsJyksIHNlbGYucXVlcnlJZCkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuY29uZGl0aW9uU2VydmljZS5zYXZlU2NoZW1hKHNhdmVTY2hlbWEpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgIHNlbGYuY2xlYXJDaGFuZ2VzKCk7XHJcbiAgICAgICAgICAgIHNlbGYubm90aWZ5U2VydmljZVsnc3VjY2VzcyddKHtcclxuICAgICAgICAgICAgICB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2UuaW5mby50aXRsZScpLCBtc2c6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLm9wZXJhdGUuc3VjY2VzcycpLCB0aW1lb3V0OiAzMDAwXHJcbiAgICAgICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHNlbGYuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgICB9LCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKGVycm9yLk1lc3NhZ2UsIGVycm9yKTtcclxuICAgICAgICAgICAgLy8gc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgICAvLyAgIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5pbmZvLnRpdGxlJyksIG1zZzogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2Uub3BlcmF0ZS5lcnJvcicpLCB0aW1lb3V0OiAzMDAwXHJcbiAgICAgICAgICAgIC8vIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHNlbGYuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9LCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgICAvLyBzZWxmLm5vdGlmeVNlcnZpY2VbJ3N1Y2Nlc3MnXSh7XHJcbiAgICAgICAgICAvLyAgIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5pbmZvLnRpdGxlJyksIG1zZzogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2Uub3BlcmF0ZS5lcnJvcicpLCB0aW1lb3V0OiAzMDAwXHJcbiAgICAgICAgICAvLyB9IGFzIE5vdGlmeU9wdGlvbnMpO1xyXG4gICAgICAgICAgc2VsZi5mYXJyaXNEaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmIChkZWxldGVTY2hlbWFzLmxlbmd0aCkge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9uU2VydmljZS5kZWxldGVTY2hlbWFMaXN0KGRlbGV0ZVNjaGVtYXMuam9pbignLCcpLCBzZWxmLnF1ZXJ5SWQpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICBzZWxmLmNsZWFyQ2hhbmdlcygpO1xyXG4gICAgICAgICAgc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgICB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2UuaW5mby50aXRsZScpLCBtc2c6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLm9wZXJhdGUuc3VjY2VzcycpLCB0aW1lb3V0OiAzMDAwXHJcbiAgICAgICAgICB9IGFzIE5vdGlmeU9wdGlvbnMpO1xyXG4gICAgICAgICAgc2VsZi5mYXJyaXNEaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9LCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgICAvLyBzZWxmLm5vdGlmeVNlcnZpY2VbJ3N1Y2Nlc3MnXSh7XHJcbiAgICAgICAgICAvLyAgIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5pbmZvLnRpdGxlJyksIG1zZzogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2Uub3BlcmF0ZS5lcnJvcicpLCB0aW1lb3V0OiAzMDAwXHJcbiAgICAgICAgICAvLyB9IGFzIE5vdGlmeU9wdGlvbnMpO1xyXG4gICAgICAgICAgc2VsZi5mYXJyaXNEaWFsb2cuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmIChzYXZlU2NoZW1hICYmIHNhdmVTY2hlbWEuaWQpIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvblNlcnZpY2Uuc2F2ZVNjaGVtYShzYXZlU2NoZW1hKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgc2VsZi5jbGVhckNoYW5nZXMoKTtcclxuICAgICAgICAgIHNlbGYubm90aWZ5U2VydmljZVsnc3VjY2VzcyddKHtcclxuICAgICAgICAgICAgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmluZm8udGl0bGUnKSwgbXNnOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5vcGVyYXRlLnN1Y2Nlc3MnKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgfSBhcyBOb3RpZnlPcHRpb25zKTtcclxuICAgICAgICAgIHNlbGYuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgIHNlbGYuZm9ybUVycm9yU2VydmljZS5leGNlcHRpb24oZXJyb3IuTWVzc2FnZSwgZXJyb3IpO1xyXG4gICAgICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgLy8gc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgLy8gICB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2UuaW5mby50aXRsZScpLCBtc2c6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLm9wZXJhdGUuZXJyb3InKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgLy8gfSBhcyBOb3RpZnlPcHRpb25zKTtcclxuICAgICAgICAgIHNlbGYuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsZWFyQ2hhbmdlcygpIHtcclxuICAgIHRoaXMubW90aWZ5TGlzdCA9IFtdO1xyXG4gICAgdGhpcy5yZW1vdmVMaXN0ID0gW107XHJcbiAgfVxyXG5cclxuICBoYW5kbGVDYW5jZWxDbGljaygpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgaWYgKHRoaXMubW90aWZ5TGlzdC5sZW5ndGgpIHtcclxuICAgICAgdGhpcy5tb3RpZnlMaXN0LmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICdkZWxldGUnKSB7XHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBzZWxmLnJlbW92ZUxpc3QuZmluZCgoZWw6IGFueSkgPT4gZWwuaWQgPT09IGl0ZW0uaWQpO1xyXG4gICAgICAgICAgaWYgKHJlc3VsdC5zY2hlbWFUeXBlID09PSAwKSB7XHJcbiAgICAgICAgICAgIHNlbGYucHVibGljTGlzdC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VsZi5wZXJzb25hbExpc3QucHVzaChpdGVtKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5wdWJsaWNMaXN0LmZvckVhY2goKGVsOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgZWwuaXNEZWZhdWx0ID0gZWwuaWQgPT09IGl0ZW0uaWQgPyAxIDogMDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy5wZXJzb25hbExpc3QuZm9yRWFjaCgoZWwxOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgZWwxLmlzRGVmYXVsdCA9IGVsMS5pZCA9PT0gaXRlbS5pZCA/IDEgOiAwO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5yZW1vdmVMaXN0ID0gW107XHJcbiAgICAgIHRoaXMubW90aWZ5TGlzdCA9IFtdO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mYXJyaXNEaWFsb2cuY2xvc2UoKTtcclxuICB9XHJcbn1cclxuIl19
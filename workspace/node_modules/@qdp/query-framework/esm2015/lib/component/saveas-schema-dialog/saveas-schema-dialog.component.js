/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Injector, LOCALE_ID, Input } from '@angular/core';
import { DialogComponent } from '@farris/ui-dialog';
import { LocalizeService, DEFAULT_LANGUAGE } from '@qdp/localize';
import { EventBus } from '@qdp/common';
import { ConditionSchemaService } from '@qdp/condition-schema';
import { MessagerService } from '@farris/ui-messager';
import { NotifyService } from '@farris/ui-notify';
import { Repository } from '@farris/devkit';
import { FormErrorService } from '@farris/command-services';
export class SaveasSchemaDialogComponent {
    /**
     * @param {?} injector
     * @param {?} msgService
     * @param {?} conditionService
     * @param {?} notifyService
     */
    constructor(injector, msgService, conditionService, notifyService) {
        this.injector = injector;
        this.msgService = msgService;
        this.conditionService = conditionService;
        this.notifyService = notifyService;
        this.formInline = true;
        this.conditionSchemaName = 'conditionSchemaName' + EventBus.guid();
        this.schemaName = '';
        this.isDefault = false;
        this.isSchemaType = 0;
        this.publicSchema = 'publicSchema' + EventBus.guid();
        this.personSchema = 'personSchema' + EventBus.guid();
        this.defaultSchema = 'defaultSchema' + EventBus.guid();
        if (this.injector) {
            this.localizeService = this.injector.get(LocalizeService);
            this.localId = this.injector.get(LOCALE_ID) || DEFAULT_LANGUAGE;
            this.formInline = this.localId.toLowerCase() === DEFAULT_LANGUAGE;
            this.repository = this.injector.get(Repository);
            this.formErrorService = this.injector.get(FormErrorService);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        /** @type {?} */
        const self = this;
        for (const changeName in changes) {
            /** @type {?} */
            const newValue = changes[changeName].currentValue;
            if (newValue !== null && newValue !== void 0) {
                switch (changeName) {
                    case 'currentSchema':
                        break;
                }
            }
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
    }
    /**
     * @return {?}
     */
    handleDialogShow() {
        this.farrisDialog.show();
    }
    /**
     * @return {?}
     */
    handleOKClick() {
        /** @type {?} */
        const self = this;
        /** @type {?} */
        const data = this.conditionService.schemaList;
        if (!this.schemaName) {
            this.msgService.warning(this.localizeService.getValue('queryFramework.message.validate.notNull'));
            return;
        }
        if (this.schemaName && this.schemaName.length > 15) {
            this.msgService.warning(this.localizeService.getValue('queryFramework.message.lengthValidate'));
            return;
        }
        if (data && data[this.queryId]) {
            for (const key in data[self.queryId]) {
                if (data[self.queryId][key].schemaName === self.schemaName) {
                    this.msgService.warning(this.localizeService.getValue('queryFramework.message.saveas'));
                    return;
                }
            }
        }
        /** @type {?} */
        const params = this.handlerGetEntity();
        if (this.currentSchema && this.currentSchema.id) {
            for (const key in data[self.queryId]) {
                if (data[self.queryId][key].schemaName === self.schemaName) {
                    this.msgService.warning(this.localizeService.getValue('queryFramework.message.saveas'));
                    return;
                }
            }
            /** @type {?} */
            const newValue = JSON.parse(JSON.stringify(this.currentSchema));
            newValue.schemaValue = params;
            newValue.id = '';
            newValue.queryId = self.queryId;
            if (this.filterInstance) {
                if (!newValue.schemaValue) {
                    newValue.schemaValue = {};
                }
                newValue.schemaValue['@filterExpressionString@'] = this.filterInstance.getFilterExpression();
            }
            newValue.schemaValue = newValue.schemaValue ? JSON.stringify(newValue.schemaValue) : null;
            newValue.schemaName = self.schemaName;
            newValue.isDefault = self.isDefault ? 1 : 0;
            newValue.schemaType = self.isSchemaType;
            this.conditionService.saveSchema(newValue).subscribe((/**
             * @return {?}
             */
            () => {
                self.notifyService['success']((/** @type {?} */ ({
                    title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.save.success'), timeout: 3000
                })));
                self.farrisDialog.close();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                self.formErrorService.exception(error.Message, error);
            }));
        }
        else {
            /** @type {?} */
            const newValue = {
                schemaName: self.schemaName,
                schemaType: self.isSchemaType,
                schemaValue: null,
                isDefault: self.isDefault ? 1 : 0,
                isProtected: 0,
                queryId: self.queryId
            };
            newValue.schemaValue = params;
            if (this.filterInstance) {
                if (!newValue.schemaValue) {
                    newValue.schemaValue = {};
                }
                newValue.schemaValue['@filterExpressionString@'] = this.filterInstance.getFilterExpression();
            }
            newValue.schemaValue = newValue.schemaValue ? JSON.stringify(newValue.schemaValue) : null;
            this.conditionService.saveSchema(newValue).subscribe((/**
             * @return {?}
             */
            () => {
                self.notifyService['success']((/** @type {?} */ ({
                    title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.save.success'), timeout: 3000
                })));
                self.farrisDialog.close();
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                self.formErrorService.exception(error.Message, error);
            }));
        }
    }
    /**
     * @return {?}
     */
    handleCancelClick() {
        this.schemaName = '';
        this.isDefault = false;
        this.isSchemaType = 0;
        this.farrisDialog.close();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    handleSchemaTypeSelect(value) {
        this.isSchemaType = value;
    }
    /**
     * @return {?}
     */
    handlerGetEntity() {
        /** @type {?} */
        const entitys = this.repository.entityCollection.getAllEntities();
        /** @type {?} */
        let params;
        if (entitys && entitys.length) {
            params = entitys[0].toJSON();
        }
        return params;
    }
}
SaveasSchemaDialogComponent.decorators = [
    { type: Component, args: [{
                selector: 'saveas-schema-dialog',
                template: "<farris-dialog #farrisDialog [title]=\"localizeService.getValue('queryFramework.dialogTitle2')\" [showButtons]=\"false\"\r\n  [width]=\"509\" [showMaxButton]=\"false\" [showCloseButton]=\"false\" [showMinButton]=\"false\" [resizable]=\"false\" [height]=\"285\">\r\n  <div class=\"f-utils-absolute-all f-utils-flex-column bg-white\">\r\n    <div class=\"f-utils-fill-flex-column\">\r\n      <div class=\"f-utils-flex-row pt-2\">\r\n        <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n          <div class=\"form-group farris-form-group\">\r\n            <label class=\"col-form-label\" for=\"colName\">\r\n              <span class=\"farris-label-info text-danger\">*</span>\r\n              <span class=\"farris-label-text\">{{localizeService.getValue('queryFramework.schemaName')}}:</span>\r\n            </label>\r\n            <div class=\"farris-input-wrap\">\r\n              <input-group id=\"colName\" [(ngModel)]=\"schemaName\"></input-group>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- <div class=\"f-utils-flex-row\">\r\n        <div class=\"farris-group-wrap form-inline farris-form-inline\">\r\n          <div class=\"form-group farris-form-group\">\r\n            <label class=\"col-form-label\" for=\"colVisible\">\r\n              <span class=\"farris-label-text\"></span>\r\n            </label>\r\n            <div class=\"farris-input-wrap farris-checkradio-hor\">\r\n              <div class=\"custom-control custom-checkbox mb-0\">\r\n                <input type=\"checkbox\" [(ngModel)]=\"isDefault\" class=\"custom-control-input\" id=\"{{conditionSchemaName}}\"\r\n                  checked=\"\">\r\n                <label class=\"custom-control-label\"\r\n                  for=\"{{conditionSchemaName}}\">{{localizeService.getValue('queryFramework.defaultSchemaName')}}</label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div> -->\r\n      <div class=\"f-utils-flex-row pt-2\">\r\n        <div class=\"farris-group-wrap form-inline farris-form-inline m-1\">\r\n          <div class=\"form-group farris-group-wrap\">\r\n            <label class=\"col-form-label\" style=\"min-width: 0;\" for=\"range_type_id\">\r\n              <span class=\"farris-label-text\">{{localizeService.getValue('ideCmp.schemaManager.schemeType')}}:</span>\r\n            </label>\r\n            <div class=\"farris-input-wrap farris-checkradio-hor\">\r\n              <div class=\"custom-control custom-radio mb-0\">\r\n                <input type=\"radio\" id=\"{{publicSchema}}\" name=\"custom-radio1\" class=\"custom-control-input\"\r\n                  [checked]=\"isSchemaType==0\">\r\n                <label class=\"custom-control-label\" for=\"{{publicSchema}}\"\r\n                  (click)=\"handleSchemaTypeSelect(0)\">{{localizeService.getValue('ideCmp.schemaManager.schemeTypePublic')}}</label>\r\n              </div>\r\n              <div class=\"custom-control custom-radio mb-0\">\r\n                <input type=\"radio\" id=\"{{personSchema}}\" name=\"custom-radio1\" class=\"custom-control-input\"\r\n                  [checked]=\"isSchemaType==1\">\r\n                <label class=\"custom-control-label\" for=\"{{personSchema}}\"\r\n                  (click)=\"handleSchemaTypeSelect(1)\">{{localizeService.getValue('ideCmp.schemaManager.schemeTypePersonal')}}</label>\r\n              </div>\r\n              <div class=\"custom-control custom-checkbox mb-0\">\r\n                <input type=\"checkbox\" class=\"custom-control-input\" id=\"{{defaultSchema}}\"\r\n                  [(ngModel)]=\"isDefault\">\r\n                <label class=\"custom-control-label\"\r\n                  for=\"{{defaultSchema}}\">{{localizeService.getValue('ideCmp.schemaManager.schemeDefault')}}</label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n      <div class=\"btn-toolbar btn-group-lg\" id=\"page-header-toolbar\">\r\n        <button class=\"btn btn-primary mr-1\" id=\"button-edit\" (click)=\"handleOKClick()\">\r\n          {{localizeService.getValue('queryFramework.btnOk')}}</button>\r\n        <button class=\"btn btn-secondary mr-1\" id=\"button-edit\" (click)=\"handleCancelClick()\">\r\n          {{localizeService.getValue('queryFramework.btnCancel')}}</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n",
                styles: [""]
            }] }
];
/** @nocollapse */
SaveasSchemaDialogComponent.ctorParameters = () => [
    { type: Injector },
    { type: MessagerService },
    { type: ConditionSchemaService },
    { type: NotifyService }
];
SaveasSchemaDialogComponent.propDecorators = {
    currentSchema: [{ type: Input }],
    queryId: [{ type: Input }],
    farrisDialog: [{ type: ViewChild, args: ['farrisDialog',] }]
};
if (false) {
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.currentSchema;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.queryId;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.farrisDialog;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.localizeService;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.formInline;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.localId;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.conditionSchemaName;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.schemaName;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.isDefault;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.isSchemaType;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.publicSchema;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.personSchema;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.defaultSchema;
    /**
     * @type {?}
     * @private
     */
    SaveasSchemaDialogComponent.prototype.repository;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.formErrorService;
    /** @type {?} */
    SaveasSchemaDialogComponent.prototype.filterInstance;
    /**
     * @type {?}
     * @private
     */
    SaveasSchemaDialogComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    SaveasSchemaDialogComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    SaveasSchemaDialogComponent.prototype.conditionService;
    /**
     * @type {?}
     * @private
     */
    SaveasSchemaDialogComponent.prototype.notifyService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2F2ZWFzLXNjaGVtYS1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHFkcC9xdWVyeS1mcmFtZXdvcmsvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50L3NhdmVhcy1zY2hlbWEtZGlhbG9nL3NhdmVhcy1zY2hlbWEtZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBNEIsS0FBSyxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQzlILE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDdkMsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxhQUFhLEVBQWlCLE1BQU0sbUJBQW1CLENBQUM7QUFDakUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBTzVELE1BQU0sT0FBTywyQkFBMkI7Ozs7Ozs7SUFrQnRDLFlBQ1UsUUFBa0IsRUFDbEIsVUFBMkIsRUFDM0IsZ0JBQXdDLEVBQ3hDLGFBQTRCO1FBSDVCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDbEIsZUFBVSxHQUFWLFVBQVUsQ0FBaUI7UUFDM0IscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF3QjtRQUN4QyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQWpCdEMsZUFBVSxHQUFHLElBQUksQ0FBQztRQUVsQix3QkFBbUIsR0FBRyxxQkFBcUIsR0FBRyxR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QUFDLEtBQUssRUFBRSxDQUFDO0lBQzVCLENBQUM7Ozs7O0lBRUQsc0JBQXNCLENBQUMsS0FBVTtRQUMvQixJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztJQUM1QixDQUFDOzs7O0lBRUQsZ0JBQWdCOztjQUNSLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsRUFBRTs7WUFDN0QsTUFBTTtRQUNWLElBQUksT0FBTyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDN0IsTUFBTSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUM5QjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7OztZQXhKRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHNCQUFzQjtnQkFDaEMsMjRJQUFvRDs7YUFFckQ7Ozs7WUFkc0MsUUFBUTtZQUt0QyxlQUFlO1lBRGYsc0JBQXNCO1lBRXRCLGFBQWE7Ozs0QkFVbkIsS0FBSztzQkFDTCxLQUFLOzJCQUNMLFNBQVMsU0FBQyxjQUFjOzs7O0lBRnpCLG9EQUE0Qjs7SUFDNUIsOENBQXNCOztJQUN0QixtREFBeUQ7O0lBQ3pELHNEQUFxQjs7SUFDckIsaURBQWtCOztJQUNsQiw4Q0FBYTs7SUFDYiwwREFBOEQ7O0lBQzlELGlEQUFxQjs7SUFDckIsZ0RBQWtCOztJQUNsQixtREFBaUI7O0lBQ2pCLG1EQUFnRDs7SUFDaEQsbURBQWdEOztJQUNoRCxvREFBa0Q7Ozs7O0lBQ2xELGlEQUF3Qjs7SUFDeEIsdURBQXNCOztJQUN0QixxREFBb0I7Ozs7O0lBR2xCLCtDQUEwQjs7Ozs7SUFDMUIsaURBQW1DOzs7OztJQUNuQyx1REFBZ0Q7Ozs7O0lBQ2hELG9EQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGQsIEluamVjdG9yLCBMT0NBTEVfSUQsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgSW5wdXQsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEaWFsb2dDb21wb25lbnQgfSBmcm9tICdAZmFycmlzL3VpLWRpYWxvZyc7XHJcbmltcG9ydCB7IExvY2FsaXplU2VydmljZSwgREVGQVVMVF9MQU5HVUFHRSB9IGZyb20gJ0BxZHAvbG9jYWxpemUnO1xyXG5pbXBvcnQgeyBFdmVudEJ1cyB9IGZyb20gJ0BxZHAvY29tbW9uJztcclxuaW1wb3J0IHsgQ29uZGl0aW9uU2NoZW1hU2VydmljZSB9IGZyb20gJ0BxZHAvY29uZGl0aW9uLXNjaGVtYSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlLCBOb3RpZnlPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBGb3JtRXJyb3JTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnc2F2ZWFzLXNjaGVtYS1kaWFsb2cnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zYXZlYXMtc2NoZW1hLWRpYWxvZy5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2F2ZWFzLXNjaGVtYS1kaWFsb2cuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTYXZlYXNTY2hlbWFEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcclxuICBASW5wdXQoKSBjdXJyZW50U2NoZW1hOiBhbnk7XHJcbiAgQElucHV0KCkgcXVlcnlJZDogYW55O1xyXG4gIEBWaWV3Q2hpbGQoJ2ZhcnJpc0RpYWxvZycpIGZhcnJpc0RpYWxvZzogRGlhbG9nQ29tcG9uZW50O1xyXG4gIGxvY2FsaXplU2VydmljZTogYW55O1xyXG4gIGZvcm1JbmxpbmUgPSB0cnVlO1xyXG4gIGxvY2FsSWQ6IGFueTtcclxuICBjb25kaXRpb25TY2hlbWFOYW1lID0gJ2NvbmRpdGlvblNjaGVtYU5hbWUnICsgRXZlbnRCdXMuZ3VpZCgpO1xyXG4gIHNjaGVtYU5hbWU6IGFueSA9ICcnO1xyXG4gIGlzRGVmYXVsdCA9IGZhbHNlO1xyXG4gIGlzU2NoZW1hVHlwZSA9IDA7XHJcbiAgcHVibGljU2NoZW1hID0gJ3B1YmxpY1NjaGVtYScgKyBFdmVudEJ1cy5ndWlkKCk7XHJcbiAgcGVyc29uU2NoZW1hID0gJ3BlcnNvblNjaGVtYScgKyBFdmVudEJ1cy5ndWlkKCk7XHJcbiAgZGVmYXVsdFNjaGVtYSA9ICdkZWZhdWx0U2NoZW1hJyArIEV2ZW50QnVzLmd1aWQoKTtcclxuICBwcml2YXRlIHJlcG9zaXRvcnk6IGFueTtcclxuICBmb3JtRXJyb3JTZXJ2aWNlOiBhbnk7XHJcbiAgZmlsdGVySW5zdGFuY2U6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvcixcclxuICAgIHByaXZhdGUgbXNnU2VydmljZTogTWVzc2FnZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBjb25kaXRpb25TZXJ2aWNlOiBDb25kaXRpb25TY2hlbWFTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBub3RpZnlTZXJ2aWNlOiBOb3RpZnlTZXJ2aWNlKSB7XHJcbiAgICBpZiAodGhpcy5pbmplY3Rvcikge1xyXG4gICAgICB0aGlzLmxvY2FsaXplU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KExvY2FsaXplU2VydmljZSk7XHJcbiAgICAgIHRoaXMubG9jYWxJZCA9IHRoaXMuaW5qZWN0b3IuZ2V0KExPQ0FMRV9JRCkgfHwgREVGQVVMVF9MQU5HVUFHRTtcclxuICAgICAgdGhpcy5mb3JtSW5saW5lID0gdGhpcy5sb2NhbElkLnRvTG93ZXJDYXNlKCkgPT09IERFRkFVTFRfTEFOR1VBR0U7XHJcbiAgICAgIHRoaXMucmVwb3NpdG9yeSA9IHRoaXMuaW5qZWN0b3IuZ2V0KFJlcG9zaXRvcnkpO1xyXG4gICAgICB0aGlzLmZvcm1FcnJvclNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChGb3JtRXJyb3JTZXJ2aWNlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBmb3IgKGNvbnN0IGNoYW5nZU5hbWUgaW4gY2hhbmdlcykge1xyXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IGNoYW5nZXNbY2hhbmdlTmFtZV0uY3VycmVudFZhbHVlO1xyXG4gICAgICBpZiAobmV3VmFsdWUgIT09IG51bGwgJiYgbmV3VmFsdWUgIT09IHZvaWQgMCkge1xyXG4gICAgICAgIHN3aXRjaCAoY2hhbmdlTmFtZSkge1xyXG4gICAgICAgICAgY2FzZSAnY3VycmVudFNjaGVtYSc6XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKSB7XHJcblxyXG4gIH1cclxuXHJcbiAgaGFuZGxlRGlhbG9nU2hvdygpIHtcclxuICAgIHRoaXMuZmFycmlzRGlhbG9nLnNob3coKTtcclxuICB9XHJcblxyXG4gIGhhbmRsZU9LQ2xpY2soKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmNvbmRpdGlvblNlcnZpY2Uuc2NoZW1hTGlzdDtcclxuICAgIGlmICghdGhpcy5zY2hlbWFOYW1lKSB7XHJcbiAgICAgIHRoaXMubXNnU2VydmljZS53YXJuaW5nKHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLnZhbGlkYXRlLm5vdE51bGwnKSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLnNjaGVtYU5hbWUgJiYgdGhpcy5zY2hlbWFOYW1lLmxlbmd0aCA+IDE1KSB7XHJcbiAgICAgIHRoaXMubXNnU2VydmljZS53YXJuaW5nKHRoaXMubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmxlbmd0aFZhbGlkYXRlJykpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoZGF0YSAmJiBkYXRhW3RoaXMucXVlcnlJZF0pIHtcclxuICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YVtzZWxmLnF1ZXJ5SWRdKSB7XHJcbiAgICAgICAgaWYgKGRhdGFbc2VsZi5xdWVyeUlkXVtrZXldLnNjaGVtYU5hbWUgPT09IHNlbGYuc2NoZW1hTmFtZSkge1xyXG4gICAgICAgICAgdGhpcy5tc2dTZXJ2aWNlLndhcm5pbmcodGhpcy5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2Uuc2F2ZWFzJykpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5oYW5kbGVyR2V0RW50aXR5KCk7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50U2NoZW1hICYmIHRoaXMuY3VycmVudFNjaGVtYS5pZCkge1xyXG4gICAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhW3NlbGYucXVlcnlJZF0pIHtcclxuICAgICAgICBpZiAoZGF0YVtzZWxmLnF1ZXJ5SWRdW2tleV0uc2NoZW1hTmFtZSA9PT0gc2VsZi5zY2hlbWFOYW1lKSB7XHJcbiAgICAgICAgICB0aGlzLm1zZ1NlcnZpY2Uud2FybmluZyh0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5zYXZlYXMnKSk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmN1cnJlbnRTY2hlbWEpKTtcclxuICAgICAgbmV3VmFsdWUuc2NoZW1hVmFsdWUgPSBwYXJhbXM7XHJcbiAgICAgIG5ld1ZhbHVlLmlkID0gJyc7XHJcbiAgICAgIG5ld1ZhbHVlLnF1ZXJ5SWQgPSBzZWxmLnF1ZXJ5SWQ7XHJcbiAgICAgIGlmICh0aGlzLmZpbHRlckluc3RhbmNlKSB7XHJcbiAgICAgICAgaWYgKCFuZXdWYWx1ZS5zY2hlbWFWYWx1ZSkgeyBuZXdWYWx1ZS5zY2hlbWFWYWx1ZSA9IHt9OyB9XHJcbiAgICAgICAgbmV3VmFsdWUuc2NoZW1hVmFsdWVbJ0BmaWx0ZXJFeHByZXNzaW9uU3RyaW5nQCddID0gdGhpcy5maWx0ZXJJbnN0YW5jZS5nZXRGaWx0ZXJFeHByZXNzaW9uKCk7XHJcbiAgICAgIH1cclxuICAgICAgbmV3VmFsdWUuc2NoZW1hVmFsdWUgPSBuZXdWYWx1ZS5zY2hlbWFWYWx1ZSA/IEpTT04uc3RyaW5naWZ5KG5ld1ZhbHVlLnNjaGVtYVZhbHVlKSA6IG51bGw7XHJcbiAgICAgIG5ld1ZhbHVlLnNjaGVtYU5hbWUgPSBzZWxmLnNjaGVtYU5hbWU7XHJcbiAgICAgIG5ld1ZhbHVlLmlzRGVmYXVsdCA9IHNlbGYuaXNEZWZhdWx0ID8gMSA6IDA7XHJcbiAgICAgIG5ld1ZhbHVlLnNjaGVtYVR5cGUgPSBzZWxmLmlzU2NoZW1hVHlwZTtcclxuICAgICAgdGhpcy5jb25kaXRpb25TZXJ2aWNlLnNhdmVTY2hlbWEobmV3VmFsdWUpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmluZm8udGl0bGUnKSwgbXNnOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5zYXZlLnN1Y2Nlc3MnKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgc2VsZi5mYXJyaXNEaWFsb2cuY2xvc2UoKTtcclxuICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICBzZWxmLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKGVycm9yLk1lc3NhZ2UsIGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IHtcclxuICAgICAgICBzY2hlbWFOYW1lOiBzZWxmLnNjaGVtYU5hbWUsXHJcbiAgICAgICAgc2NoZW1hVHlwZTogc2VsZi5pc1NjaGVtYVR5cGUsXHJcbiAgICAgICAgc2NoZW1hVmFsdWU6IG51bGwsXHJcbiAgICAgICAgaXNEZWZhdWx0OiBzZWxmLmlzRGVmYXVsdCA/IDEgOiAwLFxyXG4gICAgICAgIGlzUHJvdGVjdGVkOiAwLFxyXG4gICAgICAgIHF1ZXJ5SWQ6IHNlbGYucXVlcnlJZFxyXG4gICAgICB9O1xyXG4gICAgICBuZXdWYWx1ZS5zY2hlbWFWYWx1ZSA9IHBhcmFtcztcclxuICAgICAgaWYgKHRoaXMuZmlsdGVySW5zdGFuY2UpIHtcclxuICAgICAgICBpZiAoIW5ld1ZhbHVlLnNjaGVtYVZhbHVlKSB7IG5ld1ZhbHVlLnNjaGVtYVZhbHVlID0ge307IH1cclxuICAgICAgICBuZXdWYWx1ZS5zY2hlbWFWYWx1ZVsnQGZpbHRlckV4cHJlc3Npb25TdHJpbmdAJ10gPSB0aGlzLmZpbHRlckluc3RhbmNlLmdldEZpbHRlckV4cHJlc3Npb24oKTtcclxuICAgICAgfVxyXG4gICAgICBuZXdWYWx1ZS5zY2hlbWFWYWx1ZSA9IG5ld1ZhbHVlLnNjaGVtYVZhbHVlID8gSlNPTi5zdHJpbmdpZnkobmV3VmFsdWUuc2NoZW1hVmFsdWUpIDogbnVsbDtcclxuICAgICAgdGhpcy5jb25kaXRpb25TZXJ2aWNlLnNhdmVTY2hlbWEobmV3VmFsdWUpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmluZm8udGl0bGUnKSwgbXNnOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5zYXZlLnN1Y2Nlc3MnKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgc2VsZi5mYXJyaXNEaWFsb2cuY2xvc2UoKTtcclxuICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICBzZWxmLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKGVycm9yLk1lc3NhZ2UsIGVycm9yKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVDYW5jZWxDbGljaygpIHtcclxuICAgIHRoaXMuc2NoZW1hTmFtZSA9ICcnO1xyXG4gICAgdGhpcy5pc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgIHRoaXMuaXNTY2hlbWFUeXBlID0gMDtcclxuICAgIHRoaXMuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVTY2hlbWFUeXBlU2VsZWN0KHZhbHVlOiBhbnkpIHtcclxuICAgIHRoaXMuaXNTY2hlbWFUeXBlID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVyR2V0RW50aXR5KCkge1xyXG4gICAgY29uc3QgZW50aXR5cyA9IHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKCk7XHJcbiAgICBsZXQgcGFyYW1zO1xyXG4gICAgaWYgKGVudGl0eXMgJiYgZW50aXR5cy5sZW5ndGgpIHtcclxuICAgICAgcGFyYW1zID0gZW50aXR5c1swXS50b0pTT04oKTtcclxuICAgIH1cclxuICAgIHJldHVybiBwYXJhbXM7XHJcbiAgfVxyXG59XHJcbiJdfQ==
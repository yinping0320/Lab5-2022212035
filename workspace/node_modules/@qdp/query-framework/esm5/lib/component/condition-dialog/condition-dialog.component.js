/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Injector, ViewChild, Input, Output, EventEmitter, QueryList, ContentChildren } from '@angular/core';
import { DialogComponent } from '@farris/ui-dialog';
import { LocalizeService } from '@qdp/localize';
import { Repository } from '@farris/devkit';
import { SchemaService } from '@qdp/ide-cmp';
import { NotifyService } from '@farris/ui-notify';
import { ConditionSchemaService } from '@qdp/condition-schema';
import { ConditionManagerDialogComponent } from '../condition-manager-dialog/condition-manager-dialog.component';
import { SaveasSchemaDialogComponent } from '../saveas-schema-dialog/saveas-schema-dialog.component';
import { of, Subject } from 'rxjs';
import { CacheService } from '@ecp-caf/caf-common';
import { LcpService, QDPCacheUtil, RtfServices, EventBus } from '@qdp/common';
import { FinishLoadService } from '@qdp/condition-schema';
import { ConditionDialogTabComponent } from '../condition-dialog-tab/condition-dialog-tab.component';
import { FormErrorService } from '@farris/command-services';
var ConditionDialogComponent = /** @class */ (function () {
    function ConditionDialogComponent(injector, conditionService, repository, cacheService, finishLoasService) {
        this.injector = injector;
        this.conditionService = conditionService;
        this.repository = repository;
        this.cacheService = cacheService;
        this.finishLoasService = finishLoasService;
        // OnChanges,
        this.schemaId = '';
        this.showFilterExpression = true;
        this.tabIndex = 0;
        this.queryEvent = new EventEmitter();
        this.dialogInitEvent = new EventEmitter();
        this.idChanged = new Subject();
        this.menuShow = false;
        this.defaultSchemaName = '条件方案';
        this.publicList = [];
        this.personalList = [];
        this.controlIndexChanged = 0;
        this.subscriptions = [];
        this.closeType = '';
        this.propertyList = [];
        this.filterExpressionString = '';
        this.beforeOpen = (/**
         * @return {?}
         */
        function () { return true; });
        this.handlebeforeClose = (/**
         * @return {?}
         */
        function () {
            // const self = this;
            // if (this.closeType !== 'query') {
            //   if (self.repository.entityCollection.getAllEntities() && self.repository.entityCollection.getAllEntities()[0]) {
            //     const obj = {
            //       id: self.repository.entityCollection.getAllEntities()[0]['id']
            //     };
            //     self.repository.entityCollection.getAllEntities()[0].load(obj);
            //     (self.repository as BefRepository<Entity>).entityManager.clearAllEntityChanges();
            //     if (this.advanceFilterTab) {
            //       this.advanceFilterTab.filterExpressionString = '';
            //     }
            //   }
            // }
            // this.closeType = '';
            return of(true);
        });
        if (this.injector) {
            this.localizeService = this.injector.get(LocalizeService);
            this.notifyService = this.injector.get(NotifyService);
            this.defaultSchemaName = this.localizeService.getValue('queryFramework.ispreName');
            this.formErrorService = this.injector.get(FormErrorService);
            this.schemaService = this.injector.get(SchemaService);
            this.lcpService = this.injector.get(LcpService);
        }
    }
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.getConditionTabs = /**
     * @return {?}
     */
    function () {
        try {
            if (this.conditionTabs && this.conditionTabs.length) {
                return this.conditionTabs;
            }
            else if (QDPCacheUtil.getCache(RtfServices.getTabId('condition-dialog-tabs') + 'condition-dialog-tabs') && QDPCacheUtil.getCache(RtfServices.getTabId('condition-dialog-tabs') + 'condition-dialog-tabs').length) {
                return QDPCacheUtil.getCache(RtfServices.getTabId('condition-dialog-tabs') + 'condition-dialog-tabs');
            }
        }
        catch (e) {
            return this.conditionTabs;
        }
    };
    Object.defineProperty(ConditionDialogComponent.prototype, "Id", {
        get: /**
         * @return {?}
         */
        function () {
            return this.schemaId;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.schemaId = value;
            this.idChanged.next(value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.tabId = RtfServices.getTabId(this.queryId);
        this.queryCount = 1;
        this.conditionDialogInit();
        if (!this.beforeQuery) {
            this.beforeQuery = (/**
             * @param {?} params
             * @return {?}
             */
            function (params) { return of(true); });
        }
        QDPCacheUtil.setCache(this.tabId + 'advanceTemplate-condition-dialog', this);
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        EventBus.dispatch(this.tabId + 'advanceTemplate-condition-dialog-dialogInitEvent', {});
        this.dialogInitEvent.emit(true);
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.conditionDialogInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var self = this;
        this.subscriptions.push(self.conditionService.getSchemaList(self.queryId, '', '').subscribe());
        this.subscriptions.push(self.conditionService.schemaListChange.subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            /** @type {?} */
            var data = result.schemaInfo;
            if (data && data[self.queryId]) {
                self.publicList = [];
                self.personalList = [];
                for (var key in data[self.queryId]) {
                    if (data[self.queryId][key].schemaType === 0) {
                        self.publicList.push(data[self.queryId][key]);
                    }
                    else {
                        self.personalList.push(data[self.queryId][key]);
                    }
                }
                /** @type {?} */
                var flag = false;
                if (self.schemaId) {
                    /** @type {?} */
                    var index = self.publicList.findIndex((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return item.id === self.schemaId; }));
                    if (index >= 0) {
                        flag = true;
                        self.currentSchema = self.publicList[index];
                        self.initCondition(self.currentSchema);
                    }
                    index = self.personalList.findIndex((/**
                     * @param {?} item
                     * @return {?}
                     */
                    function (item) { return item.id === self.schemaId; }));
                    if (index >= 0) {
                        flag = true;
                        self.currentSchema = self.personalList[index];
                        self.initCondition(self.currentSchema);
                    }
                }
                if (!flag && self.conditionService.isDefaultSchema && self.conditionService.isDefaultSchema[self.queryId] && self.conditionService.isDefaultSchema[self.queryId].id) {
                    self.currentSchema = self.conditionService.isDefaultSchema[self.queryId];
                    self.schemaId = self.conditionService.isDefaultSchema[self.queryId].id;
                    self.defaultSchemaName = self.currentSchema.schemaName;
                }
                _this.subscriptions.push(_this.finishLoasService.finish.subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    self.initCondition(self.currentSchema);
                })));
            }
            else {
                self.defaultSchemaName = self.localizeService.getValue('queryFramework.ispreName');
            }
        })));
        this.subscriptions.push(self.idChanged.subscribe((/**
         * @param {?} schemaId
         * @return {?}
         */
        function (schemaId) {
            if (schemaId) {
                self.subscriptions.push(self.conditionService.getSchema(schemaId, self.queryId, true).subscribe((/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    if (data) {
                        self.currentSchema = data;
                        self.defaultSchemaName = self.currentSchema.schemaName;
                        self.initCondition(self.currentSchema);
                        if (self.controlIndexChanged === 1) {
                            self.handleInfoChanged(self.controlIndexChanged);
                        }
                    }
                })));
            }
        })));
    };
    /**
     * @private
     * @param {?} schema
     * @return {?}
     */
    ConditionDialogComponent.prototype.initCondition = /**
     * @private
     * @param {?} schema
     * @return {?}
     */
    function (schema) {
        /** @type {?} */
        var self = this;
        if (schema) { // 预制默认对象
            if (schema.schemaValue && typeof (schema.schemaValue) === 'object') {
                if (schema && schema.schemaValue && this.repository.entityCollection.getAllEntities() && this.repository.entityCollection.getAllEntities().length) {
                    schema.schemaValue.id = this.repository.entityCollection.getAllEntities()[0]['id'];
                }
                self.repository.entityCollection.getAllEntities()[0].load(schema.schemaValue);
                self.filterExpressionString = '';
                if (schema.schemaValue.hasOwnProperty('@filterExpressionString@')) {
                    self.filterExpressionString = schema.schemaValue['@filterExpressionString@'];
                }
            }
            else {
                if (self.repository.entityCollection.getAllEntities() && self.repository.entityCollection.getAllEntities()[0]) {
                    /** @type {?} */
                    var obj = {
                        id: self.repository.entityCollection.getAllEntities()[0]['id']
                    };
                    self.repository.entityCollection.getAllEntities()[0].load(obj);
                }
            }
        }
    };
    /**
     * @param {?} item
     * @return {?}
     */
    ConditionDialogComponent.prototype.getPropertyList = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        var _this = this;
        this.subscriptions.push(this.lcpService.getCol({
            schemaId: '1',
            entityData: JSON.stringify({ 'id': 'undefined_null' }),
            pageIndex: 1,
            pageSize: 0,
            qoManagerCode: QDPCacheUtil.getCache(this.tabId + 'qoManagerCode'),
            controlType: QDPCacheUtil.getCache(this.tabId + 'controlType'),
            voCode: QDPCacheUtil.getCache(this.tabId + 'voId')
        }, QDPCacheUtil.getCache(this.tabId + 'queryRelativeUrl')).subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value && value.dynamicCols && value.dynamicCols.length) {
                _this.analysisColListData(value.dynamicCols, 'col');
                if (_this.advanceFilterTab) {
                    _this.advanceFilterTab.propertyList = tslib_1.__spread(_this.propertyList);
                    _this.advanceFilterTab.filterExpressionString = _this.filterExpressionString;
                }
                item.createFilterComponent();
            }
        })));
    };
    /**
     * @private
     * @param {?} newValue
     * @param {?=} type
     * @return {?}
     */
    ConditionDialogComponent.prototype.analysisColListData = /**
     * @private
     * @param {?} newValue
     * @param {?=} type
     * @return {?}
     */
    function (newValue, type) {
        var _this = this;
        this.propertyList = [];
        newValue.forEach((/**
         * @param {?} col
         * @return {?}
         */
        function (col) {
            _this.recursiveAnalysisColListData(null, col, type);
        }));
    };
    /**
     * @private
     * @param {?} children
     * @param {?} col
     * @param {?=} type
     * @return {?}
     */
    ConditionDialogComponent.prototype.recursiveAnalysisColListData = /**
     * @private
     * @param {?} children
     * @param {?} col
     * @param {?=} type
     * @return {?}
     */
    function (children, col, type) {
        var _this = this;
        if (col) {
            /** @type {?} */
            var index = this.propertyList.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.Code === col.bindField; }));
            if (index < 0) {
                /** @type {?} */
                var node = {};
                node['value'] = col.bindField;
                node['propertyFieldType'] = this.getDataType(col.type);
                node['text'] = col.name;
                this.propertyList.push(node);
            }
            else if (type !== 'col') {
                this.propertyList[index]['text'] = col.name;
            }
            if (col.childList && col.childList.length) {
                this.recursiveAnalysisColListData(col.childList, null);
            }
        }
        else {
            children.forEach((/**
             * @param {?} c
             * @return {?}
             */
            function (c) {
                /** @type {?} */
                var index = _this.propertyList.findIndex((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) { return item.Code === c.bindField; }));
                if (index < 0) {
                    /** @type {?} */
                    var node = {};
                    node['value'] = c.bindField;
                    node['propertyFieldType'] = _this.getDataType(c.type);
                    node['text'] = c.name;
                    _this.propertyList.push(node);
                }
                else if (type !== 'col') {
                    _this.propertyList[index]['text'] = c.name;
                }
                if (c.childList && c.childList.length) {
                    _this.recursiveAnalysisColListData(c.childList, null);
                }
            }));
        }
    };
    /**
     * @private
     * @param {?} type
     * @return {?}
     */
    ConditionDialogComponent.prototype.getDataType = /**
     * @private
     * @param {?} type
     * @return {?}
     */
    function (type) {
        /** @type {?} */
        var result = 0;
        switch (type) {
            case 'string':
            case 'text':
                result = 0;
                break;
            case 'integer':
                result = 2;
                break;
            case 'decimal':
                result = 4;
                break;
            case 'boolean':
                result = 8;
                break;
            case 'date':
            case 'dateTime':
                result = 9;
                break;
            case 'byte':
                result = 6;
                break;
            case 'char':
                result = 7;
                break;
            case 'array':
                result = 10;
                break;
            default:
                break;
        }
        return result;
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (this.subscriptions && this.subscriptions.length) {
            try {
                for (var _b = tslib_1.__values(this.subscriptions), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var subscription = _c.value;
                    subscription.unsubscribe();
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ConditionDialogComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleDialogShow = /**
     * @return {?}
     */
    function () {
        this.farrisDialog.show();
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleDialogClose = /**
     * @return {?}
     */
    function () {
        this.farrisDialog.close();
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleSchemaManagerDialog = /**
     * @return {?}
     */
    function () {
        this.conditionManagerDialog.handleDialogShow();
        this.menuShow = !this.menuShow;
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleSaveasSchemaDialog = /**
     * @return {?}
     */
    function () {
        this.saveasSchemaDialogComponent.schemaName = '';
        this.saveasSchemaDialogComponent.isDefault = false;
        this.saveasSchemaDialogComponent.isSchemaType = 0;
        this.menuShow = false;
        this.saveasSchemaDialogComponent.handleDialogShow();
        if (this.advanceFilterTab && this.advanceFilterTab.filterInstance) {
            this.saveasSchemaDialogComponent.filterInstance = this.advanceFilterTab.filterInstance;
        }
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleSchemaMenu = /**
     * @return {?}
     */
    function () {
        this.menuShow = !this.menuShow;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleInfoChanged = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var self = this;
        this.controlIndexChanged = $event;
        if (this.getConditionTabs() && this.getConditionTabs().length) {
            this.getConditionTabs().forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                item.controlIndexChanged = $event;
                item.changeCss();
                if (item.tabIndex === 1 && self.showFilterExpression) {
                    self.advanceFilterTab = item;
                    self.getPropertyList(item);
                }
            }));
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleSchemaSelected = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.defaultSchemaName = $event.schemaName;
        this.menuShow = !this.menuShow;
        this.currentSchema = $event;
        this.Id = this.currentSchema.id;
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleQueryClick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var params = this.handlerGetEntity();
        this.beforeQuery().subscribe((/**
         * @param {?} result
         * @return {?}
         */
        function (result) {
            if (result == true) {
                EventBus.dispatch('openAdvanceTemplateDialog', {});
                _this.cacheService.set(_this.tabId, params);
                EventBus.dispatch(_this.tabId + 'advanceTemplate-condition-dialog-queryEvent', _this.queryCount++);
                _this.queryEvent.emit(_this.queryCount++);
                _this.closeType = 'query';
                _this.handleDialogClose();
            }
        }));
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handleSaveClick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var self = this;
        /** @type {?} */
        var params = this.handlerGetEntity();
        if (this.currentSchema) {
            this.currentSchema.schemaValue = params;
            /** @type {?} */
            var newSchema = JSON.parse(JSON.stringify(this.currentSchema));
            if (this.advanceFilterTab && this.advanceFilterTab.filterInstance) {
                if (!newSchema.schemaValue) {
                    newSchema.schemaValue = {};
                }
                newSchema.schemaValue['@filterExpressionString@'] = this.advanceFilterTab.filterInstance.getFilterExpression();
            }
            newSchema.schemaValue = newSchema.schemaValue ? JSON.stringify(newSchema.schemaValue) : null;
            this.conditionService.saveSchema(newSchema).subscribe((/**
             * @return {?}
             */
            function () {
                self.notifyService['success']((/** @type {?} */ ({
                    title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.save.success'), timeout: 3000
                })));
            }), (/**
             * @param {?} error
             * @return {?}
             */
            function (error) {
                self.formErrorService.exception(_this.localizeService.getValue('ideCmp.schemaManager.message.validate.qdpModifyPublicSchema'), error);
            }));
        }
    };
    /**
     * @return {?}
     */
    ConditionDialogComponent.prototype.handlerGetEntity = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var entitys = this.repository.entityCollection.getAllEntities();
        /** @type {?} */
        var params;
        if (entitys && entitys.length) {
            params = entitys[0].toJSON();
            if (this.advanceFilterTab && this.advanceFilterTab.filterInstance) {
                if (!params) {
                    params = { id: 'undefined_null' };
                }
                params['@filterExpressionString@'] = this.advanceFilterTab.filterInstance.getFilterExpression();
            }
            else if (this.filterExpressionString) {
                if (!params) {
                    params = { id: 'undefined_null' };
                }
                params['@filterExpressionString@'] = this.filterExpressionString;
            }
        }
        return params;
    };
    ConditionDialogComponent.decorators = [
        { type: Component, args: [{
                    selector: 'condition-dialog',
                    template: "<farris-dialog #farrisDialog [title]=\"localizeService.getValue('queryFramework.dialogTitle')\" [showButtons]=\"false\" [beforeClose]=\"handlebeforeClose\"\r\n  [width]=\"960\" [showMaxButton]=\"false\" [showMinButton]=\"false\" [resizable]=\"false\" [height]=\"570\" [beforeOpen]=\"beforeOpen\">\r\n  <div class=\"f-utils-absolute-all f-utils-flex-column bg-white\">\r\n    <div class=\"f-utils-flex-row-wrap farris-overflow-hidden\">\r\n      <div class=\"ml-3 mt-2 schema-manager-title\" (click)=\"handleSchemaMenu()\">{{defaultSchemaName}}</div>\r\n      <div class=\"schema-manager-tr\">\r\n      </div>\r\n    </div>\r\n    <div class=\"box ml-3 mt-2 schema-manager-dropdown\" [style.display]=\"menuShow?'block':'none'\">\r\n      <div class=\"f-utils-absolute-all f-utils-flex-column\">\r\n        <div class=\"f-utils-fill-flex-column f-utils-fill-auto\">\r\n          <div class=\"schemaType\">{{localizeService.getValue('queryFramework.schemaType.public')}}</div>\r\n          <div *ngFor=\"let item of publicList\" [class]=\"currentSchema && currentSchema.id && currentSchema.id === item.id ? 'schemaItem schemaItemHover' : 'schemaItem'\">\r\n            <div class=\"f-utils-flex-row-wrap\" (click)=\"handleSchemaSelected(item)\">\r\n              <div class=\"schemaItemFont1 col-8\">{{item.schemaName}}</div>\r\n              <div *ngIf=\"item.isDefault === 1\" class=\"schemaItemFont2 col-4\">\r\n                {{localizeService.getValue('queryFramework.defaultName')}}</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"schemaType\">{{localizeService.getValue('queryFramework.schemaType.personal')}}</div>\r\n          <div *ngFor=\"let item1 of personalList\" [class]=\"currentSchema && currentSchema.id && currentSchema.id === item1.id ? 'schemaItem schemaItemHover' : 'schemaItem'\">\r\n            <div class=\"f-utils-flex-row-wrap\" (click)=\"handleSchemaSelected(item1)\">\r\n              <div class=\"schemaItemFont1 col-8\">{{item1.schemaName}}</div>\r\n              <div *ngIf=\"item1.isDefault === 1\" class=\"schemaItemFont2 col-4\">\r\n                {{localizeService.getValue('queryFramework.defaultName')}}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"p-2 schema-manager-toolbar\">\r\n          <div class=\"btn-toolbar btn-group-lg\" id=\"page-header-toolbar\">\r\n            <button class=\"btn btn-link mr-1\" id=\"button-edit\"\r\n              (click)=\"handleSchemaManagerDialog()\">{{localizeService.getValue('queryFramework.btnManager')}}</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"f-utils-flex-row pl-3 pr-3 pt-2 pb-2\">\r\n      <button [class]=\"controlIndexChanged === 0 ? 'btn btn-primary' : 'btn btn-secondary'\" id=\"button-edit1\"\r\n        (click)=\"handleInfoChanged(0)\">\r\n        {{localizeService.getValue('queryFramework.tabName1')}}</button>\r\n      <button [class]=\"controlIndexChanged === 1 ? 'btn btn-primary' : 'btn btn-secondary'\" id=\"button-edit2\"\r\n        (click)=\"handleInfoChanged(1)\">\r\n        {{localizeService.getValue('queryFramework.tabName2')}}</button>\r\n      <!-- <button [class]=\"controlIndexChanged == false ? 'btn btn-primary' : 'btn btn-secondary'\" id=\"button-edit2\"\r\n          (click)=\"handleInfoChanged(2)\">\r\n          {{localizeService.getValue('ideCmp.schemaManager.columnOption.selection2')}}</button> -->\r\n    </div>\r\n    <div class=\"f-utils-fill-flex-column\">\r\n      <ng-content></ng-content>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n      <div class=\"btn-toolbar btn-group-lg\" id=\"page-header-toolbar\">\r\n        <button class=\"btn btn-primary mr-1\" id=\"button-edit\" (click)=\"handleQueryClick()\">\r\n          {{localizeService.getValue('queryFramework.btnQuery')}}</button>\r\n        <button class=\"btn btn-secondary mr-1\" id=\"button-edit\" (click)=\"handleSaveasSchemaDialog()\">\r\n          {{localizeService.getValue('queryFramework.btnSaveAsSchema')}}</button>\r\n        <button *ngIf=\"(!currentSchema) == false\" class=\"btn btn-secondary mr-1\" id=\"button-edit\" (click)=\"handleSaveClick()\">\r\n          {{localizeService.getValue('queryFramework.btnSaveSchema')}}</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n<condition-manager-dialog [queryId]=\"queryId\" [publicList]=\"publicList\" [personalList]=\"personalList\" [currentSchema]=\"currentSchema\"></condition-manager-dialog>\r\n<saveas-schema-dialog [queryId]=\"queryId\" [currentSchema]=\"currentSchema\"></saveas-schema-dialog>\r\n",
                    styles: [".schema-manager-title{cursor:pointer;display:block;height:22px;font-family:PingFangSC-Regular;font-size:16px;color:#388fff;text-align:right}.schema-manager-tr{margin-top:1.1rem!important;margin-left:.25rem!important;width:0;height:0;border-left:3px solid transparent;border-right:3px solid transparent;border-top:6px solid rgba(0,0,0,.25)}.box{cursor:pointer;display:inline-block;position:relative;width:200px;height:246px;-webkit-filter:drop-shadow(0 2px 4px rgba(0, 0, 0, .2));filter:drop-shadow(0 2px 4px rgba(0, 0, 0, .2));border-radius:3px;background-color:#fff;border:1px solid #bbb}.box:after,.box:before{content:\"\";position:absolute;border:10px solid transparent;bottom:100%;left:10px}.box:before{border-bottom-color:#bbb}.box:after{border-bottom-color:#fff;margin-bottom:-1px}.schemaType{font-family:PingFangSC-Regular;font-size:14px;color:rgba(0,0,0,.45);line-height:20px;padding-left:.75rem!important;padding-top:.75rem!important;padding-bottom:.25rem!important}.schemaItem{height:30px}.schemaItem:hover,.schemaItemHover{background:#ddf4ff}.schemaItemFont1{font-family:PingFangSC-Regular;font-size:14px;color:rgba(0,0,0,.85);line-height:20px;margin-top:.25rem!important;margin-bottom:.25rem!important;float:left;text-align:center;word-break:keep-all;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:0;padding-right:0}.schemaItemFont2{font-family:PingFangSC-Regular;font-size:12px;color:rgba(0,0,0,.45);line-height:20px;margin-top:.25rem!important;margin-bottom:.25rem!important;float:right;text-align:right;padding-left:0}.schema-manager-toolbar{background:#f9f9f9;display:flex;align-items:center;justify-content:flex-end;border-top:1px solid #e2e8f0}.schema-manager-dropdown{float:left;z-index:1000;position:absolute;top:30px}"]
                }] }
    ];
    /** @nocollapse */
    ConditionDialogComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: ConditionSchemaService },
        { type: Repository },
        { type: CacheService },
        { type: FinishLoadService }
    ]; };
    ConditionDialogComponent.propDecorators = {
        showFilterExpression: [{ type: Input }],
        queryId: [{ type: Input }],
        tabIndex: [{ type: Input }],
        beforeQuery: [{ type: Input }],
        queryEvent: [{ type: Output }],
        farrisDialog: [{ type: ViewChild, args: ['farrisDialog',] }],
        conditionTabs: [{ type: ContentChildren, args: [ConditionDialogTabComponent,] }],
        conditionManagerDialog: [{ type: ViewChild, args: [ConditionManagerDialogComponent,] }],
        saveasSchemaDialogComponent: [{ type: ViewChild, args: [SaveasSchemaDialogComponent,] }]
    };
    return ConditionDialogComponent;
}());
export { ConditionDialogComponent };
if (false) {
    /** @type {?} */
    ConditionDialogComponent.prototype.schemaId;
    /** @type {?} */
    ConditionDialogComponent.prototype.showFilterExpression;
    /** @type {?} */
    ConditionDialogComponent.prototype.queryId;
    /** @type {?} */
    ConditionDialogComponent.prototype.tabIndex;
    /** @type {?} */
    ConditionDialogComponent.prototype.beforeQuery;
    /** @type {?} */
    ConditionDialogComponent.prototype.queryEvent;
    /** @type {?} */
    ConditionDialogComponent.prototype.dialogInitEvent;
    /** @type {?} */
    ConditionDialogComponent.prototype.idChanged;
    /** @type {?} */
    ConditionDialogComponent.prototype.farrisDialog;
    /** @type {?} */
    ConditionDialogComponent.prototype.conditionTabs;
    /** @type {?} */
    ConditionDialogComponent.prototype.conditionManagerDialog;
    /** @type {?} */
    ConditionDialogComponent.prototype.saveasSchemaDialogComponent;
    /** @type {?} */
    ConditionDialogComponent.prototype.localizeService;
    /** @type {?} */
    ConditionDialogComponent.prototype.menuShow;
    /** @type {?} */
    ConditionDialogComponent.prototype.defaultSchemaName;
    /** @type {?} */
    ConditionDialogComponent.prototype.currentSchema;
    /** @type {?} */
    ConditionDialogComponent.prototype.publicList;
    /** @type {?} */
    ConditionDialogComponent.prototype.personalList;
    /** @type {?} */
    ConditionDialogComponent.prototype.controlIndexChanged;
    /** @type {?} */
    ConditionDialogComponent.prototype.queryCount;
    /** @type {?} */
    ConditionDialogComponent.prototype.notifyService;
    /**
     * @type {?}
     * @private
     */
    ConditionDialogComponent.prototype.subscriptions;
    /**
     * @type {?}
     * @private
     */
    ConditionDialogComponent.prototype.closeType;
    /** @type {?} */
    ConditionDialogComponent.prototype.formErrorService;
    /** @type {?} */
    ConditionDialogComponent.prototype.propertyList;
    /** @type {?} */
    ConditionDialogComponent.prototype.filterExpressionString;
    /** @type {?} */
    ConditionDialogComponent.prototype.advanceFilterTab;
    /** @type {?} */
    ConditionDialogComponent.prototype.schemaService;
    /** @type {?} */
    ConditionDialogComponent.prototype.lcpService;
    /** @type {?} */
    ConditionDialogComponent.prototype.tabId;
    /** @type {?} */
    ConditionDialogComponent.prototype.beforeOpen;
    /** @type {?} */
    ConditionDialogComponent.prototype.handlebeforeClose;
    /**
     * @type {?}
     * @private
     */
    ConditionDialogComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ConditionDialogComponent.prototype.conditionService;
    /**
     * @type {?}
     * @private
     */
    ConditionDialogComponent.prototype.repository;
    /**
     * @type {?}
     * @private
     */
    ConditionDialogComponent.prototype.cacheService;
    /**
     * @type {?}
     * @private
     */
    ConditionDialogComponent.prototype.finishLoasService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZGl0aW9uLWRpYWxvZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcWRwL3F1ZXJ5LWZyYW1ld29yay8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnQvY29uZGl0aW9uLWRpYWxvZy9jb25kaXRpb24tZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFVLFNBQVMsRUFBNEIsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQWEsU0FBUyxFQUFFLGVBQWUsRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDcEwsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEQsT0FBTyxFQUFVLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXBELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDN0MsT0FBTyxFQUFFLGFBQWEsRUFBaUIsTUFBTSxtQkFBbUIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMvRCxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxnRUFBZ0UsQ0FBQztBQUNqSCxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSx3REFBd0QsQ0FBQztBQUNyRyxPQUFPLEVBQWMsRUFBRSxFQUFFLE9BQU8sRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDN0QsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDOUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDMUQsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0s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QWtCOztJQUNsQiwwREFBNEI7O0lBQzVCLG9EQUFzQjs7SUFDdEIsaURBQTZCOztJQUM3Qiw4Q0FBdUI7O0lBQ3ZCLHlDQUFXOztJQW1VWCw4Q0FBd0I7O0lBRXhCLHFEQWdCQzs7Ozs7SUFsVkMsNENBQTBCOzs7OztJQUMxQixvREFBZ0Q7Ozs7O0lBQ2hELDhDQUFtQzs7Ozs7SUFDbkMsZ0RBQWtDOzs7OztJQUNsQyxxREFBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEluamVjdG9yLCBPbkluaXQsIFZpZXdDaGlsZCwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIE9uRGVzdHJveSwgUXVlcnlMaXN0LCBDb250ZW50Q2hpbGRyZW4sIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBMb2NhbGl6ZVNlcnZpY2UgfSBmcm9tICdAcWRwL2xvY2FsaXplJztcclxuaW1wb3J0IHsgRW50aXR5LCBSZXBvc2l0b3J5IH0gZnJvbSAnQGZhcnJpcy9kZXZraXQnO1xyXG5pbXBvcnQgeyBNZXNzYWdlclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL3VpLW1lc3NhZ2VyJztcclxuaW1wb3J0IHsgU2NoZW1hU2VydmljZSB9IGZyb20gJ0BxZHAvaWRlLWNtcCc7XHJcbmltcG9ydCB7IE5vdGlmeVNlcnZpY2UsIE5vdGlmeU9wdGlvbnMgfSBmcm9tICdAZmFycmlzL3VpLW5vdGlmeSc7XHJcbmltcG9ydCB7IENvbmRpdGlvblNjaGVtYVNlcnZpY2UgfSBmcm9tICdAcWRwL2NvbmRpdGlvbi1zY2hlbWEnO1xyXG5pbXBvcnQgeyBDb25kaXRpb25NYW5hZ2VyRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnLi4vY29uZGl0aW9uLW1hbmFnZXItZGlhbG9nL2NvbmRpdGlvbi1tYW5hZ2VyLWRpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTYXZlYXNTY2hlbWFEaWFsb2dDb21wb25lbnQgfSBmcm9tICcuLi9zYXZlYXMtc2NoZW1hLWRpYWxvZy9zYXZlYXMtc2NoZW1hLWRpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgU3ViamVjdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IENhY2hlU2VydmljZSB9IGZyb20gJ0BlY3AtY2FmL2NhZi1jb21tb24nO1xyXG5pbXBvcnQgeyBMY3BTZXJ2aWNlLCBRRFBDYWNoZVV0aWwsIFJ0ZlNlcnZpY2VzLCBFdmVudEJ1cyB9IGZyb20gJ0BxZHAvY29tbW9uJztcclxuaW1wb3J0IHsgRmluaXNoTG9hZFNlcnZpY2UgfSBmcm9tICdAcWRwL2NvbmRpdGlvbi1zY2hlbWEnO1xyXG5pbXBvcnQgeyBDb25kaXRpb25EaWFsb2dUYWJDb21wb25lbnQgfSBmcm9tICcuLi9jb25kaXRpb24tZGlhbG9nLXRhYi9jb25kaXRpb24tZGlhbG9nLXRhYi5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBCZWZSZXBvc2l0b3J5IH0gZnJvbSAnQGZhcnJpcy9iZWYnO1xyXG5pbXBvcnQgeyBGb3JtRXJyb3JTZXJ2aWNlIH0gZnJvbSAnQGZhcnJpcy9jb21tYW5kLXNlcnZpY2VzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnY29uZGl0aW9uLWRpYWxvZycsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbmRpdGlvbi1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2NvbmRpdGlvbi1kaWFsb2cuY29tcG9uZW50LmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBDb25kaXRpb25EaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0IHsgLy8gT25DaGFuZ2VzLFxyXG4gIHNjaGVtYUlkID0gJyc7XHJcbiAgQElucHV0KCkgc2hvd0ZpbHRlckV4cHJlc3Npb24gPSB0cnVlO1xyXG4gIEBJbnB1dCgpIHF1ZXJ5SWQ7XHJcbiAgQElucHV0KCkgdGFiSW5kZXggPSAwO1xyXG4gIEBJbnB1dCgpIGJlZm9yZVF1ZXJ5OiAoZW1wdHlPYmo/OiB7fSkgPT4gT2JzZXJ2YWJsZTxhbnk+O1xyXG4gIEBPdXRwdXQoKSBxdWVyeUV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgZGlhbG9nSW5pdEV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcbiAgaWRDaGFuZ2VkID0gbmV3IFN1YmplY3Q8YW55PigpO1xyXG4gIEBWaWV3Q2hpbGQoJ2ZhcnJpc0RpYWxvZycpIGZhcnJpc0RpYWxvZzogRGlhbG9nQ29tcG9uZW50O1xyXG4gIEBDb250ZW50Q2hpbGRyZW4oQ29uZGl0aW9uRGlhbG9nVGFiQ29tcG9uZW50KSBjb25kaXRpb25UYWJzOiBRdWVyeUxpc3Q8Q29uZGl0aW9uRGlhbG9nVGFiQ29tcG9uZW50PjtcclxuICBnZXRDb25kaXRpb25UYWJzKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHRoaXMuY29uZGl0aW9uVGFicyAmJiB0aGlzLmNvbmRpdGlvblRhYnMubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZGl0aW9uVGFicztcclxuICAgICAgfSBlbHNlIGlmIChRRFBDYWNoZVV0aWwuZ2V0Q2FjaGUoUnRmU2VydmljZXMuZ2V0VGFiSWQoJ2NvbmRpdGlvbi1kaWFsb2ctdGFicycpICsgJ2NvbmRpdGlvbi1kaWFsb2ctdGFicycpICYmIFFEUENhY2hlVXRpbC5nZXRDYWNoZShSdGZTZXJ2aWNlcy5nZXRUYWJJZCgnY29uZGl0aW9uLWRpYWxvZy10YWJzJykgKyAnY29uZGl0aW9uLWRpYWxvZy10YWJzJykubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuIFFEUENhY2hlVXRpbC5nZXRDYWNoZShSdGZTZXJ2aWNlcy5nZXRUYWJJZCgnY29uZGl0aW9uLWRpYWxvZy10YWJzJykgKyAnY29uZGl0aW9uLWRpYWxvZy10YWJzJyk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY29uZGl0aW9uVGFicztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIEBWaWV3Q2hpbGQoQ29uZGl0aW9uTWFuYWdlckRpYWxvZ0NvbXBvbmVudCkgY29uZGl0aW9uTWFuYWdlckRpYWxvZzogQ29uZGl0aW9uTWFuYWdlckRpYWxvZ0NvbXBvbmVudDtcclxuICBAVmlld0NoaWxkKFNhdmVhc1NjaGVtYURpYWxvZ0NvbXBvbmVudCkgc2F2ZWFzU2NoZW1hRGlhbG9nQ29tcG9uZW50OiBTYXZlYXNTY2hlbWFEaWFsb2dDb21wb25lbnQ7XHJcbiAgbG9jYWxpemVTZXJ2aWNlOiBhbnk7XHJcbiAgbWVudVNob3cgPSBmYWxzZTtcclxuICBkZWZhdWx0U2NoZW1hTmFtZSA9ICfmnaHku7bmlrnmoYgnO1xyXG4gIGN1cnJlbnRTY2hlbWE6IGFueTtcclxuICBwdWJsaWNMaXN0ID0gW107XHJcbiAgcGVyc29uYWxMaXN0ID0gW107XHJcbiAgY29udHJvbEluZGV4Q2hhbmdlZCA9IDA7XHJcbiAgcXVlcnlDb3VudDogYW55O1xyXG4gIG5vdGlmeVNlcnZpY2U6IE5vdGlmeVNlcnZpY2U7XHJcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xyXG4gIHByaXZhdGUgY2xvc2VUeXBlID0gJyc7XHJcbiAgZm9ybUVycm9yU2VydmljZTogYW55O1xyXG5cclxuICBwdWJsaWMgZ2V0IElkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuc2NoZW1hSWQ7XHJcbiAgfVxyXG4gIHB1YmxpYyBzZXQgSWQodmFsdWU6IGFueSkge1xyXG4gICAgdGhpcy5zY2hlbWFJZCA9IHZhbHVlO1xyXG4gICAgdGhpcy5pZENoYW5nZWQubmV4dCh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBwcm9wZXJ0eUxpc3QgPSBbXTtcclxuICBmaWx0ZXJFeHByZXNzaW9uU3RyaW5nID0gJyc7XHJcbiAgYWR2YW5jZUZpbHRlclRhYjogYW55O1xyXG4gIHNjaGVtYVNlcnZpY2U6IFNjaGVtYVNlcnZpY2U7XHJcbiAgbGNwU2VydmljZTogTGNwU2VydmljZTtcclxuICB0YWJJZDogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBjb25kaXRpb25TZXJ2aWNlOiBDb25kaXRpb25TY2hlbWFTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PGFueT4sXHJcbiAgICBwcml2YXRlIGNhY2hlU2VydmljZTogQ2FjaGVTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBmaW5pc2hMb2FzU2VydmljZTogRmluaXNoTG9hZFNlcnZpY2UpIHtcclxuICAgIGlmICh0aGlzLmluamVjdG9yKSB7XHJcbiAgICAgIHRoaXMubG9jYWxpemVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxpemVTZXJ2aWNlKTtcclxuICAgICAgdGhpcy5ub3RpZnlTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTm90aWZ5U2VydmljZSk7XHJcbiAgICAgIHRoaXMuZGVmYXVsdFNjaGVtYU5hbWUgPSB0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsuaXNwcmVOYW1lJyk7XHJcbiAgICAgIHRoaXMuZm9ybUVycm9yU2VydmljZSA9IHRoaXMuaW5qZWN0b3IuZ2V0KEZvcm1FcnJvclNlcnZpY2UpO1xyXG4gICAgICB0aGlzLnNjaGVtYVNlcnZpY2UgPSB0aGlzLmluamVjdG9yLmdldChTY2hlbWFTZXJ2aWNlKTtcclxuICAgICAgdGhpcy5sY3BTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTGNwU2VydmljZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMudGFiSWQgPSBSdGZTZXJ2aWNlcy5nZXRUYWJJZCh0aGlzLnF1ZXJ5SWQpO1xyXG4gICAgdGhpcy5xdWVyeUNvdW50ID0gMTtcclxuICAgIHRoaXMuY29uZGl0aW9uRGlhbG9nSW5pdCgpO1xyXG4gICAgaWYgKCF0aGlzLmJlZm9yZVF1ZXJ5KSB7XHJcbiAgICAgIHRoaXMuYmVmb3JlUXVlcnkgPSAocGFyYW1zOiBhbnkpID0+IG9mKHRydWUpO1xyXG4gICAgfVxyXG4gICAgUURQQ2FjaGVVdGlsLnNldENhY2hlKHRoaXMudGFiSWQgKyAnYWR2YW5jZVRlbXBsYXRlLWNvbmRpdGlvbi1kaWFsb2cnLCB0aGlzKTtcclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIEV2ZW50QnVzLmRpc3BhdGNoKHRoaXMudGFiSWQgKyAnYWR2YW5jZVRlbXBsYXRlLWNvbmRpdGlvbi1kaWFsb2ctZGlhbG9nSW5pdEV2ZW50Jywge30pO1xyXG4gICAgdGhpcy5kaWFsb2dJbml0RXZlbnQuZW1pdCh0cnVlKTtcclxuICB9XHJcblxyXG4gIGNvbmRpdGlvbkRpYWxvZ0luaXQoKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHNlbGYuY29uZGl0aW9uU2VydmljZS5nZXRTY2hlbWFMaXN0KHNlbGYucXVlcnlJZCwgJycsICcnKS5zdWJzY3JpYmUoKSk7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChzZWxmLmNvbmRpdGlvblNlcnZpY2Uuc2NoZW1hTGlzdENoYW5nZS5zdWJzY3JpYmUoKHJlc3VsdDogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSByZXN1bHQuc2NoZW1hSW5mbztcclxuICAgICAgaWYgKGRhdGEgJiYgZGF0YVtzZWxmLnF1ZXJ5SWRdKSB7XHJcbiAgICAgICAgc2VsZi5wdWJsaWNMaXN0ID0gW107XHJcbiAgICAgICAgc2VsZi5wZXJzb25hbExpc3QgPSBbXTtcclxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhW3NlbGYucXVlcnlJZF0pIHtcclxuICAgICAgICAgIGlmIChkYXRhW3NlbGYucXVlcnlJZF1ba2V5XS5zY2hlbWFUeXBlID09PSAwKSB7XHJcbiAgICAgICAgICAgIHNlbGYucHVibGljTGlzdC5wdXNoKGRhdGFbc2VsZi5xdWVyeUlkXVtrZXldKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbGYucGVyc29uYWxMaXN0LnB1c2goZGF0YVtzZWxmLnF1ZXJ5SWRdW2tleV0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgIGlmIChzZWxmLnNjaGVtYUlkKSB7XHJcbiAgICAgICAgICBsZXQgaW5kZXggPSBzZWxmLnB1YmxpY0xpc3QuZmluZEluZGV4KChpdGVtOiBhbnkpID0+IGl0ZW0uaWQgPT09IHNlbGYuc2NoZW1hSWQpO1xyXG4gICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlbGYuY3VycmVudFNjaGVtYSA9IHNlbGYucHVibGljTGlzdFtpbmRleF07XHJcbiAgICAgICAgICAgIHNlbGYuaW5pdENvbmRpdGlvbihzZWxmLmN1cnJlbnRTY2hlbWEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaW5kZXggPSBzZWxmLnBlcnNvbmFsTGlzdC5maW5kSW5kZXgoKGl0ZW06IGFueSkgPT4gaXRlbS5pZCA9PT0gc2VsZi5zY2hlbWFJZCk7XHJcbiAgICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VsZi5jdXJyZW50U2NoZW1hID0gc2VsZi5wZXJzb25hbExpc3RbaW5kZXhdO1xyXG4gICAgICAgICAgICBzZWxmLmluaXRDb25kaXRpb24oc2VsZi5jdXJyZW50U2NoZW1hKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFmbGFnICYmIHNlbGYuY29uZGl0aW9uU2VydmljZS5pc0RlZmF1bHRTY2hlbWEgJiYgc2VsZi5jb25kaXRpb25TZXJ2aWNlLmlzRGVmYXVsdFNjaGVtYVtzZWxmLnF1ZXJ5SWRdICYmIHNlbGYuY29uZGl0aW9uU2VydmljZS5pc0RlZmF1bHRTY2hlbWFbc2VsZi5xdWVyeUlkXS5pZCkge1xyXG4gICAgICAgICAgc2VsZi5jdXJyZW50U2NoZW1hID0gc2VsZi5jb25kaXRpb25TZXJ2aWNlLmlzRGVmYXVsdFNjaGVtYVtzZWxmLnF1ZXJ5SWRdO1xyXG4gICAgICAgICAgc2VsZi5zY2hlbWFJZCA9IHNlbGYuY29uZGl0aW9uU2VydmljZS5pc0RlZmF1bHRTY2hlbWFbc2VsZi5xdWVyeUlkXS5pZDtcclxuICAgICAgICAgIHNlbGYuZGVmYXVsdFNjaGVtYU5hbWUgPSBzZWxmLmN1cnJlbnRTY2hlbWEuc2NoZW1hTmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5maW5pc2hMb2FzU2VydmljZS5maW5pc2guc3Vic2NyaWJlKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICBzZWxmLmluaXRDb25kaXRpb24oc2VsZi5jdXJyZW50U2NoZW1hKTtcclxuICAgICAgICB9KSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc2VsZi5kZWZhdWx0U2NoZW1hTmFtZSA9IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5pc3ByZU5hbWUnKTtcclxuICAgICAgfVxyXG4gICAgfSkpO1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goc2VsZi5pZENoYW5nZWQuc3Vic2NyaWJlKChzY2hlbWFJZDogYW55KSA9PiB7XHJcbiAgICAgIGlmIChzY2hlbWFJZCkge1xyXG4gICAgICAgIHNlbGYuc3Vic2NyaXB0aW9ucy5wdXNoKHNlbGYuY29uZGl0aW9uU2VydmljZS5nZXRTY2hlbWEoc2NoZW1hSWQsIHNlbGYucXVlcnlJZCwgdHJ1ZSkuc3Vic2NyaWJlKChkYXRhOiBhbnkpID0+IHtcclxuICAgICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHNlbGYuY3VycmVudFNjaGVtYSA9IGRhdGE7XHJcbiAgICAgICAgICAgIHNlbGYuZGVmYXVsdFNjaGVtYU5hbWUgPSBzZWxmLmN1cnJlbnRTY2hlbWEuc2NoZW1hTmFtZTtcclxuICAgICAgICAgICAgc2VsZi5pbml0Q29uZGl0aW9uKHNlbGYuY3VycmVudFNjaGVtYSk7XHJcbiAgICAgICAgICAgIGlmIChzZWxmLmNvbnRyb2xJbmRleENoYW5nZWQgPT09IDEpIHtcclxuICAgICAgICAgICAgICBzZWxmLmhhbmRsZUluZm9DaGFuZ2VkKHNlbGYuY29udHJvbEluZGV4Q2hhbmdlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KSk7XHJcbiAgICAgIH1cclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5pdENvbmRpdGlvbihzY2hlbWE6IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICBpZiAoc2NoZW1hKSB7IC8vIOmihOWItum7mOiupOWvueixoVxyXG4gICAgICBpZiAoc2NoZW1hLnNjaGVtYVZhbHVlICYmIHR5cGVvZiAoc2NoZW1hLnNjaGVtYVZhbHVlKSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBpZiAoc2NoZW1hICYmIHNjaGVtYS5zY2hlbWFWYWx1ZSAmJiB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpICYmIHRoaXMucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKCkubGVuZ3RoKSB7XHJcbiAgICAgICAgICBzY2hlbWEuc2NoZW1hVmFsdWUuaWQgPSB0aGlzLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpWzBdWydpZCddO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpWzBdLmxvYWQoc2NoZW1hLnNjaGVtYVZhbHVlKTtcclxuICAgICAgICBzZWxmLmZpbHRlckV4cHJlc3Npb25TdHJpbmcgPSAnJztcclxuICAgICAgICBpZiAoc2NoZW1hLnNjaGVtYVZhbHVlLmhhc093blByb3BlcnR5KCdAZmlsdGVyRXhwcmVzc2lvblN0cmluZ0AnKSkge1xyXG4gICAgICAgICAgc2VsZi5maWx0ZXJFeHByZXNzaW9uU3RyaW5nID0gc2NoZW1hLnNjaGVtYVZhbHVlWydAZmlsdGVyRXhwcmVzc2lvblN0cmluZ0AnXTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHNlbGYucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKCkgJiYgc2VsZi5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKVswXSkge1xyXG4gICAgICAgICAgY29uc3Qgb2JqID0ge1xyXG4gICAgICAgICAgICBpZDogc2VsZi5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKVswXVsnaWQnXVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHNlbGYucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKClbMF0ubG9hZChvYmopO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0UHJvcGVydHlMaXN0KGl0ZW06IGFueSkge1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5sY3BTZXJ2aWNlLmdldENvbCh7XHJcbiAgICAgIHNjaGVtYUlkOiAnMScsXHJcbiAgICAgIGVudGl0eURhdGE6IEpTT04uc3RyaW5naWZ5KHsgJ2lkJzogJ3VuZGVmaW5lZF9udWxsJyB9KSxcclxuICAgICAgcGFnZUluZGV4OiAxLFxyXG4gICAgICBwYWdlU2l6ZTogMCxcclxuICAgICAgcW9NYW5hZ2VyQ29kZTogUURQQ2FjaGVVdGlsLmdldENhY2hlKHRoaXMudGFiSWQgKyAncW9NYW5hZ2VyQ29kZScpLFxyXG4gICAgICBjb250cm9sVHlwZTogUURQQ2FjaGVVdGlsLmdldENhY2hlKHRoaXMudGFiSWQgKyAnY29udHJvbFR5cGUnKSxcclxuICAgICAgdm9Db2RlOiBRRFBDYWNoZVV0aWwuZ2V0Q2FjaGUodGhpcy50YWJJZCArICd2b0lkJylcclxuICAgIH0sIFFEUENhY2hlVXRpbC5nZXRDYWNoZSh0aGlzLnRhYklkICsgJ3F1ZXJ5UmVsYXRpdmVVcmwnKSkuc3Vic2NyaWJlKHZhbHVlID0+IHtcclxuICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLmR5bmFtaWNDb2xzICYmIHZhbHVlLmR5bmFtaWNDb2xzLmxlbmd0aCkge1xyXG4gICAgICAgIHRoaXMuYW5hbHlzaXNDb2xMaXN0RGF0YSh2YWx1ZS5keW5hbWljQ29scywgJ2NvbCcpO1xyXG4gICAgICAgIGlmICh0aGlzLmFkdmFuY2VGaWx0ZXJUYWIpIHtcclxuICAgICAgICAgIHRoaXMuYWR2YW5jZUZpbHRlclRhYi5wcm9wZXJ0eUxpc3QgPSBbLi4udGhpcy5wcm9wZXJ0eUxpc3RdO1xyXG4gICAgICAgICAgdGhpcy5hZHZhbmNlRmlsdGVyVGFiLmZpbHRlckV4cHJlc3Npb25TdHJpbmcgPSB0aGlzLmZpbHRlckV4cHJlc3Npb25TdHJpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGl0ZW0uY3JlYXRlRmlsdGVyQ29tcG9uZW50KCk7XHJcbiAgICAgIH1cclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYW5hbHlzaXNDb2xMaXN0RGF0YShuZXdWYWx1ZTogYW55LCB0eXBlPzogYW55KSB7XHJcbiAgICB0aGlzLnByb3BlcnR5TGlzdCA9IFtdO1xyXG4gICAgbmV3VmFsdWUuZm9yRWFjaChjb2wgPT4ge1xyXG4gICAgICB0aGlzLnJlY3Vyc2l2ZUFuYWx5c2lzQ29sTGlzdERhdGEobnVsbCwgY29sLCB0eXBlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWN1cnNpdmVBbmFseXNpc0NvbExpc3REYXRhKGNoaWxkcmVuOiBhbnksIGNvbDogYW55LCB0eXBlPzogYW55KSB7XHJcbiAgICBpZiAoY29sKSB7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5wcm9wZXJ0eUxpc3QuZmluZEluZGV4KChpdGVtOiBhbnkpID0+IGl0ZW0uQ29kZSA9PT0gY29sLmJpbmRGaWVsZCk7XHJcbiAgICAgIGlmIChpbmRleCA8IDApIHtcclxuICAgICAgICBjb25zdCBub2RlID0ge307XHJcbiAgICAgICAgbm9kZVsndmFsdWUnXSA9IGNvbC5iaW5kRmllbGQ7XHJcbiAgICAgICAgbm9kZVsncHJvcGVydHlGaWVsZFR5cGUnXSA9IHRoaXMuZ2V0RGF0YVR5cGUoY29sLnR5cGUpO1xyXG4gICAgICAgIG5vZGVbJ3RleHQnXSA9IGNvbC5uYW1lO1xyXG4gICAgICAgIHRoaXMucHJvcGVydHlMaXN0LnB1c2gobm9kZSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZSAhPT0gJ2NvbCcpIHtcclxuICAgICAgICB0aGlzLnByb3BlcnR5TGlzdFtpbmRleF1bJ3RleHQnXSA9IGNvbC5uYW1lO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjb2wuY2hpbGRMaXN0ICYmIGNvbC5jaGlsZExpc3QubGVuZ3RoKSB7XHJcbiAgICAgICAgdGhpcy5yZWN1cnNpdmVBbmFseXNpc0NvbExpc3REYXRhKGNvbC5jaGlsZExpc3QsIG51bGwpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjaGlsZHJlbi5mb3JFYWNoKChjOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucHJvcGVydHlMaXN0LmZpbmRJbmRleCgoaXRlbTogYW55KSA9PiBpdGVtLkNvZGUgPT09IGMuYmluZEZpZWxkKTtcclxuICAgICAgICBpZiAoaW5kZXggPCAwKSB7XHJcbiAgICAgICAgICBjb25zdCBub2RlID0ge307XHJcbiAgICAgICAgICBub2RlWyd2YWx1ZSddID0gYy5iaW5kRmllbGQ7XHJcbiAgICAgICAgICBub2RlWydwcm9wZXJ0eUZpZWxkVHlwZSddID0gdGhpcy5nZXREYXRhVHlwZShjLnR5cGUpO1xyXG4gICAgICAgICAgbm9kZVsndGV4dCddID0gYy5uYW1lO1xyXG4gICAgICAgICAgdGhpcy5wcm9wZXJ0eUxpc3QucHVzaChub2RlKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgIT09ICdjb2wnKSB7XHJcbiAgICAgICAgICB0aGlzLnByb3BlcnR5TGlzdFtpbmRleF1bJ3RleHQnXSA9IGMubmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGMuY2hpbGRMaXN0ICYmIGMuY2hpbGRMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgdGhpcy5yZWN1cnNpdmVBbmFseXNpc0NvbExpc3REYXRhKGMuY2hpbGRMaXN0LCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXREYXRhVHlwZSh0eXBlOiBhbnkpIHtcclxuICAgIGxldCByZXN1bHQgPSAwO1xyXG4gICAgc3dpdGNoICh0eXBlKSB7XHJcbiAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgIGNhc2UgJ3RleHQnOlxyXG4gICAgICAgIHJlc3VsdCA9IDA7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2ludGVnZXInOlxyXG4gICAgICAgIHJlc3VsdCA9IDI7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2RlY2ltYWwnOlxyXG4gICAgICAgIHJlc3VsdCA9IDQ7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxyXG4gICAgICAgIHJlc3VsdCA9IDg7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ2RhdGUnOlxyXG4gICAgICBjYXNlICdkYXRlVGltZSc6XHJcbiAgICAgICAgcmVzdWx0ID0gOTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnYnl0ZSc6XHJcbiAgICAgICAgcmVzdWx0ID0gNjtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnY2hhcic6XHJcbiAgICAgICAgcmVzdWx0ID0gNztcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnYXJyYXknOlxyXG4gICAgICAgIHJlc3VsdCA9IDEwO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9ucyAmJiB0aGlzLnN1YnNjcmlwdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgIGZvciAoY29uc3Qgc3Vic2NyaXB0aW9uIG9mIHRoaXMuc3Vic2NyaXB0aW9ucykge1xyXG4gICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVEaWFsb2dTaG93KCkge1xyXG4gICAgdGhpcy5mYXJyaXNEaWFsb2cuc2hvdygpO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlRGlhbG9nQ2xvc2UoKSB7XHJcbiAgICB0aGlzLmZhcnJpc0RpYWxvZy5jbG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlU2NoZW1hTWFuYWdlckRpYWxvZygpIHtcclxuICAgIHRoaXMuY29uZGl0aW9uTWFuYWdlckRpYWxvZy5oYW5kbGVEaWFsb2dTaG93KCk7XHJcbiAgICB0aGlzLm1lbnVTaG93ID0gIXRoaXMubWVudVNob3c7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVTYXZlYXNTY2hlbWFEaWFsb2coKSB7XHJcbiAgICB0aGlzLnNhdmVhc1NjaGVtYURpYWxvZ0NvbXBvbmVudC5zY2hlbWFOYW1lID0gJyc7XHJcbiAgICB0aGlzLnNhdmVhc1NjaGVtYURpYWxvZ0NvbXBvbmVudC5pc0RlZmF1bHQgPSBmYWxzZTtcclxuICAgIHRoaXMuc2F2ZWFzU2NoZW1hRGlhbG9nQ29tcG9uZW50LmlzU2NoZW1hVHlwZSA9IDA7XHJcbiAgICB0aGlzLm1lbnVTaG93ID0gZmFsc2U7XHJcbiAgICB0aGlzLnNhdmVhc1NjaGVtYURpYWxvZ0NvbXBvbmVudC5oYW5kbGVEaWFsb2dTaG93KCk7XHJcbiAgICBpZiAodGhpcy5hZHZhbmNlRmlsdGVyVGFiICYmIHRoaXMuYWR2YW5jZUZpbHRlclRhYi5maWx0ZXJJbnN0YW5jZSkge1xyXG4gICAgICB0aGlzLnNhdmVhc1NjaGVtYURpYWxvZ0NvbXBvbmVudC5maWx0ZXJJbnN0YW5jZSA9IHRoaXMuYWR2YW5jZUZpbHRlclRhYi5maWx0ZXJJbnN0YW5jZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZVNjaGVtYU1lbnUoKSB7XHJcbiAgICB0aGlzLm1lbnVTaG93ID0gIXRoaXMubWVudVNob3c7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVJbmZvQ2hhbmdlZCgkZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICB0aGlzLmNvbnRyb2xJbmRleENoYW5nZWQgPSAkZXZlbnQ7XHJcbiAgICBpZiAodGhpcy5nZXRDb25kaXRpb25UYWJzKCkgJiYgdGhpcy5nZXRDb25kaXRpb25UYWJzKCkubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMuZ2V0Q29uZGl0aW9uVGFicygpLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgIGl0ZW0uY29udHJvbEluZGV4Q2hhbmdlZCA9ICRldmVudDtcclxuICAgICAgICBpdGVtLmNoYW5nZUNzcygpO1xyXG4gICAgICAgIGlmIChpdGVtLnRhYkluZGV4ID09PSAxICYmIHNlbGYuc2hvd0ZpbHRlckV4cHJlc3Npb24pIHtcclxuICAgICAgICAgIHNlbGYuYWR2YW5jZUZpbHRlclRhYiA9IGl0ZW07XHJcbiAgICAgICAgICBzZWxmLmdldFByb3BlcnR5TGlzdChpdGVtKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlU2NoZW1hU2VsZWN0ZWQoJGV2ZW50OiBhbnkpIHtcclxuICAgIHRoaXMuZGVmYXVsdFNjaGVtYU5hbWUgPSAkZXZlbnQuc2NoZW1hTmFtZTtcclxuICAgIHRoaXMubWVudVNob3cgPSAhdGhpcy5tZW51U2hvdztcclxuICAgIHRoaXMuY3VycmVudFNjaGVtYSA9ICRldmVudDtcclxuICAgIHRoaXMuSWQgPSB0aGlzLmN1cnJlbnRTY2hlbWEuaWQ7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVRdWVyeUNsaWNrKCkge1xyXG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5oYW5kbGVyR2V0RW50aXR5KCk7XHJcbiAgICB0aGlzLmJlZm9yZVF1ZXJ5KCkuc3Vic2NyaWJlKChyZXN1bHQpID0+IHtcclxuICAgICAgaWYgKHJlc3VsdCA9PSB0cnVlKSB7XHJcbiAgICAgICAgRXZlbnRCdXMuZGlzcGF0Y2goJ29wZW5BZHZhbmNlVGVtcGxhdGVEaWFsb2cnLCB7fSk7XHJcbiAgICAgICAgdGhpcy5jYWNoZVNlcnZpY2Uuc2V0KHRoaXMudGFiSWQsIHBhcmFtcyk7XHJcbiAgICAgICAgRXZlbnRCdXMuZGlzcGF0Y2godGhpcy50YWJJZCArICdhZHZhbmNlVGVtcGxhdGUtY29uZGl0aW9uLWRpYWxvZy1xdWVyeUV2ZW50JywgdGhpcy5xdWVyeUNvdW50KyspO1xyXG4gICAgICAgIHRoaXMucXVlcnlFdmVudC5lbWl0KHRoaXMucXVlcnlDb3VudCsrKTtcclxuICAgICAgICB0aGlzLmNsb3NlVHlwZSA9ICdxdWVyeSc7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVEaWFsb2dDbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGhhbmRsZVNhdmVDbGljaygpIHtcclxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG4gICAgY29uc3QgcGFyYW1zID0gdGhpcy5oYW5kbGVyR2V0RW50aXR5KCk7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50U2NoZW1hKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudFNjaGVtYS5zY2hlbWFWYWx1ZSA9IHBhcmFtcztcclxuICAgICAgY29uc3QgbmV3U2NoZW1hID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLmN1cnJlbnRTY2hlbWEpKTtcclxuICAgICAgaWYgKHRoaXMuYWR2YW5jZUZpbHRlclRhYiAmJiB0aGlzLmFkdmFuY2VGaWx0ZXJUYWIuZmlsdGVySW5zdGFuY2UpIHtcclxuICAgICAgICBpZiAoIW5ld1NjaGVtYS5zY2hlbWFWYWx1ZSkgeyBuZXdTY2hlbWEuc2NoZW1hVmFsdWUgPSB7fTsgfVxyXG4gICAgICAgIG5ld1NjaGVtYS5zY2hlbWFWYWx1ZVsnQGZpbHRlckV4cHJlc3Npb25TdHJpbmdAJ10gPSB0aGlzLmFkdmFuY2VGaWx0ZXJUYWIuZmlsdGVySW5zdGFuY2UuZ2V0RmlsdGVyRXhwcmVzc2lvbigpO1xyXG4gICAgICB9XHJcbiAgICAgIG5ld1NjaGVtYS5zY2hlbWFWYWx1ZSA9IG5ld1NjaGVtYS5zY2hlbWFWYWx1ZSA/IEpTT04uc3RyaW5naWZ5KG5ld1NjaGVtYS5zY2hlbWFWYWx1ZSkgOiBudWxsO1xyXG4gICAgICB0aGlzLmNvbmRpdGlvblNlcnZpY2Uuc2F2ZVNjaGVtYShuZXdTY2hlbWEpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmluZm8udGl0bGUnKSwgbXNnOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5zYXZlLnN1Y2Nlc3MnKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgIH0sIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbih0aGlzLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgnaWRlQ21wLnNjaGVtYU1hbmFnZXIubWVzc2FnZS52YWxpZGF0ZS5xZHBNb2RpZnlQdWJsaWNTY2hlbWEnKSwgZXJyb3IpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZXJHZXRFbnRpdHkoKSB7XHJcbiAgICBjb25zdCBlbnRpdHlzID0gdGhpcy5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKTtcclxuICAgIGxldCBwYXJhbXM7XHJcbiAgICBpZiAoZW50aXR5cyAmJiBlbnRpdHlzLmxlbmd0aCkge1xyXG4gICAgICBwYXJhbXMgPSBlbnRpdHlzWzBdLnRvSlNPTigpO1xyXG4gICAgICBpZiAodGhpcy5hZHZhbmNlRmlsdGVyVGFiICYmIHRoaXMuYWR2YW5jZUZpbHRlclRhYi5maWx0ZXJJbnN0YW5jZSkge1xyXG4gICAgICAgIGlmICghcGFyYW1zKSB7IHBhcmFtcyA9IHsgaWQ6ICd1bmRlZmluZWRfbnVsbCcgfTsgfVxyXG4gICAgICAgIHBhcmFtc1snQGZpbHRlckV4cHJlc3Npb25TdHJpbmdAJ10gPSB0aGlzLmFkdmFuY2VGaWx0ZXJUYWIuZmlsdGVySW5zdGFuY2UuZ2V0RmlsdGVyRXhwcmVzc2lvbigpO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZmlsdGVyRXhwcmVzc2lvblN0cmluZykge1xyXG4gICAgICAgIGlmICghcGFyYW1zKSB7IHBhcmFtcyA9IHsgaWQ6ICd1bmRlZmluZWRfbnVsbCcgfTsgfVxyXG4gICAgICAgIHBhcmFtc1snQGZpbHRlckV4cHJlc3Npb25TdHJpbmdAJ10gPSB0aGlzLmZpbHRlckV4cHJlc3Npb25TdHJpbmc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBwYXJhbXM7XHJcbiAgfVxyXG5cclxuICBiZWZvcmVPcGVuID0gKCkgPT4gdHJ1ZTtcclxuXHJcbiAgaGFuZGxlYmVmb3JlQ2xvc2UgPSAoKSA9PiB7XHJcbiAgICAvLyBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIC8vIGlmICh0aGlzLmNsb3NlVHlwZSAhPT0gJ3F1ZXJ5Jykge1xyXG4gICAgLy8gICBpZiAoc2VsZi5yZXBvc2l0b3J5LmVudGl0eUNvbGxlY3Rpb24uZ2V0QWxsRW50aXRpZXMoKSAmJiBzZWxmLnJlcG9zaXRvcnkuZW50aXR5Q29sbGVjdGlvbi5nZXRBbGxFbnRpdGllcygpWzBdKSB7XHJcbiAgICAvLyAgICAgY29uc3Qgb2JqID0ge1xyXG4gICAgLy8gICAgICAgaWQ6IHNlbGYucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKClbMF1bJ2lkJ11cclxuICAgIC8vICAgICB9O1xyXG4gICAgLy8gICAgIHNlbGYucmVwb3NpdG9yeS5lbnRpdHlDb2xsZWN0aW9uLmdldEFsbEVudGl0aWVzKClbMF0ubG9hZChvYmopO1xyXG4gICAgLy8gICAgIChzZWxmLnJlcG9zaXRvcnkgYXMgQmVmUmVwb3NpdG9yeTxFbnRpdHk+KS5lbnRpdHlNYW5hZ2VyLmNsZWFyQWxsRW50aXR5Q2hhbmdlcygpO1xyXG4gICAgLy8gICAgIGlmICh0aGlzLmFkdmFuY2VGaWx0ZXJUYWIpIHtcclxuICAgIC8vICAgICAgIHRoaXMuYWR2YW5jZUZpbHRlclRhYi5maWx0ZXJFeHByZXNzaW9uU3RyaW5nID0gJyc7XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gICB9XHJcbiAgICAvLyB9XHJcbiAgICAvLyB0aGlzLmNsb3NlVHlwZSA9ICcnO1xyXG4gICAgcmV0dXJuIG9mKHRydWUpO1xyXG4gIH1cclxufVxyXG4iXX0=
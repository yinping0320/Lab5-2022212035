/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, Injector, Input } from '@angular/core';
import { DialogComponent } from '@farris/ui-dialog';
import { LocalizeService } from '@qdp/localize';
import { ConditionSchemaService } from '@qdp/condition-schema';
import { MessagerService } from '@farris/ui-messager';
import { NotifyService } from '@farris/ui-notify';
import { Subject } from 'rxjs';
import { FormErrorService } from '@farris/command-services';
var ConditionManagerDialogComponent = /** @class */ (function () {
    function ConditionManagerDialogComponent(injector, msgService, conditionService, notifyService) {
        this.injector = injector;
        this.msgService = msgService;
        this.conditionService = conditionService;
        this.notifyService = notifyService;
        this.expandPublic = true;
        this.expandPersonal = true;
        this.publicList = [];
        this.personalList = [];
        this.removeList = [];
        this.motifyList = [];
        this.removeListEvent = new Subject();
        if (this.injector) {
            this.localizeService = this.injector.get(LocalizeService);
            this.formErrorService = this.injector.get(FormErrorService);
        }
    }
    /**
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.handleDialogShow = /**
     * @return {?}
     */
    function () {
        this.farrisDialog.show();
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.handleExpandType = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.expandPublic = $event === 0 ? !this.expandPublic : this.expandPublic;
        this.expandPersonal = $event === 1 ? !this.expandPersonal : this.expandPersonal;
    };
    /**
     * @param {?} change
     * @param {?} item
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.handleNgModelChange = /**
     * @param {?} change
     * @param {?} item
     * @return {?}
     */
    function (change, item) {
        item.isDefault = change ? 1 : 0;
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.handleDeleteSchame = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this.removeList.findIndex((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.id === $event.id; })) < 0) {
            this.removeList.push($event);
            this.motifyList.push({ type: 'delete', id: $event.id });
        }
        /** @type {?} */
        var index = $event.schemaType === 0
            ? this.publicList.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.id === $event.id; }))
            : this.personalList.findIndex((/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return item.id === $event.id; }));
        if ($event.schemaType === 0) {
            this.publicList.splice(index, 1);
        }
        else {
            this.personalList.splice(index, 1);
        }
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.handleSettingDefault = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        /** @type {?} */
        var self = this;
        this.publicList.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            item.isDefault = item.id === $event.id ? 1 : 0;
            if (item.id === $event.id) {
                self.motifyList.push({ type: 'edit', id: $event.id });
            }
        }));
        this.personalList.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            item.isDefault = item.id === $event.id ? 1 : 0;
            if (item.id === $event.id) {
                self.motifyList.push({ type: 'edit', id: $event.id });
            }
        }));
    };
    /**
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.handleOKClick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var self = this;
        if (this.motifyList.length) {
            /** @type {?} */
            var deleteSchemas_1 = [];
            /** @type {?} */
            var saveSchema_1;
            this.motifyList.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item.type === 'delete') {
                    deleteSchemas_1.push(item.id);
                }
                else {
                    saveSchema_1 = self.publicList.find((/**
                     * @param {?} el
                     * @return {?}
                     */
                    function (el) { return el.id === item.id; }));
                    if (!saveSchema_1 || !saveSchema_1.id) {
                        saveSchema_1 = self.personalList.find((/**
                         * @param {?} el
                         * @return {?}
                         */
                        function (el) { return el.id === item.id; }));
                    }
                }
            }));
            if (saveSchema_1 && saveSchema_1.schemaValue) {
                saveSchema_1.schemaValue = saveSchema_1 && saveSchema_1.schemaValue ? JSON.stringify(saveSchema_1.schemaValue) : null;
            }
            if (deleteSchemas_1.length && saveSchema_1 && saveSchema_1.id) {
                this.conditionService.deleteSchemaList(deleteSchemas_1.join(','), self.queryId).subscribe((/**
                 * @return {?}
                 */
                function () {
                    _this.conditionService.saveSchema(saveSchema_1).subscribe((/**
                     * @return {?}
                     */
                    function () {
                        self.clearChanges();
                        self.notifyService['success']((/** @type {?} */ ({
                            title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.success'), timeout: 3000
                        })));
                        self.farrisDialog.close();
                    }), (/**
                     * @param {?} error
                     * @return {?}
                     */
                    function (error) {
                        self.formErrorService.exception(error.Message, error);
                        // self.notifyService['success']({
                        //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                        // } as NotifyOptions);
                        self.farrisDialog.close();
                    }));
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    self.formErrorService.exception(error.Message, error);
                    // console.log(error);
                    // self.notifyService['success']({
                    //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                    // } as NotifyOptions);
                    self.farrisDialog.close();
                }));
            }
            else if (deleteSchemas_1.length) {
                this.conditionService.deleteSchemaList(deleteSchemas_1.join(','), self.queryId).subscribe((/**
                 * @return {?}
                 */
                function () {
                    self.clearChanges();
                    self.notifyService['success']((/** @type {?} */ ({
                        title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.success'), timeout: 3000
                    })));
                    self.farrisDialog.close();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    self.formErrorService.exception(error.Message, error);
                    // console.log(error);
                    // self.notifyService['success']({
                    //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                    // } as NotifyOptions);
                    self.farrisDialog.close();
                }));
            }
            else if (saveSchema_1 && saveSchema_1.id) {
                this.conditionService.saveSchema(saveSchema_1).subscribe((/**
                 * @return {?}
                 */
                function () {
                    self.clearChanges();
                    self.notifyService['success']((/** @type {?} */ ({
                        title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.success'), timeout: 3000
                    })));
                    self.farrisDialog.close();
                }), (/**
                 * @param {?} error
                 * @return {?}
                 */
                function (error) {
                    self.formErrorService.exception(error.Message, error);
                    // console.log(error);
                    // self.notifyService['success']({
                    //   title: self.localizeService.getValue('queryFramework.message.info.title'), msg: self.localizeService.getValue('queryFramework.message.operate.error'), timeout: 3000
                    // } as NotifyOptions);
                    self.farrisDialog.close();
                }));
            }
        }
    };
    /**
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.clearChanges = /**
     * @return {?}
     */
    function () {
        this.motifyList = [];
        this.removeList = [];
    };
    /**
     * @return {?}
     */
    ConditionManagerDialogComponent.prototype.handleCancelClick = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var self = this;
        if (this.motifyList.length) {
            this.motifyList.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item.type === 'delete') {
                    /** @type {?} */
                    var result = self.removeList.find((/**
                     * @param {?} el
                     * @return {?}
                     */
                    function (el) { return el.id === item.id; }));
                    if (result.schemaType === 0) {
                        self.publicList.push(item);
                    }
                    else {
                        self.personalList.push(item);
                    }
                }
                else {
                    _this.publicList.forEach((/**
                     * @param {?} el
                     * @return {?}
                     */
                    function (el) {
                        el.isDefault = el.id === item.id ? 1 : 0;
                    }));
                    _this.personalList.forEach((/**
                     * @param {?} el1
                     * @return {?}
                     */
                    function (el1) {
                        el1.isDefault = el1.id === item.id ? 1 : 0;
                    }));
                }
            }));
            this.removeList = [];
            this.motifyList = [];
        }
        this.farrisDialog.close();
    };
    ConditionManagerDialogComponent.decorators = [
        { type: Component, args: [{
                    selector: 'condition-manager-dialog',
                    template: "<farris-dialog #farrisDialog [title]=\"localizeService.getValue('queryFramework.dialogTitle1')\" [showButtons]=\"false\"\r\n  [width]=\"550\" [showMaxButton]=\"false\" [showMinButton]=\"false\" [showCloseButton]=\"false\" [resizable]=\"false\" [height]=\"570\">\r\n  <div class=\"f-utils-absolute-all f-utils-flex-column bg-white\">\r\n    <div class=\"f-utils-fill-auto\">\r\n      <div class=\"f-utils-flex-row-wrap m-2 item-header-row\" style=\"height: 40px\">\r\n        <div class=\"col-4 pt-1 item-header-col-font item-header-col1\">\r\n          {{localizeService.getValue('queryFramework.conditionManagerListColumn')[0]}}\r\n        </div>\r\n        <div class=\"col-4 pt-1 item-header-col-font item-header-col2\">\r\n          {{localizeService.getValue('queryFramework.conditionManagerListColumn')[1]}}\r\n        </div>\r\n        <div class=\"col-4 pt-1 item-header-col-font item-header-col3\">\r\n          {{localizeService.getValue('queryFramework.conditionManagerListColumn')[2]}}\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-flex-row-wrap m-2\" (click)=\"handleExpandType(0)\">\r\n        <span *ngIf=\"expandPublic\" class=\"f-icon f-icon-minus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <span *ngIf=\"!expandPublic\" class=\"f-icon f-icon-plus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <div class=\"item-schema-type\">{{localizeService.getValue('queryFramework.schemaType.public')}}</div>\r\n      </div>\r\n      <div [class]=\"expandPublic ? 'f-utils-flex-column item-list-block' : 'f-utils-flex-column item-list-none'\">\r\n        <div *ngFor=\"let item of publicList\" [class]=\"currentSchema && currentSchema.id  && currentSchema.id === item.id ? 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row item-row-hover' : 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row'\">\r\n          <div [class]=\"item.isProtected === 1 ? 'col-4 item-data-font item-data-col1' : 'col-4 item-data-font-disable item-data-col1'\">\r\n            {{item.schemaName}}\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col2\">\r\n            <div class=\"custom-control custom-checkbox mb-0 ml-4\">\r\n              <input type=\"checkbox\" class=\"custom-control-input\" [ngModel]=\"item.isDefault === 1 ? true : false\" (ngModelChange)=\"handleNgModelChange($event, item)\" (click)=\"handleSettingDefault(item)\" [disabled]=\"item.isProtected === 1\" id=\"{{item.id}}\" checked=\"\">\r\n              <label class=\"custom-control-label\" for=\"{{item.id}}\"></label>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col3\">\r\n            <button class=\"btn btn-link p-1 mr-1\" id=\"button-delete\" [disabled]=\"item.isProtected === 1\" (click)=\"handleDeleteSchame(item)\">\r\n              <span class=\"f-icon f-icon-delete item-delete\"></span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"f-utils-flex-row-wrap m-2\" (click)=\"handleExpandType(1)\">\r\n        <span *ngIf=\"expandPersonal\" class=\"f-icon f-icon-minus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <span *ngIf=\"!expandPersonal\" class=\"f-icon f-icon-plus-outline ml-3 mr-2\" style=\"color: #B9C3C9;\"></span>\r\n        <div class=\"item-schema-type\">{{localizeService.getValue('queryFramework.schemaType.personal')}}</div>\r\n      </div>\r\n      <div [class]=\"expandPersonal ? 'f-utils-flex-column item-list-block' : 'f-utils-flex-column item-list-none'\">\r\n        <div *ngFor=\"let item1 of personalList\" [class]=\"currentSchema && currentSchema.id && currentSchema.id === item1.id ? 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row item-row-hover' : 'f-utils-flex-row-wrap ml-0 mr-0 mt-1 mb-1 item-row'\">\r\n          <div [class]=\"item1.isProtected === 1 ? 'col-4 item-data-font item-data-col1' : 'col-4 item-data-font-disable item-data-col1'\">\r\n            {{item1.schemaName}}\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col2\">\r\n            <div class=\"custom-control custom-checkbox mb-0 ml-4\">\r\n              <input type=\"checkbox\" class=\"custom-control-input\" [ngModel]=\"item1.isDefault === 1 ? true : false\" (ngModelChange)=\"handleNgModelChange($event, item1)\" (click)=\"handleSettingDefault(item1)\" [disabled]=\"item1.isProtected === 1\"\r\n                id=\"{{item1.id}}\" checked=\"\">\r\n              <label class=\"custom-control-label\" for=\"{{item1.id}}\"></label>\r\n            </div>\r\n          </div>\r\n          <div class=\"col-4 item-data-font item-data-col3\">\r\n            <button class=\"btn btn-link p-1 mr-1\" id=\"button-delete\" [disabled]=\"item1.isProtected === 1\" (click)=\"handleDeleteSchame(item1)\">\r\n              <span class=\"f-icon f-icon-delete item-delete\"></span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n      <div class=\"btn-toolbar btn-group-lg\" id=\"page-header-toolbar\">\r\n        <button class=\"btn btn-primary mr-1\" id=\"button-edit\" (click)=\"handleOKClick()\">\r\n          {{localizeService.getValue('queryFramework.btnOk')}}</button>\r\n        <button class=\"btn btn-secondary mr-1\" id=\"button-edit\" (click)=\"handleCancelClick()\">\r\n          {{localizeService.getValue('queryFramework.btnCancel')}}</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</farris-dialog>\r\n",
                    styles: [".item-header-row{border-bottom:1px solid #e2e8f0}.item-row{height:40px}.item-header-col-font{font-family:PingFangSC-Regular;font-size:14px;color:#000}.item-header-col1{text-align:left}.item-header-col2{text-align:center}.item-header-col3{text-align:right}.item-schema-type{font-family:PingFangSC-Regular;font-size:14px;color:#000;line-height:20px;display:block;top:-2px;position:relative}.item-row-current{background:#ddf4ff;border-left:3px solid #388fff!important}.item-data-font-disable{font-family:PingFangSC-Regular;font-size:14px;color:rgba(166,166,166,.8);line-height:20px;position:relative;top:-2px;padding-top:.75rem!important}.item-data-font{font-family:PingFangSC-Regular;font-size:14px;color:rgba(0,0,0,.8);line-height:20px;position:relative;top:-2px;padding-top:.75rem!important}.item-data-col1,.item-data-col2{text-align:center}.item-data-col3{text-align:right;padding-right:1.25rem!important}.item-row-hover,.item-row:hover{background:#ddf4ff;border-left:3px solid #388fff!important}.item-list-block{display:block!important}.item-list-none{display:none!important}.item-delete{position:relative;top:-3px}"]
                }] }
    ];
    /** @nocollapse */
    ConditionManagerDialogComponent.ctorParameters = function () { return [
        { type: Injector },
        { type: MessagerService },
        { type: ConditionSchemaService },
        { type: NotifyService }
    ]; };
    ConditionManagerDialogComponent.propDecorators = {
        farrisDialog: [{ type: ViewChild, args: ['farrisDialog',] }],
        currentSchema: [{ type: Input }],
        queryId: [{ type: Input }],
        publicList: [{ type: Input }],
        personalList: [{ type: Input }]
    };
    return ConditionManagerDialogComponent;
}());
export { ConditionManagerDialogComponent };
if (false) {
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.farrisDialog;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.currentSchema;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.localizeService;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.expandPublic;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.expandPersonal;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.queryId;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.publicList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.personalList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.removeList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.motifyList;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.removeListEvent;
    /** @type {?} */
    ConditionManagerDialogComponent.prototype.formErrorService;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.injector;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.msgService;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.conditionService;
    /**
     * @type {?}
     * @private
     */
    ConditionManagerDialogComponent.prototype.notifyService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZGl0aW9uLW1hbmFnZXItZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BxZHAvcXVlcnktZnJhbWV3b3JrLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudC9jb25kaXRpb24tbWFuYWdlci1kaWFsb2cvY29uZGl0aW9uLW1hbmFnZXItZGlhbG9nLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFDeEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEQsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDL0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxhQUFhLEVBQWlCLE1BQU0sbUJBQW1CLENBQUM7QUFDakUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUU1RDtJQW1CRSx5Q0FDVSxRQUFrQixFQUNsQixVQUEyQixFQUMzQixnQkFBd0MsRUFDeEMsYUFBNEI7UUFINUIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNsQixlQUFVLEdBQVYsVUFBVSxDQUFpQjtRQUMzQixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQXdCO1FBQ3hDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBZHRDLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBRWIsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNoQixpQkFBWSxHQUFHLEVBQUUsQ0FBQztRQUMzQixlQUFVLEdBQUcsRUFBRSxDQUFDO1FB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QUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDN0MsQ0FBQyxFQUFDLENBQUM7aUJBQ0o7WUFDSCxDQUFDLEVBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1NBQ3RCO1FBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUM1QixDQUFDOztnQkF6TEYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSwwQkFBMEI7b0JBQ3BDLHc1S0FBd0Q7O2lCQUV6RDs7OztnQkFic0MsUUFBUTtnQkFJdEMsZUFBZTtnQkFEZixzQkFBc0I7Z0JBRXRCLGFBQWE7OzsrQkFVbkIsU0FBUyxTQUFDLGNBQWM7Z0NBQ3hCLEtBQUs7MEJBSUwsS0FBSzs2QkFDTCxLQUFLOytCQUNMLEtBQUs7O0lBNktSLHNDQUFDO0NBQUEsQUExTEQsSUEwTEM7U0FyTFksK0JBQStCOzs7SUFDMUMsdURBQXlEOztJQUN6RCx3REFBNEI7O0lBQzVCLDBEQUFxQjs7SUFDckIsdURBQW9COztJQUNwQix5REFBc0I7O0lBQ3RCLGtEQUFzQjs7SUFDdEIscURBQXlCOztJQUN6Qix1REFBMkI7O0lBQzNCLHFEQUFnQjs7SUFDaEIscURBQWdCOztJQUNoQiwwREFBcUM7O0lBQ3JDLDJEQUFzQjs7Ozs7SUFHcEIsbURBQTBCOzs7OztJQUMxQixxREFBbUM7Ozs7O0lBQ25DLDJEQUFnRDs7Ozs7SUFDaEQsd0RBQW9DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIFZpZXdDaGlsZCwgSW5qZWN0b3IsIElucHV0LCBTaW1wbGVDaGFuZ2VzLCBPbkNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnQGZhcnJpcy91aS1kaWFsb2cnO1xyXG5pbXBvcnQgeyBMb2NhbGl6ZVNlcnZpY2UgfSBmcm9tICdAcWRwL2xvY2FsaXplJztcclxuaW1wb3J0IHsgQ29uZGl0aW9uU2NoZW1hU2VydmljZSB9IGZyb20gJ0BxZHAvY29uZGl0aW9uLXNjaGVtYSc7XHJcbmltcG9ydCB7IE1lc3NhZ2VyU2VydmljZSB9IGZyb20gJ0BmYXJyaXMvdWktbWVzc2FnZXInO1xyXG5pbXBvcnQgeyBOb3RpZnlTZXJ2aWNlLCBOb3RpZnlPcHRpb25zIH0gZnJvbSAnQGZhcnJpcy91aS1ub3RpZnknO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IEZvcm1FcnJvclNlcnZpY2UgfSBmcm9tICdAZmFycmlzL2NvbW1hbmQtc2VydmljZXMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdjb25kaXRpb24tbWFuYWdlci1kaWFsb2cnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25kaXRpb24tbWFuYWdlci1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2NvbmRpdGlvbi1tYW5hZ2VyLWRpYWxvZy5jb21wb25lbnQuY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIENvbmRpdGlvbk1hbmFnZXJEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XHJcbiAgQFZpZXdDaGlsZCgnZmFycmlzRGlhbG9nJykgZmFycmlzRGlhbG9nOiBEaWFsb2dDb21wb25lbnQ7XHJcbiAgQElucHV0KCkgY3VycmVudFNjaGVtYTogYW55O1xyXG4gIGxvY2FsaXplU2VydmljZTogYW55O1xyXG4gIGV4cGFuZFB1YmxpYyA9IHRydWU7XHJcbiAgZXhwYW5kUGVyc29uYWwgPSB0cnVlO1xyXG4gIEBJbnB1dCgpIHF1ZXJ5SWQ6IGFueTtcclxuICBASW5wdXQoKSBwdWJsaWNMaXN0ID0gW107XHJcbiAgQElucHV0KCkgcGVyc29uYWxMaXN0ID0gW107XHJcbiAgcmVtb3ZlTGlzdCA9IFtdO1xyXG4gIG1vdGlmeUxpc3QgPSBbXTtcclxuICByZW1vdmVMaXN0RXZlbnQgPSBuZXcgU3ViamVjdDxhbnk+KCk7XHJcbiAgZm9ybUVycm9yU2VydmljZTogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLFxyXG4gICAgcHJpdmF0ZSBtc2dTZXJ2aWNlOiBNZXNzYWdlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGNvbmRpdGlvblNlcnZpY2U6IENvbmRpdGlvblNjaGVtYVNlcnZpY2UsXHJcbiAgICBwcml2YXRlIG5vdGlmeVNlcnZpY2U6IE5vdGlmeVNlcnZpY2VcclxuICApIHtcclxuICAgIGlmICh0aGlzLmluamVjdG9yKSB7XHJcbiAgICAgIHRoaXMubG9jYWxpemVTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoTG9jYWxpemVTZXJ2aWNlKTtcclxuICAgICAgdGhpcy5mb3JtRXJyb3JTZXJ2aWNlID0gdGhpcy5pbmplY3Rvci5nZXQoRm9ybUVycm9yU2VydmljZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICB9XHJcblxyXG4gIGhhbmRsZURpYWxvZ1Nob3coKSB7XHJcbiAgICB0aGlzLmZhcnJpc0RpYWxvZy5zaG93KCk7XHJcbiAgfVxyXG5cclxuICBoYW5kbGVFeHBhbmRUeXBlKCRldmVudDogYW55KSB7XHJcbiAgICB0aGlzLmV4cGFuZFB1YmxpYyA9ICRldmVudCA9PT0gMCA/ICF0aGlzLmV4cGFuZFB1YmxpYyA6IHRoaXMuZXhwYW5kUHVibGljO1xyXG4gICAgdGhpcy5leHBhbmRQZXJzb25hbCA9ICRldmVudCA9PT0gMSA/ICF0aGlzLmV4cGFuZFBlcnNvbmFsIDogdGhpcy5leHBhbmRQZXJzb25hbDtcclxuICB9XHJcblxyXG4gIGhhbmRsZU5nTW9kZWxDaGFuZ2UoY2hhbmdlOiBhbnksIGl0ZW06IGFueSkge1xyXG4gICAgaXRlbS5pc0RlZmF1bHQgPSBjaGFuZ2UgPyAxIDogMDtcclxuICB9XHJcblxyXG4gIGhhbmRsZURlbGV0ZVNjaGFtZSgkZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKHRoaXMucmVtb3ZlTGlzdC5maW5kSW5kZXgoKGl0ZW06IGFueSkgPT4gaXRlbS5pZCA9PT0gJGV2ZW50LmlkKSA8IDApIHtcclxuICAgICAgdGhpcy5yZW1vdmVMaXN0LnB1c2goJGV2ZW50KTtcclxuICAgICAgdGhpcy5tb3RpZnlMaXN0LnB1c2goeyB0eXBlOiAnZGVsZXRlJywgaWQ6ICRldmVudC5pZCB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IGluZGV4ID0gJGV2ZW50LnNjaGVtYVR5cGUgPT09IDBcclxuICAgICAgPyB0aGlzLnB1YmxpY0xpc3QuZmluZEluZGV4KChpdGVtOiBhbnkpID0+IGl0ZW0uaWQgPT09ICRldmVudC5pZClcclxuICAgICAgOiB0aGlzLnBlcnNvbmFsTGlzdC5maW5kSW5kZXgoKGl0ZW06IGFueSkgPT4gaXRlbS5pZCA9PT0gJGV2ZW50LmlkKTtcclxuICAgIGlmICgkZXZlbnQuc2NoZW1hVHlwZSA9PT0gMCkge1xyXG4gICAgICB0aGlzLnB1YmxpY0xpc3Quc3BsaWNlKGluZGV4LCAxKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucGVyc29uYWxMaXN0LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVTZXR0aW5nRGVmYXVsdCgkZXZlbnQ6IGFueSkge1xyXG4gICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcbiAgICB0aGlzLnB1YmxpY0xpc3QuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgIGl0ZW0uaXNEZWZhdWx0ID0gaXRlbS5pZCA9PT0gJGV2ZW50LmlkID8gMSA6IDA7XHJcbiAgICAgIGlmIChpdGVtLmlkID09PSAkZXZlbnQuaWQpIHtcclxuICAgICAgICBzZWxmLm1vdGlmeUxpc3QucHVzaCh7IHR5cGU6ICdlZGl0JywgaWQ6ICRldmVudC5pZCB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLnBlcnNvbmFsTGlzdC5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgaXRlbS5pc0RlZmF1bHQgPSBpdGVtLmlkID09PSAkZXZlbnQuaWQgPyAxIDogMDtcclxuICAgICAgaWYgKGl0ZW0uaWQgPT09ICRldmVudC5pZCkge1xyXG4gICAgICAgIHNlbGYubW90aWZ5TGlzdC5wdXNoKHsgdHlwZTogJ2VkaXQnLCBpZDogJGV2ZW50LmlkIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGhhbmRsZU9LQ2xpY2soKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGlmICh0aGlzLm1vdGlmeUxpc3QubGVuZ3RoKSB7XHJcbiAgICAgIGNvbnN0IGRlbGV0ZVNjaGVtYXMgPSBbXTtcclxuICAgICAgbGV0IHNhdmVTY2hlbWE6IGFueTtcclxuICAgICAgdGhpcy5tb3RpZnlMaXN0LmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChpdGVtLnR5cGUgPT09ICdkZWxldGUnKSB7XHJcbiAgICAgICAgICBkZWxldGVTY2hlbWFzLnB1c2goaXRlbS5pZCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHNhdmVTY2hlbWEgPSBzZWxmLnB1YmxpY0xpc3QuZmluZCgoZWw6IGFueSkgPT4gZWwuaWQgPT09IGl0ZW0uaWQpO1xyXG4gICAgICAgICAgaWYgKCFzYXZlU2NoZW1hIHx8ICFzYXZlU2NoZW1hLmlkKSB7XHJcbiAgICAgICAgICAgIHNhdmVTY2hlbWEgPSBzZWxmLnBlcnNvbmFsTGlzdC5maW5kKChlbDogYW55KSA9PiBlbC5pZCA9PT0gaXRlbS5pZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgaWYgKHNhdmVTY2hlbWEgJiYgc2F2ZVNjaGVtYS5zY2hlbWFWYWx1ZSkge1xyXG4gICAgICAgIHNhdmVTY2hlbWEuc2NoZW1hVmFsdWUgPSBzYXZlU2NoZW1hICYmIHNhdmVTY2hlbWEuc2NoZW1hVmFsdWUgPyBKU09OLnN0cmluZ2lmeShzYXZlU2NoZW1hLnNjaGVtYVZhbHVlKSA6IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGRlbGV0ZVNjaGVtYXMubGVuZ3RoICYmIHNhdmVTY2hlbWEgJiYgc2F2ZVNjaGVtYS5pZCkge1xyXG4gICAgICAgIHRoaXMuY29uZGl0aW9uU2VydmljZS5kZWxldGVTY2hlbWFMaXN0KGRlbGV0ZVNjaGVtYXMuam9pbignLCcpLCBzZWxmLnF1ZXJ5SWQpLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmNvbmRpdGlvblNlcnZpY2Uuc2F2ZVNjaGVtYShzYXZlU2NoZW1hKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmNsZWFyQ2hhbmdlcygpO1xyXG4gICAgICAgICAgICBzZWxmLm5vdGlmeVNlcnZpY2VbJ3N1Y2Nlc3MnXSh7XHJcbiAgICAgICAgICAgICAgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmluZm8udGl0bGUnKSwgbXNnOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5vcGVyYXRlLnN1Y2Nlc3MnKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgICB9IGFzIE5vdGlmeU9wdGlvbnMpO1xyXG4gICAgICAgICAgICBzZWxmLmZhcnJpc0RpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgc2VsZi5mb3JtRXJyb3JTZXJ2aWNlLmV4Y2VwdGlvbihlcnJvci5NZXNzYWdlLCBlcnJvcik7XHJcbiAgICAgICAgICAgIC8vIHNlbGYubm90aWZ5U2VydmljZVsnc3VjY2VzcyddKHtcclxuICAgICAgICAgICAgLy8gICB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2UuaW5mby50aXRsZScpLCBtc2c6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLm9wZXJhdGUuZXJyb3InKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgICAvLyB9IGFzIE5vdGlmeU9wdGlvbnMpO1xyXG4gICAgICAgICAgICBzZWxmLmZhcnJpc0RpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgIHNlbGYuZm9ybUVycm9yU2VydmljZS5leGNlcHRpb24oZXJyb3IuTWVzc2FnZSwgZXJyb3IpO1xyXG4gICAgICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgLy8gc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgLy8gICB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2UuaW5mby50aXRsZScpLCBtc2c6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLm9wZXJhdGUuZXJyb3InKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgLy8gfSBhcyBOb3RpZnlPcHRpb25zKTtcclxuICAgICAgICAgIHNlbGYuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZGVsZXRlU2NoZW1hcy5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLmNvbmRpdGlvblNlcnZpY2UuZGVsZXRlU2NoZW1hTGlzdChkZWxldGVTY2hlbWFzLmpvaW4oJywnKSwgc2VsZi5xdWVyeUlkKS5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgc2VsZi5jbGVhckNoYW5nZXMoKTtcclxuICAgICAgICAgIHNlbGYubm90aWZ5U2VydmljZVsnc3VjY2VzcyddKHtcclxuICAgICAgICAgICAgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmluZm8udGl0bGUnKSwgbXNnOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5vcGVyYXRlLnN1Y2Nlc3MnKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgfSBhcyBOb3RpZnlPcHRpb25zKTtcclxuICAgICAgICAgIHNlbGYuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSwgKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgIHNlbGYuZm9ybUVycm9yU2VydmljZS5leGNlcHRpb24oZXJyb3IuTWVzc2FnZSwgZXJyb3IpO1xyXG4gICAgICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgLy8gc2VsZi5ub3RpZnlTZXJ2aWNlWydzdWNjZXNzJ10oe1xyXG4gICAgICAgICAgLy8gICB0aXRsZTogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2UuaW5mby50aXRsZScpLCBtc2c6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLm9wZXJhdGUuZXJyb3InKSwgdGltZW91dDogMzAwMFxyXG4gICAgICAgICAgLy8gfSBhcyBOb3RpZnlPcHRpb25zKTtcclxuICAgICAgICAgIHNlbGYuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoc2F2ZVNjaGVtYSAmJiBzYXZlU2NoZW1hLmlkKSB7XHJcbiAgICAgICAgdGhpcy5jb25kaXRpb25TZXJ2aWNlLnNhdmVTY2hlbWEoc2F2ZVNjaGVtYSkuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgIHNlbGYuY2xlYXJDaGFuZ2VzKCk7XHJcbiAgICAgICAgICBzZWxmLm5vdGlmeVNlcnZpY2VbJ3N1Y2Nlc3MnXSh7XHJcbiAgICAgICAgICAgIHRpdGxlOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5pbmZvLnRpdGxlJyksIG1zZzogc2VsZi5sb2NhbGl6ZVNlcnZpY2UuZ2V0VmFsdWUoJ3F1ZXJ5RnJhbWV3b3JrLm1lc3NhZ2Uub3BlcmF0ZS5zdWNjZXNzJyksIHRpbWVvdXQ6IDMwMDBcclxuICAgICAgICAgIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgICBzZWxmLmZhcnJpc0RpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIH0sIChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICBzZWxmLmZvcm1FcnJvclNlcnZpY2UuZXhjZXB0aW9uKGVycm9yLk1lc3NhZ2UsIGVycm9yKTtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgIC8vIHNlbGYubm90aWZ5U2VydmljZVsnc3VjY2VzcyddKHtcclxuICAgICAgICAgIC8vICAgdGl0bGU6IHNlbGYubG9jYWxpemVTZXJ2aWNlLmdldFZhbHVlKCdxdWVyeUZyYW1ld29yay5tZXNzYWdlLmluZm8udGl0bGUnKSwgbXNnOiBzZWxmLmxvY2FsaXplU2VydmljZS5nZXRWYWx1ZSgncXVlcnlGcmFtZXdvcmsubWVzc2FnZS5vcGVyYXRlLmVycm9yJyksIHRpbWVvdXQ6IDMwMDBcclxuICAgICAgICAgIC8vIH0gYXMgTm90aWZ5T3B0aW9ucyk7XHJcbiAgICAgICAgICBzZWxmLmZhcnJpc0RpYWxvZy5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjbGVhckNoYW5nZXMoKSB7XHJcbiAgICB0aGlzLm1vdGlmeUxpc3QgPSBbXTtcclxuICAgIHRoaXMucmVtb3ZlTGlzdCA9IFtdO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlQ2FuY2VsQ2xpY2soKSB7XHJcbiAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgIGlmICh0aGlzLm1vdGlmeUxpc3QubGVuZ3RoKSB7XHJcbiAgICAgIHRoaXMubW90aWZ5TGlzdC5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoaXRlbS50eXBlID09PSAnZGVsZXRlJykge1xyXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VsZi5yZW1vdmVMaXN0LmZpbmQoKGVsOiBhbnkpID0+IGVsLmlkID09PSBpdGVtLmlkKTtcclxuICAgICAgICAgIGlmIChyZXN1bHQuc2NoZW1hVHlwZSA9PT0gMCkge1xyXG4gICAgICAgICAgICBzZWxmLnB1YmxpY0xpc3QucHVzaChpdGVtKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbGYucGVyc29uYWxMaXN0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMucHVibGljTGlzdC5mb3JFYWNoKChlbDogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGVsLmlzRGVmYXVsdCA9IGVsLmlkID09PSBpdGVtLmlkID8gMSA6IDA7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHRoaXMucGVyc29uYWxMaXN0LmZvckVhY2goKGVsMTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGVsMS5pc0RlZmF1bHQgPSBlbDEuaWQgPT09IGl0ZW0uaWQgPyAxIDogMDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMucmVtb3ZlTGlzdCA9IFtdO1xyXG4gICAgICB0aGlzLm1vdGlmeUxpc3QgPSBbXTtcclxuICAgIH1cclxuICAgIHRoaXMuZmFycmlzRGlhbG9nLmNsb3NlKCk7XHJcbiAgfVxyXG59XHJcbiJdfQ==